import { BreakpointObserver, Breakpoints, } from '@angular/cdk/layout';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, ViewChild, } from '@angular/core';
import { Subscription } from 'rxjs';
import { IiifManifestService } from '../../core/iiif-manifest-service/iiif-manifest-service';
import { ViewingDirection } from '../../core/models/viewing-direction';
import { CanvasService } from './../../core/canvas-service/canvas-service';
import { MimeViewerIntl } from './../../core/intl';
import { ViewerService } from './../../core/viewer-service/viewer.service';
import { ModeService } from './../../core/mode-service/mode.service';
import { easeInWithDelay, rotate45 } from './../../shared/animations';
import * as i0 from "@angular/core";
import * as i1 from "./../../core/intl";
import * as i2 from "@angular/cdk/layout";
import * as i3 from "./../../core/viewer-service/viewer.service";
import * as i4 from "./../../core/canvas-service/canvas-service";
import * as i5 from "../../core/iiif-manifest-service/iiif-manifest-service";
import * as i6 from "./../../core/mode-service/mode.service";
import * as i7 from "@angular/material/button";
import * as i8 from "@angular/material/icon";
import * as i9 from "@angular/material/tooltip";
export class OsdToolbarComponent {
    constructor(intl, breakpointObserver, changeDetectorRef, viewerService, canvasService, iiifManifestService, modeService) {
        this.intl = intl;
        this.breakpointObserver = breakpointObserver;
        this.changeDetectorRef = changeDetectorRef;
        this.viewerService = viewerService;
        this.canvasService = canvasService;
        this.iiifManifestService = iiifManifestService;
        this.modeService = modeService;
        this.numberOfCanvasGroups = 0;
        this.isFirstCanvasGroup = false;
        this.isLastCanvasGroup = false;
        this.invert = false;
        this.isWeb = false;
        this.fabState = 'closed';
        this.fabIcon = 'menu';
        this.showControlButtons = false;
        this.baseAnimationDelay = 20;
        this.isZoomed = true;
        this.subscriptions = new Subscription();
    }
    ngOnInit() {
        this.subscriptions.add(this.modeService.onChange.subscribe(() => {
            this.isZoomed = this.modeService.isPageZoomed();
            this.changeDetectorRef.detectChanges();
        }));
        this.subscriptions.add(this.breakpointObserver
            .observe([Breakpoints.Web])
            .subscribe((value) => {
            this.isWeb = value.matches;
            this.changeDetectorRef.detectChanges();
        }));
        this.subscriptions.add(this.iiifManifestService.currentManifest.subscribe((manifest) => {
            if (manifest) {
                this.invert = manifest.viewingDirection === ViewingDirection.LTR;
                this.changeDetectorRef.detectChanges();
            }
        }));
        this.subscriptions.add(this.viewerService.onCanvasGroupIndexChange.subscribe((currentCanvasGroupIndex) => {
            this.numberOfCanvasGroups = this.canvasService.numberOfCanvasGroups;
            this.isFirstCanvasGroup = this.isOnFirstCanvasGroup(currentCanvasGroupIndex);
            this.isLastCanvasGroup = this.isOnLastCanvasGroup(currentCanvasGroupIndex);
            this.changeDetectorRef.detectChanges();
        }));
        this.subscriptions.add(this.intl.changes.subscribe(() => this.changeDetectorRef.markForCheck()));
    }
    toggleFab() {
        this.showControlButtons = !this.showControlButtons;
        this.fabState = this.fabState === 'closed' ? 'open' : 'closed';
        this.fabIcon = this.fabState === 'closed' ? 'menu' : 'clear';
    }
    zoomIn() {
        this.viewerService.zoomIn();
    }
    zoomOut() {
        this.viewerService.zoomOut();
    }
    home() {
        this.viewerService.home();
    }
    rotate() {
        this.viewerService.rotate();
    }
    ngOnDestroy() {
        this.subscriptions.unsubscribe();
    }
    goToPreviousCanvasGroup() {
        this.viewerService.goToPreviousCanvasGroup();
    }
    goToNextCanvasGroup() {
        this.viewerService.goToNextCanvasGroup();
    }
    isOnFirstCanvasGroup(currentCanvasGroupIndex) {
        return currentCanvasGroupIndex === 0;
    }
    isOnLastCanvasGroup(currentCanvasGroupIndex) {
        return currentCanvasGroupIndex === this.numberOfCanvasGroups - 1;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.9", ngImport: i0, type: OsdToolbarComponent, deps: [{ token: i1.MimeViewerIntl }, { token: i2.BreakpointObserver }, { token: i0.ChangeDetectorRef }, { token: i3.ViewerService }, { token: i4.CanvasService }, { token: i5.IiifManifestService }, { token: i6.ModeService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.9", type: OsdToolbarComponent, selector: "mime-osd-toolbar", viewQueries: [{ propertyName: "container", first: true, predicate: ["container"], descendants: true, static: true }], ngImport: i0, template: "<div #container class=\"osd-toolbar\">\n  @if (isWeb) {\n    <div class=\"flex gap-2\">\n      <div class=\"flex flex-col gap-2\">\n        <button\n          mat-fab\n          aria-controls=\"osdControls\"\n          data-testid=\"fabButton\"\n          [attr.aria-expanded]=\"fabState === 'open'\"\n          [attr.aria-label]=\"\n            fabState === 'open'\n              ? intl.closeOsdControlPanelLabel\n              : intl.openOsdControlPanelLabel\n          \"\n          [matTooltip]=\"\n            fabState === 'open'\n              ? intl.closeOsdControlPanelLabel\n              : intl.openOsdControlPanelLabel\n          \"\n          (click)=\"toggleFab()\"\n        >\n          <mat-icon [@rotate45]=\"fabState\">{{ fabIcon }}</mat-icon>\n        </button>\n      </div>\n      <div id=\"osdControls\" class=\"flex items-center gap-2\">\n        @if (invert) {\n          @if (showControlButtons) {\n            <button\n              data-testid=\"navigateBeforeButton\"\n              mat-mini-fab\n              [attr.aria-label]=\"intl.previousPageLabel\"\n              [matTooltip]=\"intl.previousPageLabel\"\n              [disabled]=\"isFirstCanvasGroup\"\n              [@easeInWithDelay]=\"{\n                value: '',\n                params: { delayEnter: 0, delayLeave: baseAnimationDelay * 5 }\n              }\"\n              (click)=\"goToPreviousCanvasGroup()\"\n            >\n              <mat-icon>navigate_before</mat-icon>\n            </button>\n          }\n        } @else {\n          @if (showControlButtons) {\n            <button\n              data-testid=\"navigateNextButton\"\n              mat-mini-fab\n              [attr.aria-label]=\"intl.nextPageLabel\"\n              [matTooltip]=\"intl.nextPageLabel\"\n              [disabled]=\"isLastCanvasGroup\"\n              [@easeInWithDelay]=\"{\n                value: '',\n                params: { delayEnter: 0, delayLeave: baseAnimationDelay * 5 }\n              }\"\n              (click)=\"goToNextCanvasGroup()\"\n            >\n              <mat-icon>navigate_before</mat-icon>\n            </button>\n          }\n        }\n        @if (invert) {\n          @if (showControlButtons) {\n            <button\n              data-testid=\"navigateNextButton\"\n              mat-mini-fab\n              [attr.aria-label]=\"intl.nextPageLabel\"\n              [matTooltip]=\"intl.nextPageLabel\"\n              [disabled]=\"isLastCanvasGroup\"\n              [@easeInWithDelay]=\"{\n                value: '',\n                params: {\n                  delayEnter: baseAnimationDelay,\n                  delayLeave: baseAnimationDelay * 4\n                }\n              }\"\n              (click)=\"goToNextCanvasGroup()\"\n            >\n              <mat-icon>navigate_next</mat-icon>\n            </button>\n          }\n        } @else {\n          @if (showControlButtons) {\n            <button\n              data-testid=\"navigateBeforeButton\"\n              mat-mini-fab\n              [attr.aria-label]=\"intl.previousPageLabel\"\n              [matTooltip]=\"intl.previousPageLabel\"\n              [disabled]=\"isFirstCanvasGroup\"\n              [@easeInWithDelay]=\"{\n                value: '',\n                params: {\n                  delayEnter: baseAnimationDelay,\n                  delayLeave: baseAnimationDelay * 4\n                }\n              }\"\n              (click)=\"goToPreviousCanvasGroup()\"\n            >\n              <mat-icon>navigate_next</mat-icon>\n            </button>\n          }\n        }\n        @if (showControlButtons) {\n          <button\n            (click)=\"zoomIn()\"\n            data-testid=\"zoomInButton\"\n            mat-mini-fab\n            [attr.aria-label]=\"intl.zoomInLabel\"\n            [matTooltip]=\"intl.zoomInLabel\"\n            [@easeInWithDelay]=\"{\n              value: '',\n              params: {\n                delayEnter: baseAnimationDelay * 2,\n                delayLeave: baseAnimationDelay * 3\n              }\n            }\"\n          >\n            <mat-icon>zoom_in</mat-icon>\n          </button>\n          <button\n            (click)=\"home()\"\n            data-testid=\"homeButton\"\n            mat-mini-fab\n            [attr.aria-label]=\"intl.resetZoomLabel\"\n            [disabled]=\"!isZoomed\"\n            [matTooltip]=\"intl.resetZoomLabel\"\n            [@easeInWithDelay]=\"{\n              value: '',\n              params: {\n                delayEnter: baseAnimationDelay * 3,\n                delayLeave: baseAnimationDelay * 2\n              }\n            }\"\n          >\n            <mat-icon>home</mat-icon>\n          </button>\n          <button\n            (click)=\"zoomOut()\"\n            data-testid=\"zoomOutButton\"\n            mat-mini-fab\n            [attr.aria-label]=\"intl.zoomOutLabel\"\n            [matTooltip]=\"intl.zoomOutLabel\"\n            [@easeInWithDelay]=\"{\n              value: '',\n              params: {\n                delayEnter: baseAnimationDelay * 4,\n                delayLeave: baseAnimationDelay\n              }\n            }\"\n          >\n            <mat-icon>zoom_out</mat-icon>\n          </button>\n          <button\n            (click)=\"rotate()\"\n            data-testid=\"rotateButton\"\n            mat-mini-fab\n            [attr.aria-label]=\"intl.rotateCwLabel\"\n            [matTooltip]=\"intl.rotateCwLabel\"\n            [@easeInWithDelay]=\"{\n              value: '',\n              params: { delayEnter: baseAnimationDelay * 5, delayLeave: 0 }\n            }\"\n          >\n            <mat-icon>rotate_right</mat-icon>\n          </button>\n        }\n      </div>\n    </div>\n  }\n</div>\n", styles: [":host{z-index:2}.osd-toolbar{position:absolute;background:transparent;width:auto;border-radius:8px;margin:8px 0 0 8px}\n"], dependencies: [{ kind: "component", type: i7.MatMiniFabButton, selector: "button[mat-mini-fab]", exportAs: ["matButton"] }, { kind: "component", type: i7.MatFabButton, selector: "button[mat-fab]", inputs: ["extended"], exportAs: ["matButton"] }, { kind: "component", type: i8.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "directive", type: i9.MatTooltip, selector: "[matTooltip]", inputs: ["matTooltipPosition", "matTooltipPositionAtOrigin", "matTooltipDisabled", "matTooltipShowDelay", "matTooltipHideDelay", "matTooltipTouchGestures", "matTooltip", "matTooltipClass"], exportAs: ["matTooltip"] }], animations: [rotate45, easeInWithDelay], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.9", ngImport: i0, type: OsdToolbarComponent, decorators: [{
            type: Component,
            args: [{ selector: 'mime-osd-toolbar', changeDetection: ChangeDetectionStrategy.OnPush, animations: [rotate45, easeInWithDelay], template: "<div #container class=\"osd-toolbar\">\n  @if (isWeb) {\n    <div class=\"flex gap-2\">\n      <div class=\"flex flex-col gap-2\">\n        <button\n          mat-fab\n          aria-controls=\"osdControls\"\n          data-testid=\"fabButton\"\n          [attr.aria-expanded]=\"fabState === 'open'\"\n          [attr.aria-label]=\"\n            fabState === 'open'\n              ? intl.closeOsdControlPanelLabel\n              : intl.openOsdControlPanelLabel\n          \"\n          [matTooltip]=\"\n            fabState === 'open'\n              ? intl.closeOsdControlPanelLabel\n              : intl.openOsdControlPanelLabel\n          \"\n          (click)=\"toggleFab()\"\n        >\n          <mat-icon [@rotate45]=\"fabState\">{{ fabIcon }}</mat-icon>\n        </button>\n      </div>\n      <div id=\"osdControls\" class=\"flex items-center gap-2\">\n        @if (invert) {\n          @if (showControlButtons) {\n            <button\n              data-testid=\"navigateBeforeButton\"\n              mat-mini-fab\n              [attr.aria-label]=\"intl.previousPageLabel\"\n              [matTooltip]=\"intl.previousPageLabel\"\n              [disabled]=\"isFirstCanvasGroup\"\n              [@easeInWithDelay]=\"{\n                value: '',\n                params: { delayEnter: 0, delayLeave: baseAnimationDelay * 5 }\n              }\"\n              (click)=\"goToPreviousCanvasGroup()\"\n            >\n              <mat-icon>navigate_before</mat-icon>\n            </button>\n          }\n        } @else {\n          @if (showControlButtons) {\n            <button\n              data-testid=\"navigateNextButton\"\n              mat-mini-fab\n              [attr.aria-label]=\"intl.nextPageLabel\"\n              [matTooltip]=\"intl.nextPageLabel\"\n              [disabled]=\"isLastCanvasGroup\"\n              [@easeInWithDelay]=\"{\n                value: '',\n                params: { delayEnter: 0, delayLeave: baseAnimationDelay * 5 }\n              }\"\n              (click)=\"goToNextCanvasGroup()\"\n            >\n              <mat-icon>navigate_before</mat-icon>\n            </button>\n          }\n        }\n        @if (invert) {\n          @if (showControlButtons) {\n            <button\n              data-testid=\"navigateNextButton\"\n              mat-mini-fab\n              [attr.aria-label]=\"intl.nextPageLabel\"\n              [matTooltip]=\"intl.nextPageLabel\"\n              [disabled]=\"isLastCanvasGroup\"\n              [@easeInWithDelay]=\"{\n                value: '',\n                params: {\n                  delayEnter: baseAnimationDelay,\n                  delayLeave: baseAnimationDelay * 4\n                }\n              }\"\n              (click)=\"goToNextCanvasGroup()\"\n            >\n              <mat-icon>navigate_next</mat-icon>\n            </button>\n          }\n        } @else {\n          @if (showControlButtons) {\n            <button\n              data-testid=\"navigateBeforeButton\"\n              mat-mini-fab\n              [attr.aria-label]=\"intl.previousPageLabel\"\n              [matTooltip]=\"intl.previousPageLabel\"\n              [disabled]=\"isFirstCanvasGroup\"\n              [@easeInWithDelay]=\"{\n                value: '',\n                params: {\n                  delayEnter: baseAnimationDelay,\n                  delayLeave: baseAnimationDelay * 4\n                }\n              }\"\n              (click)=\"goToPreviousCanvasGroup()\"\n            >\n              <mat-icon>navigate_next</mat-icon>\n            </button>\n          }\n        }\n        @if (showControlButtons) {\n          <button\n            (click)=\"zoomIn()\"\n            data-testid=\"zoomInButton\"\n            mat-mini-fab\n            [attr.aria-label]=\"intl.zoomInLabel\"\n            [matTooltip]=\"intl.zoomInLabel\"\n            [@easeInWithDelay]=\"{\n              value: '',\n              params: {\n                delayEnter: baseAnimationDelay * 2,\n                delayLeave: baseAnimationDelay * 3\n              }\n            }\"\n          >\n            <mat-icon>zoom_in</mat-icon>\n          </button>\n          <button\n            (click)=\"home()\"\n            data-testid=\"homeButton\"\n            mat-mini-fab\n            [attr.aria-label]=\"intl.resetZoomLabel\"\n            [disabled]=\"!isZoomed\"\n            [matTooltip]=\"intl.resetZoomLabel\"\n            [@easeInWithDelay]=\"{\n              value: '',\n              params: {\n                delayEnter: baseAnimationDelay * 3,\n                delayLeave: baseAnimationDelay * 2\n              }\n            }\"\n          >\n            <mat-icon>home</mat-icon>\n          </button>\n          <button\n            (click)=\"zoomOut()\"\n            data-testid=\"zoomOutButton\"\n            mat-mini-fab\n            [attr.aria-label]=\"intl.zoomOutLabel\"\n            [matTooltip]=\"intl.zoomOutLabel\"\n            [@easeInWithDelay]=\"{\n              value: '',\n              params: {\n                delayEnter: baseAnimationDelay * 4,\n                delayLeave: baseAnimationDelay\n              }\n            }\"\n          >\n            <mat-icon>zoom_out</mat-icon>\n          </button>\n          <button\n            (click)=\"rotate()\"\n            data-testid=\"rotateButton\"\n            mat-mini-fab\n            [attr.aria-label]=\"intl.rotateCwLabel\"\n            [matTooltip]=\"intl.rotateCwLabel\"\n            [@easeInWithDelay]=\"{\n              value: '',\n              params: { delayEnter: baseAnimationDelay * 5, delayLeave: 0 }\n            }\"\n          >\n            <mat-icon>rotate_right</mat-icon>\n          </button>\n        }\n      </div>\n    </div>\n  }\n</div>\n", styles: [":host{z-index:2}.osd-toolbar{position:absolute;background:transparent;width:auto;border-radius:8px;margin:8px 0 0 8px}\n"] }]
        }], ctorParameters: () => [{ type: i1.MimeViewerIntl }, { type: i2.BreakpointObserver }, { type: i0.ChangeDetectorRef }, { type: i3.ViewerService }, { type: i4.CanvasService }, { type: i5.IiifManifestService }, { type: i6.ModeService }], propDecorators: { container: [{
                type: ViewChild,
                args: ['container', { static: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3NkLXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtbWltZS9zcmMvbGliL3ZpZXdlci9vc2QtdG9vbGJhci9vc2QtdG9vbGJhci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL25neC1taW1lL3NyYy9saWIvdmlld2VyL29zZC10b29sYmFyL29zZC10b29sYmFyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxrQkFBa0IsRUFDbEIsV0FBVyxHQUVaLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFVBQVUsRUFHVixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3REFBd0QsQ0FBQztBQUU3RixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUN2RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDM0UsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUMzRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDckUsT0FBTyxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQzs7Ozs7Ozs7Ozs7QUFTdEUsTUFBTSxPQUFPLG1CQUFtQjtJQWM5QixZQUNTLElBQW9CLEVBQ25CLGtCQUFzQyxFQUN0QyxpQkFBb0MsRUFDcEMsYUFBNEIsRUFDNUIsYUFBNEIsRUFDNUIsbUJBQXdDLEVBQ3hD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LDh6QkQ1SWMsQ0FBQyxRQUFRLEVBQUUsZUFBZSxDQUFDOzsyRkFFNUIsbUJBQW1CO2tCQVAvQixTQUFTOytCQUNFLGtCQUFrQixtQkFHWCx1QkFBdUIsQ0FBQyxNQUFNLGNBQ25DLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQzt3UUFHRyxTQUFTO3NCQUFsRCxTQUFTO3VCQUFDLFdBQVcsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBCcmVha3BvaW50T2JzZXJ2ZXIsXG4gIEJyZWFrcG9pbnRzLFxuICBCcmVha3BvaW50U3RhdGUsXG59IGZyb20gJ0Bhbmd1bGFyL2Nkay9sYXlvdXQnO1xuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBJaWlmTWFuaWZlc3RTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9paWlmLW1hbmlmZXN0LXNlcnZpY2UvaWlpZi1tYW5pZmVzdC1zZXJ2aWNlJztcbmltcG9ydCB7IE1hbmlmZXN0IH0gZnJvbSAnLi4vLi4vY29yZS9tb2RlbHMvbWFuaWZlc3QnO1xuaW1wb3J0IHsgVmlld2luZ0RpcmVjdGlvbiB9IGZyb20gJy4uLy4uL2NvcmUvbW9kZWxzL3ZpZXdpbmctZGlyZWN0aW9uJztcbmltcG9ydCB7IENhbnZhc1NlcnZpY2UgfSBmcm9tICcuLy4uLy4uL2NvcmUvY2FudmFzLXNlcnZpY2UvY2FudmFzLXNlcnZpY2UnO1xuaW1wb3J0IHsgTWltZVZpZXdlckludGwgfSBmcm9tICcuLy4uLy4uL2NvcmUvaW50bCc7XG5pbXBvcnQgeyBWaWV3ZXJTZXJ2aWNlIH0gZnJvbSAnLi8uLi8uLi9jb3JlL3ZpZXdlci1zZXJ2aWNlL3ZpZXdlci5zZXJ2aWNlJztcbmltcG9ydCB7IE1vZGVTZXJ2aWNlIH0gZnJvbSAnLi8uLi8uLi9jb3JlL21vZGUtc2VydmljZS9tb2RlLnNlcnZpY2UnO1xuaW1wb3J0IHsgZWFzZUluV2l0aERlbGF5LCByb3RhdGU0NSB9IGZyb20gJy4vLi4vLi4vc2hhcmVkL2FuaW1hdGlvbnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtaW1lLW9zZC10b29sYmFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL29zZC10b29sYmFyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vb3NkLXRvb2xiYXIuY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIGFuaW1hdGlvbnM6IFtyb3RhdGU0NSwgZWFzZUluV2l0aERlbGF5XSxcbn0pXG5leHBvcnQgY2xhc3MgT3NkVG9vbGJhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUgfSkgY29udGFpbmVyITogRWxlbWVudFJlZjtcbiAgcHVibGljIG51bWJlck9mQ2FudmFzR3JvdXBzID0gMDtcbiAgcHVibGljIGlzRmlyc3RDYW52YXNHcm91cCA9IGZhbHNlO1xuICBwdWJsaWMgaXNMYXN0Q2FudmFzR3JvdXAgPSBmYWxzZTtcbiAgaW52ZXJ0ID0gZmFsc2U7XG4gIGlzV2ViID0gZmFsc2U7XG4gIGZhYlN0YXRlID0gJ2Nsb3NlZCc7XG4gIGZhYkljb24gPSAnbWVudSc7XG4gIHNob3dDb250cm9sQnV0dG9ucyA9IGZhbHNlO1xuICBiYXNlQW5pbWF0aW9uRGVsYXkgPSAyMDtcbiAgaXNab29tZWQgPSB0cnVlO1xuICBwcml2YXRlIHN1YnNjcmlwdGlvbnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGludGw6IE1pbWVWaWV3ZXJJbnRsLFxuICAgIHByaXZhdGUgYnJlYWtwb2ludE9ic2VydmVyOiBCcmVha3BvaW50T2JzZXJ2ZXIsXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSB2aWV3ZXJTZXJ2aWNlOiBWaWV3ZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgY2FudmFzU2VydmljZTogQ2FudmFzU2VydmljZSxcbiAgICBwcml2YXRlIGlpaWZNYW5pZmVzdFNlcnZpY2U6IElpaWZNYW5pZmVzdFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBtb2RlU2VydmljZTogTW9kZVNlcnZpY2VcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQoXG4gICAgICB0aGlzLm1vZGVTZXJ2aWNlLm9uQ2hhbmdlLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuaXNab29tZWQgPSB0aGlzLm1vZGVTZXJ2aWNlLmlzUGFnZVpvb21lZCgpO1xuICAgICAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQoXG4gICAgICB0aGlzLmJyZWFrcG9pbnRPYnNlcnZlclxuICAgICAgICAub2JzZXJ2ZShbQnJlYWtwb2ludHMuV2ViXSlcbiAgICAgICAgLnN1YnNjcmliZSgodmFsdWU6IEJyZWFrcG9pbnRTdGF0ZSkgPT4ge1xuICAgICAgICAgIHRoaXMuaXNXZWIgPSB2YWx1ZS5tYXRjaGVzO1xuICAgICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9KVxuICAgICk7XG5cbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKFxuICAgICAgdGhpcy5paWlmTWFuaWZlc3RTZXJ2aWNlLmN1cnJlbnRNYW5pZmVzdC5zdWJzY3JpYmUoXG4gICAgICAgIChtYW5pZmVzdDogTWFuaWZlc3QgfCBudWxsKSA9PiB7XG4gICAgICAgICAgaWYgKG1hbmlmZXN0KSB7XG4gICAgICAgICAgICB0aGlzLmludmVydCA9IG1hbmlmZXN0LnZpZXdpbmdEaXJlY3Rpb24gPT09IFZpZXdpbmdEaXJlY3Rpb24uTFRSO1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApXG4gICAgKTtcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQoXG4gICAgICB0aGlzLnZpZXdlclNlcnZpY2Uub25DYW52YXNHcm91cEluZGV4Q2hhbmdlLnN1YnNjcmliZShcbiAgICAgICAgKGN1cnJlbnRDYW52YXNHcm91cEluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICB0aGlzLm51bWJlck9mQ2FudmFzR3JvdXBzID0gdGhpcy5jYW52YXNTZXJ2aWNlLm51bWJlck9mQ2FudmFzR3JvdXBzO1xuICAgICAgICAgIHRoaXMuaXNGaXJzdENhbnZhc0dyb3VwID0gdGhpcy5pc09uRmlyc3RDYW52YXNHcm91cChcbiAgICAgICAgICAgIGN1cnJlbnRDYW52YXNHcm91cEluZGV4XG4gICAgICAgICAgKTtcbiAgICAgICAgICB0aGlzLmlzTGFzdENhbnZhc0dyb3VwID0gdGhpcy5pc09uTGFzdENhbnZhc0dyb3VwKFxuICAgICAgICAgICAgY3VycmVudENhbnZhc0dyb3VwSW5kZXhcbiAgICAgICAgICApO1xuICAgICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9XG4gICAgICApXG4gICAgKTtcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQoXG4gICAgICB0aGlzLmludGwuY2hhbmdlcy5zdWJzY3JpYmUoKCkgPT4gdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKSlcbiAgICApO1xuICB9XG5cbiAgdG9nZ2xlRmFiKCk6IHZvaWQge1xuICAgIHRoaXMuc2hvd0NvbnRyb2xCdXR0b25zID0gIXRoaXMuc2hvd0NvbnRyb2xCdXR0b25zO1xuICAgIHRoaXMuZmFiU3RhdGUgPSB0aGlzLmZhYlN0YXRlID09PSAnY2xvc2VkJyA/ICdvcGVuJyA6ICdjbG9zZWQnO1xuICAgIHRoaXMuZmFiSWNvbiA9IHRoaXMuZmFiU3RhdGUgPT09ICdjbG9zZWQnID8gJ21lbnUnIDogJ2NsZWFyJztcbiAgfVxuXG4gIHpvb21JbigpOiB2b2lkIHtcbiAgICB0aGlzLnZpZXdlclNlcnZpY2Uuem9vbUluKCk7XG4gIH1cblxuICB6b29tT3V0KCk6IHZvaWQge1xuICAgIHRoaXMudmlld2VyU2VydmljZS56b29tT3V0KCk7XG4gIH1cblxuICBob21lKCk6IHZvaWQge1xuICAgIHRoaXMudmlld2VyU2VydmljZS5ob21lKCk7XG4gIH1cblxuICByb3RhdGUoKTogdm9pZCB7XG4gICAgdGhpcy52aWV3ZXJTZXJ2aWNlLnJvdGF0ZSgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwdWJsaWMgZ29Ub1ByZXZpb3VzQ2FudmFzR3JvdXAoKTogdm9pZCB7XG4gICAgdGhpcy52aWV3ZXJTZXJ2aWNlLmdvVG9QcmV2aW91c0NhbnZhc0dyb3VwKCk7XG4gIH1cblxuICBwdWJsaWMgZ29Ub05leHRDYW52YXNHcm91cCgpOiB2b2lkIHtcbiAgICB0aGlzLnZpZXdlclNlcnZpY2UuZ29Ub05leHRDYW52YXNHcm91cCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc09uRmlyc3RDYW52YXNHcm91cChjdXJyZW50Q2FudmFzR3JvdXBJbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGN1cnJlbnRDYW52YXNHcm91cEluZGV4ID09PSAwO1xuICB9XG5cbiAgcHJpdmF0ZSBpc09uTGFzdENhbnZhc0dyb3VwKGN1cnJlbnRDYW52YXNHcm91cEluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gY3VycmVudENhbnZhc0dyb3VwSW5kZXggPT09IHRoaXMubnVtYmVyT2ZDYW52YXNHcm91cHMgLSAxO1xuICB9XG59XG4iLCI8ZGl2ICNjb250YWluZXIgY2xhc3M9XCJvc2QtdG9vbGJhclwiPlxuICBAaWYgKGlzV2ViKSB7XG4gICAgPGRpdiBjbGFzcz1cImZsZXggZ2FwLTJcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJmbGV4IGZsZXgtY29sIGdhcC0yXCI+XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICBtYXQtZmFiXG4gICAgICAgICAgYXJpYS1jb250cm9scz1cIm9zZENvbnRyb2xzXCJcbiAgICAgICAgICBkYXRhLXRlc3RpZD1cImZhYkJ1dHRvblwiXG4gICAgICAgICAgW2F0dHIuYXJpYS1leHBhbmRlZF09XCJmYWJTdGF0ZSA9PT0gJ29wZW4nXCJcbiAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgZmFiU3RhdGUgPT09ICdvcGVuJ1xuICAgICAgICAgICAgICA/IGludGwuY2xvc2VPc2RDb250cm9sUGFuZWxMYWJlbFxuICAgICAgICAgICAgICA6IGludGwub3Blbk9zZENvbnRyb2xQYW5lbExhYmVsXG4gICAgICAgICAgXCJcbiAgICAgICAgICBbbWF0VG9vbHRpcF09XCJcbiAgICAgICAgICAgIGZhYlN0YXRlID09PSAnb3BlbidcbiAgICAgICAgICAgICAgPyBpbnRsLmNsb3NlT3NkQ29udHJvbFBhbmVsTGFiZWxcbiAgICAgICAgICAgICAgOiBpbnRsLm9wZW5Pc2RDb250cm9sUGFuZWxMYWJlbFxuICAgICAgICAgIFwiXG4gICAgICAgICAgKGNsaWNrKT1cInRvZ2dsZUZhYigpXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxtYXQtaWNvbiBbQHJvdGF0ZTQ1XT1cImZhYlN0YXRlXCI+e3sgZmFiSWNvbiB9fTwvbWF0LWljb24+XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGlkPVwib3NkQ29udHJvbHNcIiBjbGFzcz1cImZsZXggaXRlbXMtY2VudGVyIGdhcC0yXCI+XG4gICAgICAgIEBpZiAoaW52ZXJ0KSB7XG4gICAgICAgICAgQGlmIChzaG93Q29udHJvbEJ1dHRvbnMpIHtcbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9XCJuYXZpZ2F0ZUJlZm9yZUJ1dHRvblwiXG4gICAgICAgICAgICAgIG1hdC1taW5pLWZhYlxuICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImludGwucHJldmlvdXNQYWdlTGFiZWxcIlxuICAgICAgICAgICAgICBbbWF0VG9vbHRpcF09XCJpbnRsLnByZXZpb3VzUGFnZUxhYmVsXCJcbiAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cImlzRmlyc3RDYW52YXNHcm91cFwiXG4gICAgICAgICAgICAgIFtAZWFzZUluV2l0aERlbGF5XT1cIntcbiAgICAgICAgICAgICAgICB2YWx1ZTogJycsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7IGRlbGF5RW50ZXI6IDAsIGRlbGF5TGVhdmU6IGJhc2VBbmltYXRpb25EZWxheSAqIDUgfVxuICAgICAgICAgICAgICB9XCJcbiAgICAgICAgICAgICAgKGNsaWNrKT1cImdvVG9QcmV2aW91c0NhbnZhc0dyb3VwKClcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8bWF0LWljb24+bmF2aWdhdGVfYmVmb3JlPC9tYXQtaWNvbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIH1cbiAgICAgICAgfSBAZWxzZSB7XG4gICAgICAgICAgQGlmIChzaG93Q29udHJvbEJ1dHRvbnMpIHtcbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9XCJuYXZpZ2F0ZU5leHRCdXR0b25cIlxuICAgICAgICAgICAgICBtYXQtbWluaS1mYWJcbiAgICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJpbnRsLm5leHRQYWdlTGFiZWxcIlxuICAgICAgICAgICAgICBbbWF0VG9vbHRpcF09XCJpbnRsLm5leHRQYWdlTGFiZWxcIlxuICAgICAgICAgICAgICBbZGlzYWJsZWRdPVwiaXNMYXN0Q2FudmFzR3JvdXBcIlxuICAgICAgICAgICAgICBbQGVhc2VJbldpdGhEZWxheV09XCJ7XG4gICAgICAgICAgICAgICAgdmFsdWU6ICcnLFxuICAgICAgICAgICAgICAgIHBhcmFtczogeyBkZWxheUVudGVyOiAwLCBkZWxheUxlYXZlOiBiYXNlQW5pbWF0aW9uRGVsYXkgKiA1IH1cbiAgICAgICAgICAgICAgfVwiXG4gICAgICAgICAgICAgIChjbGljayk9XCJnb1RvTmV4dENhbnZhc0dyb3VwKClcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8bWF0LWljb24+bmF2aWdhdGVfYmVmb3JlPC9tYXQtaWNvbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBAaWYgKGludmVydCkge1xuICAgICAgICAgIEBpZiAoc2hvd0NvbnRyb2xCdXR0b25zKSB7XG4gICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwibmF2aWdhdGVOZXh0QnV0dG9uXCJcbiAgICAgICAgICAgICAgbWF0LW1pbmktZmFiXG4gICAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiaW50bC5uZXh0UGFnZUxhYmVsXCJcbiAgICAgICAgICAgICAgW21hdFRvb2x0aXBdPVwiaW50bC5uZXh0UGFnZUxhYmVsXCJcbiAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cImlzTGFzdENhbnZhc0dyb3VwXCJcbiAgICAgICAgICAgICAgW0BlYXNlSW5XaXRoRGVsYXldPVwie1xuICAgICAgICAgICAgICAgIHZhbHVlOiAnJyxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgIGRlbGF5RW50ZXI6IGJhc2VBbmltYXRpb25EZWxheSxcbiAgICAgICAgICAgICAgICAgIGRlbGF5TGVhdmU6IGJhc2VBbmltYXRpb25EZWxheSAqIDRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cIlxuICAgICAgICAgICAgICAoY2xpY2spPVwiZ29Ub05leHRDYW52YXNHcm91cCgpXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPG1hdC1pY29uPm5hdmlnYXRlX25leHQ8L21hdC1pY29uPlxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgfVxuICAgICAgICB9IEBlbHNlIHtcbiAgICAgICAgICBAaWYgKHNob3dDb250cm9sQnV0dG9ucykge1xuICAgICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD1cIm5hdmlnYXRlQmVmb3JlQnV0dG9uXCJcbiAgICAgICAgICAgICAgbWF0LW1pbmktZmFiXG4gICAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiaW50bC5wcmV2aW91c1BhZ2VMYWJlbFwiXG4gICAgICAgICAgICAgIFttYXRUb29sdGlwXT1cImludGwucHJldmlvdXNQYWdlTGFiZWxcIlxuICAgICAgICAgICAgICBbZGlzYWJsZWRdPVwiaXNGaXJzdENhbnZhc0dyb3VwXCJcbiAgICAgICAgICAgICAgW0BlYXNlSW5XaXRoRGVsYXldPVwie1xuICAgICAgICAgICAgICAgIHZhbHVlOiAnJyxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgIGRlbGF5RW50ZXI6IGJhc2VBbmltYXRpb25EZWxheSxcbiAgICAgICAgICAgICAgICAgIGRlbGF5TGVhdmU6IGJhc2VBbmltYXRpb25EZWxheSAqIDRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cIlxuICAgICAgICAgICAgICAoY2xpY2spPVwiZ29Ub1ByZXZpb3VzQ2FudmFzR3JvdXAoKVwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxtYXQtaWNvbj5uYXZpZ2F0ZV9uZXh0PC9tYXQtaWNvbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBAaWYgKHNob3dDb250cm9sQnV0dG9ucykge1xuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIChjbGljayk9XCJ6b29tSW4oKVwiXG4gICAgICAgICAgICBkYXRhLXRlc3RpZD1cInpvb21JbkJ1dHRvblwiXG4gICAgICAgICAgICBtYXQtbWluaS1mYWJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiaW50bC56b29tSW5MYWJlbFwiXG4gICAgICAgICAgICBbbWF0VG9vbHRpcF09XCJpbnRsLnpvb21JbkxhYmVsXCJcbiAgICAgICAgICAgIFtAZWFzZUluV2l0aERlbGF5XT1cIntcbiAgICAgICAgICAgICAgdmFsdWU6ICcnLFxuICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBkZWxheUVudGVyOiBiYXNlQW5pbWF0aW9uRGVsYXkgKiAyLFxuICAgICAgICAgICAgICAgIGRlbGF5TGVhdmU6IGJhc2VBbmltYXRpb25EZWxheSAqIDNcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPG1hdC1pY29uPnpvb21faW48L21hdC1pY29uPlxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIChjbGljayk9XCJob21lKClcIlxuICAgICAgICAgICAgZGF0YS10ZXN0aWQ9XCJob21lQnV0dG9uXCJcbiAgICAgICAgICAgIG1hdC1taW5pLWZhYlxuICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJpbnRsLnJlc2V0Wm9vbUxhYmVsXCJcbiAgICAgICAgICAgIFtkaXNhYmxlZF09XCIhaXNab29tZWRcIlxuICAgICAgICAgICAgW21hdFRvb2x0aXBdPVwiaW50bC5yZXNldFpvb21MYWJlbFwiXG4gICAgICAgICAgICBbQGVhc2VJbldpdGhEZWxheV09XCJ7XG4gICAgICAgICAgICAgIHZhbHVlOiAnJyxcbiAgICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgZGVsYXlFbnRlcjogYmFzZUFuaW1hdGlvbkRlbGF5ICogMyxcbiAgICAgICAgICAgICAgICBkZWxheUxlYXZlOiBiYXNlQW5pbWF0aW9uRGVsYXkgKiAyXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxtYXQtaWNvbj5ob21lPC9tYXQtaWNvbj5cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAoY2xpY2spPVwiem9vbU91dCgpXCJcbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwiem9vbU91dEJ1dHRvblwiXG4gICAgICAgICAgICBtYXQtbWluaS1mYWJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiaW50bC56b29tT3V0TGFiZWxcIlxuICAgICAgICAgICAgW21hdFRvb2x0aXBdPVwiaW50bC56b29tT3V0TGFiZWxcIlxuICAgICAgICAgICAgW0BlYXNlSW5XaXRoRGVsYXldPVwie1xuICAgICAgICAgICAgICB2YWx1ZTogJycsXG4gICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIGRlbGF5RW50ZXI6IGJhc2VBbmltYXRpb25EZWxheSAqIDQsXG4gICAgICAgICAgICAgICAgZGVsYXlMZWF2ZTogYmFzZUFuaW1hdGlvbkRlbGF5XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxtYXQtaWNvbj56b29tX291dDwvbWF0LWljb24+XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgKGNsaWNrKT1cInJvdGF0ZSgpXCJcbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwicm90YXRlQnV0dG9uXCJcbiAgICAgICAgICAgIG1hdC1taW5pLWZhYlxuICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJpbnRsLnJvdGF0ZUN3TGFiZWxcIlxuICAgICAgICAgICAgW21hdFRvb2x0aXBdPVwiaW50bC5yb3RhdGVDd0xhYmVsXCJcbiAgICAgICAgICAgIFtAZWFzZUluV2l0aERlbGF5XT1cIntcbiAgICAgICAgICAgICAgdmFsdWU6ICcnLFxuICAgICAgICAgICAgICBwYXJhbXM6IHsgZGVsYXlFbnRlcjogYmFzZUFuaW1hdGlvbkRlbGF5ICogNSwgZGVsYXlMZWF2ZTogMCB9XG4gICAgICAgICAgICB9XCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8bWF0LWljb24+cm90YXRlX3JpZ2h0PC9tYXQtaWNvbj5cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgfVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIH1cbjwvZGl2PlxuIl19