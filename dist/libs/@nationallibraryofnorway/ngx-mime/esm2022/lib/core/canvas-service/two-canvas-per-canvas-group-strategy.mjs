import { TwoPageCalculateCanvasGroupPositionStrategy } from '../canvas-group-position/two-page-calculate-page-position-strategy';
import { CanvasGroups } from '../models/canvas-groups';
import { Rect } from '../models/rect';
export class TwoCanvasPerCanvasGroupStrategy {
    constructor(config, viewingDirection, rotation) {
        this.config = config;
        this.viewingDirection = viewingDirection;
        this.rotation = rotation;
        this.positionStrategy = new TwoPageCalculateCanvasGroupPositionStrategy(this.config);
    }
    addAll(tileSources) {
        const canvasGroups = new CanvasGroups();
        // Add first single page
        this.addSinglePage(canvasGroups, tileSources[0], 0, new Rect());
        for (let i = 1; i < tileSources.length; i += 2) {
            if (this.hasNextPage(tileSources, i)) {
                this.addPairedPages(canvasGroups, tileSources, i);
            }
            else {
                this.addSinglePage(canvasGroups, tileSources[i], i, this.getLastRect(canvasGroups));
            }
        }
        return canvasGroups;
    }
    addSinglePage(canvasGroups, tileSource, index, previousRect) {
        const position = this.calculatePosition(tileSource, index, previousRect);
        const tileSourceAndRect = { tileSource, rect: position };
        const newCanvasGroup = {
            tileSourceAndRects: [tileSourceAndRect],
            rect: position,
        };
        canvasGroups.add(newCanvasGroup);
        canvasGroups.canvasesPerCanvasGroup.push([index]);
    }
    addPairedPages(canvasGroups, tileSources, index) {
        const previousCanvasGroup = this.getLastCanvasGroup(canvasGroups);
        const firstTileSourceAndRect = this.createTileSourceAndRect(tileSources[index], index, previousCanvasGroup.rect);
        const secondTileSourceAndRect = this.createTileSourceAndRect(tileSources[index + 1], index + 1, firstTileSourceAndRect.rect);
        const newCanvasGroup = {
            tileSourceAndRects: [firstTileSourceAndRect, secondTileSourceAndRect],
            rect: this.combineRects(firstTileSourceAndRect.rect, secondTileSourceAndRect.rect),
        };
        canvasGroups.add(newCanvasGroup);
        canvasGroups.canvasesPerCanvasGroup.push([index, index + 1]);
    }
    hasNextPage(tileSources, index) {
        return index + 1 < tileSources.length;
    }
    createTileSourceAndRect(tileSource, index, previousRect) {
        return {
            tileSource,
            rect: this.calculatePosition(tileSource, index, previousRect),
        };
    }
    calculatePosition(tileSource, index, previousRect) {
        return this.positionStrategy.calculateCanvasGroupPosition({
            canvasGroupIndex: index,
            canvasSource: tileSource,
            previousCanvasGroupPosition: previousRect,
            viewingDirection: this.viewingDirection,
        }, this.rotation);
    }
    getLastCanvasGroup(canvasGroups) {
        return canvasGroups.canvasGroups[canvasGroups.canvasGroups.length - 1];
    }
    getLastRect(canvasGroups) {
        const lastCanvasGroup = this.getLastCanvasGroup(canvasGroups);
        return lastCanvasGroup.rect;
    }
    combineRects(rect1, rect2) {
        return new Rect({
            x: Math.min(rect1.x, rect2.x),
            y: Math.min(rect1.y, rect2.y),
            height: Math.max(rect1.height, rect2.height),
            width: rect1.width + rect2.width,
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHdvLWNhbnZhcy1wZXItY2FudmFzLWdyb3VwLXN0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtbWltZS9zcmMvbGliL2NvcmUvY2FudmFzLXNlcnZpY2UvdHdvLWNhbnZhcy1wZXItY2FudmFzLWdyb3VwLXN0cmF0ZWd5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSwyQ0FBMkMsRUFBRSxNQUFNLG9FQUFvRSxDQUFDO0FBRWpJLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFLdEMsTUFBTSxPQUFPLCtCQUErQjtJQUsxQyxZQUNVLE1BQXdCLEVBQ3hCLGdCQUFrQyxFQUNsQyxRQUFnQjtRQUZoQixXQUFNLEdBQU4sTUFBTSxDQUFrQjtRQUN4QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQVE7UUFFeEIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksMkNBQTJDLENBQ3JFLElBQUksQ0FBQyxNQUFNLENBQ1osQ0FBQztJQUNKLENBQUM7SUFFRCxNQUFNLENBQUMsV0FBK0I7UUFDcEMsTUFBTSxZQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUV4Qyx3QkFBd0I7UUFDeEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLENBQUM7UUFFaEUsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQy9DLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLEVBQUUs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LE9BQU8sWUFBWSxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN6RSxDQUFDO0lBRU8sV0FBVyxDQUFDLFlBQTBCO1FBQzVDLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM5RCxPQUFPLGVBQWUsQ0FBQyxJQUFJLENBQUM7SUFDOUIsQ0FBQztJQUVPLFlBQVksQ0FBQyxLQUFXLEVBQUUsS0FBVztRQUMzQyxPQUFPLElBQUksSUFBSSxDQUFDO1lBQ2QsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQzdCLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUM3QixNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUM7WUFDNUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUs7U0FDakMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHdvUGFnZUNhbGN1bGF0ZUNhbnZhc0dyb3VwUG9zaXRpb25TdHJhdGVneSB9IGZyb20gJy4uL2NhbnZhcy1ncm91cC1wb3NpdGlvbi90d28tcGFnZS1jYWxjdWxhdGUtcGFnZS1wb3NpdGlvbi1zdHJhdGVneSc7XG5pbXBvcnQgeyBNaW1lVmlld2VyQ29uZmlnIH0gZnJvbSAnLi4vbWltZS12aWV3ZXItY29uZmlnJztcbmltcG9ydCB7IENhbnZhc0dyb3VwcyB9IGZyb20gJy4uL21vZGVscy9jYW52YXMtZ3JvdXBzJztcbmltcG9ydCB7IFJlY3QgfSBmcm9tICcuLi9tb2RlbHMvcmVjdCc7XG5pbXBvcnQgeyBWaWV3aW5nRGlyZWN0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL3ZpZXdpbmctZGlyZWN0aW9uJztcbmltcG9ydCB7IEFic3RyYWN0Q2FudmFzR3JvdXBTdHJhdGVneSB9IGZyb20gJy4vY2FudmFzLWdyb3VwLnN0cmF0ZWd5JztcbmltcG9ydCB7IENhbnZhc0dyb3VwLCBUaWxlU291cmNlQW5kUmVjdCB9IGZyb20gJy4vdGlsZS1zb3VyY2UtYW5kLXJlY3QubW9kZWwnO1xuXG5leHBvcnQgY2xhc3MgVHdvQ2FudmFzUGVyQ2FudmFzR3JvdXBTdHJhdGVneVxuICBpbXBsZW1lbnRzIEFic3RyYWN0Q2FudmFzR3JvdXBTdHJhdGVneVxue1xuICBwcml2YXRlIHBvc2l0aW9uU3RyYXRlZ3k6IFR3b1BhZ2VDYWxjdWxhdGVDYW52YXNHcm91cFBvc2l0aW9uU3RyYXRlZ3k7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjb25maWc6IE1pbWVWaWV3ZXJDb25maWcsXG4gICAgcHJpdmF0ZSB2aWV3aW5nRGlyZWN0aW9uOiBWaWV3aW5nRGlyZWN0aW9uLFxuICAgIHByaXZhdGUgcm90YXRpb246IG51bWJlcixcbiAgKSB7XG4gICAgdGhpcy5wb3NpdGlvblN0cmF0ZWd5ID0gbmV3IFR3b1BhZ2VDYWxjdWxhdGVDYW52YXNHcm91cFBvc2l0aW9uU3RyYXRlZ3koXG4gICAgICB0aGlzLmNvbmZpZyxcbiAgICApO1xuICB9XG5cbiAgYWRkQWxsKHRpbGVTb3VyY2VzOiBSZWFkb25seUFycmF5PGFueT4pOiBDYW52YXNHcm91cHMge1xuICAgIGNvbnN0IGNhbnZhc0dyb3VwcyA9IG5ldyBDYW52YXNHcm91cHMoKTtcblxuICAgIC8vIEFkZCBmaXJzdCBzaW5nbGUgcGFnZVxuICAgIHRoaXMuYWRkU2luZ2xlUGFnZShjYW52YXNHcm91cHMsIHRpbGVTb3VyY2VzWzBdLCAwLCBuZXcgUmVjdCgpKTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGlsZVNvdXJjZXMubGVuZ3RoOyBpICs9IDIpIHtcbiAgICAgIGlmICh0aGlzLmhhc05leHRQYWdlKHRpbGVTb3VyY2VzLCBpKSkge1xuICAgICAgICB0aGlzLmFkZFBhaXJlZFBhZ2VzKGNhbnZhc0dyb3VwcywgdGlsZVNvdXJjZXMsIGkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hZGRTaW5nbGVQYWdlKFxuICAgICAgICAgIGNhbnZhc0dyb3VwcyxcbiAgICAgICAgICB0aWxlU291cmNlc1tpXSxcbiAgICAgICAgICBpLFxuICAgICAgICAgIHRoaXMuZ2V0TGFzdFJlY3QoY2FudmFzR3JvdXBzKSxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2FudmFzR3JvdXBzO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRTaW5nbGVQYWdlKFxuICAgIGNhbnZhc0dyb3VwczogQ2FudmFzR3JvdXBzLFxuICAgIHRpbGVTb3VyY2U6IGFueSxcbiAgICBpbmRleDogbnVtYmVyLFxuICAgIHByZXZpb3VzUmVjdDogUmVjdCxcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmNhbGN1bGF0ZVBvc2l0aW9uKHRpbGVTb3VyY2UsIGluZGV4LCBwcmV2aW91c1JlY3QpO1xuICAgIGNvbnN0IHRpbGVTb3VyY2VBbmRSZWN0OiBUaWxlU291cmNlQW5kUmVjdCA9IHsgdGlsZVNvdXJjZSwgcmVjdDogcG9zaXRpb24gfTtcbiAgICBjb25zdCBuZXdDYW52YXNHcm91cDogQ2FudmFzR3JvdXAgPSB7XG4gICAgICB0aWxlU291cmNlQW5kUmVjdHM6IFt0aWxlU291cmNlQW5kUmVjdF0sXG4gICAgICByZWN0OiBwb3NpdGlvbixcbiAgICB9O1xuXG4gICAgY2FudmFzR3JvdXBzLmFkZChuZXdDYW52YXNHcm91cCk7XG4gICAgY2FudmFzR3JvdXBzLmNhbnZhc2VzUGVyQ2FudmFzR3JvdXAucHVzaChbaW5kZXhdKTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkUGFpcmVkUGFnZXMoXG4gICAgY2FudmFzR3JvdXBzOiBDYW52YXNHcm91cHMsXG4gICAgdGlsZVNvdXJjZXM6IFJlYWRvbmx5QXJyYXk8YW55PixcbiAgICBpbmRleDogbnVtYmVyLFxuICApOiB2b2lkIHtcbiAgICBjb25zdCBwcmV2aW91c0NhbnZhc0dyb3VwID0gdGhpcy5nZXRMYXN0Q2FudmFzR3JvdXAoY2FudmFzR3JvdXBzKTtcbiAgICBjb25zdCBmaXJzdFRpbGVTb3VyY2VBbmRSZWN0ID0gdGhpcy5jcmVhdGVUaWxlU291cmNlQW5kUmVjdChcbiAgICAgIHRpbGVTb3VyY2VzW2luZGV4XSxcbiAgICAgIGluZGV4LFxuICAgICAgcHJldmlvdXNDYW52YXNHcm91cC5yZWN0LFxuICAgICk7XG4gICAgY29uc3Qgc2Vjb25kVGlsZVNvdXJjZUFuZFJlY3QgPSB0aGlzLmNyZWF0ZVRpbGVTb3VyY2VBbmRSZWN0KFxuICAgICAgdGlsZVNvdXJjZXNbaW5kZXggKyAxXSxcbiAgICAgIGluZGV4ICsgMSxcbiAgICAgIGZpcnN0VGlsZVNvdXJjZUFuZFJlY3QucmVjdCxcbiAgICApO1xuXG4gICAgY29uc3QgbmV3Q2FudmFzR3JvdXA6IENhbnZhc0dyb3VwID0ge1xuICAgICAgdGlsZVNvdXJjZUFuZFJlY3RzOiBbZmlyc3RUaWxlU291cmNlQW5kUmVjdCwgc2Vjb25kVGlsZVNvdXJjZUFuZFJlY3RdLFxuICAgICAgcmVjdDogdGhpcy5jb21iaW5lUmVjdHMoXG4gICAgICAgIGZpcnN0VGlsZVNvdXJjZUFuZFJlY3QucmVjdCxcbiAgICAgICAgc2Vjb25kVGlsZVNvdXJjZUFuZFJlY3QucmVjdCxcbiAgICAgICksXG4gICAgfTtcblxuICAgIGNhbnZhc0dyb3Vwcy5hZGQobmV3Q2FudmFzR3JvdXApO1xuICAgIGNhbnZhc0dyb3Vwcy5jYW52YXNlc1BlckNhbnZhc0dyb3VwLnB1c2goW2luZGV4LCBpbmRleCArIDFdKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFzTmV4dFBhZ2UodGlsZVNvdXJjZXM6IFJlYWRvbmx5QXJyYXk8YW55PiwgaW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBpbmRleCArIDEgPCB0aWxlU291cmNlcy5sZW5ndGg7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVRpbGVTb3VyY2VBbmRSZWN0KFxuICAgIHRpbGVTb3VyY2U6IGFueSxcbiAgICBpbmRleDogbnVtYmVyLFxuICAgIHByZXZpb3VzUmVjdDogUmVjdCxcbiAgKTogVGlsZVNvdXJjZUFuZFJlY3Qge1xuICAgIHJldHVybiB7XG4gICAgICB0aWxlU291cmNlLFxuICAgICAgcmVjdDogdGhpcy5jYWxjdWxhdGVQb3NpdGlvbih0aWxlU291cmNlLCBpbmRleCwgcHJldmlvdXNSZWN0KSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVQb3NpdGlvbihcbiAgICB0aWxlU291cmNlOiBhbnksXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICBwcmV2aW91c1JlY3Q6IFJlY3QsXG4gICk6IFJlY3Qge1xuICAgIHJldHVybiB0aGlzLnBvc2l0aW9uU3RyYXRlZ3kuY2FsY3VsYXRlQ2FudmFzR3JvdXBQb3NpdGlvbihcbiAgICAgIHtcbiAgICAgICAgY2FudmFzR3JvdXBJbmRleDogaW5kZXgsXG4gICAgICAgIGNhbnZhc1NvdXJjZTogdGlsZVNvdXJjZSxcbiAgICAgICAgcHJldmlvdXNDYW52YXNHcm91cFBvc2l0aW9uOiBwcmV2aW91c1JlY3QsXG4gICAgICAgIHZpZXdpbmdEaXJlY3Rpb246IHRoaXMudmlld2luZ0RpcmVjdGlvbixcbiAgICAgIH0sXG4gICAgICB0aGlzLnJvdGF0aW9uLFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldExhc3RDYW52YXNHcm91cChjYW52YXNHcm91cHM6IENhbnZhc0dyb3Vwcyk6IENhbnZhc0dyb3VwIHtcbiAgICByZXR1cm4gY2FudmFzR3JvdXBzLmNhbnZhc0dyb3Vwc1tjYW52YXNHcm91cHMuY2FudmFzR3JvdXBzLmxlbmd0aCAtIDFdO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRMYXN0UmVjdChjYW52YXNHcm91cHM6IENhbnZhc0dyb3Vwcyk6IFJlY3Qge1xuICAgIGNvbnN0IGxhc3RDYW52YXNHcm91cCA9IHRoaXMuZ2V0TGFzdENhbnZhc0dyb3VwKGNhbnZhc0dyb3Vwcyk7XG4gICAgcmV0dXJuIGxhc3RDYW52YXNHcm91cC5yZWN0O1xuICB9XG5cbiAgcHJpdmF0ZSBjb21iaW5lUmVjdHMocmVjdDE6IFJlY3QsIHJlY3QyOiBSZWN0KTogUmVjdCB7XG4gICAgcmV0dXJuIG5ldyBSZWN0KHtcbiAgICAgIHg6IE1hdGgubWluKHJlY3QxLngsIHJlY3QyLngpLFxuICAgICAgeTogTWF0aC5taW4ocmVjdDEueSwgcmVjdDIueSksXG4gICAgICBoZWlnaHQ6IE1hdGgubWF4KHJlY3QxLmhlaWdodCwgcmVjdDIuaGVpZ2h0KSxcbiAgICAgIHdpZHRoOiByZWN0MS53aWR0aCArIHJlY3QyLndpZHRoLFxuICAgIH0pO1xuICB9XG59XG4iXX0=