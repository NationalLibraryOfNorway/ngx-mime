function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}(function(e){e.version={versionStr:"4.0.0",major:parseInt("4",10),minor:parseInt("0",10),revision:parseInt("0",10)};var n,t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,s=Object.prototype.hasOwnProperty;e.isFunction=function(r){return"function"===e.type(r)},e.isArray=Array.isArray||function(r){return"array"===e.type(r)},e.isWindow=function(r){return r&&"object"==typeof r&&"setInterval"in r},e.type=function(r){return null==r?String(r):t[i.call(r)]||"object"},e.isPlainObject=function(r){if(!r||"object"!==OpenSeadragon.type(r)||r.nodeType||e.isWindow(r)||r.constructor&&!s.call(r,"constructor")&&!s.call(r.constructor.prototype,"isPrototypeOf"))return!1;var a;for(var l in r)a=l;return void 0===a||s.call(r,a)},e.isEmptyObject=function(r){for(var a in r)return!1;return!0},e.freezeObject=function(r){return e.freezeObject=Object.freeze?Object.freeze:function(a){return a},e.freezeObject(r)},e.supportsCanvas=(n=document.createElement("canvas"),!(!e.isFunction(n.getContext)||!n.getContext("2d"))),e.isCanvasTainted=function(r){var a=!1;try{r.getContext("2d").getImageData(0,0,1,1)}catch{a=!0}return a},e.supportsAddEventListener=!(!document.documentElement.addEventListener||!document.addEventListener),e.supportsRemoveEventListener=!(!document.documentElement.removeEventListener||!document.removeEventListener),e.supportsEventListenerOptions=function(){var r=0;if(e.supportsAddEventListener)try{var a={get capture(){return r++,!1},get once(){return r++,!1},get passive(){return r++,!1}};window.addEventListener("test",null,a),window.removeEventListener("test",null,a)}catch{r=0}return 3<=r}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var r=document.createElement("canvas").getContext("2d"),a=window.devicePixelRatio||1;return r=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1,Math.max(a,1)/r}return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(OpenSeadragon),function(e){function t(r){}e.extend=function(){var r,a,l,u,p,d=arguments[0]||{},f=arguments.length,w=!1,T=1;for("boolean"==typeof d&&(w=d,d=arguments[1]||{},T=2),"object"==typeof d||OpenSeadragon.isFunction(d)||(d={}),f===T&&(d=this,--T);T<f;T++)if(null!==(r=arguments[T])||void 0!==r)for(a in r){var S=Object.getOwnPropertyDescriptor(r,a);void 0!==S?S.get||S.set?Object.defineProperty(d,a,S):d!==(l=S.value)&&(w&&l&&(OpenSeadragon.isPlainObject(l)||(u=OpenSeadragon.isArray(l)))?(S=d[a],u?(u=!1,p=S&&OpenSeadragon.isArray(S)?S:[]):p=S&&OpenSeadragon.isPlainObject(S)?S:{},d[a]=OpenSeadragon.extend(w,p,l)):void 0!==l&&(d[a]=l)):e.console.warn('Could not copy inherited property "'+a+'".')}return d},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:function(){if("object"!=typeof navigator)return!1;var r=navigator.userAgent;return"string"==typeof r&&(-1!==r.indexOf("iPhone")||-1!==r.indexOf("iPad")||-1!==r.indexOf("iPod"))}(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(r,a){return function(){var l=arguments;return a.apply(r,l=void 0===l?[]:l)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(r){return e._viewers.get(this.getElement(r))},getElement:function(r){return"string"==typeof r?document.getElementById(r):r},getElementPosition:function(r){var a,l,u=new e.Point;for(l=n(r=e.getElement(r),a="fixed"===e.getElementStyle(r).position);l;)u.x+=r.offsetLeft,u.y+=r.offsetTop,a&&(u=u.plus(e.getPageScroll())),l=n(r=l,a="fixed"===e.getElementStyle(r).position);return u},getElementOffset:function(r){var a,l=(r=e.getElement(r))&&r.ownerDocument,u={top:0,left:0};return l?(a=l.documentElement,void 0!==r.getBoundingClientRect&&(u=r.getBoundingClientRect()),new e.Point(u.left+((l=l===l.window?l:9===l.nodeType&&(l.defaultView||l.parentWindow)).pageXOffset||a.scrollLeft)-(a.clientLeft||0),u.top+(l.pageYOffset||a.scrollTop)-(a.clientTop||0))):new e.Point},getElementSize:function(r){return r=e.getElement(r),new e.Point(r.clientWidth,r.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(r){return(r=e.getElement(r)).currentStyle}:function(r){return r=e.getElement(r),window.getComputedStyle(r,"")},getCssPropertyWithVendorPrefix:function(r){var a={};return e.getCssPropertyWithVendorPrefix=function(l){if(void 0!==a[l])return a[l];var u=document.createElement("div").style,p=null;if(void 0!==u[l])p=l;else for(var d=["Webkit","Moz","MS","O","webkit","moz","ms","o"],f=e.capitalizeFirstLetter(l),w=0;w<d.length;w++){var T=d[w]+f;if(void 0!==u[T]){p=T;break}}return a[l]=p},e.getCssPropertyWithVendorPrefix(r)},capitalizeFirstLetter:function(r){return r.charAt(0).toUpperCase()+r.slice(1)},positiveModulo:function(r,a){return(r%=a)<0&&(r+=a),r},pointInElement:function(u,a){u=e.getElement(u);var l=e.getElementOffset(u);return u=e.getElementSize(u),a.x>=l.x&&a.x<l.x+u.x&&a.y<l.y+u.y&&a.y>=l.y},getMousePosition:function(r){if("number"==typeof r.pageX)e.getMousePosition=function(a){var l=new e.Point;return l.x=a.pageX,l.y=a.pageY,l};else{if("number"!=typeof r.clientX)throw new Error("Unknown event mouse position, no known technique.");e.getMousePosition=function(a){var l=new e.Point;return l.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,l.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop,l}}return e.getMousePosition(r)},getPageScroll:function(){var r=document.documentElement||{},a=document.body||{};if("number"==typeof window.pageXOffset)e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(a.scrollLeft||a.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!r.scrollLeft&&!r.scrollTop)return new e.Point(0,0);e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return e.getPageScroll()},setPageScroll:function(r){if(void 0!==window.scrollTo)e.setPageScroll=function(u){window.scrollTo(u.x,u.y)};else{var a=e.getPageScroll();if(a.x===r.x&&a.y===r.y)return;document.body.scrollLeft=r.x,document.body.scrollTop=r.y;var l=e.getPageScroll();if(l.x!==a.x&&l.y!==a.y)return void(e.setPageScroll=function(u){document.body.scrollLeft=u.x,document.body.scrollTop=u.y});if(document.documentElement.scrollLeft=r.x,document.documentElement.scrollTop=r.y,(l=e.getPageScroll()).x!==a.x&&l.y!==a.y)return void(e.setPageScroll=function(u){document.documentElement.scrollLeft=u.x,document.documentElement.scrollTop=u.y});e.setPageScroll=function(u){}}e.setPageScroll(r)},getWindowSize:function(){var r=document.documentElement||{},a=document.body||{};if("number"==typeof window.innerWidth)e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(r.clientWidth||r.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!a.clientWidth&&!a.clientHeight)throw new Error("Unknown window size, no known technique.");e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)}}return e.getWindowSize()},makeCenteredNode:function(r){r=e.getElement(r);var a=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(a[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(a[1].style,{display:"table-row"}),e.extend(a[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),a[0].appendChild(a[1]),a[1].appendChild(a[2]),a[2].appendChild(r),a[0]},makeNeutralElement:function(l){var a=document.createElement(l);return(l=a.style).background="transparent none",l.border="none",l.margin="0px",l.padding="0px",l.position="static",a},now:function(){return e.now=Date.now?Date.now:function(){return(new Date).getTime()},e.now()},makeTransparentImage:function(r){var a=e.makeNeutralElement("img");return a.src=r,a},setElementOpacity:function(r,a,l){r=e.getElement(r),l&&!e.Browser.alpha&&(a=Math.round(a)),e.Browser.opacity?r.style.opacity=a<1?a:"":a<1?(a=Math.round(100*a),r.style.filter="alpha(opacity="+a+")"):r.style.filter=""},setElementTouchActionNone:function(r){void 0!==(r=e.getElement(r)).style.touchAction?r.style.touchAction="none":void 0!==r.style.msTouchAction&&(r.style.msTouchAction="none")},setElementPointerEvents:function(r,a){void 0!==(r=e.getElement(r)).style&&void 0!==r.style.pointerEvents&&(r.style.pointerEvents=a)},setElementPointerEventsNone:function(r){e.setElementPointerEvents(r,"none")},addClass:function(r,a){(r=e.getElement(r)).className?-1===(" "+r.className+" ").indexOf(" "+a+" ")&&(r.className+=" "+a):r.className=a},indexOf:function(r,a,l){return this.indexOf=Array.prototype.indexOf?function(u,p,d){return u.indexOf(p,d)}:function(u,p,T){var f,w;if(T=T||0,!u)throw new TypeError;if(0===(w=u.length)||w<=T)return-1;for(f=T=T<0?w-Math.abs(T):T;f<w;f++)if(u[f]===p)return f;return-1},this.indexOf(r,a,l)},removeClass:function(r,a){var l,u,p=[];for(l=(r=e.getElement(r)).className.split(/\s+/),u=0;u<l.length;u++)l[u]&&l[u]!==a&&p.push(l[u]);r.className=p.join(" ")},normalizeEventListenerOptions:function(r){return void 0!==r?"boolean"==typeof r?e.supportsEventListenerOptions?{capture:r}:r:e.supportsEventListenerOptions?r:void 0!==r.capture&&r.capture:!!e.supportsEventListenerOptions&&{capture:!1}},addEvent:function(){if(e.supportsAddEventListener)return function(r,a,l,u){u=e.normalizeEventListenerOptions(u),(r=e.getElement(r)).addEventListener(a,l,u)};if(document.documentElement.attachEvent&&document.attachEvent)return function(r,a,l){(r=e.getElement(r)).attachEvent("on"+a,l)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(r,a,l,u){u=e.normalizeEventListenerOptions(u),(r=e.getElement(r)).removeEventListener(a,l,u)};if(document.documentElement.detachEvent&&document.detachEvent)return function(r,a,l){(r=e.getElement(r)).detachEvent("on"+a,l)};throw new Error("No known event model.")}(),cancelEvent:function(r){r.preventDefault()},eventIsCanceled:function(r){return r.defaultPrevented},stopEvent:function(r){r.stopPropagation()},createCallback:function(r,a){var l,u=[];for(l=2;l<arguments.length;l++)u.push(arguments[l]);return function(){var p,d=u.concat([]);for(p=0;p<arguments.length;p++)d.push(arguments[p]);return a.apply(r,d)}},getUrlParameter:function(r){return(r=s[r])||null},getUrlProtocol:function(r){return null===(r=r.match(/^([a-z]+:)\/\//i))?window.location.protocol:r[1].toLowerCase()},createAjaxRequest:function(r){var a;try{a=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{a=!1}if(a)e.createAjaxRequest=window.XMLHttpRequest?function(l){return l?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");e.createAjaxRequest=function(){return new XMLHttpRequest}}return e.createAjaxRequest(r)},makeAjaxRequest:function(r,a,l){var u,p,d,f;e.isPlainObject(r)&&(a=r.success,l=r.error,u=r.withCredentials,p=r.headers,d=r.responseType||null,f=r.postData||null,r=r.url);var w=e.getUrlProtocol(r),T=e.createAjaxRequest("file:"===w);if(!e.isFunction(a))throw new Error("makeAjaxRequest requires a success callback");T.onreadystatechange=function(){4===T.readyState&&(T.onreadystatechange=function(){},200<=T.status&&T.status<300||0===T.status&&"http:"!==w&&"https:"!==w?a(T):e.isFunction(l)?l(T):e.console.error("AJAX request returned %d: %s",T.status,r))};var S=f?"POST":"GET";try{if(T.open(S,r,!0),d&&(T.responseType=d),p)for(var E in p)Object.prototype.hasOwnProperty.call(p,E)&&p[E]&&T.setRequestHeader(E,p[E]);u&&(T.withCredentials=!0),T.send(f)}catch(_){e.console.error("%s while making AJAX request: %s",_.name,_.message),T.onreadystatechange=function(){},e.isFunction(l)&&l(T,_)}return T},jsonp:function(r){var a,l=r.url,u=document.head||document.getElementsByTagName("head")[0]||document.documentElement,p=r.callbackName||"openseadragon"+e.now(),d=window[p],f=r.param||"callback",w=r.callback;l=l.replace(/(=)\?(&|$)|\?\?/i,"$1"+p+"$2"),l+=(/\?/.test(l)?"&":"?")+f+"="+p,window[p]=function(T){if(d)window[p]=d;else try{delete window[p]}catch{}w&&e.isFunction(w)&&w(T)},a=document.createElement("script"),void 0===r.async&&!1===r.async||(a.async="async"),r.scriptCharset&&(a.charset=r.scriptCharset),a.src=l,a.onload=a.onreadystatechange=function(T,S){(S||!a.readyState||/loaded|complete/.test(a.readyState))&&(a.onload=a.onreadystatechange=null,u&&a.parentNode&&u.removeChild(a),a=void 0)},u.insertBefore(a,u.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(r){if(window.DOMParser)e.parseXml=function(a){return(new DOMParser).parseFromString(a,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");e.parseXml=function(a){var l=null;return(l=new ActiveXObject("Microsoft.XMLDOM")).async=!1,l.loadXML(a),l}}return e.parseXml(r)},parseJSON:function(r){return e.parseJSON=window.JSON.parse,e.parseJSON(r)},imageFormatSupported:function(r){return!!i[(r=r||"").toLowerCase()]},setImageFormatsSupported:function(r){e.extend(i,r)}}),e.console=window.console||{log:t,debug:t,info:t,warn:t,error:t,assert:t};var i={bmp:!(e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0}),jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},s={};function n(r,a){return a&&r!==document.body?document.body:r.offsetParent}(function(){var r=navigator.appVersion,a=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(a.substring(a.indexOf("MSIE")+5,a.indexOf(";",a.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=a.indexOf("Edge")?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(a.substring(a.indexOf("Edge")+5))):0<=a.indexOf("Edg")?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(a.substring(a.indexOf("Edg")+4))):0<=a.indexOf("Firefox")?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(a.substring(a.indexOf("Firefox")+8))):0<=a.indexOf("Safari")?(e.Browser.vendor=0<=a.indexOf("Chrome")?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(a.substring(a.substring(0,a.indexOf("Safari")).lastIndexOf("/")+1,a.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(a)&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(r)}var l,u,p=window.location.search.substring(1).split("&");for(u=0;u<p.length;u++)if(0<(f=(l=p[u]).indexOf("="))){var d=l.substring(0,f),f=l.substring(f+1);try{s[d]=decodeURIComponent(f)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",d,f)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(r){var a=r.requestAnimationFrame||r.mozRequestAnimationFrame||r.webkitRequestAnimationFrame||r.msRequestAnimationFrame,l=r.cancelAnimationFrame||r.mozCancelAnimationFrame||r.webkitCancelAnimationFrame||r.msCancelAnimationFrame;if(a&&l)e.requestAnimationFrame=function(){return a.apply(r,arguments)},e.cancelAnimationFrame=function(){return l.apply(r,arguments)};else{var u,p=[],d=[],f=0;e.requestAnimationFrame=function(w){return p.push([++f,w]),u=u||setInterval(function(){if(p.length){var T=e.now(),S=d;for(d=p,p=S;d.length;)d.shift()[1](T)}else clearInterval(u),u=void 0},20),f},e.cancelAnimationFrame=function(w){var T,S;for(T=0,S=p.length;T<S;T+=1)if(p[T][0]===w)return void p.splice(T,1);for(T=0,S=d.length;T<S;T+=1)if(d[T][0]===w)return void d.splice(T,1)}}}(window)}(OpenSeadragon),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.OpenSeadragon=t()}(this,function(){return OpenSeadragon}),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(i){return i.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(i){return i.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(i){return i.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(i){return i.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(i){return i.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return null!==t.getFullScreenElement()},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(OpenSeadragon),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(t,i,s,n){var r=this;n=n||1;var a=0;this.addHandler(t,function l(u){++a===n&&r.removeHandler(t,l),i(u)},s)},addHandler:function(t,i,s){var n=this.events[t];n||(this.events[t]=n=[]),i&&e.isFunction(i)&&(n[n.length]={handler:i,userData:s||null})},removeHandler:function(t,i){var s,n=this.events[t],r=[];if(n&&e.isArray(n)){for(s=0;s<n.length;s++)n[s].handler!==i&&r.push(n[s]);this.events[t]=r}},numberOfHandlers:function(t){return(t=this.events[t])?t.length:0},removeAllHandlers:function(t){if(t)this.events[t]=[];else for(var i in this.events)this.events[i]=[]},getHandler:function(t){var i=this.events[t];return i&&i.length?(i=1===i.length?[i[0]]:Array.apply(null,i),function(s,n){var r,a=i.length;for(r=0;r<a;r++)i[r]&&(n.eventSource=s,n.userData=i[r].userData,i[r].handler(n))}):null},raiseEvent:function(t,i){(t=this.getHandler(t))&&t(this,i=i||{})}}}(OpenSeadragon),function(e){var t=[],i={};e.MouseTracker=function(g){t.push(this);var o=arguments;e.isPlainObject(g)||(g={element:o[0],clickTimeThreshold:o[1],clickDistThreshold:o[2]}),this.hash=Math.random(),this.element=e.getElement(g.element),this.clickTimeThreshold=g.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=g.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=g.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=g.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=g.userData||null,this.stopDelay=g.stopDelay||50,this.preProcessEventHandler=g.preProcessEventHandler||null,this.contextMenuHandler=g.contextMenuHandler||null,this.enterHandler=g.enterHandler||null,this.leaveHandler=g.leaveHandler||null,this.exitHandler=g.exitHandler||null,this.overHandler=g.overHandler||null,this.outHandler=g.outHandler||null,this.pressHandler=g.pressHandler||null,this.nonPrimaryPressHandler=g.nonPrimaryPressHandler||null,this.releaseHandler=g.releaseHandler||null,this.nonPrimaryReleaseHandler=g.nonPrimaryReleaseHandler||null,this.moveHandler=g.moveHandler||null,this.scrollHandler=g.scrollHandler||null,this.clickHandler=g.clickHandler||null,this.dblClickHandler=g.dblClickHandler||null,this.dragHandler=g.dragHandler||null,this.dragEndHandler=g.dragEndHandler||null,this.pinchHandler=g.pinchHandler||null,this.stopHandler=g.stopHandler||null,this.keyDownHandler=g.keyDownHandler||null,this.keyUpHandler=g.keyUpHandler||null,this.keyHandler=g.keyHandler||null,this.focusHandler=g.focusHandler||null,this.blurHandler=g.blurHandler||null;var h=this;i[this.hash]={click:function(c){var v,x;H(h,x={originalEvent:v=c,eventType:"click",pointerType:"mouse",isEmulated:!1}),x.preventDefault&&!x.defaultPrevented&&e.cancelEvent(v),x.stopPropagation&&e.stopEvent(v)},dblclick:function(c){var v,x;H(h,x={originalEvent:v=c,eventType:"dblclick",pointerType:"mouse",isEmulated:!1}),x.preventDefault&&!x.defaultPrevented&&e.cancelEvent(v),x.stopPropagation&&e.stopEvent(v)},keydown:function(c){var m,v,x,y;x=null,H(m=h,y={originalEvent:v=c,eventType:"keydown",pointerType:"",isEmulated:!1}),m.keyDownHandler&&!y.preventGesture&&!y.defaultPrevented&&m.keyDownHandler(x={eventSource:m,keyCode:v.keyCode||v.charCode,ctrl:v.ctrlKey,shift:v.shiftKey,alt:v.altKey,meta:v.metaKey,originalEvent:v,preventDefault:y.preventDefault||y.defaultPrevented,userData:m.userData}),(x&&x.preventDefault||y.preventDefault&&!y.defaultPrevented)&&e.cancelEvent(v),y.stopPropagation&&e.stopEvent(v)},keyup:function(c){var m,v,x,y;x=null,H(m=h,y={originalEvent:v=c,eventType:"keyup",pointerType:"",isEmulated:!1}),m.keyUpHandler&&!y.preventGesture&&!y.defaultPrevented&&m.keyUpHandler(x={eventSource:m,keyCode:v.keyCode||v.charCode,ctrl:v.ctrlKey,shift:v.shiftKey,alt:v.altKey,meta:v.metaKey,originalEvent:v,preventDefault:y.preventDefault||y.defaultPrevented,userData:m.userData}),(x&&x.preventDefault||y.preventDefault&&!y.defaultPrevented)&&e.cancelEvent(v),y.stopPropagation&&e.stopEvent(v)},keypress:function(c){var m,v,x,y;x=null,H(m=h,y={originalEvent:v=c,eventType:"keypress",pointerType:"",isEmulated:!1}),m.keyHandler&&!y.preventGesture&&!y.defaultPrevented&&m.keyHandler(x={eventSource:m,keyCode:v.keyCode||v.charCode,ctrl:v.ctrlKey,shift:v.shiftKey,alt:v.altKey,meta:v.metaKey,originalEvent:v,preventDefault:y.preventDefault||y.defaultPrevented,userData:m.userData}),(x&&x.preventDefault||y.preventDefault&&!y.defaultPrevented)&&e.cancelEvent(v),y.stopPropagation&&e.stopEvent(v)},focus:function(c){var m,v,x;H(m=h,x={originalEvent:v=c,eventType:"focus",pointerType:"",isEmulated:!1}),m.focusHandler&&!x.preventGesture&&m.focusHandler({eventSource:m,originalEvent:v,userData:m.userData})},blur:function(c){var m,v,x;H(m=h,x={originalEvent:v=c,eventType:"blur",pointerType:"",isEmulated:!1}),m.blurHandler&&!x.preventGesture&&m.blurHandler({eventSource:m,originalEvent:v,userData:m.userData})},contextmenu:function(c){var m,v,x,y;x=null,H(m=h,y={originalEvent:v=c,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1}),m.contextMenuHandler&&!y.preventGesture&&!y.defaultPrevented&&(x={eventSource:m,position:D(R(v),m.element),originalEvent:y.originalEvent,preventDefault:y.preventDefault||y.defaultPrevented,userData:m.userData},m.contextMenuHandler(x)),(x&&x.preventDefault||y.preventDefault&&!y.defaultPrevented)&&e.cancelEvent(v),y.stopPropagation&&e.stopEvent(v)},wheel:function(c){Y(h,c,c)},mousewheel:function(c){U(h,c)},DOMMouseScroll:function(c){U(h,c)},MozMousePixelScroll:function(c){U(h,c)},losecapture:function(c){var m,v,x,y;x={id:e.MouseTracker.mousePointerId,type:"mouse"},H(m=h,y={originalEvent:v=c,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1}),v.target===m.element&&A(m,x,!1),y.stopPropagation&&e.stopEvent(v)},mouseenter:function(c){K(h,c)},mouseleave:function(c){Q(h,c)},mouseover:function(c){J(h,c)},mouseout:function(c){V(h,c)},mousedown:function(c){G(h,c)},mouseup:function(c){j(h,c)},mousemove:function(c){$(h,c)},touchstart:function(c){!function(m,v){var x,y,P,I=v.changedTouches.length,b=m.getActivePointersListByType("touch");x=e.now(),b.getLength()>v.touches.length-I&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var B={originalEvent:v,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(H(m,B),y=0;y<I;y++)te(m,B,P={id:v.changedTouches[y].identifier,type:"touch",isPrimary:0===b.getLength(),currentPos:R(v.changedTouches[y]),currentTime:x}),ne(m,B,P,0),A(m,P,!0);B.preventDefault&&!B.defaultPrevented&&e.cancelEvent(v),B.stopPropagation&&e.stopEvent(v)}(h,c)},touchend:function(c){!function(m,v){var x,y,P,I=v.changedTouches.length;x=e.now();var b={originalEvent:v,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(H(m,b),y=0;y<I;y++)oe(m,b,P={id:v.changedTouches[y].identifier,type:"touch",currentPos:R(v.changedTouches[y]),currentTime:x},0),A(m,P,!1),ie(m,b,P);b.preventDefault&&!b.defaultPrevented&&e.cancelEvent(v),b.stopPropagation&&e.stopEvent(v)}(h,c)},touchmove:function(c){!function(m,v){var x,y,I=v.changedTouches.length;x=e.now();var b={originalEvent:v,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(H(m,b),y=0;y<I;y++)re(m,b,{id:v.changedTouches[y].identifier,type:"touch",currentPos:R(v.changedTouches[y]),currentTime:x});b.preventDefault&&!b.defaultPrevented&&e.cancelEvent(v),b.stopPropagation&&e.stopEvent(v)}(h,c)},touchcancel:function(c){!function(m,v){var x,P=v.changedTouches.length,I={originalEvent:v,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(H(m,I),x=0;x<P;x++)se(m,0,{id:v.changedTouches[x].identifier,type:"touch"});I.stopPropagation&&e.stopEvent(v)}(h,c)},gesturestart:function(c){e.eventIsCanceled(c)||c.preventDefault()},gesturechange:function(c){e.eventIsCanceled(c)||c.preventDefault()},gotpointercapture:function(c){var m,v,x;H(m=h,x={originalEvent:v=c,eventType:"gotpointercapture",pointerType:_(v),isEmulated:!1}),v.target===m.element&&A(m,{id:v.pointerId,type:_(v)},!0),x.stopPropagation&&e.stopEvent(v)},lostpointercapture:function(c){var m,v,x;H(m=h,x={originalEvent:v=c,eventType:"lostpointercapture",pointerType:_(v),isEmulated:!1}),v.target===m.element&&A(m,{id:v.pointerId,type:_(v)},!1),x.stopPropagation&&e.stopEvent(v)},pointerenter:function(c){K(h,c)},pointerleave:function(c){Q(h,c)},pointerover:function(c){J(h,c)},pointerout:function(c){V(h,c)},pointerdown:function(c){G(h,c)},pointerup:function(c){j(h,c)},pointermove:function(c){$(h,c)},pointercancel:function(c){var m,v,x,y;m=h,x={id:(v=c).pointerId,type:_(v)},H(m,y={originalEvent:v,eventType:"pointercancel",pointerType:x.type,isEmulated:!1}),se(m,0,x),y.stopPropagation&&e.stopEvent(v)},pointerupcaptured:function(c){var m,v;(m=h).getActivePointersListByType(_(v=c)).getById(v.pointerId)&&k(m,v),e.stopEvent(v)},pointermovecaptured:function(c){var m,v;(m=h).getActivePointersListByType(_(v=c)).getById(v.pointerId)&&ee(m,v),e.stopEvent(v)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),g.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var g;for(w(this),this.element=null,g=0;g<t.length;g++)if(t[g]===this){t.splice(g,1);break}i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(g){return(g?function(o){var h,c,m=i[o.hash];if(!m.tracking){for(c=0;c<e.MouseTracker.subscribeEvents.length;c++)e.addEvent(o.element,h=e.MouseTracker.subscribeEvents[c],m[h],h===e.MouseTracker.wheelEventName&&{passive:!1,capture:!1});f(o),m.tracking=!0}}:w)(this),this},getActivePointersListByType:function(g){var o,h,c=i[this.hash],m=c.activePointersLists.length;for(o=0;o<m;o++)if(c.activePointersLists[o].type===g)return c.activePointersLists[o];return h=new e.MouseTracker.GesturePointList(g),c.activePointersLists.push(h),h},getActivePointerCount:function(){var g,o=i[this.hash],h=o.activePointersLists.length,c=0;for(g=0;g<h;g++)c+=o.activePointersLists[g].getLength();return c},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var l,u,p,d,s=function(){try{return window.self!==window.top}catch{return!0}}();function n(g){try{return g.addEventListener&&g.removeEventListener}catch{return}}function r(g,o){return g.hash.toString()+o.type+o.id.toString()}function a(){var g,o,h,c,m,v=l.length,x=e.now();for(c=x-p,p=x,g=0;g<v;g++)(h=(o=l[g]).gPoint).direction=Math.atan2(h.currentPos.y-o.lastPos.y,h.currentPos.x-o.lastPos.x),m=o.lastPos.distanceTo(h.currentPos),o.lastPos=h.currentPos,h.speed=1e3*m/(1+c)*.75+.25*h.speed}function f(g){var o,h,c,m,v,x=i[g.hash],y=x.activePointersLists.length;for(o=0;o<y;o++)if(0<(c=x.activePointersLists[o]).getLength()){for(v=[],m=c.asArray(),h=0;h<m.length;h++)v.push(m[h]);for(h=0;h<v.length;h++)W(g,c,v[h])}for(o=0;o<y;o++)x.activePointersLists.pop();x.sentDragEvent=!1}function w(g){var o,h,c=i[g.hash];if(c.tracking){for(h=0;h<e.MouseTracker.subscribeEvents.length;h++)e.removeEvent(g.element,o=e.MouseTracker.subscribeEvents[h],c[o],!1);f(g),c.tracking=!1}}function T(g,o){if(g=i[g.hash],"pointerevent"===o)return{upName:"pointerup",upHandler:g.pointerupcaptured,moveName:"pointermove",moveHandler:g.pointermovecaptured};if("mouse"===o)return{upName:"pointerup",upHandler:g.pointerupcaptured,moveName:"pointermove",moveHandler:g.pointermovecaptured};if("touch"===o)return{upName:"touchend",upHandler:g.touchendcaptured,moveName:"touchmove",moveHandler:g.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function S(g,o){var h;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(!(h=g.getActivePointersListByType(o.type).getById(o.id))||!h.captured)return;try{g.element.releasePointerCapture(o.id)}catch{}}else g.element.releaseCapture();else h=T(g,e.MouseTracker.havePointerEvents?"pointerevent":o.type),s&&n(window.top)&&e.removeEvent(window.top,h.upName,h.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,h.moveName,h.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,h.upName,h.upHandler,!0);A(g,o,!1)}function E(g){return e.MouseTracker.havePointerEvents?g.pointerId:e.MouseTracker.mousePointerId}function _(g){return e.MouseTracker.havePointerEvents?g.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function C(g){return!e.MouseTracker.havePointerEvents||g.isPrimary}function R(g){return e.getMousePosition(g)}function z(g,o){return D(R(g),o)}function D(g,o){return o=e.getElementOffset(o),g.minus(o)}function L(g,o){return new e.Point((g.x+o.x)/2,(g.y+o.y)/2)}function U(g,o){var h={target:o.target||o.srcElement,type:"wheel",shiftKey:o.shiftKey||!1,clientX:o.clientX,clientY:o.clientY,pageX:o.pageX||o.clientX,pageY:o.pageY||o.clientY,deltaMode:"MozMousePixelScroll"===o.type?0:1,deltaX:0,deltaZ:0};h.deltaY="mousewheel"===e.MouseTracker.wheelEventName?-o.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:o.detail,Y(g,h,o)}function Y(g,o,h){var c,m,v=null;c=o.deltaY<0?1:-1,H(g,m={originalEvent:o,eventType:"wheel",pointerType:"mouse",isEmulated:o!==h}),g.scrollHandler&&!m.preventGesture&&!m.defaultPrevented&&(v={eventSource:g,pointerType:"mouse",position:z(o,g.element),scroll:c,shift:o.shiftKey,isTouchEvent:!1,originalEvent:h,preventDefault:m.preventDefault||m.defaultPrevented,userData:g.userData},g.scrollHandler(v)),m.stopPropagation&&e.stopEvent(h),(v&&v.preventDefault||m.preventDefault&&!m.defaultPrevented)&&e.cancelEvent(h)}function K(g,o){var h={id:E(o),type:_(o),isPrimary:C(o),currentPos:R(o),currentTime:e.now()};H(g,o={originalEvent:o,eventType:"pointerenter",pointerType:h.type,isEmulated:!1}),te(g,o,h)}function Q(g,o){var h={id:E(o),type:_(o),isPrimary:C(o),currentPos:R(o),currentTime:e.now()};H(g,o={originalEvent:o,eventType:"pointerleave",pointerType:h.type,isEmulated:!1}),ie(g,o,h)}function J(g,o){var m,v,x,y,P,h={id:E(o),type:_(o),isPrimary:C(o),currentPos:R(o),currentTime:e.now()},c={originalEvent:o,eventType:"pointerover",pointerType:h.type,isEmulated:!1};H(g,c),v=c,(P=(y=(m=g).getActivePointersListByType((x=h).type)).getById(x.id))?x=P:(x.captured=!1,x.insideElementPressed=!1),m.overHandler&&m.overHandler({eventSource:m,pointerType:x.type,position:D(x.currentPos,m.element),buttons:y.buttons,pointers:m.getActivePointerCount(),insideElementPressed:x.insideElementPressed,buttonDownAny:0!==y.buttons,isTouchEvent:"touch"===x.type,originalEvent:v.originalEvent,userData:m.userData}),c.preventDefault&&!c.defaultPrevented&&e.cancelEvent(o),c.stopPropagation&&e.stopEvent(o)}function V(g,o){var m,v,x,y,P,h={id:E(o),type:_(o),isPrimary:C(o),currentPos:R(o),currentTime:e.now()},c={originalEvent:o,eventType:"pointerout",pointerType:h.type,isEmulated:!1};H(g,c),v=c,(P=(y=(m=g).getActivePointersListByType((x=h).type)).getById(x.id))?x=P:(x.captured=!1,x.insideElementPressed=!1),m.outHandler&&m.outHandler({eventSource:m,pointerType:x.type,position:x.currentPos&&D(x.currentPos,m.element),buttons:y.buttons,pointers:m.getActivePointerCount(),insideElementPressed:x.insideElementPressed,buttonDownAny:0!==y.buttons,isTouchEvent:"touch"===x.type,originalEvent:v.originalEvent,userData:m.userData}),c.preventDefault&&!c.defaultPrevented&&e.cancelEvent(o),c.stopPropagation&&e.stopEvent(o)}function G(g,o){var h={id:E(o),type:_(o),isPrimary:C(o),currentPos:R(o),currentTime:e.now()},c=e.MouseTracker.havePointerEvents&&"touch"===h.type&&e.Browser.vendor!==e.BROWSERS.IE,m={originalEvent:o,eventType:"pointerdown",pointerType:h.type,isEmulated:!1};H(g,m),ne(g,m,h,o.button),m.preventDefault&&!m.defaultPrevented&&e.cancelEvent(o),m.stopPropagation&&e.stopEvent(o),m.shouldCapture&&(c?A(g,h,!0):function(v,x){var y;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{v.element.setPointerCapture(x.id)}catch{return void e.console.warn("setPointerCapture() called on invalid pointer ID")}else v.element.setCapture(!0);else y=T(v,e.MouseTracker.havePointerEvents?"pointerevent":x.type),s&&n(window.top)&&e.addEvent(window.top,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.moveName,y.moveHandler,!0);A(v,x,!0)}(g,h))}function j(g,o){k(g,o)}function k(g,o){var h,c={originalEvent:o,eventType:"pointerup",pointerType:(h={id:E(o),type:_(o),isPrimary:C(o),currentPos:R(o),currentTime:e.now()}).type,isEmulated:!1};H(g,c),oe(g,c,h,o.button),c.preventDefault&&!c.defaultPrevented&&e.cancelEvent(o),c.stopPropagation&&e.stopEvent(o),c.shouldReleaseCapture&&(o.target===g.element?S(g,h):A(g,h,!1))}function $(g,o){ee(g,o)}function ee(g,o){var h={id:E(o),type:_(o),isPrimary:C(o),currentPos:R(o),currentTime:e.now()},c={originalEvent:o,eventType:"pointermove",pointerType:h.type,isEmulated:!1};H(g,c),re(g,c,h),c.preventDefault&&!c.defaultPrevented&&e.cancelEvent(o),c.stopPropagation&&e.stopEvent(o)}function q(g,o){return o.speed=0,o.direction=0,o.contactPos=o.currentPos,o.contactTime=o.currentTime,o.lastPos=o.currentPos,o.lastTime=o.currentTime,g.add(o)}function W(g,o,h){var c,m=o.getById(h.id);return m?(m.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),S(g,m)),o.removeContact(),c=o.removeById(h.id)):c=o.getLength(),c}function H(g,o){o.eventSource=g,o.eventPhase=o.originalEvent&&void 0!==o.originalEvent.eventPhase?o.originalEvent.eventPhase:0,o.defaultPrevented=e.eventIsCanceled(o.originalEvent),o.shouldCapture=!1,o.shouldReleaseCapture=!1,o.userData=g.userData,function(h,c){switch(c.eventType){case"pointermove":case"pointerdown":case"pointerup":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!1,c.preventGesture=!h.hasGestureHandlers,c.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!1,c.preventGesture=!1,c.stopPropagation=!1;break;case"wheel":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!1,c.preventGesture=!h.hasScrollHandler,c.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":c.isStoppable=!0,c.isCancelable=!1,c.preventDefault=!1,c.preventGesture=!1,c.stopPropagation=!1;break;case"click":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!!h.clickHandler,c.preventGesture=!1,c.stopPropagation=!1;break;case"dblclick":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!!h.dblClickHandler,c.preventGesture=!1,c.stopPropagation=!1;break;default:c.isStoppable=!1,c.isCancelable=!1,c.preventDefault=!1,c.preventGesture=!1,c.stopPropagation=!1}}(g,o),g.preProcessEventHandler&&g.preProcessEventHandler(o)}function A(g,o,h){(o=(g=g.getActivePointersListByType(o.type)).getById(o.id))?h&&!o.captured?(o.captured=!0,g.captureCount++):!h&&o.captured&&(o.captured=!1,g.captureCount--,g.captureCount<0&&(g.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function te(g,o,h){var c,m=g.getActivePointersListByType(h.type);(c=m.getById(h.id))?(c.insideElement=!0,c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=h.currentPos,c.currentTime=h.currentTime,h=c):(h.captured=!1,h.insideElementPressed=!1,h.insideElement=!0,q(m,h)),g.enterHandler&&g.enterHandler({eventSource:g,pointerType:h.type,position:D(h.currentPos,g.element),buttons:m.buttons,pointers:g.getActivePointerCount(),insideElementPressed:h.insideElementPressed,buttonDownAny:0!==m.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:g.userData})}function ie(g,o,h){var c,m=g.getActivePointersListByType(h.type);(c=m.getById(h.id))?(c.captured?(c.insideElement=!1,c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=h.currentPos,c.currentTime=h.currentTime):W(g,m,c),h=c):(h.captured=!1,h.insideElementPressed=!1),(g.leaveHandler||g.exitHandler)&&(o={eventSource:g,pointerType:h.type,position:h.currentPos&&D(h.currentPos,g.element),buttons:m.buttons,pointers:g.getActivePointerCount(),insideElementPressed:h.insideElementPressed,buttonDownAny:0!==m.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:g.userData},g.leaveHandler&&g.leaveHandler(o),g.exitHandler&&g.exitHandler(o))}function ne(g,o,h,c){var m,v=i[g.hash],x=g.getActivePointersListByType(h.type);void 0!==o.originalEvent.buttons?x.buttons=o.originalEvent.buttons:0===c?x.buttons|=1:1===c?x.buttons|=4:2===c?x.buttons|=2:3===c?x.buttons|=8:4===c?x.buttons|=16:5===c&&(x.buttons|=32),0===c?((m=x.getById(h.id))?(m.insideElementPressed=!0,m.insideElement=!0,m.originalTarget=o.originalEvent.target,m.contactPos=h.currentPos,m.contactTime=h.currentTime,m.lastPos=m.currentPos,m.lastTime=m.currentTime,m.currentPos=h.currentPos,m.currentTime=h.currentTime,h=m):(h.captured=!1,h.insideElementPressed=!0,h.insideElement=!0,h.originalTarget=o.originalEvent.target,q(x,h)),x.addContact(),o.preventGesture||o.defaultPrevented?(o.shouldCapture=!1,o.shouldReleaseCapture=!1):(o.shouldCapture=!0,o.shouldReleaseCapture=!1,o.preventDefault=!0,(g.dragHandler||g.dragEndHandler||g.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(g,h),1===x.contacts?g.pressHandler&&!o.preventGesture&&g.pressHandler({eventSource:g,pointerType:h.type,position:D(h.contactPos,g.element),buttons:x.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:g.userData}):2===x.contacts&&g.pinchHandler&&"touch"===h.type&&(v.pinchGPoints=x.asArray(),v.lastPinchDist=v.currentPinchDist=v.pinchGPoints[0].currentPos.distanceTo(v.pinchGPoints[1].currentPos),v.lastPinchCenter=v.currentPinchCenter=L(v.pinchGPoints[0].currentPos,v.pinchGPoints[1].currentPos)))):(o.shouldCapture=!1,o.shouldReleaseCapture=!1,g.nonPrimaryPressHandler&&!o.preventGesture&&!o.defaultPrevented&&(o.preventDefault=!0,g.nonPrimaryPressHandler({eventSource:g,pointerType:h.type,position:D(h.currentPos,g.element),button:c,buttons:x.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:g.userData})))}function oe(g,o,h,c){var m,v,x,y=i[g.hash],P=g.getActivePointersListByType(h.type),I=!1;void 0!==o.originalEvent.buttons?P.buttons=o.originalEvent.buttons:0===c?P.buttons^=-2:1===c?P.buttons^=-5:2===c?P.buttons^=-3:3===c?P.buttons^=-9:4===c?P.buttons^=-17:5===c&&(P.buttons^=-33),o.shouldCapture=!1,0===c?((v=P.getById(h.id))?(P.removeContact(),v.captured&&(I=!0),v.lastPos=v.currentPos,v.lastTime=v.currentTime,v.currentPos=h.currentPos,v.currentTime=h.currentTime,v.insideElement||W(g,P,v),m=v.currentPos,x=v.currentTime):(h.captured=!1,h.insideElementPressed=!1,h.insideElement=!0,q(P,h),v=h),!o.preventGesture&&!o.defaultPrevented&&(I?(o.shouldReleaseCapture=!0,o.preventDefault=!0,(g.dragHandler||g.dragEndHandler||g.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(g,v),0===P.contacts?(g.releaseHandler&&m&&g.releaseHandler({eventSource:g,pointerType:v.type,position:D(m,g.element),buttons:P.buttons,insideElementPressed:v.insideElementPressed,insideElementReleased:v.insideElement,isTouchEvent:"touch"===v.type,originalEvent:o.originalEvent,userData:g.userData}),g.dragEndHandler&&y.sentDragEvent&&g.dragEndHandler({eventSource:g,pointerType:v.type,position:D(v.currentPos,g.element),speed:v.speed,direction:v.direction,shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===v.type,originalEvent:o.originalEvent,userData:g.userData}),y.sentDragEvent=!1,(g.clickHandler||g.dblClickHandler)&&v.insideElement&&(x=x-v.contactTime<=g.clickTimeThreshold&&v.contactPos.distanceTo(m)<=g.clickDistThreshold,g.clickHandler&&g.clickHandler({eventSource:g,pointerType:v.type,position:D(v.currentPos,g.element),quick:x,shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===v.type,originalEvent:o.originalEvent,originalTarget:v.originalTarget,userData:g.userData}),g.dblClickHandler&&x&&(P.clicks++,1===P.clicks?(y.lastClickPos=m,y.dblClickTimeOut=setTimeout(function(){P.clicks=0},g.dblClickTimeThreshold)):2===P.clicks&&(clearTimeout(y.dblClickTimeOut),P.clicks=0,y.lastClickPos.distanceTo(m)<=g.dblClickDistThreshold&&g.dblClickHandler({eventSource:g,pointerType:v.type,position:D(v.currentPos,g.element),shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===v.type,originalEvent:o.originalEvent,userData:g.userData}),y.lastClickPos=null)))):2===P.contacts&&g.pinchHandler&&"touch"===v.type&&(y.pinchGPoints=P.asArray(),y.lastPinchDist=y.currentPinchDist=y.pinchGPoints[0].currentPos.distanceTo(y.pinchGPoints[1].currentPos),y.lastPinchCenter=y.currentPinchCenter=L(y.pinchGPoints[0].currentPos,y.pinchGPoints[1].currentPos))):(o.shouldReleaseCapture=!1,g.releaseHandler&&m&&(g.releaseHandler({eventSource:g,pointerType:v.type,position:D(m,g.element),buttons:P.buttons,insideElementPressed:v.insideElementPressed,insideElementReleased:v.insideElement,isTouchEvent:"touch"===v.type,originalEvent:o.originalEvent,userData:g.userData}),o.preventDefault=!0)))):(o.shouldReleaseCapture=!1,g.nonPrimaryReleaseHandler&&!o.preventGesture&&!o.defaultPrevented&&(o.preventDefault=!0,g.nonPrimaryReleaseHandler({eventSource:g,pointerType:h.type,position:D(h.currentPos,g.element),button:c,buttons:P.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:g.userData})))}function re(g,o,h){var c,m,v=i[g.hash],x=g.getActivePointersListByType(h.type);void 0!==o.originalEvent.buttons&&(x.buttons=o.originalEvent.buttons),(c=x.getById(h.id))&&(c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=h.currentPos,c.currentTime=h.currentTime,o.shouldCapture=!1,o.shouldReleaseCapture=!1,g.stopHandler&&"mouse"===h.type&&(clearTimeout(g.stopTimeOut),g.stopTimeOut=setTimeout(function(){var y,P,I;P=o.originalEvent,I=h.type,(y=g).stopHandler&&y.stopHandler({eventSource:y,pointerType:I,position:z(P,y.element),buttons:y.getActivePointersListByType(I).buttons,isTouchEvent:"touch"===I,originalEvent:P,userData:y.userData})},g.stopDelay)),0===x.contacts?g.moveHandler&&g.moveHandler({eventSource:g,pointerType:h.type,position:D(h.currentPos,g.element),buttons:x.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:g.userData}):1===x.contacts?(g.moveHandler&&(c=x.asArray()[0],g.moveHandler({eventSource:g,pointerType:c.type,position:D(c.currentPos,g.element),buttons:x.buttons,isTouchEvent:"touch"===c.type,originalEvent:o.originalEvent,userData:g.userData})),g.dragHandler&&!o.preventGesture&&!o.defaultPrevented&&(m=(c=x.asArray()[0]).currentPos.minus(c.lastPos),g.dragHandler({eventSource:g,pointerType:c.type,position:D(c.currentPos,g.element),buttons:x.buttons,delta:m,speed:c.speed,direction:c.direction,shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===c.type,originalEvent:o.originalEvent,userData:g.userData}),o.preventDefault=!0,v.sentDragEvent=!0)):2===x.contacts&&(g.moveHandler&&(c=x.asArray(),g.moveHandler({eventSource:g,pointerType:c[0].type,position:D(L(c[0].currentPos,c[1].currentPos),g.element),buttons:x.buttons,isTouchEvent:"touch"===c[0].type,originalEvent:o.originalEvent,userData:g.userData})),g.pinchHandler&&"touch"===h.type&&!o.preventGesture&&!o.defaultPrevented&&(m=v.pinchGPoints[0].currentPos.distanceTo(v.pinchGPoints[1].currentPos))!==v.currentPinchDist&&(v.lastPinchDist=v.currentPinchDist,v.currentPinchDist=m,v.lastPinchCenter=v.currentPinchCenter,v.currentPinchCenter=L(v.pinchGPoints[0].currentPos,v.pinchGPoints[1].currentPos),g.pinchHandler({eventSource:g,pointerType:"touch",gesturePoints:v.pinchGPoints,lastCenter:D(v.lastPinchCenter,g.element),center:D(v.currentPinchCenter,g.element),lastDistance:v.lastPinchDist,distance:v.currentPinchDist,shift:o.originalEvent.shiftKey,originalEvent:o.originalEvent,userData:g.userData}),o.preventDefault=!0)))}function se(g,o,h){var c=g.getActivePointersListByType(h.type);(h=c.getById(h.id))&&W(g,c,h)}e.MouseTracker.gesturePointVelocityTracker=(l=[],p=u=0,{addPoint:function(g,o){g=r(g,o),l.push({guid:g,gPoint:o,lastPos:o.currentPos}),1===l.length&&(p=e.now(),u=window.setInterval(a,50))},removePoint:function(g,o){var h,c=r(g,o),m=l.length;for(h=0;h<m;h++)if(l[h].guid===c){l.splice(h,1),0==--m&&window.clearInterval(u);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&8<e.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],"DOMMouseScroll"===e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=(d=document.createElement("div"),e.isFunction(d.setPointerCapture)&&e.isFunction(d.releasePointerCapture)),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=(d=document.createElement("div"),e.isFunction(d.setCapture)&&e.isFunction(d.releaseCapture)),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(g){this._gPoints=[],this.type=g,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(g){return this._gPoints.push(g)},removeById:function(g){var o,h=this._gPoints.length;for(o=0;o<h;o++)if(this._gPoints[o].id===g){this._gPoints.splice(o,1);break}return this._gPoints.length},getByIndex:function(g){return g<this._gPoints.length?this._gPoints[g]:null},getById:function(g){var o,h=this._gPoints.length;for(o=0;o<h;o++)if(this._gPoints[o].id===g)return this._gPoints[o];return null},getPrimary:function(g){var o,h=this._gPoints.length;for(o=0;o<h;o++)if(this._gPoints[o].isPrimary)return this._gPoints[o];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,s){var n=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=void 0===i.attachToViewer||i.attachToViewer,this.autoFade=void 0===i.autoFade||i.autoFade,this.element=t,this.anchor=i.anchor,this.container=s,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):n.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!==this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){e.setElementOpacity(this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?this.element:this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(i,s){var n,r=i.controls;for(n=r.length-1;0<=n;n--)if(r[n].element===s)return n;return-1}e.ControlDock=function(i){var s,n,r=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<r.length;n++)this.controls[s=r[n]]=e.makeNeutralElement("div"),this.controls[s].style.position="absolute",s.match("left")&&(this.controls[s].style.left="0px"),s.match("right")&&(this.controls[s].style.right="0px"),s.match("top")&&(this.controls[s].style.top="0px"),s.match("bottom")&&(this.controls[s].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,s){var n=null;if(!(0<=t(this,i=e.getElement(i)))){switch(s.anchor){case e.ControlAnchor.TOP_RIGHT:n=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:n=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:n=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:n=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;default:n=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,s,n)),i.style.display="inline-block"}},removeControl:function(i){return 0<=(i=t(this,i=e.getElement(i)))&&(this.controls[i].destroy(),this.controls.splice(i,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;0<=i;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(i){var s;for(s=this.controls.length-1;0<=s;s--)this.controls[s].setVisible(i);return this}}}(OpenSeadragon),OpenSeadragon.Placement=OpenSeadragon.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}}),function(e){var t={},i=1;function s(o){return o=e.getElement(o),new e.Point(0===o.clientWidth?1:o.clientWidth,0===o.clientHeight?1:o.clientHeight)}function n(o,h){if(h instanceof e.Overlay)return h;var c=null;if(h.element)c=e.getElement(h.element);else{var m=h.id||"openseadragon-overlay-"+Math.floor(1e7*Math.random());(c=e.getElement(h.id))||((c=document.createElement("a")).href="#/overlay/"+m),c.id=m,e.addClass(c,h.className||"openseadragon-overlay")}var v=h.location,x=h.width,y=h.height;if(!v){m=h.x;var P=h.y;void 0!==h.px&&(m=(o=o.viewport.imageToViewportRectangle(new e.Rect(h.px,h.py,x||0,y||0))).x,P=o.y,x=void 0!==x?o.width:void 0,y=void 0!==y?o.height:void 0),v=new e.Point(m,P)}return(P=h.placement)&&"string"===e.type(P)&&(P=e.Placement[h.placement.toUpperCase()]),new e.Overlay({element:c,location:v,placement:P,onDraw:h.onDraw,checkResize:h.checkResize,width:x,height:y,rotationMode:h.rotationMode})}function r(o,h){var c;for(c=o.length-1;0<=c;c--)if(o[c].element===h)return c;return-1}function a(o,h){return e.requestAnimationFrame(function(){h(o)})}function l(o){e.requestAnimationFrame(function(){!function(h){var c,m,v;if(h.controlsShouldFade){for(c=e.now(),m=1-(c-=h.controlsFadeBeginTime)/h.controlsFadeLength,m=Math.min(1,m),m=Math.max(0,m),v=h.controls.length-1;0<=v;v--)h.controls[v].autoFade&&h.controls[v].setOpacity(m);0<m&&l(h)}}(o)})}function u(o){o.autoHideControls&&(o.controlsShouldFade=!0,o.controlsFadeBeginTime=e.now()+o.controlsFadeDelay,window.setTimeout(function(){l(o)},o.controlsFadeDelay))}function p(o){var h;for(o.controlsShouldFade=!1,h=o.controls.length-1;0<=h;h--)o.controls[h].setOpacity(1)}function d(){p(this)}function f(){u(this)}function w(o){var h={tracker:o.eventSource,position:o.position,originalEvent:o.originalEvent,preventDefault:o.preventDefault};this.raiseEvent("canvas-contextmenu",h),o.preventDefault=h.preventDefault}function T(o){var h={originalEvent:o.originalEvent,preventDefaultAction:!1,preventVerticalPan:o.preventVerticalPan||!this.panVertical,preventHorizontalPan:o.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",h),h.preventDefaultAction||o.ctrl||o.alt||o.meta)o.preventDefault=!1;else switch(o.keyCode){case 38:h.preventVerticalPan||(o.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 40:h.preventVerticalPan||(o.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 37:h.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 39:h.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;default:o.preventDefault=!1}}function S(o){var h={originalEvent:o.originalEvent,preventDefaultAction:!1,preventVerticalPan:o.preventVerticalPan||!this.panVertical,preventHorizontalPan:o.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",h),h.preventDefaultAction||o.ctrl||o.alt||o.meta)o.preventDefault=!1;else switch(o.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 119:case 87:h.preventVerticalPan||(o.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 115:case 83:h.preventVerticalPan||(o.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 97:h.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 100:h.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 114:this.viewport.setRotation(this.viewport.flipped?this.viewport.getRotation()-this.rotationIncrement:this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 82:this.viewport.setRotation(this.viewport.flipped?this.viewport.getRotation()+this.rotationIncrement:this.viewport.getRotation()-this.rotationIncrement),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),o.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:o.preventDefault=!1}}function E(o){document.activeElement===this.canvas||this.canvas.focus(),this.viewport.flipped&&(o.position.x=this.viewport.getContainerSize().x-o.position.x);var h={tracker:o.eventSource,position:o.position,quick:o.quick,shift:o.shift,originalEvent:o.originalEvent,originalTarget:o.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",h),!h.preventDefaultAction&&this.viewport&&o.quick&&(!0===(h=this.gestureSettingsByDeviceType(o.pointerType)).clickToZoom&&(this.viewport.zoomBy(o.shift?1/this.zoomPerClick:this.zoomPerClick,h.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints()),h.dblClickDragToZoom&&(!0===t[this.hash].draggingToZoom?(t[this.hash].lastClickTime=null,t[this.hash].draggingToZoom=!1):t[this.hash].lastClickTime=e.now()))}function _(o){var h,c={tracker:o.eventSource,position:o.position,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",c),!c.preventDefaultAction&&this.viewport&&(h=this.gestureSettingsByDeviceType(o.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(o.shift?1/this.zoomPerClick:this.zoomPerClick,h.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints())}function C(o){var h,c={tracker:o.eventSource,pointerType:o.pointerType,position:o.position,delta:o.delta,speed:o.speed,direction:o.direction,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",c),h=this.gestureSettingsByDeviceType(o.pointerType),!c.preventDefaultAction&&this.viewport)if(h.dblClickDragToZoom&&t[this.hash].draggingToZoom){var m=Math.pow(this.zoomPerDblClickDrag,o.delta.y/50);this.viewport.zoomBy(m)}else h.dragToPan&&!t[this.hash].draggingToZoom&&(this.panHorizontal||(o.delta.x=0),this.panVertical||(o.delta.y=0),this.viewport.flipped&&(o.delta.x=-o.delta.x),this.constrainDuringPan&&(c=this.viewport.deltaPointsFromPixels(o.delta.negate()),this.viewport.centerSpringX.target.value+=c.x,this.viewport.centerSpringY.target.value+=c.y,m=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=c.x,this.viewport.centerSpringY.target.value-=c.y,m.xConstrained&&(o.delta.x=0),m.yConstrained&&(o.delta.y=0)),this.viewport.panBy(this.viewport.deltaPointsFromPixels(o.delta.negate()),h.flickEnabled&&!this.constrainDuringPan))}function R(o){var h,c={tracker:o.eventSource,pointerType:o.pointerType,position:o.position,speed:o.speed,direction:o.direction,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",c),h=this.gestureSettingsByDeviceType(o.pointerType),!c.preventDefaultAction&&this.viewport){if(!t[this.hash].draggingToZoom&&h.flickEnabled&&o.speed>=h.flickMinSpeed){var m=0;this.panHorizontal&&(m=h.flickMomentum*o.speed*Math.cos(o.direction)),c=0,this.panVertical&&(c=h.flickMomentum*o.speed*Math.sin(o.direction)),o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),c=this.viewport.pointFromPixel(new e.Point(o.x-m,o.y-c)),this.viewport.panTo(c,!1)}this.viewport.applyConstraints()}h.dblClickDragToZoom&&!0===t[this.hash].draggingToZoom&&(t[this.hash].draggingToZoom=!1)}function z(o){this.raiseEvent("canvas-enter",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function D(o){this.raiseEvent("canvas-exit",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function L(o){if(this.raiseEvent("canvas-press",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,insideElementPressed:o.insideElementPressed,insideElementReleased:o.insideElementReleased,originalEvent:o.originalEvent}),this.gestureSettingsByDeviceType(o.pointerType).dblClickDragToZoom){var h=t[this.hash].lastClickTime;o=e.now(),null!==h&&(o-h<this.dblClickTimeThreshold&&(t[this.hash].draggingToZoom=!0),t[this.hash].lastClickTime=null)}}function U(o){this.raiseEvent("canvas-release",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,insideElementPressed:o.insideElementPressed,insideElementReleased:o.insideElementReleased,originalEvent:o.originalEvent})}function Y(o){this.raiseEvent("canvas-nonprimary-press",{tracker:o.eventSource,position:o.position,pointerType:o.pointerType,button:o.button,buttons:o.buttons,originalEvent:o.originalEvent})}function K(o){this.raiseEvent("canvas-nonprimary-release",{tracker:o.eventSource,position:o.position,pointerType:o.pointerType,button:o.button,buttons:o.buttons,originalEvent:o.originalEvent})}function Q(o){var h,c,m,v={tracker:o.eventSource,pointerType:o.pointerType,gesturePoints:o.gesturePoints,lastCenter:o.lastCenter,center:o.center,lastDistance:o.lastDistance,distance:o.distance,shift:o.shift,originalEvent:o.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};this.raiseEvent("canvas-pinch",v),this.viewport&&((h=this.gestureSettingsByDeviceType(o.pointerType)).pinchToZoom&&(!v.preventDefaultPanAction||!v.preventDefaultZoomAction)&&(c=this.viewport.pointFromPixel(o.center,!0),h.zoomToRefPoint&&!v.preventDefaultPanAction&&(m=this.viewport.pointFromPixel(o.lastCenter,!0).minus(c),this.panHorizontal||(m.x=0),this.panVertical||(m.y=0),this.viewport.panBy(m,!0)),v.preventDefaultZoomAction||this.viewport.zoomBy(o.distance/o.lastDistance,c,!0),this.viewport.applyConstraints()),h.pinchRotate&&!v.preventDefaultRotateAction&&(v=Math.atan2(o.gesturePoints[0].currentPos.y-o.gesturePoints[1].currentPos.y,o.gesturePoints[0].currentPos.x-o.gesturePoints[1].currentPos.x),o=Math.atan2(o.gesturePoints[0].lastPos.y-o.gesturePoints[1].lastPos.y,o.gesturePoints[0].lastPos.x-o.gesturePoints[1].lastPos.x),this.viewport.setRotation(this.viewport.getRotation()+(v-o)*(180/Math.PI))))}function J(o){var h,c,m;(m=e.now())-this._lastScrollTime>this.minScrollDeltaTime?(this._lastScrollTime=m,this.raiseEvent("canvas-scroll",h={tracker:o.eventSource,position:o.position,scroll:o.scroll,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1,preventDefault:!0}),!h.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(o.position.x=this.viewport.getContainerSize().x-o.position.x),(c=this.gestureSettingsByDeviceType(o.pointerType)).scrollToZoom&&(m=Math.pow(this.zoomPerScroll,o.scroll),this.viewport.zoomBy(m,c.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints())),o.preventDefault=h.preventDefault):o.preventDefault=!0}function V(o){t[this.hash].mouseInside=!0,p(this),this.raiseEvent("container-enter",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function G(o){o.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||u(this)),this.raiseEvent("container-exit",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function j(o){(function(h){if(!h._opening&&t[h.hash]){if(h.autoResize||t[h.hash].forceResize){if(h._autoResizePolling){m=s(h.container);var c=t[h.hash].prevContainerSize;m.equals(c)||(t[h.hash].needsResize=!0)}t[h.hash].needsResize&&function(v,x){var b,y=v.viewport,P=y.getZoom(),I=y.getCenter();if(y.resize(x,v.preserveImageSizeOnResize),y.panTo(I,!0),v.preserveImageSizeOnResize)b=t[v.hash].prevContainerSize.x/x.x;else{var B=new e.Point(0,0);I=new e.Point(t[v.hash].prevContainerSize.x,t[v.hash].prevContainerSize.y).distanceTo(B),b=(B=new e.Point(x.x,x.y).distanceTo(B))/I*t[v.hash].prevContainerSize.x/x.x}y.zoomTo(P*b,null,!0),t[v.hash].prevContainerSize=x,t[v.hash].forceRedraw=!0,t[v.hash].needsResize=!1,t[v.hash].forceResize=!1}(h,m||s(h.container))}c=h.viewport.update();var m=h.world.update()||c;c&&h.raiseEvent("viewport-change"),h.referenceStrip&&(m=h.referenceStrip.update(h.viewport)||m),!(c=t[h.hash].animating)&&m&&(h.raiseEvent("animation-start"),p(h)),(c=c&&!m)&&(t[h.hash].animating=!1),(m||c||t[h.hash].forceRedraw||h.world.needsDraw())&&((v=h).imageLoader.clear(),v.drawer.clear(),v.world.draw(),v.raiseEvent("update-viewport",{}),h._drawOverlays(),h.navigator&&h.navigator.update(h.viewport),t[h.hash].forceRedraw=!1,m&&h.raiseEvent("animation")),c&&(h.raiseEvent("animation-finish"),t[h.hash].mouseInside||u(h)),t[h.hash].animating=m}var v})(o),o._updateRequestId=!!o.isOpen()&&a(o,j)}function k(o,h){return o?o+h:h}function $(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,W(this)}function ee(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,W(this)}function q(){t[this.hash].zooming=!1}function W(o){e.requestAnimationFrame(e.delegate(o,H))}function H(){var o,h;t[this.hash].zooming&&this.viewport&&(h=(o=e.now())-t[this.hash].lastZoomTime,h=Math.pow(t[this.hash].zoomFactor,h/1e3),this.viewport.zoomBy(h),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=o,W(this))}function A(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function te(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function ie(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function ne(){this.viewport&&this.viewport.goHome()}function oe(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function re(){if(this.viewport){var o=this.viewport.getRotation();this.viewport.flipped?o+=this.rotationIncrement:o-=this.rotationIncrement,this.viewport.setRotation(o)}}function se(){if(this.viewport){var o=this.viewport.getRotation();this.viewport.flipped?o-=this.rotationIncrement:o+=this.rotationIncrement,this.viewport.setRotation(o)}}function g(){this.viewport.toggleFlip()}e.Viewer=function(o){var h,v,c=arguments,m=this;if((o=e.isPlainObject(o)?o:{id:c[0],xmlPath:1<c.length?c[1]:void 0,prefixUrl:2<c.length?c[2]:void 0,controls:3<c.length?c[3]:void 0,overlays:4<c.length?c[4]:void 0}).config&&(e.extend(!0,o,o.config),delete o.config),e.extend(!0,this,{id:o.id,hash:o.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},e.DEFAULT_SETTINGS,o),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(v){v=e.getString("Errors.OpenFailed",v.eventSource,v.message),m._showMessage(v)}),e.ControlDock.call(this,o),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(v=this.canvas.style).width="100%",v.height="100%",v.overflow="hidden",v.position="absolute",v.top="0px",v.left="0px",e.setElementTouchActionNone(this.canvas),""!==o.tabIndex&&(this.canvas.tabIndex=void 0===o.tabIndex?0:o.tabIndex),this.container.className="openseadragon-container",function(v){v.width="100%",v.height="100%",v.position="relative",v.overflow="hidden",v.left="0px",v.top="0px",v.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,w),keyDownHandler:e.delegate(this,T),keyHandler:e.delegate(this,S),clickHandler:e.delegate(this,E),dblClickHandler:e.delegate(this,_),dragHandler:e.delegate(this,C),dragEndHandler:e.delegate(this,R),enterHandler:e.delegate(this,z),leaveHandler:e.delegate(this,D),pressHandler:e.delegate(this,L),releaseHandler:e.delegate(this,U),nonPrimaryPressHandler:e.delegate(this,Y),nonPrimaryReleaseHandler:e.delegate(this,K),scrollHandler:e.delegate(this,J),pinchHandler:e.delegate(this,Q)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,V),leaveHandler:e.delegate(this,G)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=s(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){t[m.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(v){m.source=m.world.getItemAt(0).source,t[m.hash].forceRedraw=!0,m._updateRequestId||(m._updateRequestId=a(m,j))}),this.world.addHandler("remove-item",function(v){m.source=m.world.getItemCount()?m.world.getItemAt(0).source:null,t[m.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(v){m.viewport&&m.viewport._setContentBounds(m.world.getHomeBounds(),m.world.getContentFactor())}),this.world.addHandler("item-index-change",function(v){m.source=m.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:o.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(h=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(h,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(h=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(h,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),h=0;h<this.customControls.length;h++)this.addControl(this.customControls[h].id,{anchor:this.customControls[h].anchor});e.requestAnimationFrame(function(){u(m)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(o){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(o)},openTileSource:function(o){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(o)},get buttons(){return e.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(o,h){var c=this;if(this.close(),!o)return this;if(this.sequenceMode&&e.isArray(o))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===h||isNaN(h)||(this.initialPage=h),this.tileSources=o,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(!(o=e.isArray(o)?o:[o]).length)return this;this._opening=!0;for(var y,m=o.length,v=0,x=0,P=function(){if(v+x===m)if(v){(c._firstOpen||!c.preserveViewport)&&(c.viewport.goHome(!0),c.viewport.update()),c._firstOpen=!1;var b=o[0];if(b.tileSource&&(b=b.tileSource),c.overlays&&!c.preserveOverlays)for(var B=0;B<c.overlays.length;B++)c.currentOverlays[B]=n(c,c.overlays[B]);c._drawOverlays(),c._opening=!1,c.raiseEvent("open",{source:b})}else c._opening=!1,c.raiseEvent("open-failed",y)},I=0;I<o.length;I++)!function(b){void 0!==(b=e.isPlainObject(b)&&b.tileSource?b:{tileSource:b}).index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete b.index),void 0===b.collectionImmediately&&(b.collectionImmediately=!0);var B=b.success;b.success=function(O){if(v++,b.tileSource.overlays)for(var F=0;F<b.tileSource.overlays.length;F++)c.addOverlay(b.tileSource.overlays[F]);B&&B(O),P()};var N=b.error;b.error=function(O){x++,y=y||O,N&&N(O),P()},c.addTiledImage(b)}(o[I]);return this},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),t[this.navigator.hash]=null,delete t[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(o){return this.innerTracker.setTracking(o),this.outerTracker.setTracking(o),this.raiseEvent("mouse-enabled",{enabled:o}),this},areControlsEnabled:function(){var o,h=this.controls.length;for(o=0;o<this.controls.length;o++)h=h&&this.controls[o].isVisible();return h},setControlsEnabled:function(o){return(o?p:u)(this),this.raiseEvent("controls-enabled",{enabled:o}),this},setDebugMode:function(o){for(var h=0;h<this.world.getItemCount();h++)this.world.getItemAt(h).debugMode=o;this.debugMode=o,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(o){var h,c,m=document.body,v=m.style,x=document.documentElement.style,y=this;if(o===this.isFullPage())return this;var P={fullPage:o,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",P),P.preventDefaultAction)return this;if(o){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=v.margin,this.docMargin=x.margin,v.margin="0",x.margin="0",this.bodyPadding=v.padding,this.docPadding=x.padding,v.padding="0",x.padding="0",this.bodyWidth=v.width,this.docWidth=x.width,v.width="100%",x.width="100%",this.bodyHeight=v.height,this.docHeight=x.height,v.height="100%",x.height="100%",this.bodyDisplay=v.display,v.display="block",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,h=m.childNodes.length,c=0;c<h;c++)this.previousBody.push(m.childNodes[0]),m.removeChild(m.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,m.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),m.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,V)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,v.margin=this.bodyMargin,x.margin=this.docMargin,v.padding=this.bodyPadding,x.padding=this.docPadding,v.width=this.bodyWidth,x.width=this.docWidth,v.height=this.bodyHeight,x.height=this.docHeight,v.display=this.bodyDisplay,m.removeChild(this.element),h=this.previousBody.length,c=0;c<h;c++)m.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(m.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var I=0,b=function(){e.setPageScroll(y.pageScroll);var B=e.getPageScroll();++I<10&&(B.x!==y.pageScroll.x||B.y!==y.pageScroll.y)&&e.requestAnimationFrame(b)};e.requestAnimationFrame(b),t[this.hash].fullPage=!1,e.delegate(this,G)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:o}),this},setFullScreen:function(o){var h=this;if(!e.supportsFullScreen)return this.setFullPage(o);if(e.isFullScreen()===o)return this;var c={fullScreen:o,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",c),c.preventDefaultAction)return this;if(o){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var m=function(){var v=e.isFullScreen();v||(e.removeEvent(document,e.fullScreenEventName,m),e.removeEvent(document,e.fullScreenErrorEventName,m),h.setFullPage(!1),h.isFullPage()&&(h.element.style.width=h.fullPageStyleWidth,h.element.style.height=h.fullPageStyleHeight)),h.navigator&&h.viewport&&setTimeout(function(){h.navigator.update(h.viewport)}),h.raiseEvent("full-screen",{fullScreen:v})};e.addEvent(document,e.fullScreenEventName,m),e.addEvent(document,e.fullScreenErrorEventName,m),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!==this.container.style.visibility},isFullScreen:function(){return e.isFullScreen()&&this.isFullPage()},setVisible:function(o){return this.container.style.visibility=o?"":"hidden",this.raiseEvent("visible",{visible:o}),this},addTiledImage:function(o){e.console.assert(o,"[Viewer.addTiledImage] options is required"),e.console.assert(o.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!o.replace||-1<o.index&&o.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var h=this;o.replace&&(o.replaceItem=h.world.getItemAt(o.index)),this._hideMessage(),void 0===o.placeholderFillStyle&&(o.placeholderFillStyle=this.placeholderFillStyle),void 0===o.opacity&&(o.opacity=this.opacity),void 0===o.preload&&(o.preload=this.preload),void 0===o.compositeOperation&&(o.compositeOperation=this.compositeOperation),void 0===o.crossOriginPolicy&&(o.crossOriginPolicy=(void 0!==o.tileSource.crossOriginPolicy?o.tileSource:this).crossOriginPolicy),void 0===o.ajaxWithCredentials&&(o.ajaxWithCredentials=this.ajaxWithCredentials),void 0===o.loadTilesWithAjax&&(o.loadTilesWithAjax=this.loadTilesWithAjax),null==o.ajaxHeaders?o.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(o.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(o.ajaxHeaders=e.extend({},this.ajaxHeaders,o.ajaxHeaders));var c={options:o};function m(y){for(var P=0;P<h._loadQueue.length;P++)if(h._loadQueue[P]===c){h._loadQueue.splice(P,1);break}0===h._loadQueue.length&&v(c),h.raiseEvent("add-item-failed",y),o.error&&o.error(y)}function v(y){h.collectionMode&&(h.world.arrange({immediately:y.options.collectionImmediately,rows:h.collectionRows,columns:h.collectionColumns,layout:h.collectionLayout,tileSize:h.collectionTileSize,tileMargin:h.collectionTileMargin}),h.world.setAutoRefigureSizes(!0))}function x(){for(var y,P;h._loadQueue.length&&(y=h._loadQueue[0]).tileSource;){if(h._loadQueue.splice(0,1),y.options.replace){var I=h.world.getIndexOfItem(y.options.replaceItem);-1!==I&&(y.options.index=I),h.world.removeItem(y.options.replaceItem)}P=new e.TiledImage({viewer:h,source:y.tileSource,viewport:h.viewport,drawer:h.drawer,tileCache:h.tileCache,imageLoader:h.imageLoader,x:y.options.x,y:y.options.y,width:y.options.width,height:y.options.height,fitBounds:y.options.fitBounds,fitBoundsPlacement:y.options.fitBoundsPlacement,clip:y.options.clip,placeholderFillStyle:y.options.placeholderFillStyle,opacity:y.options.opacity,preload:y.options.preload,degrees:y.options.degrees,flipped:y.options.flipped,compositeOperation:y.options.compositeOperation,springStiffness:h.springStiffness,animationTime:h.animationTime,minZoomImageRatio:h.minZoomImageRatio,wrapHorizontal:h.wrapHorizontal,wrapVertical:h.wrapVertical,immediateRender:h.immediateRender,blendTime:h.blendTime,alwaysBlend:h.alwaysBlend,minPixelRatio:h.minPixelRatio,smoothTileEdgesMinZoom:h.smoothTileEdgesMinZoom,iOSDevice:h.iOSDevice,crossOriginPolicy:y.options.crossOriginPolicy,ajaxWithCredentials:y.options.ajaxWithCredentials,loadTilesWithAjax:y.options.loadTilesWithAjax,ajaxHeaders:y.options.ajaxHeaders,debugMode:h.debugMode,subPixelRoundingForTransparency:h.subPixelRoundingForTransparency}),h.collectionMode&&h.world.setAutoRefigureSizes(!1),h.navigator&&(I=e.extend({},y.options,{replace:!1,originalTiledImage:P,tileSource:y.tileSource}),h.navigator.addTiledImage(I)),h.world.addItem(P,{index:y.options.index}),0===h._loadQueue.length&&v(y),1!==h.world.getItemCount()||h.preserveViewport||h.viewport.goHome(!0),y.options.success&&y.options.success({item:P})}}e.isArray(o.tileSource)?setTimeout(function(){m({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:o.tileSource,options:o})}):(this._loadQueue.push(c),function(y,P,I,b,B){var N=y;if("string"===e.type(P))if(P.match(/^\s*<.*>\s*$/))P=e.parseXml(P);else if(P.match(/^\s*[{[].*[}\]]\s*$/))try{var O=e.parseJSON(P);P=O}catch{}function F(M,Z){M.ready?b(M):(M.addHandler("ready",function(){b(M)}),M.addHandler("open-failed",function(X){B({message:X.message,source:Z})}))}setTimeout(function(){if("string"===e.type(P))(P=new e.TileSource({url:P,crossOriginPolicy:(void 0!==I.crossOriginPolicy?I:y).crossOriginPolicy,ajaxWithCredentials:y.ajaxWithCredentials,ajaxHeaders:I.ajaxHeaders||y.ajaxHeaders,splitHashDataForPost:y.splitHashDataForPost,useCanvas:y.useCanvas,success:function(X){b(X.tileSource)}})).addHandler("open-failed",function(X){B(X)});else if(e.isPlainObject(P)||P.nodeType)if(void 0!==P.crossOriginPolicy||void 0===I.crossOriginPolicy&&void 0===y.crossOriginPolicy||(P.crossOriginPolicy=(void 0!==I.crossOriginPolicy?I:y).crossOriginPolicy),void 0===P.ajaxWithCredentials&&(P.ajaxWithCredentials=y.ajaxWithCredentials),void 0===P.useCanvas&&(P.useCanvas=y.useCanvas),e.isFunction(P.getTileUrl)){var M=new e.TileSource(P);M.getTileUrl=P.getTileUrl,b(M)}else{var Z=e.TileSource.determineType(N,P);Z?(M=Z.prototype.configure.apply(N,[P]),F(new Z(M),P)):B({message:"Unable to load TileSource",source:P})}else F(P,P)})}(this,o.tileSource,o,function(y){c.tileSource=y,x()},function(y){y.options=o,m(y),x()}))},addSimpleImage:function(o){e.console.assert(o,"[Viewer.addSimpleImage] options is required"),e.console.assert(o.url,"[Viewer.addSimpleImage] options.url is required"),delete(o=e.extend({},o,{tileSource:{type:"image",url:o.url}})).url,this.addTiledImage(o)},addLayer:function(o){var h=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var c=e.extend({},o,{success:function(m){h.raiseEvent("add-layer",{options:o,drawer:m.item})},error:function(m){h.raiseEvent("add-layer-failed",m)}});return this.addTiledImage(c),this},getLayerAtLevel:function(o){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(o)},getLevelOfLayer:function(o){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(o)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(o,h){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(o,h)},removeLayer:function(o){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(o)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},forceResize:function(){t[this.hash].needsResize=!0,t[this.hash].forceResize=!0},bindSequenceControls:function(){var o=e.delegate(this,d),h=e.delegate(this,f),c=e.delegate(this,this.goToNextPage),m=e.delegate(this,this.goToPreviousPage),v=this.navImages,x=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(x=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:k(this.prefixUrl,v.previous.REST),srcGroup:k(this.prefixUrl,v.previous.GROUP),srcHover:k(this.prefixUrl,v.previous.HOVER),srcDown:k(this.prefixUrl,v.previous.DOWN),onRelease:m,onFocus:o,onBlur:h}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:k(this.prefixUrl,v.next.REST),srcGroup:k(this.prefixUrl,v.next.GROUP),srcHover:k(this.prefixUrl,v.next.HOVER),srcDown:k(this.prefixUrl,v.next.DOWN),onRelease:c,onFocus:o,onBlur:h}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),x&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var o=e.delegate(this,$),h=e.delegate(this,q),c=e.delegate(this,A),m=e.delegate(this,ee),v=e.delegate(this,te),x=e.delegate(this,ne),y=e.delegate(this,oe),P=e.delegate(this,re),I=e.delegate(this,se),b=e.delegate(this,g),B=e.delegate(this,d),N=e.delegate(this,f),O=this.navImages,F=[],M=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(M=!1),this.showZoomControl&&(F.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:k(this.prefixUrl,O.zoomIn.REST),srcGroup:k(this.prefixUrl,O.zoomIn.GROUP),srcHover:k(this.prefixUrl,O.zoomIn.HOVER),srcDown:k(this.prefixUrl,O.zoomIn.DOWN),onPress:o,onRelease:h,onClick:c,onEnter:o,onExit:h,onFocus:B,onBlur:N})),F.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:k(this.prefixUrl,O.zoomOut.REST),srcGroup:k(this.prefixUrl,O.zoomOut.GROUP),srcHover:k(this.prefixUrl,O.zoomOut.HOVER),srcDown:k(this.prefixUrl,O.zoomOut.DOWN),onPress:m,onRelease:h,onClick:v,onEnter:m,onExit:h,onFocus:B,onBlur:N}))),this.showHomeControl&&F.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:k(this.prefixUrl,O.home.REST),srcGroup:k(this.prefixUrl,O.home.GROUP),srcHover:k(this.prefixUrl,O.home.HOVER),srcDown:k(this.prefixUrl,O.home.DOWN),onRelease:x,onFocus:B,onBlur:N})),this.showFullPageControl&&F.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:k(this.prefixUrl,O.fullpage.REST),srcGroup:k(this.prefixUrl,O.fullpage.GROUP),srcHover:k(this.prefixUrl,O.fullpage.HOVER),srcDown:k(this.prefixUrl,O.fullpage.DOWN),onRelease:y,onFocus:B,onBlur:N})),this.showRotationControl&&(F.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:k(this.prefixUrl,O.rotateleft.REST),srcGroup:k(this.prefixUrl,O.rotateleft.GROUP),srcHover:k(this.prefixUrl,O.rotateleft.HOVER),srcDown:k(this.prefixUrl,O.rotateleft.DOWN),onRelease:P,onFocus:B,onBlur:N})),F.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:k(this.prefixUrl,O.rotateright.REST),srcGroup:k(this.prefixUrl,O.rotateright.GROUP),srcHover:k(this.prefixUrl,O.rotateright.HOVER),srcDown:k(this.prefixUrl,O.rotateright.DOWN),onRelease:I,onFocus:B,onBlur:N}))),this.showFlipControl&&F.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:k(this.prefixUrl,O.flip.REST),srcGroup:k(this.prefixUrl,O.flip.GROUP),srcHover:k(this.prefixUrl,O.flip.HOVER),srcDown:k(this.prefixUrl,O.flip.DOWN),onRelease:b,onFocus:B,onBlur:N})),M?(this.buttonGroup=new e.ButtonGroup({buttons:F,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,ie)),(this.toolbar||this).addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=F),this},currentPage:function(){return this._sequenceIndex},goToPage:function(o){return this.tileSources&&0<=o&&o<this.tileSources.length&&(this._sequenceIndex=o,this._updateSequenceButtons(o),this.open(this.tileSources[o]),this.referenceStrip&&this.referenceStrip.setFocus(o),this.raiseEvent("page",{page:o})),this},addOverlay:function(o,h,c,m){return c=e.isPlainObject(o)?o:{element:o,location:h,placement:c,onDraw:m},o=e.getElement(c.element),0<=r(this.currentOverlays,o)||(m=n(this,c),this.currentOverlays.push(m),m.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:o,location:c.location,placement:c.placement})),this},updateOverlay:function(o,h,c){var m;return o=e.getElement(o),0<=(m=r(this.currentOverlays,o))&&(this.currentOverlays[m].update(h,c),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:o,location:h,placement:c})),this},removeOverlay:function(o){var h;return o=e.getElement(o),0<=(h=r(this.currentOverlays,o))&&(this.currentOverlays[h].destroy(),this.currentOverlays.splice(h,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:o})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(o){return o=e.getElement(o),0<=(o=r(this.currentOverlays,o))?this.currentOverlays[o]:null},_updateSequenceButtons:function(o){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==o?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<o?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(o){this._hideMessage();var h=e.makeNeutralElement("div");h.appendChild(document.createTextNode(o)),this.messageDiv=e.makeCenteredNode(h),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var o=this.messageDiv;o&&(o.parentNode.removeChild(o),delete this.messageDiv)},gestureSettingsByDeviceType:function(o){switch(o){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var o,h=this.currentOverlays.length;for(o=0;o<h;o++)this.currentOverlays[o].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){this.showReferenceStrip=!0,this.sequenceMode?!this.referenceStrip&&this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var o=e.pixelDensityRatio,h=e.getCurrentPixelDensityRatio();o!==h&&(e.pixelDensityRatio=h,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var o=this._sequenceIndex-1;this.navPrevNextWrap&&o<0&&(o+=this.tileSources.length),this.goToPage(o)},goToNextPage:function(){var o=this._sequenceIndex+1;this.navPrevNextWrap&&o>=this.tileSources.length&&(o=0),this.goToPage(o)},isAnimating:function(){return t[this.hash].animating}})}(OpenSeadragon),function(e){function t(l){var u={tracker:l.eventSource,position:l.position,quick:l.quick,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-click",u),!u.preventDefaultAction&&l.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(l.position.x=this.viewport.getContainerSize().x-l.position.x),l=this.viewport.pointFromPixel(l.position),this.panVertical?this.panHorizontal||(l.x=this.viewer.viewport.getCenter(!0).x):l.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(l),this.viewer.viewport.applyConstraints())}function i(l){var u={tracker:l.eventSource,position:l.position,delta:l.delta,speed:l.speed,direction:l.direction,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",u),!u.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(l.delta.x=0),this.panVertical||(l.delta.y=0),this.viewer.viewport.flipped&&(l.delta.x=-l.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(l.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function s(l){l.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function n(l){var u={tracker:l.eventSource,position:l.position,scroll:l.scroll,shift:l.shift,originalEvent:l.originalEvent,preventDefault:l.preventDefault};this.viewer.raiseEvent("navigator-scroll",u),l.preventDefault=u.preventDefault}function r(l,u){a(l,"rotate("+u+"deg)")}function a(l,u){l.style.webkitTransform=u,l.style.mozTransform=u,l.style.msTransform=u,l.style.oTransform=u,l.style.transform=u}e.Navigator=function(l){var u,w,T,p=l.viewer,d=this;function f(w){r(d.displayRegionContainer,w),r(d.displayRegion,-w),d.viewport.setRotation(w)}l.element||l.id?(l.element?(l.id&&e.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),l.id=l.element.id?l.element.id:"navigator-"+e.now(),this.element=l.element):this.element=document.getElementById(l.id),l.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(l.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),l.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:l.autoFade},l.position&&("BOTTOM_RIGHT"===l.position?l.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===l.position?l.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===l.position?l.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===l.position?l.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"===l.position&&(l.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,l.controlOptions.top=l.top,l.controlOptions.left=l.left,l.controlOptions.height=l.height,l.controlOptions.width=l.width))),this.element.id=l.id,this.element.className+=" navigator",(l=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},l,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:l.animationTime,autoResize:!1,minZoomImageRatio:1,background:l.background,opacity:l.opacity,borderColor:l.borderColor,displayRegionColor:l.displayRegionColor})).minPixelRatio=this.minPixelRatio=p.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),l.controlOptions.anchor!==e.ControlAnchor.NONE&&(T=this.borderWidth,(w=this.element.style).margin="0px",w.border=T+"px solid "+l.borderColor,w.padding="0px",w.background=l.background,w.opacity=l.opacity,w.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(w,T){w.position="relative",w.top="0px",w.left="0px",w.fontSize="0px",w.overflow="hidden",w.border=T+"px solid "+l.displayRegionColor,w.margin="0px",w.padding="0px",w.background="transparent",w.float="left",w.cssFloat="left",w.styleFloat="left",w.zIndex=999999999,w.cursor="default"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),p.addControl(this.element,l.controlOptions),this._resizeWithViewer=l.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&l.controlOptions.anchor!==e.ControlAnchor.NONE,l.width&&l.height?(this.setWidth(l.width),this.setHeight(l.height)):this._resizeWithViewer&&(u=e.getElementSize(p.element),this.element.style.height=Math.round(u.y*l.sizeRatio)+"px",this.element.style.width=Math.round(u.x*l.sizeRatio)+"px",this.oldViewerSize=u,u=e.getElementSize(this.element),this.elementArea=u.x*u.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[l]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),l.navigatorRotate&&(f(l.viewer.viewport?l.viewer.viewport.getRotation():l.viewer.degrees||0),l.viewer.addHandler("rotate",function(w){f(w.degrees)})),this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,s),scrollHandler:e.delegate(this,n),preProcessEventHandler:function(w){"wheel"===w.eventType&&(w.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){d.viewport&&d.viewport.goHome(!0)}),p.world.addHandler("item-index-change",function(w){window.setTimeout(function(){var T=d.world.getItemAt(w.previousIndex);d.world.setItemIndex(T,w.newIndex)},1)}),p.world.addHandler("remove-item",function(w){(w=d._getMatchingItem(w=w.item))&&d.world.removeItem(w)}),this.update(p.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var l=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);l.equals(this.oldContainerSize)||(this.viewport.resize(l,!0),this.viewport.goHome(!0),this.oldContainerSize=l,this.drawer.clear(),this.world.draw())}},setWidth:function(l){this.width=l,this.element.style.width="number"==typeof l?l+"px":l,this._resizeWithViewer=!1},setHeight:function(l){this.height=l,this.element.style.height="number"==typeof l?l+"px":l,this._resizeWithViewer=!1},setFlip:function(l){return this.viewport.setFlip(l),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(l){a(this.displayRegion,l),a(this.canvas,l),a(this.element,l)},update:function(l){var u;if(p=e.getElementSize(this.viewer.element),this._resizeWithViewer&&p.x&&p.y&&!p.equals(this.oldViewerSize)&&(this.oldViewerSize=p,this.maintainSizeRatio||!this.elementArea?(u=p.x*this.sizeRatio,d=p.y*this.sizeRatio):(u=Math.sqrt(this.elementArea*(p.x/p.y)),d=this.elementArea/u),this.element.style.width=Math.round(u)+"px",this.element.style.height=Math.round(d)+"px",this.elementArea||(this.elementArea=u*d),this.updateSize()),l&&this.viewport){p=l.getBoundsNoRotate(!0),u=this.viewport.pixelFromPointNoRotate(p.getTopLeft(),!1),d=this.viewport.pixelFromPointNoRotate(p.getBottomRight(),!1).minus(this.totalBorderWidths),(l=this.displayRegion.style).display=this.world.getItemCount()?"block":"none",l.top=Math.round(u.y)+"px",l.left=Math.round(u.x)+"px";var p=Math.abs(u.x-d.x),d=Math.abs(u.y-d.y);l.width=Math.round(Math.max(p,0))+"px",l.height=Math.round(Math.max(d,0))+"px"}},addTiledImage:function(l){var u=this,p=l.originalTiledImage;return delete l.original,l=e.extend({},l,{success:function(d){var f=d.item;function w(){u._matchBounds(f,p)}f._originalForNavigator=p,u._matchBounds(f,p,!0),u._matchOpacity(f,p),u._matchCompositeOperation(f,p),p.addHandler("bounds-change",w),p.addHandler("clip-change",w),p.addHandler("opacity-change",function(){u._matchOpacity(f,p)}),p.addHandler("composite-operation-change",function(){u._matchCompositeOperation(f,p)})}}),e.Viewer.prototype.addTiledImage.apply(this,[l])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(l){for(var p,u=this.world.getItemCount(),d=0;d<u;d++)if((p=this.world.getItemAt(d))._originalForNavigator===l)return p;return null},_matchBounds:function(l,u,p){var d=u.getBoundsNoRotate();l.setPosition(d.getTopLeft(),p),l.setWidth(d.width,p),l.setRotation(u.getRotation(),p),l.setClip(u.getClip()),l.setFlip(u.getFlip())},_matchOpacity:function(l,u){l.setOpacity(u.opacity)},_matchCompositeOperation:function(l,u){l.setCompositeOperation(u.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(i){var s,n=i.split("."),r=null,a=arguments,l=t;for(s=0;s<n.length-1;s++)l=l[n[s]]||{};return"string"!=typeof(r=l[n[s]])&&(e.console.error("Untranslated source string:",i),r=""),r.replace(/\{\d+\}/g,function(u){return(u=parseInt(u.match(/\d+/),10)+1)<a.length?a[u]:""})},setString:function(i,s){var n,r=i.split("."),a=t;for(n=0;n<r.length-1;n++)a[r[n]]||(a[r[n]]={}),a=a[r[n]];a[r[n]]=s}})}(OpenSeadragon),function(e){e.Point=function(t,i){this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},squaredDistanceTo:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var s,n;if(i=i||new e.Point(0,0),t%90==0)switch(e.positiveModulo(t,360)){case 0:s=1,n=0;break;case 90:s=0,n=1;break;case 180:s=-1,n=0;break;case 270:s=0,n=-1}else{var r=t*Math.PI/180;s=Math.cos(r),n=Math.sin(r)}return new e.Point(r=s*(this.x-i.x)-n*(this.y-i.y)+i.x,i=n*(this.x-i.x)+s*(this.y-i.y)+i.y)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,i,s,n,r,a){var u,l=this,p=arguments;if(p=e.isPlainObject(t)?t:{width:p[0],height:p[1],tileSize:p[2],tileOverlap:p[3],minLevel:p[4],maxLevel:p[5]},e.EventSource.call(this),e.extend(!0,this,p),!this.success)for(u=0;u<arguments.length;u++)if(e.isFunction(arguments[u])){this.success=arguments[u];break}this.success&&this.addHandler("ready",function(d){l.success(d)}),"string"===e.type(t)&&(this.url=t),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=p.width&&p.height?p.width/p.height:1,this.dimensions=new e.Point(p.width,p.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=p.tileOverlap||0,this.minLevel=p.minLevel||0,this.maxLevel=null!=p.maxLevel?p.maxLevel:p.width&&p.height?Math.ceil(Math.log(Math.max(p.width,p.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(t){return this._tileWidth||this.getTileSize(t)},getTileHeight:function(t){return this._tileHeight||this.getTileSize(t)},setMaxLevel:function(t){this.maxLevel=t,this._memoizeLevelScale()},getLevelScale:function(t){return this._memoizeLevelScale(),this.getLevelScale(t)},_memoizeLevelScale:function(){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);this.getLevelScale=function(s){return i[s]}},getNumTiles:function(n){var i=this.getLevelScale(n),s=Math.ceil(i*this.dimensions.x/this.getTileWidth(n));return n=Math.ceil(i*this.dimensions.y/this.getTileHeight(n)),new e.Point(s,n)},getPixelRatio:function(i){var s=this.dimensions.times(this.getLevelScale(i));return new e.Point(i=1/s.x*e.pixelDensityRatio,s=1/s.y*e.pixelDensityRatio)},getClosestLevel:function(){var t,i;for(t=this.minLevel+1;t<=this.maxLevel&&!(1<(i=this.getNumTiles(t)).x||1<i.y);t++);return t-1},getTileAtPoint:function(t,i){var s=0<=i.x&&i.x<=1&&0<=i.y&&i.y<=1/this.aspectRatio;e.console.assert(s,"[TileSource.getTileAtPoint] must be called with a valid point.");var n=this.dimensions.x*this.getLevelScale(t);return s=i.x*n,n*=i.y,s=Math.floor(s/this.getTileWidth(t)),n=Math.floor(n/this.getTileHeight(t)),1<=i.x&&(s=this.getNumTiles(t).x-1),i.y>=1/this.aspectRatio-1e-15&&(n=this.getNumTiles(t).y-1),new e.Point(s,n)},getTileBounds:function(u,p,f,n){var r=this.dimensions.times(this.getLevelScale(u)),a=this.getTileWidth(u),d=this.getTileHeight(u),l=0===p?0:a*p-this.tileOverlap;return u=0===f?0:d*f-this.tileOverlap,p=a+(0===p?1:2)*this.tileOverlap,d+=(0===f?1:2)*this.tileOverlap,f=1/r.x,p=Math.min(p,r.x-l),d=Math.min(d,r.y-u),n?new e.Rect(0,0,p,d):new e.Rect(l*f,u*f,p*f,d*f)},getImageInfo:function(t){var i,s,n,r,a,l=this;t&&-1<(a=(r=(n=t.split("/"))[n.length-1]).lastIndexOf("."))&&(n[n.length-1]=r.slice(0,a));var u=null;if(this.splitHashDataForPost){var p=t.indexOf("#");-1!==p&&(u=t.substring(p+1),t=t.substr(0,p))}i=function(d){"string"==typeof d&&(d=e.parseXml(d));var f=e.TileSource.determineType(l,d,t);f?(void 0===(s=f.prototype.configure.apply(l,[d,t,u])).ajaxWithCredentials&&(s.ajaxWithCredentials=l.ajaxWithCredentials),s=new f(s),l.ready=!0,l.raiseEvent("ready",{tileSource:s})):l.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(p=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:p,callback:i})):e.makeAjaxRequest({url:t,postData:u,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(d){d=function(f){var T,S=f.responseText,E=f.status;if(!f)throw new Error(e.getString("Errors.Security"));if(200!==f.status&&0!==f.status)throw E=f.status,new Error(e.getString("Errors.Status",E,404===E?"Not Found":f.statusText));if(S.match(/\s*<.*/))try{T=f.responseXML&&f.responseXML.documentElement?f.responseXML:e.parseXml(S)}catch{T=f.responseText}else if(S.match(/\s*[{[].*/))try{T=e.parseJSON(S)}catch{T=S}else T=S;return T}(d),i(d)},error:function(d,f){var w;try{w="HTTP "+d.status+" attempting to load TileSource: "+t}catch{w=(void 0!==f&&f.toString?f.toString():"Unknown error")+" attempting to load TileSource: "+t}e.console.error(w),l.raiseEvent("open-failed",{message:w,source:t,postData:u})}})},supports:function(t,i){return!1},configure:function(t,i,s){throw new Error("Method not implemented.")},getTileUrl:function(t,i,s){throw new Error("Method not implemented.")},getTilePostData:function(t,i,s){return null},getTileAjaxHeaders:function(t,i,s){return{}},getTileHashKey:function(t,i,s,n,r,a){return function l(u){return r?u+"+"+JSON.stringify(r):u}("string"!=typeof n?t+"/"+i+"_"+s:n)},tileExists:function(t,i,s){var n=this.getNumTiles(t);return t>=this.minLevel&&t<=this.maxLevel&&0<=i&&0<=s&&i<n.x&&s<n.y},hasTransparency:function(t,i,s,n){return!!t||i.match(".png")},downloadTileStart:function(t){var i=t.userData,s=new Image;function n(r){s?(s.onload=s.onerror=s.onabort=null,t.finish(r?null:s,i.request,r)):t.finish(null,i.request,"Image load failed: undefined Image instance.")}i.image=s,i.request=null,s.onload=function(){n()},s.onabort=s.onerror=function(){n("Image load aborted.")},t.loadWithAjax?i.request=e.makeAjaxRequest({url:t.src,withCredentials:t.ajaxWithCredentials,headers:t.ajaxHeaders,responseType:"arraybuffer",postData:t.postData,success:function(r){var a;try{a=new window.Blob([r.response])}catch(u){var l=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===u.name&&l&&((l=new l).append(r.response),a=l.getBlob())}0===a.size?n("Empty image response."):s.src=(window.URL||window.webkitURL).createObjectURL(a)},error:function(r){n("Image load aborted - XHR error")}}):(!1!==t.crossOriginPolicy&&(s.crossOrigin=t.crossOriginPolicy),s.src=t.src)},downloadTileAbort:function(t){t.userData.request&&t.userData.request.abort();var i=t.userData.image;t.userData.image&&(i.onload=i.onerror=i.onabort=null)},createTileCache:function(t,i,s){t._data=i},destroyTileCache:function(t){t._data=null,t._renderedContext=null},getTileCacheData:function(t){return t._data},getTileCacheDataAsImage:function(t){return t._data},getTileCacheDataAsContext2D:function(t){if(!t._renderedContext){var i=document.createElement("canvas");i.width=t._data.width,i.height=t._data.height,t._renderedContext=i.getContext("2d"),t._renderedContext.drawImage(t._data,0,0),t._data=null}return t._renderedContext}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,i,s){for(var n in OpenSeadragon)if(n.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[n])&&e.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(t,i,s))return OpenSeadragon[n];return e.console.error("No TileSource was able to open %s %s",s,i),null}}(OpenSeadragon),function(e){function t(i,s){var n,r,a=(w=s.Image).Url,l=w.Format,f=w.Size,u=w.DisplayRect||[],p=parseInt(f.Width,10),d=parseInt(f.Height,10),w=(f=parseInt(w.TileSize,10),parseInt(w.Overlap,10)),T=[];for(r=0;r<u.length;r++)n=u[r].Rect,T.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:p,height:d,tileSize:f,tileOverlap:w,minLevel:null,maxLevel:null,tilesUrl:a,fileFormat:l,displayRects:T},s)}e.DziTileSource=function(i,s,n,r,a,l,u,p,d){var f,w,T,S;if(S=e.isPlainObject(i)?i:{width:i,height:s,tileSize:n,tileOverlap:r,tilesUrl:a,fileFormat:l,displayRects:u,minLevel:p,maxLevel:d},this._levelRects={},this.tilesUrl=S.tilesUrl,this.fileFormat=S.fileFormat,this.displayRects=S.displayRects,this.displayRects)for(f=this.displayRects.length-1;0<=f;f--)for(T=(w=this.displayRects[f]).minLevel;T<=w.maxLevel;T++)this._levelRects[T]||(this._levelRects[T]=[]),this._levelRects[T].push(w);e.TileSource.apply(this,[S])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(i,s){var n;return i.Image?n=i.Image.xmlns:i.documentElement&&("Image"!==i.documentElement.localName&&"Image"!==i.documentElement.tagName||(n=i.documentElement.namespaceURI)),-1!==(n=(n||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==n.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,s,n){return i=(e.isPlainObject(i)?t:function(r,E){if(!E||!E.documentElement)throw new Error(e.getString("Errors.Xml"));var l,u,p,d,f,w=E.documentElement,T=w.localName||w.tagName,S=E.documentElement.namespaceURI,_=(E=null,[]);if("Image"===T)try{if(void 0===(d=w.getElementsByTagName("Size")[0])&&(d=w.getElementsByTagNameNS(S,"Size")[0]),E={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:w.getAttribute("Url"),Format:w.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(w.getAttribute("Overlap"),10),TileSize:parseInt(w.getAttribute("TileSize"),10),Size:{Height:parseInt(d.getAttribute("Height"),10),Width:parseInt(d.getAttribute("Width"),10)}}},!e.imageFormatSupported(E.Image.Format))throw new Error(e.getString("Errors.ImageFormat",E.Image.Format.toUpperCase()));for(void 0===(l=w.getElementsByTagName("DisplayRect"))&&(l=w.getElementsByTagNameNS(S,"DisplayRect")[0]),f=0;f<l.length;f++)void 0===(p=(u=l[f]).getElementsByTagName("Rect")[0])&&(p=u.getElementsByTagNameNS(S,"Rect")[0]),_.push({Rect:{X:parseInt(p.getAttribute("X"),10),Y:parseInt(p.getAttribute("Y"),10),Width:parseInt(p.getAttribute("Width"),10),Height:parseInt(p.getAttribute("Height"),10),MinLevel:parseInt(u.getAttribute("MinLevel"),10),MaxLevel:parseInt(u.getAttribute("MaxLevel"),10)}});return _.length&&(E.Image.DisplayRect=_),t(0,E)}catch(C){throw C instanceof Error?C:new Error(e.getString("Errors.Dzi"))}else{if("Collection"===T)throw new Error(e.getString("Errors.Dzc"));if("Error"===T)throw w=w.getElementsByTagName("Message")[0].firstChild.nodeValue,new Error(w)}throw new Error(e.getString("Errors.Dzi"))})(this,i),s&&!i.tilesUrl&&(i.tilesUrl=s.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),i.queryParams=-1!==s.search(/\.(dzi|xml|js)\?/)?s.match(/\?.*/):""),i},getTileUrl:function(i,s,n){return[this.tilesUrl,i,"/",s,"_",n,".",this.fileFormat,this.queryParams].join("")},tileExists:function(i,s,n){var r,a,l,u,p,d,f=this._levelRects[i];if(this.minLevel&&i<this.minLevel||this.maxLevel&&i>this.maxLevel)return!1;if(!f||!f.length)return!0;for(d=f.length-1;0<=d;d--)if(!(i<(r=f[d]).minLevel||i>r.maxLevel)&&(p=this.getLevelScale(i),u=(a=r.x*p)+r.width*p,p=(l=r.y*p)+r.height*p,a=Math.floor(a/this._tileWidth),l=Math.floor(l/this._tileWidth),u=Math.ceil(u/this._tileWidth),p=Math.ceil(p/this._tileWidth),a<=s&&s<u&&l<=n&&n<p))return!0;return!1}})}(OpenSeadragon),function(e){function t(s){var n=Array.isArray(s.profile)?s.profile[0]:s.profile,r=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(n);return n=!1,2===s.version&&1<s.profile.length&&s.profile[1].supports&&(n=-1!==s.profile[1].supports.indexOf("sizeByW")),3===s.version&&s.extraFeatures&&(n=-1!==s.extraFeatures.indexOf("sizeByWh")),!r||n}function i(s){for(var n=[],r=0;r<s.sizes.length;r++)n.push({url:s._id+"/full/"+s.sizes[r].width+","+(3===s.version?s.sizes[r].height:"")+"/0/default."+s.tileFormat,width:s.sizes[r].width,height:s.sizes[r].height});return n.sort(function(a,l){return a.width-l.width})}e.IIIFTileSource=function(s){if(e.extend(!0,this,s),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(s.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=s.version,this.tile_width&&this.tile_height)s.tileWidth=this.tile_width,s.tileHeight=this.tile_height;else if(this.tile_width)s.tileSize=this.tile_width;else if(this.tile_height)s.tileSize=this.tile_height;else if(this.tiles)if(1===this.tiles.length)s.tileWidth=this.tiles[0].width,s.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var n=0;n<this.tiles.length;n++)for(var r=0;r<this.tiles[n].scaleFactors.length;r++){var a=this.tiles[n].scaleFactors[r];this.scale_factors.push(a),s.tileSizePerScaleFactor[a]={width:this.tiles[n].width,height:this.tiles[n].height||this.tiles[n].width}}}else if(t(s)){for(var l=Math.min(this.height,this.width),u=[256,512,1024],p=[],d=0;d<u.length;d++)u[d]<=l&&p.push(u[d]);s.tileSize=0<p.length?Math.max.apply(null,p):l}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,s.levels=i(this),e.extend(!0,s,{width:s.levels[s.levels.length-1].width,height:s.levels[s.levels.length-1].height,tileSize:Math.max(s.height,s.width),tileOverlap:0,minLevel:0,maxLevel:s.levels.length-1}),this.levels=s.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!s.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var f=Math.max.apply(null,this.scale_factors);s.maxLevel=Math.round(Math.log(f)*Math.LOG2E)}else s.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[s])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(s,n){return!!(s.protocol&&"http://iiif.io/api/image"===s.protocol||s["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"===s["@context"]||"http://iiif.io/api/image/1/context.json"===s["@context"])||s.profile&&0===s.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||s.identifier&&s.width&&s.height||s.documentElement&&"info"===s.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"===s.documentElement.namespaceURI)},configure:function(s,n,r){if(e.isPlainObject(s)){if(s["@context"]){var a=s["@context"];if(Array.isArray(a))for(var l=0;l<a.length;l++)if("string"==typeof a[l]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(a[l])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===a[l])){a=a[l];break}switch(a){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":s.version=1;break;case"http://iiif.io/api/image/2/context.json":s.version=2;break;case"http://iiif.io/api/image/3/context.json":s.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else s["@context"]="http://iiif.io/api/image/1.0/context.json",s["@id"]=n.replace("/info.json",""),s.version=1;if(s.preferredFormats)for(var u=0;u<s.preferredFormats.length;u++)if(OpenSeadragon.imageFormatSupported(s.preferredFormats[u])){s.tileFormat=s.preferredFormats[u];break}return s}var p=function(T){if(!T||!T.documentElement)throw new Error(e.getString("Errors.Xml"));var f=T.documentElement;if(T=null,"info"===f.tagName)try{return function S(E,_,C){var R,z;if(3===E.nodeType&&C)(z=E.nodeValue.trim()).match(/^\d*$/)&&(z=Number(z)),_[C]?(e.isArray(_[C])||(_[C]=[_[C]]),_[C].push(z)):_[C]=z;else if(1===E.nodeType)for(R=0;R<E.childNodes.length;R++)S(E.childNodes[R],_,E.nodeName)}(f,T={}),T}catch(S){throw S instanceof Error?S:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(s);return p["@context"]="http://iiif.io/api/image/1.0/context.json",p["@id"]=n.replace("/info.xml",""),p.version=1,p},getTileWidth:function(s){return this.emulateLegacyImagePyramid?e.TileSource.prototype.getTileWidth.call(this,s):(s=Math.pow(2,this.maxLevel-s),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[s]?this.tileSizePerScaleFactor[s].width:this._tileWidth)},getTileHeight:function(s){return this.emulateLegacyImagePyramid?e.TileSource.prototype.getTileHeight.call(this,s):(s=Math.pow(2,this.maxLevel-s),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[s]?this.tileSizePerScaleFactor[s].height:this._tileHeight)},getLevelScale:function(s){if(this.emulateLegacyImagePyramid){return 0<this.levels.length&&s>=this.minLevel&&s<=this.maxLevel?this.levels[s].width/this.levels[this.maxLevel].width:NaN}return e.TileSource.prototype.getLevelScale.call(this,s)},getNumTiles:function(s){return this.emulateLegacyImagePyramid?this.getLevelScale(s)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,s)},getTileAtPoint:function(s,n){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,s,n)},getTileUrl:function(s,n,r){if(this.emulateLegacyImagePyramid){var a=null;return 0<this.levels.length&&s>=this.minLevel&&s<=this.maxLevel?this.levels[s].url:a}var l,u,p,d,f,w=Math.pow(.5,this.maxLevel-s),T=Math.round(this.width*w),S=Math.round(this.height*w);return l=this.getTileWidth(s),u=this.getTileHeight(s),f=Math.round(l/w),a=Math.round(u/w),s=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,T<l&&S<u?(d=2===this.version&&T===this.width?"full":3===this.version&&T===this.width&&S===this.height?"max":3===this.version?T+","+S:T+",",p="full"):(S=n*f,T=r*a,f=Math.min(f,this.width-S),a=Math.min(a,this.height-T),p=0===n&&0===r&&f===this.width&&a===this.height?"full":[S,T,f,a].join(","),f=Math.round(f*w),w=Math.round(a*w),d=2===this.version&&f===this.width?"full":3===this.version&&f===this.width&&w===this.height?"max":3===this.version?f+","+w:f+","),[this._id,p,d,"0",s].join("/")},__testonly__:{canBeTiled:t,constructLevels:i}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,i,s,n,r){var a;(!(a=e.isPlainObject(t)?t:{width:t,height:i,tileSize:s,tileOverlap:n,tilesUrl:r}).width||!a.height)&&(a.width=65572864,a.height=65572864),a.tileSize||(a.tileSize=256,a.tileOverlap=0),a.tilesUrl||(a.tilesUrl="http://tile.openstreetmap.org/"),a.minLevel=8,e.TileSource.apply(this,[a])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"openstreetmaps"===t.type},configure:function(t,i,s){return t},getTileUrl:function(t,i,s){return this.tilesUrl+(t-8)+"/"+i+"/"+s+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,i,s,n,r){var a;a=e.isPlainObject(t)?t:{width:t,height:i,tileSize:s,tileOverlap:n,tilesUrl:r};var u=256*Math.ceil(a.width/256),p=256*Math.ceil(a.height/256);a.maxLevel=Math.ceil(Math.log(p<u?u/256:p/256)/Math.log(2))-1,a.tileSize=256,a.width=u,a.height=p,e.TileSource.apply(this,[a])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"tiledmapservice"===t.type},configure:function(t,i,s){return t},getTileUrl:function(t,i,s){var n=this.getNumTiles(t).y-1;return this.tilesUrl+t+"/"+i+"/"+(n-s)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(t){void 0===t.tileSize&&(t.tileSize=256),void 0===t.fileFormat&&(t.fileFormat="jpg",this.fileFormat=t.fileFormat);var i={x:t.width,y:t.height};for(t.imageSizes=[{x:t.width,y:t.height}],t.gridSize=[this._getGridSize(t.width,t.height,t.tileSize)];parseInt(i.x,10)>t.tileSize||parseInt(i.y,10)>t.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),t.imageSizes.push({x:i.x,y:i.y}),t.gridSize.push(this._getGridSize(i.x,i.y,t.tileSize));t.imageSizes.reverse(),t.gridSize.reverse(),t.minLevel=0,t.maxLevel=t.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[t])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(t,i,s){return{x:Math.ceil(t/s),y:Math.ceil(i/s)}},_calculateAbsoluteTileNumber:function(t,i,s){for(var n=0,r={},a=0;a<t;a++)n+=(r=this.gridSize[a]).x*r.y;return n+((r=this.gridSize[t]).x*s+i)},supports:function(t,i){return t.type&&"zoomifytileservice"===t.type},configure:function(t,i,s){return t},getTileUrl:function(t,i,s){var n=this._calculateAbsoluteTileNumber(t,i,s);return n=Math.floor(n/256),this.tilesUrl+"TileGroup"+n+"/"+t+"-"+i+"-"+s+"."+this.fileFormat}})}(OpenSeadragon),function(e){e.LegacyTileSource=function(t){var i,s,n;(i=e.isArray(t)?{type:"legacy-image-pyramid",levels:t}:i).levels=function(r){var a,l,u=[];for(l=0;l<r.length;l++)(a=r[l]).height&&a.width&&a.url?u.push({url:a.url,width:Number(a.width),height:Number(a.height)}):e.console.error("Unsupported image format: %s",a.url||"<no URL>");return u.sort(function(p,d){return p.height-d.height})}(i.levels),0<i.levels.length?(s=i.levels[i.levels.length-1].width,n=i.levels[i.levels.length-1].height):(n=s=0,e.console.error("No supported image formats found")),e.extend(!0,i,{width:s,height:n,tileSize:Math.max(n,s),tileOverlap:0,minLevel:0,maxLevel:0<i.levels.length?i.levels.length-1:0}),e.TileSource.apply(this,[i]),this.levels=i.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"legacy-image-pyramid"===t.type||t.documentElement&&"legacy-image-pyramid"===t.documentElement.getAttribute("type")},configure:function(t,i,s){return e.isPlainObject(t)?t.levels:function(n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var r,a,l=n.documentElement,u=l.tagName,p=null,d=[];if("image"===u)try{for(p={type:l.getAttribute("type"),levels:[]},d=l.getElementsByTagName("level"),a=0;a<d.length;a++)p.levels.push({url:(r=d[a]).getAttribute("url"),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10)});return p.levels}catch(f){throw f instanceof Error?f:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"===u)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"===u)throw new Error("Error: "+n)}throw new Error("Unknown element "+u)}(t)},getLevelScale:function(t){return 0<this.levels.length&&t>=this.minLevel&&t<=this.maxLevel?this.levels[t].width/this.levels[this.maxLevel].width:NaN},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(t,i,s){return 0<this.levels.length&&t>=this.minLevel&&t<=this.maxLevel?this.levels[t].url:null}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"image"===t.type},configure:function(t,i,s){return t},getImageInfo:function(t){var i=this._image=new Image,s=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",function(){s.width=i.naturalWidth,s.height=i.naturalHeight,s.aspectRatio=s.width/s.height,s.dimensions=new e.Point(s.width,s.height),s._tileWidth=s.width,s._tileHeight=s.height,s.tileOverlap=0,s.minLevel=0,s.levels=s._buildLevels(),s.maxLevel=s.levels.length-1,s.ready=!0,s.raiseEvent("ready",{tileSource:s})}),e.addEvent(i,"error",function(){s.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})}),i.src=t},getLevelScale:function(t){return t>=this.minLevel&&t<=this.maxLevel?this.levels[t].width/this.levels[this.maxLevel].width:NaN},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(t,i,s){return t>=this.minLevel&&t<=this.maxLevel?this.levels[t].url:null},getContext2D:function(t,i,s){return t>=this.minLevel&&t<=this.maxLevel?this.levels[t].context2D:null},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var t=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=this._image.naturalWidth,s=this._image.naturalHeight,n=document.createElement("canvas"),r=n.getContext("2d");if(n.width=i,n.height=s,r.drawImage(this._image,0,0,i,s),t[0].context2D=r,delete this._image,e.isCanvasTainted(n))return t;for(;2<=i&&2<=s;){i=Math.floor(i/2),s=Math.floor(s/2);var a=document.createElement("canvas"),l=a.getContext("2d");a.width=i,a.height=s,l.drawImage(n,0,0,i,s),t.splice(0,0,{context2D:l,width:i,height:s}),n=a,r=l}return t},_freeupCanvasMemory:function(){for(var t=0;t<this.levels.length;t++)this.levels[t].context2D&&(this.levels[t].context2D.canvas.height=0,this.levels[t].context2D.canvas.width=0)}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,i,s,n){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(n){e.requestAnimationFrame(function(){var r,a;(r=n).shouldFade&&(a=e.now(),a=1-(a-=r.fadeBeginTime)/r.fadeLength,a=Math.min(1,a),a=Math.max(0,a),r.imgGroup&&e.setElementOpacity(r.imgGroup,a,!0),0<a&&t(r))})}function i(n,r){var a;n.element.disabled||(r>=e.ButtonState.GROUP&&n.currentState===e.ButtonState.REST&&((a=n).shouldFade=!1,a.imgGroup&&e.setElementOpacity(a.imgGroup,1,!0),n.currentState=e.ButtonState.GROUP),r>=e.ButtonState.HOVER&&n.currentState===e.ButtonState.GROUP&&(n.imgHover&&(n.imgHover.style.visibility=""),n.currentState=e.ButtonState.HOVER),r>=e.ButtonState.DOWN&&n.currentState===e.ButtonState.HOVER&&(n.imgDown&&(n.imgDown.style.visibility=""),n.currentState=e.ButtonState.DOWN))}function s(n,r){var a;n.element.disabled||(r<=e.ButtonState.HOVER&&n.currentState===e.ButtonState.DOWN&&(n.imgDown&&(n.imgDown.style.visibility="hidden"),n.currentState=e.ButtonState.HOVER),r<=e.ButtonState.GROUP&&n.currentState===e.ButtonState.HOVER&&(n.imgHover&&(n.imgHover.style.visibility="hidden"),n.currentState=e.ButtonState.GROUP),r<=e.ButtonState.REST&&n.currentState===e.ButtonState.GROUP&&((a=n).shouldFade=!0,a.fadeBeginTime=e.now()+a.fadeDelay,window.setTimeout(function(){t(a)},a.fadeDelay),n.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(n){var r=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},n),this.element=n.element||e.makeNeutralElement("div"),n.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){a.insideElementPressed?(i(r,e.ButtonState.DOWN),r.raiseEvent("enter",{originalEvent:a.originalEvent})):a.buttonDownAny||i(r,e.ButtonState.HOVER)},focusHandler:function(a){r.tracker.enterHandler(a),r.raiseEvent("focus",{originalEvent:a.originalEvent})},leaveHandler:function(a){s(r,e.ButtonState.GROUP),a.insideElementPressed&&r.raiseEvent("exit",{originalEvent:a.originalEvent})},blurHandler:function(a){r.tracker.leaveHandler(a),r.raiseEvent("blur",{originalEvent:a.originalEvent})},pressHandler:function(a){i(r,e.ButtonState.DOWN),r.raiseEvent("press",{originalEvent:a.originalEvent})},releaseHandler:function(a){a.insideElementPressed&&a.insideElementReleased?(s(r,e.ButtonState.HOVER),r.raiseEvent("release",{originalEvent:a.originalEvent})):a.insideElementPressed?s(r,e.ButtonState.GROUP):i(r,e.ButtonState.HOVER)},clickHandler:function(a){a.quick&&r.raiseEvent("click",{originalEvent:a.originalEvent})},keyHandler:function(a){13===a.keyCode?(r.raiseEvent("click",{originalEvent:a.originalEvent}),r.raiseEvent("release",{originalEvent:a.originalEvent}),a.preventDefault=!0):a.preventDefault=!1}}),s(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){i(this,e.ButtonState.GROUP)},notifyGroupExit:function(){s(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,s=this.buttons.concat([]),n=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",i=0;i<s.length;i++)this.element.appendChild(s[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(r){var a;for(a=0;a<n.buttons.length;a++)n.buttons[a].notifyGroupEnter()},leaveHandler:function(r){var a;if(!r.insideElementPressed)for(a=0;a<n.buttons.length;a++)n.buttons[a].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var t=this.buttons.pop();this.element.removeChild(t.element),t.destroy()}this.tracker.destroy(),this.element=null}}}(OpenSeadragon),function(e){e.Rect=function(t,i,s,n,r){var a,l;this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof s?s:0,this.height="number"==typeof n?n:0,this.degrees="number"==typeof r?r:0,this.degrees=e.positiveModulo(this.degrees,360),270<=this.degrees?(a=this.getTopRight(),this.x=a.x,this.y=a.y,l=this.height,this.height=this.width,this.width=l,this.degrees-=270):180<=this.degrees?(a=this.getBottomRight(),this.x=a.x,this.y=a.y,this.degrees-=180):90<=this.degrees&&(a=this.getBottomLeft(),this.x=a.x,this.y=a.y,l=this.height,this.height=this.width,this.width=l,this.degrees-=90)},e.Rect.fromSummits=function(t,i,s){var n=t.distanceTo(i),r=t.distanceTo(s);return s=i.minus(t),i=Math.atan(s.y/s.x),s.x<0?i+=Math.PI:s.y<0&&(i+=2*Math.PI),new e.Rect(t.x,t.y,n,r,i/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),s=t.getBoundingBox(),n=Math.min(i.x,s.x),r=Math.min(i.y,s.y);return t=Math.max(i.x+i.width,s.x+s.width),s=Math.max(i.y+i.height,s.y+s.height),new e.Rect(n,r,t-n,s-r)},intersection:function(t){var C,R,z,D,L,U,i=1e-10,s=[],n=this.getTopLeft();t.containsPoint(n,i)&&s.push(n),n=this.getTopRight(),t.containsPoint(n,i)&&s.push(n),n=this.getBottomLeft(),t.containsPoint(n,i)&&s.push(n),n=this.getBottomRight(),t.containsPoint(n,i)&&s.push(n),n=t.getTopLeft(),this.containsPoint(n,i)&&s.push(n),n=t.getTopRight(),this.containsPoint(n,i)&&s.push(n),n=t.getBottomLeft(),this.containsPoint(n,i)&&s.push(n),n=t.getBottomRight(),this.containsPoint(n,i)&&s.push(n);for(var r=this._getSegments(),a=t._getSegments(),l=0;l<r.length;l++)for(var u=r[l],p=0;p<a.length;p++){var d=a[p];z=d[0],D=d[1],void 0,void 0,L=(R=u[1]).minus(C=u[0]),(d=0==(R=-(U=D.minus(z)).x*L.y+L.x*U.y)?null:(D=(L.x*(C.y-z.y)-L.y*(C.x-z.x))/R,R=(U.x*(C.y-z.y)-U.y*(C.x-z.x))/R,-i<=D&&D<=1-i&&-i<=R&&R<=1-i?new e.Point(C.x+R*L.x,C.y+R*L.y):null))&&s.push(d)}if(0===s.length)return null;for(var f=s[0].x,w=s[0].x,T=s[0].y,S=s[0].y,E=1;E<s.length;E++){var _=s[E];_.x<f&&(f=_.x),_.x>w&&(w=_.x),_.y<T&&(T=_.y),_.y>S&&(S=_.y)}return new e.Rect(f,T,w-f,S-T)},_getSegments:function(){var t=this.getTopLeft(),i=this.getTopRight(),s=this.getBottomLeft(),n=this.getBottomRight();return[[t,i],[i,n],[n,s],[s,t]]},rotate:function(t,i){if(0===(t=e.positiveModulo(t,360)))return this.clone();i=i||this.getCenter();var s=this.getTopLeft().rotate(t,i);return t=(t=this.getTopRight().rotate(t,i).minus(s)).apply(function(n){return Math.abs(n)<1e-15?0:n}),i=Math.atan(t.y/t.x),t.x<0?i+=Math.PI:t.y<0&&(i+=2*Math.PI),new e.Rect(s.x,s.y,this.width,this.height,i/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),s=this.getBottomLeft(),n=this.getBottomRight(),r=Math.min(t.x,i.x,s.x,n.x),a=Math.max(t.x,i.x,s.x,n.x),l=Math.min(t.y,i.y,s.y,n.y);return n=Math.max(t.y,i.y,s.y,n.y),new e.Rect(r,l,a-r,n-l)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),s=Math.floor(t.y),n=Math.ceil(t.width+t.x-i);return t=Math.ceil(t.height+t.y-s),new e.Rect(i,s,n,t)},containsPoint:function(t,i){i=i||0;var s=this.getTopLeft(),n=this.getTopRight(),r=this.getBottomLeft(),a=n.minus(s),l=r.minus(s);return(t.x-s.x)*a.x+(t.y-s.y)*a.y>=-i&&(t.x-n.x)*a.x+(t.y-n.y)*a.y<=i&&(t.x-s.x)*l.x+(t.y-s.y)*l.y>=-i&&(t.x-r.x)*l.x+(t.y-r.y)*l.y<=i},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function i(d){d.quick&&(d="horizontal"===this.scroll?Math.floor(d.position.x/this.panelWidth):Math.floor(d.position.y/this.panelHeight),this.viewer.goToPage(d)),this.element.focus()}function s(d){if(this.dragging=!0,this.element){var f=Number(this.element.style.marginLeft.replace("px","")),w=Number(this.element.style.marginTop.replace("px","")),T=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),E=e.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?0<-d.delta.x?f>-(T-E.x)&&(this.element.style.marginLeft=f+2*d.delta.x+"px",r(this,E.x,f+2*d.delta.x)):-d.delta.x<0&&f<0&&(this.element.style.marginLeft=f+2*d.delta.x+"px",r(this,E.x,f+2*d.delta.x)):0<-d.delta.y?w>-(S-E.y)&&(this.element.style.marginTop=w+2*d.delta.y+"px",r(this,E.y,w+2*d.delta.y)):-d.delta.y<0&&w<0&&(this.element.style.marginTop=w+2*d.delta.y+"px",r(this,E.y,w+2*d.delta.y))}}function n(d){if(this.element){var f=Number(this.element.style.marginLeft.replace("px","")),w=Number(this.element.style.marginTop.replace("px","")),T=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),E=e.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?0<d.scroll?f>-(T-E.x)&&(this.element.style.marginLeft=f-60*d.scroll+"px",r(this,E.x,f-60*d.scroll)):d.scroll<0&&f<0&&(this.element.style.marginLeft=f-60*d.scroll+"px",r(this,E.x,f-60*d.scroll)):d.scroll<0?w>E.y-S&&(this.element.style.marginTop=w+60*d.scroll+"px",r(this,E.y,w+60*d.scroll)):0<d.scroll&&w<0&&(this.element.style.marginTop=w+60*d.scroll+"px",r(this,E.y,w+60*d.scroll)),d.preventDefault=!0}}function r(d,f,w){var T,S,E,_,C;for(T="horizontal"===d.scroll?d.panelWidth:d.panelHeight,S=Math.ceil(f/T)+5,_=S=(S=(E=Math.ceil((Math.abs(w)+f)/T)+1)-S)<0?0:S;_<E&&_<d.panels.length;_++)if(!(C=d.panels[_]).activePanel){var R=d.viewer.tileSources[_];R=new e.Viewer({id:C.id,tileSources:[R=R.referenceStripThumbnailUrl?{type:"image",url:R.referenceStripThumbnailUrl}:R],element:C,navigatorSizeRatio:d.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:d.viewer.loadTilesWithAjax,ajaxHeaders:d.viewer.ajaxHeaders,useCanvas:d.useCanvas}),e.setElementPointerEventsNone(R.canvas),e.setElementPointerEventsNone(R.container),R.innerTracker.setTracking(!1),R.outerTracker.setTracking(!1),d.miniViewers[C.id]=R,C.activePanel=!0}}function a(d){d=d.eventSource.element,"horizontal"===this.scroll?d.style.marginBottom="0px":d.style.marginLeft="0px"}function l(d){d=d.eventSource.element,"horizontal"===this.scroll?d.style.marginBottom="-"+e.getElementSize(d).y/2+"px":d.style.marginLeft="-"+e.getElementSize(d).x/2+"px"}function u(d){if(d.ctrl||d.alt||d.meta)d.preventDefault=!1;else switch(d.keyCode){case 38:case 39:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 40:case 37:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1}}function p(d){if(d.ctrl||d.alt||d.meta)d.preventDefault=!1;else switch(d.keyCode){case 61:case 48:case 119:case 87:case 100:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 45:case 115:case 83:case 97:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1}}e.ReferenceStrip=function(d){var f,w,T,S=d.viewer,E=e.getElementSize(S.element);for(d.id||(d.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element}),e.extend(this,d),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,(w=this.element.style).marginTop="0px",w.marginRight="0px",w.marginBottom="0px",w.marginLeft="0px",w.left="0px",w.bottom="0px",w.border="0px",w.background="#000",w.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=S,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,i),dragHandler:e.delegate(this,s),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,a),leaveHandler:e.delegate(this,l),keyDownHandler:e.delegate(this,u),keyHandler:e.delegate(this,p),preProcessEventHandler:function(_){"wheel"===_.eventType&&(_.preventDefault=!0)}}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",S.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"===d.scroll?(this.element.style.width=E.x*d.sizeRatio*S.tileSources.length+12*S.tileSources.length+"px",this.element.style.height=E.y*d.sizeRatio+"px",S.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=E.y*d.sizeRatio*S.tileSources.length+12*S.tileSources.length+"px",this.element.style.width=E.x*d.sizeRatio+"px",S.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=E.x*this.sizeRatio+8,this.panelHeight=E.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},T=0;T<S.tileSources.length;T++)(f=e.makeNeutralElement("div")).id=this.element.id+"-"+T,f.style.width=this.panelWidth+"px",f.style.height=this.panelHeight+"px",f.style.display="inline",f.style.float="left",f.style.cssFloat="left",f.style.styleFloat="left",f.style.padding="2px",e.setElementTouchActionNone(f),e.setElementPointerEventsNone(f),this.element.appendChild(f),f.activePanel=!1,this.panels.push(f);r(this,"vertical"===this.scroll?E.y:E.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(d){var f,w=this.element.querySelector("#"+this.element.id+"-"+d),T=e.getElementSize(this.viewer.canvas),S=Number(this.element.style.width.replace("px","")),E=Number(this.element.style.height.replace("px","")),_=-Number(this.element.style.marginLeft.replace("px","")),C=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==w&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=w,this.currentSelected.style.background="#999","horizontal"===this.scroll?(f=Number(d)*(this.panelWidth+3))>_+T.x-this.panelWidth?(f=Math.min(f,S-T.x),this.element.style.marginLeft=-f+"px",r(this,T.x,-f)):f<_&&(f=Math.max(0,f-T.x/2),this.element.style.marginLeft=-f+"px",r(this,T.x,-f)):(f=Number(d)*(this.panelHeight+3))>C+T.y-this.panelHeight?(f=Math.min(f,E-T.y),this.element.style.marginTop=-f+"px",r(this,T.y,-f)):f<C&&(f=Math.max(0,f-T.y/2),this.element.style.marginTop=-f+"px",r(this,T.y,-f)),this.currentPage=d,a.call(this,{eventSource:this.tracker}))},update:function(){return!!t[this.id].animating},destroy:function(){if(this.miniViewers)for(var d in this.miniViewers)this.miniViewers[d].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}}}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,s,n,r,a){e.Rect.apply(this,[t,i,s,n]),this.minLevel=r,this.maxLevel=a},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:1<i.length?i[1].springStiffness:5,animationTime:1<i.length?i[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&0<=t.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,i;this.current.time=e.now(),this._exponential?(t=this.start._logValue,i=this.target._logValue):(t=this.start.value,i=this.target.value),s=this.current.time>=this.target.time?i:t+(i-t)*(n=this.springStiffness,s=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(n*-s))/(1-Math.exp(-n)));var s,n=this.current.value;return this.current.value=this._exponential?Math.exp(s):s,n!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){e.ImageJob=function(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.data=null,this.userData={},this.errorMsg=null},e.ImageJob.prototype={start:function(){var t=this,i=this.abort;this.jobId=window.setTimeout(function(){t.finish(null,null,"Image load exceeded timeout ("+t.timeout+" ms)")},this.timeout),this.abort=function(){t.source.downloadTileAbort(t),"function"==typeof i&&i()},this.source.downloadTileStart(this)},finish:function(t,i,s){this.data=t,this.request=i,this.errorMsg=s,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(t){t.source||(e.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource."),t.source={downloadTileStart:(s=e.TileSource.prototype).downloadTileStart,downloadTileAbort:s.downloadTileAbort});var i=this,s=new e.ImageJob(s={src:t.src,tile:t.tile||{},source:t.source,loadWithAjax:t.loadWithAjax,ajaxHeaders:t.loadWithAjax?t.ajaxHeaders:null,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,postData:t.postData,callback:function(n){var r,a,l;a=n,l=t.callback,(r=i).jobsInProgress--,(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&0<r.jobQueue.length&&(r.jobQueue.shift().start(),r.jobsInProgress++),l(a.data,a.errorMsg,a.request)},abort:t.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(s.start(),this.jobsInProgress++):this.jobQueue.push(s)},clear:function(){for(var t=0;t<this.jobQueue.length;t++){var i=this.jobQueue[t];"function"==typeof i.abort&&i.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(t,i,s,n,r,a,l,u,p,d,f,w){this.level=t,this.x=i,this.y=s,this.bounds=n,this.sourceBounds=d,this.exists=r,this._url=a,this.postData=f,this.context2D=l,this.loadWithAjax=u,this.ajaxHeaders=p,void 0===w&&(e.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),w=e.TileSource.prototype.getTileHashKey(t,i,s,a,p,f)),this.cacheKey=w,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},drawHTML:function(t){if(this.cacheImageRecord)if(this.loaded){if(!this.element){var i=this.getImage();if(!i)return;this.element=e.makeNeutralElement("div"),this.imgElement=i.cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"}this.element.parentNode!==t&&t.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)}else e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());else e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},get image(){return e.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return e.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return"function"==typeof this._url?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord.getRenderedContext()},drawCanvas:function(t,i,s,n,r,a){var l,u=this.position.times(e.pixelDensityRatio),p=this.size.times(e.pixelDensityRatio);if(this.context2D||this.cacheImageRecord)if(l=this.getCanvasContext(),this.loaded&&l){var d,f;t.save(),t.globalAlpha=this.opacity,"number"==typeof s&&1!==s&&(u=u.times(s),p=p.times(s)),n instanceof e.Point&&(u=u.plus(n)),1===t.globalAlpha&&this.hasTransparency&&(r&&(u.x=Math.round(u.x),u.y=Math.round(u.y),p.x=Math.round(p.x),p.y=Math.round(p.y)),t.clearRect(u.x,u.y,p.x,p.y)),i({context:t,tile:this,rendered:l}),this.sourceBounds?(d=Math.min(this.sourceBounds.width,l.canvas.width),f=Math.min(this.sourceBounds.height,l.canvas.height)):(d=l.canvas.width,f=l.canvas.height),t.translate(u.x+p.x/2,0),this.flipped&&t.scale(-1,1),t.drawImage(l.canvas,0,0,d,f,-p.x/2,u.y,p.x,p.y),t.restore()}else e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());else e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,s){var n=Math.max(1,Math.ceil((s.x-i.x)/2));return i=Math.max(1,Math.ceil((s.y-i.y)/2)),new e.Point(n,i).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply(function(r){return r%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,s){s=e.isPlainObject(t)?t:{element:t,location:i,placement:s},this.element=s.element,this.style=s.element.style,this._init(s)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var s=e.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?t.x-=i.x/2:s.isRight&&(t.x-=i.x),s.isVerticallyCentered?t.y-=i.y/2:s.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var s=e.getCssPropertyWithVendorPrefix("transformOrigin");t=e.getCssPropertyWithVendorPrefix("transform"),s&&t&&(i[s]="",i[t]="")},drawHTML:function(t,i){var s=this.element;s.parentNode!==t&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,t.appendChild(s),this.style.position="absolute",this.size=e.getElementSize(s));var n=this._getOverlayPositionAndSize(i);t=n.position,s=this.size=n.size,i=n.rotate,this.onDraw?this.onDraw(t,s,this.element):((n=this.style).left=t.x+"px",n.top=t.y+"px",null!==this.width&&(n.width=s.x+"px"),null!==this.height&&(n.height=s.y+"px"),t=e.getCssPropertyWithVendorPrefix("transformOrigin"),s=e.getCssPropertyWithVendorPrefix("transform"),t&&s&&(i?(n[t]=this._getTransformOrigin(),n[s]="rotate("+i+"deg)"):(n[t]="",n[s]="")),n.display="block")},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(t);this.adjust(i,s);var n=0;if(t.getRotation(!0)&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var r=new e.Rect(i.x,i.y,s.x,s.y);i=(r=this._getBoundingBox(r,t.getRotation(!0))).getTopLeft(),s=r.getSize()}else n=t.getRotation(!0);return{position:i,size:s,rotate:n}},_getSizeInPixels:function(t){var i=this.size.x,s=this.size.y;if(null!==this.width||null!==this.height){var n=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=n.x),null!==this.height&&(s=n.y)}return this.checkResize&&(null===this.width||null===this.height)&&(n=this.size=e.getElementSize(this.element),null===this.width&&(i=n.x),null===this.height&&(s=n.y)),new e.Point(i,s)},_getBoundingBox:function(t,i){var s=this._getPlacementPoint(t);return t.rotate(i,s).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),s=e.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?i.x+=t.width/2:s.isRight&&(i.x+=t.width),s.isVerticallyCentered?i.y+=t.height/2:s.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i&&(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom")),t},update:function(t,i){i=e.isPlainObject(t)?t:{location:t,placement:i},this._init({location:i.location||this.location,placement:(void 0!==i.placement?i:this).placement,onDraw:i.onDraw||this.onDraw,checkResize:i.checkResize||this.checkResize,width:(void 0!==i.width?i:this).width,height:(void 0!==i.height?i:this).height,rotationMode:i.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,s=this.height;if(null===i||null===s){var n=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=n.x),null===s&&(s=n.y)}return n=this.location.clone(),this.adjust(n,new e.Point(i,s)),this._adjustBoundsForRotation(t,new e.Rect(n.x,n.y,i,s))},_adjustBoundsForRotation:function(t,i){return t&&0!==t.getRotation(!0)&&this.rotationMode!==e.OverlayRotationMode.EXACT?this.rotationMode!==e.OverlayRotationMode.BOUNDING_BOX?i.rotate(-t.getRotation(!0),this._getPlacementPoint(i)):null===this.width||null===this.height?i:(i=this._getOverlayPositionAndSize(t),t.viewerElementToViewportRectangle(new e.Rect(i.position.x,i.position.y,i.size.x,i.size.y))):i}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas&&(i=this._calculateCanvasSize(),this.canvas.width=i.x,this.canvas.height=i.y),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,i,s,n){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,s,n),this},updateOverlay:function(t,i,s){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,s),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){return t=this.viewport.pixelFromPointNoRotate(t,!0),new e.Point(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio)},clipWithPolygons:function(t,i){if(this.useCanvas){var s=this._getContext(i);s.beginPath(),t.forEach(function(n){n.forEach(function(r,a){s[0===a?"moveTo":"lineTo"](r.x,r.y)})}),s.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,s=0;s<i.getItemCount();s++)i.getItemAt(s).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,s=0;s<t.getItemCount();s++){var n=t.getItemAt(s).getOpacity();i<n&&(i=n)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var t=this._calculateCanvasSize();(this.canvas.width!==t.x||this.canvas.height!==t.y)&&(this.canvas.width=t.x,this.canvas.height=t.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(t=this._calculateSketchCanvasSize(),this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear()}},_clear:function(t,i){this.useCanvas&&(t=this._getContext(t),i?t.clearRect(i.x,i.y,i.width,i.height):t.clearRect(0,0,(i=t.canvas).width,i.height))},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0);return t=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0),new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio)},drawTile:function(t,i,s,n,r,a,l){e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas?(s=this._getContext(s),t.drawCanvas(s,i,n=n||1,r,a,l)):t.drawHTML(this.canvas)},_getContext:function(t){var i=this.context;if(t){if(null===this.sketchCanvas){if(this.sketchCanvas=document.createElement("canvas"),t=this._calculateSketchCanvasSize(),this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var s=this;this.viewer.addHandler("rotate",function n(){if(0!==s.viewport.getRotation()){s.viewer.removeHandler("rotate",n);var r=s._calculateSketchCanvasSize();s.sketchCanvas.width=r.x,s.sketchCanvas.height=r.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}i=this.sketchContext}return i},saveContext:function(t){this.useCanvas&&this._getContext(t).save()},restoreContext:function(t){this.useCanvas&&this._getContext(t).restore()},setClip:function(t,i){this.useCanvas&&((i=this._getContext(i)).beginPath(),i.rect(t.x,t.y,t.width,t.height),i.clip())},drawRectangle:function(t,i,s){this.useCanvas&&((s=this._getContext(s)).save(),s.fillStyle=i,s.fillRect(t.x,t.y,t.width,t.height),s.restore())},blendSketch:function(t,i,s,n){var r=t;if(e.isPlainObject(r)||(r={opacity:t,scale:i,translate:s,compositeOperation:n}),this.useCanvas&&this.sketchCanvas){t=r.opacity,n=r.compositeOperation;var a=r.bounds;this.context.save(),this.context.globalAlpha=t,n&&(this.context.globalCompositeOperation=n),a?(a.x<0&&(a.width+=a.x,a.x=0),a.x+a.width>this.canvas.width&&(a.width=this.canvas.width-a.x),a.y<0&&(a.height+=a.y,a.y=0),a.y+a.height>this.canvas.height&&(a.height=this.canvas.height-a.y),this.context.drawImage(this.sketchCanvas,a.x,a.y,a.width,a.height,a.x,a.y,a.width,a.height)):(i=r.scale||1,t=(s=r.translate)instanceof e.Point?s:new e.Point(0,0),n=0,a=0,s&&(r=this.sketchCanvas.width-this.canvas.width,s=this.sketchCanvas.height-this.canvas.height,n=Math.round(r/2),a=Math.round(s/2)),this.context.drawImage(this.sketchCanvas,t.x-n*i,t.y-a*i,(this.canvas.width+2*n)*i,(this.canvas.height+2*a)*i,-n,-a,this.canvas.width+2*n,this.canvas.height+2*a)),this.context.restore()}},drawDebugInfo:function(t,i,s,n){if(this.useCanvas){var r=this.viewer.world.getIndexOfItem(n)%this.debugGridColor.length,a=this.context;a.save(),a.lineWidth=2*e.pixelDensityRatio,a.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",a.strokeStyle=this.debugGridColor[r],a.fillStyle=this.debugGridColor[r],this.viewport.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:this.viewport.getRotation(!0)}),n.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0)}),n.viewport.getRotation(!0)%360==0&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),a.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var l=(t.position.x+t.size.x/2)*e.pixelDensityRatio;a.translate(l,r=(t.position.y+t.size.y/2)*e.pixelDensityRatio),a.rotate(Math.PI/180*-this.viewport.getRotation(!0)),a.translate(-l,-r),0===t.x&&0===t.y&&(a.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),a.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),a.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),a.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),a.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),a.fillText("Order: "+s+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),a.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),a.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),this.viewport.getRotation(!0)%360!=0&&this._restoreRotationChanges(),n.getRotation(!0)%360!=0&&this._restoreRotationChanges(),n.viewport.getRotation(!0)%360==0&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),a.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(t){this.useCanvas&&(this._imageSmoothingEnabled=t,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(t){t.msImageSmoothingEnabled=this._imageSmoothingEnabled,t.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){return t=this._getContext(t).canvas,new e.Point(t.width,t.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(t.useSketch);s.save(),s.translate(i.x,i.y),this.viewer.viewport.flipped?(s.rotate(Math.PI/180*-t.degrees),s.scale(-1,1)):s.rotate(Math.PI/180*t.degrees),s.translate(-i.x,-i.y)},_flip:function(t){var i=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter();(t=this._getContext(t.useSketch)).translate(i.x,0),t.scale(-1,1),t.translate(-i.x,0)},_restoreRotationChanges:function(t){this._getContext(t).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*t),y:Math.round(i.y*t)}},_calculateSketchCanvasSize:function(){var t=this._calculateCanvasSize();return 0===this.viewport.getRotation()?t:{x:t=Math.ceil(Math.sqrt(t.x*t.x+t.y*t.y)),y:t}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;(t=i.length&&i[0]instanceof e.Point?{containerSize:i[0],contentSize:i[1],config:i[2]}:t).config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,t.initialDegrees=t.degrees,delete t.degrees,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:e.DEFAULT_SETTINGS.silenceMultiImageWarnings},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new e.Spring({initial:t.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={get degrees(){return e.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(t){e.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(t)},resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(0<t.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(0<t.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(0<t.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(0<t.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?1<=t?t:1:1<=t?1:t)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),s=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-s/2,i,s)},goHome:function(t){return this.viewer&&this.viewer.raiseEvent("home",{immediately:t}),this.fitBounds(this.getHomeBounds(),t)},getMinZoom:function(){var t=this.getHomeZoom();return this.minZoomLevel||this.minZoomImageRatio*t},getMaxZoom:function(){var t=this.maxZoomLevel;return t||(t=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,t/=this._contentBounds.width),Math.max(t,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(-this.getRotation(t))},getBoundsNoRotate:function(t){var i=this.getCenter(t),s=1/this.getZoom(t);return t=s/this.getAspectRatio(),new e.Rect(i.x-s/2,i.y-t/2,s,t)},getBoundsWithMargins:function(t){return this.getBoundsNoRotateWithMargins(t).rotate(-this.getRotation(t),this.getCenter(t))},getBoundsNoRotateWithMargins:function(t){var i=this.getBoundsNoRotate(t);return t=this._containerInnerSize.x*this.getZoom(t),i.x-=this._margins.left/t,i.y-=this._margins.top/t,i.width+=(this._margins.left+this._margins.right)/t,i.height+=(this._margins.top+this._margins.bottom)/t,i},getCenter:function(t){var i,s,n,r=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),a=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?r:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),t=(s=1/(n=this.getZoom()))/this.getAspectRatio(),t=new e.Rect(r.x-s/2,r.y-t/2,s,t),n=this._pixelFromPoint(this.zoomPoint,t).minus(i).rotate(-this.getRotation(!0)).divide(this._containerInnerSize.x*n),a.plus(n)):a},getZoom:function(t){return(t?this.zoomSpring.current:this.zoomSpring.target).value},_applyZoomConstraints:function(t){return Math.max(Math.min(t,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var i=this.viewportToViewerElementRectangle(t).getBoundingBox(),s=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),n=!1,r=!1;if(!this.wrapHorizontal){var u,a=i.x+i.width,l=s.x+s.width;a=s.x-a+(u=i.width>s.width?this.visibilityRatio*s.width:this.visibilityRatio*i.width),l=l-i.x-u,u>s.width?(i.x+=(a+l)/2,n=!0):l<0?(i.x+=l,n=!0):0<a&&(i.x+=a,n=!0)}if(!this.wrapVertical){var p=i.y+i.height;p=s.y-p+(a=i.height>s.height?this.visibilityRatio*s.height:this.visibilityRatio*i.height),l=(l=s.y+s.height)-i.y-a,a>s.height?(i.y+=(p+l)/2,r=!0):l<0?(i.y+=l,r=!0):0<p&&(i.y+=p,r=!0)}return(t=(p=n||r)?this.viewerElementToViewportRectangle(i):t.clone()).xConstrained=n,t.yConstrained=r,t.constraintApplied=p,t},_raiseConstraintsEvent:function(t){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:t})},applyConstraints:function(t){var i=this.getZoom(),s=this._applyZoomConstraints(i);return i!==s&&this.zoomTo(s,this.zoomPoint,t),(s=this.getConstrainedBounds(!1)).constraintApplied&&(this.fitBounds(s,t),this._raiseConstraintsEvent(t)),this},ensureVisible:function(t){return this.applyConstraints(t)},_fitBounds:function(t,i){var s=(i=i||{}).immediately||!1,n=i.constraints||!1,r=this.getAspectRatio(),a=t.getCenter(),l=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();l.getAspectRatio()>=r?l.height=l.width/r:l.width=l.height*r,l.x=a.x-l.width/2,l.y=a.y-l.height/2;var u=1/l.width;if(s)return this.panTo(a,!0),this.zoomTo(u,null,!0),n&&this.applyConstraints(!0),this;var p=this.getCenter(!0);return i=this.getZoom(!0),this.panTo(p,!0),this.zoomTo(i,null,!0),t=this.getBounds(),0===(r=this.getZoom())||Math.abs(u/r-1)<1e-8?(this.zoomTo(u,null,!0),this.panTo(a,s),n&&this.applyConstraints(!1),this):(n?(this.panTo(a,!1),this.zoomTo(u,null,!1),a=this.getConstrainedBounds(),this.panTo(p,!0),this.zoomTo(i,null,!0),this.fitBounds(a)):(r=l.rotate(-this.getRotation()).getTopLeft().times(u).minus(t.getTopLeft().times(r)).divide(u-r),this.zoomTo(u,r,s)),this)},fitBounds:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!1})},fitBoundsWithConstraints:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(t){return t=this.getBounds(t),this._applyBoundaryConstraints(t)},panBy:function(t,i){var s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(t),i)},panTo:function(t,i){return i?(this.centerSpringX.resetTo(t.x),this.centerSpringY.resetTo(t.y)):(this.centerSpringX.springTo(t.x),this.centerSpringY.springTo(t.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:t,immediately:i}),this},zoomBy:function(t,i,s){return this.zoomTo(this.zoomSpring.target.value*t,i,s)},zoomTo:function(t,i,s){var n=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,s?this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.resetTo(t)}):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:s}),this},setRotation:function(t,i){return this.rotateTo(t,null,i)},getRotation:function(t){return(t?this.degreesSpring.current:this.degreesSpring.target).value},setRotationWithPivot:function(t,i,s){return this.rotateTo(t,i,s)},rotateTo:function(t,i,s){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===t&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,s)if(this.rotationPivot){if(!(t-this._oldDegrees))return this.rotationPivot=null,this;this._rotateAboutPivot(t)}else this.degreesSpring.resetTo(t);else{var n=e.positiveModulo(this.degreesSpring.current.value,360),r=e.positiveModulo(t,360);180<(i=r-n)?r-=360:i<-180&&(r+=360),this.degreesSpring.resetTo(t+(n-r)),this.degreesSpring.springTo(t)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t,immediately:!!s,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(t,i,s){return this.rotateTo(this.degreesSpring.target.value+t,i,s)},resize:function(t,i){var n=this.getBoundsNoRotate(),r=n;return this.containerSize.x=t.x,this.containerSize.y=t.y,this._updateContainerInnerSize(),i&&(r.width=n.width*(t.x/this.containerSize.x),r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var t=this;this._adjustCenterSpringsForZoomPoint(function(){t.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var i=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,i},_rotateAboutPivot:function(t){var i=!0===t,s=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(s.x),this.centerSpringY.shiftBy(s.y),i?this.degreesSpring.update():this.degreesSpring.resetTo(t),t=s.rotate(-1*(t=this.degreesSpring.current.value-this._oldDegrees)).times(-1),this.centerSpringX.shiftBy(t.x),this.centerSpringY.shiftBy(t.y)},_adjustCenterSpringsForZoomPoint:function(t){if(this.zoomPoint){var i=this.pixelFromPoint(this.zoomPoint,!0);t(),i=this.pixelFromPoint(this.zoomPoint,!0).minus(i),i=this.deltaPointsFromPixels(i,!0),this.centerSpringX.shiftBy(i.x),this.centerSpringY.shiftBy(i.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else t()},deltaPixelsFromPointsNoRotate:function(t,i){return t.times(this._containerInnerSize.x*this.getZoom(i))},deltaPixelsFromPoints:function(t,i){return this.deltaPixelsFromPointsNoRotate(t.rotate(this.getRotation(i)),i)},deltaPointsFromPixelsNoRotate:function(t,i){return t.divide(this._containerInnerSize.x*this.getZoom(i))},deltaPointsFromPixels:function(t,i){return this.deltaPointsFromPixelsNoRotate(t,i).rotate(-this.getRotation(i))},pixelFromPointNoRotate:function(t,i){return this._pixelFromPointNoRotate(t,this.getBoundsNoRotate(i))},pixelFromPoint:function(t,i){return this._pixelFromPoint(t,this.getBoundsNoRotate(i))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(t,i){return this._pixelFromPointNoRotate(t.rotate(this.getRotation(!0),this.getCenter(!0)),i)},pointFromPixelNoRotate:function(t,i){return i=this.getBoundsNoRotate(i),t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/i.width).plus(i.getTopLeft())},pointFromPixel:function(t,i){return this.pointFromPixelNoRotate(t,i).rotate(-this.getRotation(i),this.getCenter(i))},_viewportToImageDelta:function(t,i){var s=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/s,i*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(1<s)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===s)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,i,!0)}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var s=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*s,i/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(1<s)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===s)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,i,!0)}return(i=this._imageToViewportDelta(t,i)).x+=this._contentBoundsNoRotate.x,i.y+=this._contentBoundsNoRotate.y,i},imageToViewportRectangle:function(t,i,s,n){var r=t;if(r instanceof e.Rect||(r=new e.Rect(t,i,s,n)),this.viewer){var a=this.viewer.world.getItemCount();if(1<a)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===a)return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,i,s,n,!0)}return s=this.imageToViewportCoordinates(r.x,r.y),n=this._imageToViewportDelta(r.width,r.height),new e.Rect(s.x,s.y,n.x,n.y,r.degrees)},viewportToImageRectangle:function(t,i,s,n){var r=t;if(r instanceof e.Rect||(r=new e.Rect(t,i,s,n)),this.viewer){var a=this.viewer.world.getItemCount();if(1<a)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===a)return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,i,s,n,!0)}return s=this.viewportToImageCoordinates(r.x,r.y),n=this._viewportToImageDelta(r.width,r.height),new e.Rect(s.x,s.y,n.x,n.y,r.degrees)},viewerElementToImageCoordinates:function(t){return t=this.pointFromPixel(t,!0),this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(t){return t=this.imageToViewportCoordinates(t),this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer."),t=t.minus(e.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(t){return this.pointFromPixel(t,!0)},viewportToViewerElementCoordinates:function(t){return this.pixelFromPoint(t,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer."),t=t.minus(e.getElementPosition(this.viewer.element)),this.viewerElementToViewportCoordinates(t)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}return t*(this._containerInnerSize.x/(i=this._contentSizeNoRotate.x)*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(t){return this.flipped===t||(this.flipped=t,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:t})),this}}}(OpenSeadragon),function(e){e.TiledImage=function(n){var r=this;e.console.assert(n.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(n.drawer,"[TiledImage] options.drawer is required"),e.console.assert(n.viewer,"[TiledImage] options.viewer is required"),e.console.assert(n.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(n.source,"[TiledImage] options.source is required"),e.console.assert(!n.clip||n.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=n.tileCache,delete n.tileCache,this._drawer=n.drawer,delete n.drawer,this._imageLoader=n.imageLoader,delete n.imageLoader,n.clip instanceof e.Rect&&(this._clip=n.clip.clone()),delete n.clip;var a=n.x||0;delete n.x;var l=n.y||0;delete n.y,this.normHeight=n.source.dimensions.y/n.source.dimensions.x,this.contentAspectX=n.source.dimensions.x/n.source.dimensions.y;var u=1;n.width?(u=n.width,delete n.width,n.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete n.height)):n.height&&(u=n.height/this.normHeight,delete n.height);var p=n.fitBounds;delete n.fitBounds;var d=n.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete n.fitBoundsPlacement;var f=n.degrees||0;delete n.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:e.DEFAULT_SETTINGS.subPixelRoundingForTransparency},n),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:a,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:u,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:f,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),p&&this.fitBounds(p,d,!0),this._drawingHandler=function(w){r.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:r},w))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(n){n!==this._fullyLoaded&&(this._fullyLoaded=n,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var n=this._xSpring.update(),r=this._ySpring.update(),a=this._scaleSpring.update(),l=this._degreesSpring.update();return!!(n||r||a||l)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(n){return this.getBoundsNoRotate(n).rotate(this.getRotation(n),this._getRotationPoint(n))},getBoundsNoRotate:function(n){return n?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(n){var r=this.getBoundsNoRotate(n);if(this._clip){var a=(n?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x;a=this._clip.times(a),r=new e.Rect(r.x+a.x,r.y+a.y,a.width,a.height)}return r.rotate(this.getRotation(n),this._getRotationPoint(n))},getTileBounds:function(n,r,a){var l=this.source.getNumTiles(n),u=(l.x+r%l.x)%l.x,p=(l.y+a%l.y)%l.y;return n=this.source.getTileBounds(n,u,p),this.getFlip()&&(n.x=1-n.x-n.width),n.x+=(r-u)/l.x,n.y+=this._worldHeightCurrent/this._worldWidthCurrent*((a-p)/l.y),n},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var n=this.imageToWindowCoordinates(new e.Point(0,0)),r=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(r.x-n.x,r.y-n.y)},_viewportToImageDelta:function(n,r,a){return new e.Point(n*(this.source.dimensions.x/(a=(a?this._scaleSpring.current:this._scaleSpring.target).value)),r*(this.source.dimensions.y*this.contentAspectX/a))},viewportToImageCoordinates:function(n,r,a){var l;return n instanceof e.Point?(a=r,l=n):l=new e.Point(n,r),l=l.rotate(-this.getRotation(a),this._getRotationPoint(a)),a?this._viewportToImageDelta(l.x-this._xSpring.current.value,l.y-this._ySpring.current.value):this._viewportToImageDelta(l.x-this._xSpring.target.value,l.y-this._ySpring.target.value)},_imageToViewportDelta:function(n,r,a){return new e.Point(n/this.source.dimensions.x*(a=(a?this._scaleSpring.current:this._scaleSpring.target).value),r/this.source.dimensions.y/this.contentAspectX*a)},imageToViewportCoordinates:function(n,r,a){return n instanceof e.Point&&(a=r,r=n.y,n=n.x),r=this._imageToViewportDelta(n,r),a?(r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value):(r.x+=this._xSpring.target.value,r.y+=this._ySpring.target.value),r.rotate(this.getRotation(a),this._getRotationPoint(a))},imageToViewportRectangle:function(n,r,a,l,u){var p=n;return p instanceof e.Rect?u=r:p=new e.Rect(n,r,a,l),a=this.imageToViewportCoordinates(p.getTopLeft(),u),l=this._imageToViewportDelta(p.width,p.height,u),new e.Rect(a.x,a.y,l.x,l.y,p.degrees+this.getRotation(u))},viewportToImageRectangle:function(n,r,a,l,u){var p=n;return n instanceof e.Rect?u=r:p=new e.Rect(n,r,a,l),a=this.viewportToImageCoordinates(p.getTopLeft(),u),l=this._viewportToImageDelta(p.width,p.height,u),new e.Rect(a.x,a.y,l.x,l.y,p.degrees-this.getRotation(u))},viewerElementToImageCoordinates:function(n){return n=this.viewport.pointFromPixel(n,!0),this.viewportToImageCoordinates(n)},imageToViewerElementCoordinates:function(n){return n=this.imageToViewportCoordinates(n),this.viewport.pixelFromPoint(n,!0)},windowToImageCoordinates:function(n){return n=n.minus(OpenSeadragon.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(n){return this.imageToViewerElementCoordinates(n).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(n){var r=this._scaleSpring.current.value;return n=n.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((n.x-this._xSpring.current.value)/r,(n.y-this._ySpring.current.value)/r,n.width/r,n.height/r,n.degrees)},viewportToImageZoom:function(n){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*n},imageToViewportZoom:function(n){return n/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(n,r){var a=this._xSpring.target.value===n.x&&this._ySpring.target.value===n.y;if(r){if(a&&this._xSpring.current.value===n.x&&this._ySpring.current.value===n.y)return;this._xSpring.resetTo(n.x),this._ySpring.resetTo(n.y),this._needsDraw=!0}else{if(a)return;this._xSpring.springTo(n.x),this._ySpring.springTo(n.y),this._needsDraw=!0}a||this._raiseBoundsChange()},setWidth:function(n,r){this._setScale(n,r)},setHeight:function(n,r){this._setScale(n/this.normHeight,r)},setCroppingPolygons:function(n){try{if(!e.isArray(n))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=n.map(function(a){return a.map(function(l){try{if(function(a){return a instanceof e.Point||"number"==typeof a.x&&"number"==typeof a.y}(l))return{x:l.x,y:l.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})})}catch(a){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(a),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(n,r,a){var l=e.Placement.properties[r=r||e.Placement.CENTER],u=this.contentAspectX,p=0,d=0,f=1;if(r=1,this._clip&&(u=this._clip.getAspectRatio(),f=this._clip.width/this.source.dimensions.x,r=this._clip.height/this.source.dimensions.y,n.getAspectRatio()>u?(p=this._clip.x/this._clip.height*n.height,d=this._clip.y/this._clip.height*n.height):(p=this._clip.x/this._clip.width*n.width,d=this._clip.y/this._clip.width*n.width)),n.getAspectRatio()>u){var w=n.height/r;r=0,l.isHorizontallyCentered?r=(n.width-n.height*u)/2:l.isRight&&(r=n.width-n.height*u),this.setPosition(new e.Point(n.x-p+r,n.y-d),a),this.setHeight(w,a)}else w=n.width/f,f=0,l.isVerticallyCentered?f=(n.height-n.width/u)/2:l.isBottom&&(f=n.height-n.width/u),this.setPosition(new e.Point(n.x-p,n.y-d+f),a),this.setWidth(w,a)},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(n){e.console.assert(!n||n instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),this._clip=n instanceof e.Rect?n.clone():null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(n){this.flipped=!!n,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(n){n!==this.opacity&&(this.opacity=n,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(n){this._preload=!!n,this._needsDraw=!0},getRotation:function(n){return(n?this._degreesSpring.current:this._degreesSpring.target).value},setRotation:function(n,r){(this._degreesSpring.target.value!==n||!this._degreesSpring.isAtTargetValue())&&(r?this._degreesSpring.resetTo(n):this._degreesSpring.springTo(n),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(n){return this.getBoundsNoRotate(n).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(n){n!==this.compositeOperation&&(this.compositeOperation=n,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(n,r){var a=this._scaleSpring.target.value===n;if(r){if(a&&this._scaleSpring.current.value===n)return;this._scaleSpring.resetTo(n),this._updateForScale(),this._needsDraw=!0}else{if(a)return;this._scaleSpring.springTo(n),this._updateForScale(),this._needsDraw=!0}a||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var n=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),r=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value;return r=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(r/this.minPixelRatio)/Math.log(2)))),r=Math.max(r,this.source.minLevel||0),{lowestLevel:Math.min(n,r),highestLevel:r}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var n=this.viewport,r=this._viewportToTiledImageRectangle(n.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var a=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(r=r.intersection(a)))return}var l=(a=this._getLevelsInterval()).lowestLevel;a=a.highestLevel;for(var u=null,p=!1,d=e.now(),f=a;l<=f;f--){var w=!1,T=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(f),!0).x*this._scaleSpring.current.value;if(f===l||!p&&T>=this.minPixelRatio)p=w=!0;else if(!p)continue;var S=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(f),!1).x*this._scaleSpring.current.value,E=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value;if(E=this.immediateRender?1:E,T=Math.min(1,(T-.5)/.5),S=E/Math.abs(E-S),u=this._updateLevel(p,w,f,T,S,r,d,u),this._providesCoverage(this.coverage,f))break}this._drawTiles(this.lastDrawn),u&&!u.context2D?(this._loadTile(u,d),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(n,r,a){var l,u;this.wrapHorizontal?(l=e.positiveModulo(r.x,1),u=e.positiveModulo(a.x,1)):(l=Math.max(0,r.x),u=Math.min(1,a.x));var p=1/this.source.aspectRatio;this.wrapVertical?(d=e.positiveModulo(r.y,p),f=e.positiveModulo(a.y,p)):(d=Math.max(0,r.y),f=Math.min(p,a.y));var d=this.source.getTileAtPoint(n,new e.Point(l,d)),f=this.source.getTileAtPoint(n,new e.Point(u,f));return n=this.source.getNumTiles(n),this.wrapHorizontal&&(d.x+=n.x*Math.floor(r.x),f.x+=n.x*Math.floor(a.x)),this.wrapVertical&&(d.y+=n.y*Math.floor(r.y/p),f.y+=n.y*Math.floor(a.y/p)),{topLeft:d,bottomRight:f}},_updateLevel:function(n,r,a,l,u,p,d,f){var w=p.getBoundingBox().getTopLeft(),T=p.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:n,level:a,opacity:l,visibility:u,drawArea:p,topleft:w,bottomright:T,currenttime:d,best:f}),this._resetCoverage(this.coverage,a),this._resetCoverage(this.loadingCoverage,a);var S=(T=this._getCornerTiles(a,w,T)).topLeft,E=T.bottomRight,_=this.source.getNumTiles(a),C=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(E.x+=1,this.wrapHorizontal||(E.x=Math.min(E.x,_.x-1)));for(var R=S.x;R<=E.x;R++)for(var z=S.y;z<=E.y;z++){if(this.getFlip()){var D=(_.x+R%_.x)%_.x;D=R+_.x-D-D-1}else D=R;null!==p.intersection(this.getTileBounds(a,D,z))&&(f=this._updateTile(r,n,D,z,a,l,u,C,_,d,f))}return f},_updateTile:function(n,r,a,l,u,p,d,f,_,T,S){var E=this._getTile(a,l,u,T,_,this._worldWidthCurrent,this._worldHeightCurrent);return _=r,this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:E}),this._setCoverage(this.coverage,u,a,l,!1),r=E.loaded||E.loading||this._isCovered(this.loadingCoverage,u,a,l),this._setCoverage(this.loadingCoverage,u,a,l,r),!E.exists||(n&&!_&&(this._isCovered(this.coverage,u,a,l)?this._setCoverage(this.coverage,u,a,l,!0):_=!0),!_)||(this._positionTile(E,this.source.tileOverlap,this.viewport,f,d),E.loaded||(E.context2D?this._setTileLoaded(E):(d=this._tileCache.getImageRecord(E.cacheKey))&&this._setTileLoaded(E,d.getData())),E.loaded?this._blendTile(E,a,l,u,p,T)&&(this._needsDraw=!0):E.loading?this._tilesLoading++:r||(S=this._compareTiles(S,E))),S},_getTile:function(n,r,a,l,u,p,d){var f,w,T,S,E,_,C,R,z,D=this.tilesMatrix,L=this.source;return D[a]||(D[a]={}),D[a][n]||(D[a][n]={}),(!D[a][n][r]||!D[a][n][r].flipped!=!this.flipped)&&(f=(u.x+n%u.x)%u.x,w=(u.y+r%u.y)%u.y,T=this.getTileBounds(a,n,r),S=L.getTileBounds(a,f,w,!0),E=L.tileExists(a,f,w),_=L.getTileUrl(a,f,w),z=L.getTilePostData(a,f,w),this.loadTilesWithAjax?(C=L.getTileAjaxHeaders(a,f,w),e.isPlainObject(this.ajaxHeaders)&&(C=e.extend({},this.ajaxHeaders,C))):C=null,R=L.getContext2D?L.getContext2D(a,f,w):void 0,z=new e.Tile(a,n,r,T,E,_,R,this.loadTilesWithAjax,C,S,z,L.getTileHashKey(a,f,w,_,C,z)),this.getFlip()?0==f&&(z.isRightMost=!0):f==u.x-1&&(z.isRightMost=!0),w==u.y-1&&(z.isBottomMost=!0),z.flipped=this.flipped,D[a][n][r]=z),(z=D[a][n][r]).lastTouchTime=l,z},_loadTile:function(n,r){var a=this;n.loading=!0,this._imageLoader.addJob({src:n.getUrl(),tile:n,source:this.source,postData:n.postData,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(l,u,p){a._onTileLoad(n,r,l,u,p)},abort:function(){n.loading=!1}})},_onTileLoad:function(n,r,a,l,u){if(a)if(r<this.lastResetTime)e.console.warn("Ignoring tile %s loaded before reset: %s",n,n.getUrl()),n.loading=!1;else{let f=function(){var w=p.source.getClosestLevel();p._setTileLoaded(n,a,w,u)};var p=this;this._midDraw?window.setTimeout(f,1):f()}else e.console.error("Tile %s failed to load: %s - error: %s",n,n.getUrl(),l),this.viewer.raiseEvent("tile-load-failed",{tile:n,tiledImage:this,time:r,message:l,tileRequest:u}),n.loading=!1,n.exists=!1},_setTileLoaded:function(n,r,a,l){var u=0,p=this;function d(){return u++,f}function f(){0==--u&&(n.loading=!1,n.loaded=!0,n.hasTransparency=p.source.hasTransparency(n.context2D,n.getUrl(),n.ajaxHeaders,n.postData),n.context2D||p._tileCache.cacheTile({data:r,tile:n,cutoff:a,tiledImage:p}),p._needsDraw=!0)}this.viewer.raiseEvent("tile-loaded",{tile:n,tiledImage:this,tileRequest:l,get image(){return e.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),r},data:r,getCompletionCallback:d}),d()()},_positionTile:function(n,r,a,l,u){(f=n.bounds.getTopLeft()).x*=this._scaleSpring.current.value,f.y*=this._scaleSpring.current.value,f.x+=this._xSpring.current.value,f.y+=this._ySpring.current.value,(w=n.bounds.getSize()).x*=this._scaleSpring.current.value,w.y*=this._scaleSpring.current.value;var p=a.pixelFromPointNoRotate(f,!0),d=a.pixelFromPointNoRotate(f,!1),f=a.deltaPixelsFromPointsNoRotate(w,!0),w=a.deltaPixelsFromPointsNoRotate(w,!1);w=d.plus(w.divide(2)),w=l.squaredDistanceTo(w),r||(f=f.plus(new e.Point(1,1))),n.isRightMost&&this.wrapHorizontal&&(f.x+=.75),n.isBottomMost&&this.wrapVertical&&(f.y+=.75),n.position=p,n.size=f,n.squaredDistance=w,n.visibility=u},_blendTile:function(n,r,a,l,u,p){var d,f=1e3*this.blendTime;if(n.blendStart||(n.blendStart=p),d=p-n.blendStart,p=f?Math.min(1,d/f):1,this.alwaysBlend&&(p*=u),n.opacity=p,this.lastDrawn.push(n),1===p)this._setCoverage(this.coverage,l,r,a,!0),this._hasOpaqueTile=!0;else if(d<f)return!0;return!1},_compareTiles:function(n,r){return!n||r.visibility>n.visibility||r.visibility===n.visibility&&r.squaredDistance<n.squaredDistance?r:n},_drawTiles:function(n){if(0!==this.opacity&&(0!==n.length||this.placeholderFillStyle)){var a,r=n[0];r&&(a=this.opacity<1||this.compositeOperation&&"source-over"!==this.compositeOperation||!this._isBottomItem()&&this.source.hasTransparency(r.context2D,r.getUrl(),r.ajaxHeaders,r.postData));var l,u,f,p=this.viewport.getZoom(!0),d=this.viewportToImageZoom(p);if(1<n.length&&d>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360==0&&e.supportsCanvas&&this.viewer.useCanvas&&(a=!0,l=r.getScaleForEdgeSmoothing(),u=r.getTranslationForEdgeSmoothing(l,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0))),a&&(l||(f=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(this.viewport.getRotation(!0)%360==0&&this.getRotation(!0)%360==0||(f.x=this._drawer.viewer.container.clientWidth-(f.x+f.width))),f=f.times(e.pixelDensityRatio)),this._drawer._clear(!0,f)),l||(this.viewport.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:a}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:a}),this.viewport.getRotation(!0)%360==0&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip()),p=!1,this._clip&&(this._drawer.saveContext(a),d=(d=this.imageToViewportRectangle(this._clip,!0)).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),d=this._drawer.viewportToDrawerRectangle(d),l&&(d=d.times(l)),u&&(d=d.translate(u)),this._drawer.setClip(d,a),p=!0),this._croppingPolygons){var w=this;this._drawer.saveContext(a);try{var T=this._croppingPolygons.map(function(C){return C.map(function(R){return R=w.imageToViewportCoordinates(R.x,R.y,!0).rotate(-w.getRotation(!0),w._getRotationPoint(!0)),R=w._drawer.viewportCoordToDrawerCoord(R),l?R.times(l):R})});this._drawer.clipWithPolygons(T,a)}catch(C){e.console.error(C)}p=!0}if(this.placeholderFillStyle&&!1===this._hasOpaqueTile){T=this._drawer.viewportToDrawerRectangle(this.getBounds(!0)),l&&(T=T.times(l)),u&&(T=T.translate(u));var S=null;S="function"==typeof this.placeholderFillStyle?this.placeholderFillStyle(this,this._drawer.context):this.placeholderFillStyle,this._drawer.drawRectangle(T,S,a)}var E=!1;(S=function(C){if("number"==typeof C)return s(C);if(!C||!e.Browser)return t;var R=C[e.Browser.vendor];return i(R)&&(R=C["*"]),s(R)}(this.subPixelRoundingForTransparency))===e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS?E=!0:S===e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&(E=!(this.viewer&&this.viewer.isAnimating()));for(var _=n.length-1;0<=_;_--)this._drawer.drawTile(r=n[_],this._drawingHandler,a,l,u,E,this.source),r.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:r});p&&this._drawer.restoreContext(a),l||(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(a),this.viewport.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(a)),a&&(l&&(this.viewport.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:!1}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:l,translate:u,compositeOperation:this.compositeOperation,bounds:f}),l&&(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(!1))),l||this.viewport.getRotation(!0)%360==0&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(n)}},_drawDebugInfo:function(n){if(this.debugMode)for(var r=n.length-1;0<=r;r--){var a=n[r];try{this._drawer.drawDebugInfo(a,n.length,r,this)}catch(l){e.console.error(l)}}},_providesCoverage:function(n,r,a,l){var u,p,d,f;if(!n[r])return!1;if(void 0!==a&&void 0!==l)return void 0===n[r][a]||void 0===n[r][a][l]||!0===n[r][a][l];for(d in u=n[r])if(Object.prototype.hasOwnProperty.call(u,d))for(f in p=u[d])if(Object.prototype.hasOwnProperty.call(p,f)&&!p[f])return!1;return!0},_isCovered:function(n,r,a,l){return void 0===a||void 0===l?this._providesCoverage(n,r+1):this._providesCoverage(n,r+1,2*a,2*l)&&this._providesCoverage(n,r+1,2*a,2*l+1)&&this._providesCoverage(n,r+1,2*a+1,2*l)&&this._providesCoverage(n,r+1,2*a+1,2*l+1)},_setCoverage:function(n,r,a,l,u){n[r]?(n[r][a]||(n[r][a]={}),n[r][a][l]=u):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",r)},_resetCoverage:function(n,r){n[r]={}}});var t=e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function i(n){return n!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&n!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&n!==e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function s(n){return i(n)?t:n}}(OpenSeadragon),function(e){function t(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=s.tile,this.tiledImage=s.tiledImage}function i(s){e.console.assert(s,"[ImageRecord] options is required"),e.console.assert(s.data,"[ImageRecord] options.data is required"),this._tiles=[],s.create.apply(null,[this,s.data,s.ownerTile]),this._destroyImplementation=s.destroy.bind(null,this),this.getImage=s.getImage.bind(null,this),this.getData=s.getData.bind(null,this),this.getRenderedContext=s.getRenderedContext.bind(null,this)}i.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(s){e.console.assert(s,"[ImageRecord.addTile] tile is required"),this._tiles.push(s)},removeTile:function(s){for(var n=0;n<this._tiles.length;n++)if(this._tiles[n]===s)return void this._tiles.splice(n,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",s)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(s){this._maxImageCacheCount=(s=s||{}).maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var n=s.cutoff||0,r=this._tilesLoaded.length,a=this._imagesLoaded[s.tile.cacheKey];if(a||(s.data||(e.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),s.data=s.image),e.console.assert(s.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),a=this._imagesLoaded[s.tile.cacheKey]=new i({data:s.data,ownerTile:s.tile,create:s.tiledImage.source.createTileCache,destroy:s.tiledImage.source.destroyTileCache,getImage:s.tiledImage.source.getTileCacheDataAsImage,getData:s.tiledImage.source.getTileCacheData,getRenderedContext:s.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),a.addTile(s.tile),s.tile.cacheImageRecord=a,this._imagesLoadedCount>this._maxImageCacheCount){for(var d,f,T,E,l=null,u=-1,p=null,_=this._tilesLoaded.length-1;0<=_;_--)(d=(E=this._tilesLoaded[_]).tile).level<=n||d.beingDrawn||(l?((T=d.lastTouchTime)<(f=l.lastTouchTime)||T===f&&l.level<d.level)&&(l=d,u=_,p=E):(l=d,u=_,p=E));l&&0<=u&&(this._unloadTile(p),r=u)}this._tilesLoaded[r]=new t({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(s){e.console.assert(s,"[TileCache.clearTilesFor] tiledImage is required");for(var n,r=0;r<this._tilesLoaded.length;++r)(n=this._tilesLoaded[r]).tiledImage===s&&(this._unloadTile(n),this._tilesLoaded.splice(r,1),r--)},getImageRecord:function(s){return e.console.assert(s,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[s]},_unloadTile:function(s){e.console.assert(s,"[TileCache._unloadTile] tileRecord is required");var n=s.tile,r=s.tiledImage;n.unload(),n.cacheImageRecord=null,(s=this._imagesLoaded[n.cacheKey]).removeTile(n),s.getTileCount()||(s.destroy(),delete this._imagesLoaded[n.cacheKey],this._imagesLoadedCount--),r.viewer.raiseEvent("tile-unloaded",{tile:n,tiledImage:r})}}}(OpenSeadragon),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(s){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index?(i=Math.max(0,Math.min(this._items.length,i.index)),this._items.splice(i,0,t)):this._items.push(t),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==i,"[World.setItemIndex] index is required");var s=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==s&&-1!==s&&(this._items.splice(s,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:s,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);-1!==i&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var t,i;for(this.viewer._cancelPendingImages(),i=0;i<this._items.length;i++)(t=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var s=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<s.length;i++)this._raiseRemoveItem(t=s[i])},resetItems:function(){for(var t=0;t<this._items.length;t++)this._items[t].reset()},update:function(){for(var t=!1,i=0;i<this._items.length;i++)t=this._items[i].update()||t;return t},draw:function(){for(var t=0;t<this._items.length;t++)this._items[t].draw();this._needsDraw=!1},needsDraw:function(){for(var t=0;t<this._items.length;t++)if(this._items[t].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(t){(this._autoRefigureSizes=t)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var u,i=(t=t||{}).immediately||!1,s=t.layout||e.DEFAULT_SETTINGS.collectionLayout,r=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=a+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);u=!t.rows&&r?r:Math.ceil(this._items.length/(t.rows||e.DEFAULT_SETTINGS.collectionRows));var f,w,T,p=0,d=0;this.setAutoRefigureSizes(!1);for(var S=0;S<this._items.length;S++)S&&S%u==0&&("horizontal"===s?(d+=l,p=0):(p+=l,d=0)),T=(w=(T=(f=this._items[S]).getBounds()).width>T.height?a:a*(T.width/T.height))*(T.height/T.width),T=new e.Point(p+(a-w)/2,d+(a-T)/2),f.setPosition(T,i),f.setWidth(w,i),"horizontal"===s?p+=l:d+=l;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(this._items.length){var n=this._items[0],r=n.getBounds();this._contentFactor=n.getContentSize().x/r.width;for(var a=n.getClippedBounds().getBoundingBox(),l=a.x,u=a.y,p=a.x+a.width,d=a.y+a.height,f=1;f<this._items.length;f++)r=(n=this._items[f]).getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/r.width),a=n.getClippedBounds().getBoundingBox(),l=Math.min(l,a.x),u=Math.min(u,a.y),p=Math.max(p,a.x+a.width),d=Math.max(d,a.y+a.height);this._homeBounds=new e.Rect(l,u,p-l,d-u),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===s&&this._homeBounds.equals(t)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(t){this.raiseEvent("remove-item",{item:t})}})}(OpenSeadragon);