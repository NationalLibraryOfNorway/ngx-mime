function OpenSeadragon(t){return new OpenSeadragon.Viewer(t)}(function(t){t.version={versionStr:"5.0.1",major:parseInt("5",10),minor:parseInt("0",10),revision:parseInt("1",10)};var a,e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;t.isFunction=function(o){return"function"===t.type(o)},t.isArray=Array.isArray||function(o){return"array"===t.type(o)},t.isWindow=function(o){return o&&"object"==typeof o&&"setInterval"in o},t.type=function(o){return null==o?String(o):e[i.call(o)]||"object"},t.isPlainObject=function(o){if(!o||"object"!==OpenSeadragon.type(o)||o.nodeType||t.isWindow(o)||o.constructor&&!n.call(o,"constructor")&&!n.call(o.constructor.prototype,"isPrototypeOf"))return!1;var l;for(var r in o)l=r;return void 0===l||n.call(o,l)},t.isEmptyObject=function(o){for(var l in o)return!1;return!0},t.freezeObject=function(o){return t.freezeObject=Object.freeze?Object.freeze:function(l){return l},t.freezeObject(o)},t.supportsCanvas=(a=document.createElement("canvas"),!(!t.isFunction(a.getContext)||!a.getContext("2d"))),t.isCanvasTainted=function(o){var l=!1;try{o.getContext("2d").getImageData(0,0,1,1)}catch{l=!0}return l},t.supportsAddEventListener=!(!document.documentElement.addEventListener||!document.addEventListener),t.supportsRemoveEventListener=!(!document.documentElement.removeEventListener||!document.removeEventListener),t.supportsEventListenerOptions=function(){var o=0;if(t.supportsAddEventListener)try{var l={get capture(){return o++,!1},get once(){return o++,!1},get passive(){return o++,!1}};window.addEventListener("test",null,l),window.removeEventListener("test",null,l)}catch{o=0}return 3<=o}(),t.getCurrentPixelDensityRatio=function(){if(t.supportsCanvas){var o=document.createElement("canvas").getContext("2d"),l=window.devicePixelRatio||1;return o=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1,Math.max(l,1)/o}return 1},t.pixelDensityRatio=t.getCurrentPixelDensityRatio()})(OpenSeadragon),function(t){function e(o){}t.extend=function(){var o,l,r,h,c,d=arguments[0]||{},m=arguments.length,v=!1,T=1;for("boolean"==typeof d&&(v=d,d=arguments[1]||{},T=2),"object"==typeof d||OpenSeadragon.isFunction(d)||(d={}),m===T&&(d=this,--T);T<m;T++)if(null!==(o=arguments[T])||void 0!==o)for(l in o){var _=Object.getOwnPropertyDescriptor(o,l);void 0!==_?_.get||_.set?Object.defineProperty(d,l,_):d!==(r=_.value)&&(v&&r&&(OpenSeadragon.isPlainObject(r)||(h=OpenSeadragon.isArray(r)))?(_=d[l],h?(h=!1,c=_&&OpenSeadragon.isArray(_)?_:[]):c=_&&OpenSeadragon.isPlainObject(_)?_:{},d[l]=OpenSeadragon.extend(v,c,r)):void 0!==r&&(d[l]=r)):t.console.warn('Could not copy inherited property "'+l+'".')}return d},t.extend(t,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:function(){if("object"!=typeof navigator)return!1;var o=navigator.userAgent;return"string"==typeof o&&(-1!==o.indexOf("iPhone")||-1!==o.indexOf("iPad")||-1!==o.indexOf("iPod"))}(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,maxTilesPerFrame:1,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,overlayPreserveContentDirection:!0,opacity:1,compositeOperation:null,drawer:["webgl","canvas","html"],drawerOptions:{webgl:{},canvas:{},html:{},custom:{}},preload:!1,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},delegate:function(o,l){return function(){var r=arguments;return l.apply(o,r=void 0===r?[]:r)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(o){return t._viewers.get(this.getElement(o))},getElement:function(o){return"string"==typeof o?document.getElementById(o):o},getElementPosition:function(o){var l,r,h=new t.Point;for(r=a(o=t.getElement(o),l="fixed"===t.getElementStyle(o).position);r;)h.x+=o.offsetLeft,h.y+=o.offsetTop,l&&(h=h.plus(t.getPageScroll())),r=a(o=r,l="fixed"===t.getElementStyle(o).position);return h},getElementOffset:function(o){var l,r=(o=t.getElement(o))&&o.ownerDocument,h={top:0,left:0};return r?(l=r.documentElement,void 0!==o.getBoundingClientRect&&(h=o.getBoundingClientRect()),new t.Point(h.left+((r=r===r.window?r:9===r.nodeType&&(r.defaultView||r.parentWindow)).pageXOffset||l.scrollLeft)-(l.clientLeft||0),h.top+(r.pageYOffset||l.scrollTop)-(l.clientTop||0))):new t.Point},getElementSize:function(o){return o=t.getElement(o),new t.Point(o.clientWidth,o.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(o){return(o=t.getElement(o)).currentStyle}:function(o){return o=t.getElement(o),window.getComputedStyle(o,"")},getCssPropertyWithVendorPrefix:function(o){var l={};return t.getCssPropertyWithVendorPrefix=function(r){if(void 0!==l[r])return l[r];var h=document.createElement("div").style,c=null;if(void 0!==h[r])c=r;else for(var d=["Webkit","Moz","MS","O","webkit","moz","ms","o"],m=t.capitalizeFirstLetter(r),v=0;v<d.length;v++){var T=d[v]+m;if(void 0!==h[T]){c=T;break}}return l[r]=c},t.getCssPropertyWithVendorPrefix(o)},capitalizeFirstLetter:function(o){return o.charAt(0).toUpperCase()+o.slice(1)},positiveModulo:function(o,l){return(o%=l)<0&&(o+=l),o},pointInElement:function(h,l){h=t.getElement(h);var r=t.getElementOffset(h);return h=t.getElementSize(h),l.x>=r.x&&l.x<r.x+h.x&&l.y<r.y+h.y&&l.y>=r.y},getMousePosition:function(o){if("number"==typeof o.pageX)t.getMousePosition=function(l){var r=new t.Point;return r.x=l.pageX,r.y=l.pageY,r};else{if("number"!=typeof o.clientX)throw new Error("Unknown event mouse position, no known technique.");t.getMousePosition=function(l){var r=new t.Point;return r.x=l.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r.y=l.clientY+document.body.scrollTop+document.documentElement.scrollTop,r}}return t.getMousePosition(o)},getPageScroll:function(){var o=document.documentElement||{},l=document.body||{};if("number"==typeof window.pageXOffset)t.getPageScroll=function(){return new t.Point(window.pageXOffset,window.pageYOffset)};else if(l.scrollLeft||l.scrollTop)t.getPageScroll=function(){return new t.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!o.scrollLeft&&!o.scrollTop)return new t.Point(0,0);t.getPageScroll=function(){return new t.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return t.getPageScroll()},setPageScroll:function(o){if(void 0!==window.scrollTo)t.setPageScroll=function(h){window.scrollTo(h.x,h.y)};else{var l=t.getPageScroll();if(l.x===o.x&&l.y===o.y)return;document.body.scrollLeft=o.x,document.body.scrollTop=o.y;var r=t.getPageScroll();if(r.x!==l.x&&r.y!==l.y)return void(t.setPageScroll=function(h){document.body.scrollLeft=h.x,document.body.scrollTop=h.y});if(document.documentElement.scrollLeft=o.x,document.documentElement.scrollTop=o.y,(r=t.getPageScroll()).x!==l.x&&r.y!==l.y)return void(t.setPageScroll=function(h){document.documentElement.scrollLeft=h.x,document.documentElement.scrollTop=h.y});t.setPageScroll=function(h){}}t.setPageScroll(o)},getWindowSize:function(){var o=document.documentElement||{},l=document.body||{};if("number"==typeof window.innerWidth)t.getWindowSize=function(){return new t.Point(window.innerWidth,window.innerHeight)};else if(o.clientWidth||o.clientHeight)t.getWindowSize=function(){return new t.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!l.clientWidth&&!l.clientHeight)throw new Error("Unknown window size, no known technique.");t.getWindowSize=function(){return new t.Point(document.body.clientWidth,document.body.clientHeight)}}return t.getWindowSize()},makeCenteredNode:function(o){o=t.getElement(o);var l=[t.makeNeutralElement("div"),t.makeNeutralElement("div"),t.makeNeutralElement("div")];return t.extend(l[0].style,{display:"table",height:"100%",width:"100%"}),t.extend(l[1].style,{display:"table-row"}),t.extend(l[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),l[0].appendChild(l[1]),l[1].appendChild(l[2]),l[2].appendChild(o),l[0]},makeNeutralElement:function(r){var l=document.createElement(r);return(r=l.style).background="transparent none",r.border="none",r.margin="0px",r.padding="0px",r.position="static",l},now:function(){return t.now=Date.now?Date.now:function(){return(new Date).getTime()},t.now()},makeTransparentImage:function(o){var l=t.makeNeutralElement("img");return l.src=o,l},setElementOpacity:function(o,l,r){o=t.getElement(o),r&&!t.Browser.alpha&&(l=Math.round(l)),t.Browser.opacity?o.style.opacity=l<1?l:"":l<1?(l=Math.round(100*l),o.style.filter="alpha(opacity="+l+")"):o.style.filter=""},setElementTouchActionNone:function(o){void 0!==(o=t.getElement(o)).style.touchAction?o.style.touchAction="none":void 0!==o.style.msTouchAction&&(o.style.msTouchAction="none")},setElementPointerEvents:function(o,l){void 0!==(o=t.getElement(o)).style&&void 0!==o.style.pointerEvents&&(o.style.pointerEvents=l)},setElementPointerEventsNone:function(o){t.setElementPointerEvents(o,"none")},addClass:function(o,l){(o=t.getElement(o)).className?-1===(" "+o.className+" ").indexOf(" "+l+" ")&&(o.className+=" "+l):o.className=l},indexOf:function(o,l,r){return this.indexOf=Array.prototype.indexOf?function(h,c,d){return h.indexOf(c,d)}:function(h,c,T){var m,v;if(T=T||0,!h)throw new TypeError;if(0===(v=h.length)||v<=T)return-1;for(m=T=T<0?v-Math.abs(T):T;m<v;m++)if(h[m]===c)return m;return-1},this.indexOf(o,l,r)},removeClass:function(o,l){var r,h,c=[];for(r=(o=t.getElement(o)).className.split(/\s+/),h=0;h<r.length;h++)r[h]&&r[h]!==l&&c.push(r[h]);o.className=c.join(" ")},normalizeEventListenerOptions:function(o){return void 0!==o?"boolean"==typeof o?t.supportsEventListenerOptions?{capture:o}:o:t.supportsEventListenerOptions?o:void 0!==o.capture&&o.capture:!!t.supportsEventListenerOptions&&{capture:!1}},addEvent:function(){if(t.supportsAddEventListener)return function(o,l,r,h){h=t.normalizeEventListenerOptions(h),(o=t.getElement(o)).addEventListener(l,r,h)};if(document.documentElement.attachEvent&&document.attachEvent)return function(o,l,r){(o=t.getElement(o)).attachEvent("on"+l,r)};throw new Error("No known event model.")}(),removeEvent:function(){if(t.supportsRemoveEventListener)return function(o,l,r,h){h=t.normalizeEventListenerOptions(h),(o=t.getElement(o)).removeEventListener(l,r,h)};if(document.documentElement.detachEvent&&document.detachEvent)return function(o,l,r){(o=t.getElement(o)).detachEvent("on"+l,r)};throw new Error("No known event model.")}(),cancelEvent:function(o){o.preventDefault()},eventIsCanceled:function(o){return o.defaultPrevented},stopEvent:function(o){o.stopPropagation()},createCallback:function(o,l){console.error("The createCallback function is deprecated and will be removed in future versions. Please use alternativeFunction instead.");var r,h=[];for(r=2;r<arguments.length;r++)h.push(arguments[r]);return function(){var c,d=h.concat([]);for(c=0;c<arguments.length;c++)d.push(arguments[c]);return l.apply(o,d)}},getUrlParameter:function(o){return(o=n[o])||null},getUrlProtocol:function(o){return null===(o=o.match(/^([a-z]+:)\/\//i))?window.location.protocol:o[1].toLowerCase()},createAjaxRequest:function(){if(window.XMLHttpRequest)return t.createAjaxRequest=function(){return new XMLHttpRequest},new XMLHttpRequest;throw new Error("Browser doesn't support XMLHttpRequest.")},makeAjaxRequest:function(o,l,r){var h,c,d,m;t.isPlainObject(o)&&(l=o.success,r=o.error,h=o.withCredentials,c=o.headers,d=o.responseType||null,m=o.postData||null,o=o.url);var v=t.getUrlProtocol(o),T=t.createAjaxRequest();if(!t.isFunction(l))throw new Error("makeAjaxRequest requires a success callback");T.onreadystatechange=function(){4===T.readyState&&(T.onreadystatechange=function(){},200<=T.status&&T.status<300||0===T.status&&"http:"!==v&&"https:"!==v?l(T):t.isFunction(r)?r(T):t.console.error("AJAX request returned %d: %s",T.status,o))};var _=m?"POST":"GET";try{if(T.open(_,o,!0),d&&(T.responseType=d),c)for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&c[E]&&T.setRequestHeader(E,c[E]);h&&(T.withCredentials=!0),T.send(m)}catch(P){t.console.error("%s while making AJAX request: %s",P.name,P.message),T.onreadystatechange=function(){},t.isFunction(r)&&r(T,P)}return T},jsonp:function(o){var l,r=o.url,h=document.head||document.getElementsByTagName("head")[0]||document.documentElement,c=o.callbackName||"openseadragon"+t.now(),d=window[c],m=o.param||"callback",v=o.callback;r=r.replace(/(=)\?(&|$)|\?\?/i,"$1"+c+"$2"),r+=(/\?/.test(r)?"&":"?")+m+"="+c,window[c]=function(T){if(d)window[c]=d;else try{delete window[c]}catch{}v&&t.isFunction(v)&&v(T)},l=document.createElement("script"),void 0===o.async&&!1===o.async||(l.async="async"),o.scriptCharset&&(l.charset=o.scriptCharset),l.src=r,l.onload=l.onreadystatechange=function(T,_){(_||!l.readyState||/loaded|complete/.test(l.readyState))&&(l.onload=l.onreadystatechange=null,h&&l.parentNode&&h.removeChild(l),l=void 0)},h.insertBefore(l,h.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(o){if(!window.DOMParser)throw new Error("Browser doesn't support XML DOM.");return t.parseXml=function(l){return(new DOMParser).parseFromString(l,"text/xml")},t.parseXml(o)},parseJSON:function(o){return t.parseJSON=window.JSON.parse,t.parseJSON(o)},imageFormatSupported:function(o){return!!i[(o=o||"").toLowerCase()]},setImageFormatsSupported:function(o){t.extend(i,o)}}),t.console=window.console||{log:e,debug:e,info:e,warn:e,error:e,assert:e};var i={avif:!0,bmp:!(t.Browser={vendor:t.BROWSERS.UNKNOWN,version:0,alpha:!0}),jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1,webp:!0},n={};function a(o,l){return l&&o!==document.body?document.body:o.offsetParent}(function(){var o=navigator.appVersion,l=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(l.substring(l.indexOf("MSIE")+5,l.indexOf(";",l.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=l.indexOf("Edge")?(t.Browser.vendor=t.BROWSERS.EDGE,t.Browser.version=parseFloat(l.substring(l.indexOf("Edge")+5))):0<=l.indexOf("Edg")?(t.Browser.vendor=t.BROWSERS.CHROMEEDGE,t.Browser.version=parseFloat(l.substring(l.indexOf("Edg")+4))):0<=l.indexOf("Firefox")?(t.Browser.vendor=t.BROWSERS.FIREFOX,t.Browser.version=parseFloat(l.substring(l.indexOf("Firefox")+8))):0<=l.indexOf("Safari")?(t.Browser.vendor=0<=l.indexOf("Chrome")?t.BROWSERS.CHROME:t.BROWSERS.SAFARI,t.Browser.version=parseFloat(l.substring(l.substring(0,l.indexOf("Safari")).lastIndexOf("/")+1,l.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(l)&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":t.Browser.vendor=t.BROWSERS.OPERA,t.Browser.version=parseFloat(o)}var r,h,c=window.location.search.substring(1).split("&");for(h=0;h<c.length;h++)if(0<(m=(r=c[h]).indexOf("="))){var d=r.substring(0,m),m=r.substring(m+1);try{n[d]=decodeURIComponent(m)}catch{t.console.error("Ignoring malformed URL parameter: %s=%s",d,m)}}t.Browser.alpha=!(t.Browser.vendor===t.BROWSERS.CHROME&&t.Browser.version<2),t.Browser.opacity=!0,t.Browser.vendor===t.BROWSERS.IE&&t.console.error("Internet Explorer is not supported by OpenSeadragon")})(),function(o){var l=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,r=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame;if(l&&r)t.requestAnimationFrame=function(){return l.apply(o,arguments)},t.cancelAnimationFrame=function(){return r.apply(o,arguments)};else{var h,c=[],d=[],m=0;t.requestAnimationFrame=function(v){return c.push([++m,v]),h=h||setInterval(function(){if(c.length){var T=t.now(),_=d;for(d=c,c=_;d.length;)d.shift()[1](T)}else clearInterval(h),h=void 0},20),m},t.cancelAnimationFrame=function(v){var T,_;for(T=0,_=c.length;T<_;T+=1)if(c[T][0]===v)return void c.splice(T,1);for(T=0,_=d.length;T<_;T+=1)if(d[T][0]===v)return void d.splice(T,1)}}}(window)}(OpenSeadragon),function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.OpenSeadragon=e()}(this,function(){return OpenSeadragon}),OpenSeadragon.Mat3=class ee{constructor(i){this.values=i=i||[0,0,0,0,0,0,0,0,0]}static makeIdentity(){return new ee([1,0,0,0,1,0,0,0,1])}static makeTranslation(i,n){return new ee([1,0,0,0,1,0,i,n,1])}static makeRotation(i){var n=Math.cos(i);return i=Math.sin(i),new ee([n,-i,0,i,n,0,0,0,1])}static makeScaling(i,n){return new ee([i,0,0,0,n,0,0,0,1])}multiply(i){var n=this.values,a=i.values,o=n[0],l=n[1],r=n[2],h=n[3],c=n[4],d=n[5],m=n[6],v=n[7],T=n[8],_=a[0],E=a[1],P=a[2],b=a[3],C=a[4],z=a[5];return new ee([_*o+E*h+P*m,_*l+E*c+P*v,_*r+E*d+P*T,b*o+C*h+z*m,b*l+C*c+z*v,b*r+C*d+z*T,(i=a[6])*o+(n=a[7])*h+(a=a[8])*m,i*l+n*c+a*v,i*r+n*d+a*T])}},function(t){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.fullscreenElement},e.requestFullScreen=function(i){return i.requestFullscreen().catch(function(n){t.console.error("Fullscreen request failed: ",n)})},e.exitFullScreen=function(){document.exitFullscreen().catch(function(i){t.console.error("Error while exiting fullscreen: ",i)})},e.fullScreenEventName="fullscreenchange",e.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.msFullscreenElement},e.requestFullScreen=function(i){return i.msRequestFullscreen()},e.exitFullScreen=function(){document.msExitFullscreen()},e.fullScreenEventName="MSFullscreenChange",e.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitFullscreenElement},e.requestFullScreen=function(i){return i.webkitRequestFullscreen()},e.exitFullScreen=function(){document.webkitExitFullscreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},e.requestFullScreen=function(i){return i.webkitRequestFullScreen()},e.exitFullScreen=function(){document.webkitCancelFullScreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.mozFullScreenElement},e.requestFullScreen=function(i){return i.mozRequestFullScreen()},e.exitFullScreen=function(){document.mozCancelFullScreen()},e.fullScreenEventName="mozfullscreenchange",e.fullScreenErrorEventName="mozfullscreenerror"),e.isFullScreen=function(){return null!==e.getFullScreenElement()},e.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),e.exitFullScreen()},t.extend(t,e)}(OpenSeadragon),function(t){t.EventSource=function(){this.events={},this._rejectedEventList={}},t.EventSource.prototype={addOnceHandler:function(e,i,n,a,o){var l=this;a=a||1;var r=0;return this.addHandler(e,function h(c){return++r===a&&l.removeHandler(e,h),i(c)},n,o)},addHandler:function(e,i,n,a){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,e))return t.console.error(`Error adding handler for ${e}. `+this._rejectedEventList[e]),!1;var o=this.events[e];if(o||(this.events[e]=o=[]),i&&t.isFunction(i)){var l=o.length,r={handler:i,userData:n||null,priority:a||0};for(o[l]=r;0<l&&o[l-1].priority<o[l].priority;)o[l]=o[l-1],o[l-1]=r,l--}return!0},removeHandler:function(e,i){var n,a=this.events[e],o=[];if(a&&t.isArray(a)){for(n=0;n<a.length;n++)a[n].handler!==i&&o.push(a[n]);this.events[e]=o}},numberOfHandlers:function(e){return(e=this.events[e])?e.length:0},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var i in this.events)this.events[i]=[]},getHandler:function(e){var i=this.events[e];return i&&i.length?(i=1===i.length?[i[0]]:Array.apply(null,i),function(n,a){var o,l=i.length;for(o=0;o<l;o++)i[o]&&(a.eventSource=n,a.userData=i[o].userData,i[o].handler(a))}):null},raiseEvent:function(e,i){return Object.prototype.hasOwnProperty.call(this._rejectedEventList,e)?(t.console.error(`Error adding handler for ${e}. `+this._rejectedEventList[e]),!1):((e=this.getHandler(e))&&e(this,i||{}),!0)},rejectEventHandler(e,i=""){this._rejectedEventList[e]=i},allowEventHandler(e){delete this._rejectedEventList[e]}}}(OpenSeadragon),function(t){var e=[],i={};t.MouseTracker=function(g){e.push(this);var f=arguments;t.isPlainObject(g)||(g={element:f[0],clickTimeThreshold:f[1],clickDistThreshold:f[2]}),this.hash=Math.random(),this.element=t.getElement(g.element),this.clickTimeThreshold=g.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=g.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=g.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=g.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=g.userData||null,this.stopDelay=g.stopDelay||50,this.preProcessEventHandler=g.preProcessEventHandler||null,this.contextMenuHandler=g.contextMenuHandler||null,this.enterHandler=g.enterHandler||null,this.leaveHandler=g.leaveHandler||null,this.exitHandler=g.exitHandler||null,this.overHandler=g.overHandler||null,this.outHandler=g.outHandler||null,this.pressHandler=g.pressHandler||null,this.nonPrimaryPressHandler=g.nonPrimaryPressHandler||null,this.releaseHandler=g.releaseHandler||null,this.nonPrimaryReleaseHandler=g.nonPrimaryReleaseHandler||null,this.moveHandler=g.moveHandler||null,this.scrollHandler=g.scrollHandler||null,this.clickHandler=g.clickHandler||null,this.dblClickHandler=g.dblClickHandler||null,this.dragHandler=g.dragHandler||null,this.dragEndHandler=g.dragEndHandler||null,this.pinchHandler=g.pinchHandler||null,this.stopHandler=g.stopHandler||null,this.keyDownHandler=g.keyDownHandler||null,this.keyUpHandler=g.keyUpHandler||null,this.keyHandler=g.keyHandler||null,this.focusHandler=g.focusHandler||null,this.blurHandler=g.blurHandler||null;var w=this;i[this.hash]={click:function(s){var p,y;M(w,y={originalEvent:p=s,eventType:"click",pointerType:"mouse",isEmulated:!1}),y.preventDefault&&!y.defaultPrevented&&t.cancelEvent(p),y.stopPropagation&&t.stopEvent(p)},dblclick:function(s){var p,y;M(w,y={originalEvent:p=s,eventType:"dblclick",pointerType:"mouse",isEmulated:!1}),y.preventDefault&&!y.defaultPrevented&&t.cancelEvent(p),y.stopPropagation&&t.stopEvent(p)},keydown:function(s){var u,p,y,x;y=null,M(u=w,x={originalEvent:p=s,eventType:"keydown",pointerType:"",isEmulated:!1}),u.keyDownHandler&&!x.preventGesture&&!x.defaultPrevented&&u.keyDownHandler(y={eventSource:u,keyCode:p.keyCode||p.charCode,ctrl:p.ctrlKey,shift:p.shiftKey,alt:p.altKey,meta:p.metaKey,originalEvent:p,preventDefault:x.preventDefault||x.defaultPrevented,userData:u.userData}),(y&&y.preventDefault||x.preventDefault&&!x.defaultPrevented)&&t.cancelEvent(p),x.stopPropagation&&t.stopEvent(p)},keyup:function(s){var u,p,y,x;y=null,M(u=w,x={originalEvent:p=s,eventType:"keyup",pointerType:"",isEmulated:!1}),u.keyUpHandler&&!x.preventGesture&&!x.defaultPrevented&&u.keyUpHandler(y={eventSource:u,keyCode:p.keyCode||p.charCode,ctrl:p.ctrlKey,shift:p.shiftKey,alt:p.altKey,meta:p.metaKey,originalEvent:p,preventDefault:x.preventDefault||x.defaultPrevented,userData:u.userData}),(y&&y.preventDefault||x.preventDefault&&!x.defaultPrevented)&&t.cancelEvent(p),x.stopPropagation&&t.stopEvent(p)},keypress:function(s){var u,p,y,x;y=null,M(u=w,x={originalEvent:p=s,eventType:"keypress",pointerType:"",isEmulated:!1}),u.keyHandler&&!x.preventGesture&&!x.defaultPrevented&&u.keyHandler(y={eventSource:u,keyCode:p.keyCode||p.charCode,ctrl:p.ctrlKey,shift:p.shiftKey,alt:p.altKey,meta:p.metaKey,originalEvent:p,preventDefault:x.preventDefault||x.defaultPrevented,userData:u.userData}),(y&&y.preventDefault||x.preventDefault&&!x.defaultPrevented)&&t.cancelEvent(p),x.stopPropagation&&t.stopEvent(p)},focus:function(s){var u,p,y;M(u=w,y={originalEvent:p=s,eventType:"focus",pointerType:"",isEmulated:!1}),u.focusHandler&&!y.preventGesture&&u.focusHandler({eventSource:u,originalEvent:p,userData:u.userData})},blur:function(s){var u,p,y;M(u=w,y={originalEvent:p=s,eventType:"blur",pointerType:"",isEmulated:!1}),u.blurHandler&&!y.preventGesture&&u.blurHandler({eventSource:u,originalEvent:p,userData:u.userData})},contextmenu:function(s){var u,p,y,x;y=null,M(u=w,x={originalEvent:p=s,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1}),u.contextMenuHandler&&!x.preventGesture&&!x.defaultPrevented&&(y={eventSource:u,position:I(C(p),u.element),originalEvent:x.originalEvent,preventDefault:x.preventDefault||x.defaultPrevented,userData:u.userData},u.contextMenuHandler(y)),(y&&y.preventDefault||x.preventDefault&&!x.defaultPrevented)&&t.cancelEvent(p),x.stopPropagation&&t.stopEvent(p)},wheel:function(s){K(w,s,s)},mousewheel:function(s){G(w,s)},DOMMouseScroll:function(s){G(w,s)},MozMousePixelScroll:function(s){G(w,s)},losecapture:function(s){var u,p,y,x;y={id:t.MouseTracker.mousePointerId,type:"mouse"},M(u=w,x={originalEvent:p=s,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1}),p.target===u.element&&V(u,y,!1),x.stopPropagation&&t.stopEvent(p)},mouseenter:function(s){X(w,s)},mouseleave:function(s){N(w,s)},mouseover:function(s){Q(w,s)},mouseout:function(s){$(w,s)},mousedown:function(s){U(w,s)},mouseup:function(s){Y(w,s)},mousemove:function(s){q(w,s)},touchstart:function(s){!function(u,p){var y,x,S,R=p.changedTouches.length,D=u.getActivePointersListByType("touch");y=t.now(),D.getLength()>p.touches.length-R&&t.console.warn("Tracked touch contact count doesn't match event.touches.length");var H={originalEvent:p,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(M(u,H),x=0;x<R;x++)re(u,H,S={id:p.changedTouches[x].identifier,type:"touch",isPrimary:0===D.getLength(),currentPos:C(p.changedTouches[x]),currentTime:y}),se(u,H,S,0),V(u,S,!0);H.preventDefault&&!H.defaultPrevented&&t.cancelEvent(p),H.stopPropagation&&t.stopEvent(p)}(w,s)},touchend:function(s){!function(u,p){var y,x,S,R=p.changedTouches.length;y=t.now();var D={originalEvent:p,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(M(u,D),x=0;x<R;x++)ae(u,D,S={id:p.changedTouches[x].identifier,type:"touch",currentPos:C(p.changedTouches[x]),currentTime:y},0),V(u,S,!1),oe(u,D,S);D.preventDefault&&!D.defaultPrevented&&t.cancelEvent(p),D.stopPropagation&&t.stopEvent(p)}(w,s)},touchmove:function(s){!function(u,p){var y,x,R=p.changedTouches.length;y=t.now();var D={originalEvent:p,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(M(u,D),x=0;x<R;x++)le(u,D,{id:p.changedTouches[x].identifier,type:"touch",currentPos:C(p.changedTouches[x]),currentTime:y});D.preventDefault&&!D.defaultPrevented&&t.cancelEvent(p),D.stopPropagation&&t.stopEvent(p)}(w,s)},touchcancel:function(s){!function(u,p){var y,S=p.changedTouches.length,R={originalEvent:p,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(M(u,R),y=0;y<S;y++)he(u,0,{id:p.changedTouches[y].identifier,type:"touch"});R.stopPropagation&&t.stopEvent(p)}(w,s)},gesturestart:function(s){t.eventIsCanceled(s)||s.preventDefault()},gesturechange:function(s){t.eventIsCanceled(s)||s.preventDefault()},gotpointercapture:function(s){var u,p,y;M(u=w,y={originalEvent:p=s,eventType:"gotpointercapture",pointerType:P(p),isEmulated:!1}),p.target===u.element&&V(u,{id:p.pointerId,type:P(p)},!0),y.stopPropagation&&t.stopEvent(p)},lostpointercapture:function(s){var u,p,y;M(u=w,y={originalEvent:p=s,eventType:"lostpointercapture",pointerType:P(p),isEmulated:!1}),p.target===u.element&&V(u,{id:p.pointerId,type:P(p)},!1),y.stopPropagation&&t.stopEvent(p)},pointerenter:function(s){X(w,s)},pointerleave:function(s){N(w,s)},pointerover:function(s){Q(w,s)},pointerout:function(s){$(w,s)},pointerdown:function(s){U(w,s)},pointerup:function(s){Y(w,s)},pointermove:function(s){q(w,s)},pointercancel:function(s){var u,p,y,x;u=w,y={id:(p=s).pointerId,type:P(p)},M(u,x={originalEvent:p,eventType:"pointercancel",pointerType:y.type,isEmulated:!1}),he(u,0,y),x.stopPropagation&&t.stopEvent(p)},pointerupcaptured:function(s){var u,p;(u=w).getActivePointersListByType(P(p=s)).getById(p.pointerId)&&Z(u,p),t.stopEvent(p)},pointermovecaptured:function(s){var u,p;(u=w).getActivePointersListByType(P(p=s)).getById(p.pointerId)&&B(u,p),t.stopEvent(p)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,t.MouseTracker.havePointerEvents&&t.setElementPointerEvents(this.element,"auto"),this.exitHandler&&t.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),g.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){var g;for(v(this),this.element=null,g=0;g<e.length;g++)if(e[g]===this){e.splice(g,1);break}i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(g){return(g?function(f){var w,s,u=i[f.hash];if(!u.tracking){for(s=0;s<t.MouseTracker.subscribeEvents.length;s++)t.addEvent(f.element,w=t.MouseTracker.subscribeEvents[s],u[w],w===t.MouseTracker.wheelEventName&&{passive:!1,capture:!1});m(f),u.tracking=!0}}:v)(this),this},getActivePointersListByType:function(g){var f,w,s=i[this.hash],u=s?s.activePointersLists.length:0;for(f=0;f<u;f++)if(s.activePointersLists[f].type===g)return s.activePointersLists[f];return w=new t.MouseTracker.GesturePointList(g),s&&s.activePointersLists.push(w),w},getActivePointerCount:function(){var g,f=i[this.hash],w=f.activePointersLists.length,s=0;for(g=0;g<w;g++)s+=f.activePointersLists[g].getLength();return s},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var r,h,c,d,n=function(){try{return window.self!==window.top}catch{return!0}}();function a(g){try{return g.addEventListener&&g.removeEventListener}catch{return}}function o(g,f){return g.hash.toString()+f.type+f.id.toString()}function l(){var g,f,w,s,u,p=r.length,y=t.now();for(s=y-c,c=y,g=0;g<p;g++)(w=(f=r[g]).gPoint).direction=Math.atan2(w.currentPos.y-f.lastPos.y,w.currentPos.x-f.lastPos.x),u=f.lastPos.distanceTo(w.currentPos),f.lastPos=w.currentPos,w.speed=1e3*u/(1+s)*.75+.25*w.speed}function m(g){var f,w,s,u,p,y=i[g.hash],x=y.activePointersLists.length;for(f=0;f<x;f++)if(0<(s=y.activePointersLists[f]).getLength()){for(p=[],u=s.asArray(),w=0;w<u.length;w++)p.push(u[w]);for(w=0;w<p.length;w++)J(g,s,p[w])}for(f=0;f<x;f++)y.activePointersLists.pop();y.sentDragEvent=!1}function v(g){var f,w,s=i[g.hash];if(s.tracking){for(w=0;w<t.MouseTracker.subscribeEvents.length;w++)t.removeEvent(g.element,f=t.MouseTracker.subscribeEvents[w],s[f],!1);m(g),s.tracking=!1}}function T(g,f){if(g=i[g.hash],"pointerevent"===f)return{upName:"pointerup",upHandler:g.pointerupcaptured,moveName:"pointermove",moveHandler:g.pointermovecaptured};if("mouse"===f)return{upName:"pointerup",upHandler:g.pointerupcaptured,moveName:"pointermove",moveHandler:g.pointermovecaptured};if("touch"===f)return{upName:"touchend",upHandler:g.touchendcaptured,moveName:"touchmove",moveHandler:g.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function _(g,f){var w;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents){if(!(w=g.getActivePointersListByType(f.type).getById(f.id))||!w.captured)return;try{g.element.releasePointerCapture(f.id)}catch{}}else g.element.releaseCapture();else w=T(g,t.MouseTracker.havePointerEvents?"pointerevent":f.type),n&&a(window.top)&&t.removeEvent(window.top,w.upName,w.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,w.moveName,w.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,w.upName,w.upHandler,!0);V(g,f,!1)}function E(g){return t.MouseTracker.havePointerEvents?g.pointerId:t.MouseTracker.mousePointerId}function P(g){return t.MouseTracker.havePointerEvents&&g.pointerType?g.pointerType:"mouse"}function b(g){return!t.MouseTracker.havePointerEvents||g.isPrimary}function C(g){return t.getMousePosition(g)}function z(g,f){return I(C(g),f)}function I(g,f){return f=t.getElementOffset(f),g.minus(f)}function O(g,f){return new t.Point((g.x+f.x)/2,(g.y+f.y)/2)}function G(g,f){var w={target:f.target||f.srcElement,type:"wheel",shiftKey:f.shiftKey||!1,clientX:f.clientX,clientY:f.clientY,pageX:f.pageX||f.clientX,pageY:f.pageY||f.clientY,deltaMode:"MozMousePixelScroll"===f.type?0:1,deltaX:0,deltaZ:0};w.deltaY="mousewheel"===t.MouseTracker.wheelEventName?-f.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:f.detail,K(g,w,f)}function K(g,f,w){var s,u,p=null;s=f.deltaY?f.deltaY<0?1:-1:0,M(g,u={originalEvent:f,eventType:"wheel",pointerType:"mouse",isEmulated:f!==w}),g.scrollHandler&&!u.preventGesture&&!u.defaultPrevented&&(p={eventSource:g,pointerType:"mouse",position:z(f,g.element),scroll:s,shift:f.shiftKey,isTouchEvent:!1,originalEvent:w,preventDefault:u.preventDefault||u.defaultPrevented,userData:g.userData},g.scrollHandler(p)),u.stopPropagation&&t.stopEvent(w),(p&&p.preventDefault||u.preventDefault&&!u.defaultPrevented)&&t.cancelEvent(w)}function X(g,f){var w={id:E(f),type:P(f),isPrimary:b(f),currentPos:C(f),currentTime:t.now()};M(g,f={originalEvent:f,eventType:"pointerenter",pointerType:w.type,isEmulated:!1}),re(g,f,w)}function N(g,f){var w={id:E(f),type:P(f),isPrimary:b(f),currentPos:C(f),currentTime:t.now()};M(g,f={originalEvent:f,eventType:"pointerleave",pointerType:w.type,isEmulated:!1}),oe(g,f,w)}function Q(g,f){var u,p,y,x,S,w={id:E(f),type:P(f),isPrimary:b(f),currentPos:C(f),currentTime:t.now()},s={originalEvent:f,eventType:"pointerover",pointerType:w.type,isEmulated:!1};M(g,s),p=s,(S=(x=(u=g).getActivePointersListByType((y=w).type)).getById(y.id))?y=S:(y.captured=!1,y.insideElementPressed=!1),u.overHandler&&u.overHandler({eventSource:u,pointerType:y.type,position:I(y.currentPos,u.element),buttons:x.buttons,pointers:u.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:0!==x.buttons,isTouchEvent:"touch"===y.type,originalEvent:p.originalEvent,userData:u.userData}),s.preventDefault&&!s.defaultPrevented&&t.cancelEvent(f),s.stopPropagation&&t.stopEvent(f)}function $(g,f){var u,p,y,x,S,w={id:E(f),type:P(f),isPrimary:b(f),currentPos:C(f),currentTime:t.now()},s={originalEvent:f,eventType:"pointerout",pointerType:w.type,isEmulated:!1};M(g,s),p=s,(S=(x=(u=g).getActivePointersListByType((y=w).type)).getById(y.id))?y=S:(y.captured=!1,y.insideElementPressed=!1),u.outHandler&&u.outHandler({eventSource:u,pointerType:y.type,position:y.currentPos&&I(y.currentPos,u.element),buttons:x.buttons,pointers:u.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:0!==x.buttons,isTouchEvent:"touch"===y.type,originalEvent:p.originalEvent,userData:u.userData}),s.preventDefault&&!s.defaultPrevented&&t.cancelEvent(f),s.stopPropagation&&t.stopEvent(f)}function U(g,f){var w={id:E(f),type:P(f),isPrimary:b(f),currentPos:C(f),currentTime:t.now()},s=t.MouseTracker.havePointerEvents&&"touch"===w.type,u={originalEvent:f,eventType:"pointerdown",pointerType:w.type,isEmulated:!1};M(g,u),se(g,u,w,f.button),u.preventDefault&&!u.defaultPrevented&&t.cancelEvent(f),u.stopPropagation&&t.stopEvent(f),u.shouldCapture&&(s?V(g,w,!0):function(p,y){var x;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents)try{p.element.setPointerCapture(y.id)}catch{return void t.console.warn("setPointerCapture() called on invalid pointer ID")}else p.element.setCapture(!0);else x=T(p,t.MouseTracker.havePointerEvents?"pointerevent":y.type),n&&a(window.top)&&t.addEvent(window.top,x.upName,x.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,x.upName,x.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,x.moveName,x.moveHandler,!0);V(p,y,!0)}(g,w))}function Y(g,f){Z(g,f)}function Z(g,f){var w,s={originalEvent:f,eventType:"pointerup",pointerType:(w={id:E(f),type:P(f),isPrimary:b(f),currentPos:C(f),currentTime:t.now()}).type,isEmulated:!1};M(g,s),ae(g,s,w,f.button),s.preventDefault&&!s.defaultPrevented&&t.cancelEvent(f),s.stopPropagation&&t.stopEvent(f),s.shouldReleaseCapture&&(f.target===g.element?_(g,w):V(g,w,!1))}function q(g,f){B(g,f)}function B(g,f){var w={id:E(f),type:P(f),isPrimary:b(f),currentPos:C(f),currentTime:t.now()},s={originalEvent:f,eventType:"pointermove",pointerType:w.type,isEmulated:!1};M(g,s),le(g,s,w),s.preventDefault&&!s.defaultPrevented&&t.cancelEvent(f),s.stopPropagation&&t.stopEvent(f)}function te(g,f){return f.speed=0,f.direction=0,f.contactPos=f.currentPos,f.contactTime=f.currentTime,f.lastPos=f.currentPos,f.lastTime=f.currentTime,g.add(f)}function J(g,f,w){var s,u=f.getById(w.id);return u?(u.captured&&(t.console.warn("stopTrackingPointer() called on captured pointer"),_(g,u)),f.removeContact(),s=f.removeById(w.id)):s=f.getLength(),s}function M(g,f){f.eventSource=g,f.eventPhase=f.originalEvent&&void 0!==f.originalEvent.eventPhase?f.originalEvent.eventPhase:0,f.defaultPrevented=t.eventIsCanceled(f.originalEvent),f.shouldCapture=!1,f.shouldReleaseCapture=!1,f.userData=g.userData,function(w,s){switch(s.eventType){case"pointermove":case"pointerdown":case"pointerup":s.isStoppable=!0,s.isCancelable=!0,s.preventDefault=!1,s.preventGesture=!w.hasGestureHandlers,s.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":s.isStoppable=!0,s.isCancelable=!0,s.preventDefault=!1,s.preventGesture=!1,s.stopPropagation=!1;break;case"wheel":s.isStoppable=!0,s.isCancelable=!0,s.preventDefault=!1,s.preventGesture=!w.hasScrollHandler,s.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":s.isStoppable=!0,s.isCancelable=!1,s.preventDefault=!1,s.preventGesture=!1,s.stopPropagation=!1;break;case"click":s.isStoppable=!0,s.isCancelable=!0,s.preventDefault=!!w.clickHandler,s.preventGesture=!1,s.stopPropagation=!1;break;case"dblclick":s.isStoppable=!0,s.isCancelable=!0,s.preventDefault=!!w.dblClickHandler,s.preventGesture=!1,s.stopPropagation=!1;break;default:s.isStoppable=!1,s.isCancelable=!1,s.preventDefault=!1,s.preventGesture=!1,s.stopPropagation=!1}}(g,f),g.preProcessEventHandler&&g.preProcessEventHandler(f)}function V(g,f,w){(f=(g=g.getActivePointersListByType(f.type)).getById(f.id))?w&&!f.captured?(f.captured=!0,g.captureCount++):!w&&f.captured&&(f.captured=!1,g.captureCount--,g.captureCount<0&&(g.captureCount=0,t.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):t.console.warn("updatePointerCaptured() called on untracked pointer")}function re(g,f,w){var s,u=g.getActivePointersListByType(w.type);(s=u.getById(w.id))?(s.insideElement=!0,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=w.currentPos,s.currentTime=w.currentTime,w=s):(w.captured=!1,w.insideElementPressed=!1,w.insideElement=!0,te(u,w)),g.enterHandler&&g.enterHandler({eventSource:g,pointerType:w.type,position:I(w.currentPos,g.element),buttons:u.buttons,pointers:g.getActivePointerCount(),insideElementPressed:w.insideElementPressed,buttonDownAny:0!==u.buttons,isTouchEvent:"touch"===w.type,originalEvent:f.originalEvent,userData:g.userData})}function oe(g,f,w){var s,u=g.getActivePointersListByType(w.type);(s=u.getById(w.id))?(s.captured?(s.insideElement=!1,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=w.currentPos,s.currentTime=w.currentTime):J(g,u,s),w=s):(w.captured=!1,w.insideElementPressed=!1),(g.leaveHandler||g.exitHandler)&&(f={eventSource:g,pointerType:w.type,position:w.currentPos&&I(w.currentPos,g.element),buttons:u.buttons,pointers:g.getActivePointerCount(),insideElementPressed:w.insideElementPressed,buttonDownAny:0!==u.buttons,isTouchEvent:"touch"===w.type,originalEvent:f.originalEvent,userData:g.userData},g.leaveHandler&&g.leaveHandler(f),g.exitHandler&&g.exitHandler(f))}function se(g,f,w,s){var u,p=i[g.hash],y=g.getActivePointersListByType(w.type);void 0!==f.originalEvent.buttons?y.buttons=f.originalEvent.buttons:0===s?y.buttons|=1:1===s?y.buttons|=4:2===s?y.buttons|=2:3===s?y.buttons|=8:4===s?y.buttons|=16:5===s&&(y.buttons|=32),0===s?((u=y.getById(w.id))?(u.insideElementPressed=!0,u.insideElement=!0,u.originalTarget=f.originalEvent.target,u.contactPos=w.currentPos,u.contactTime=w.currentTime,u.lastPos=u.currentPos,u.lastTime=u.currentTime,u.currentPos=w.currentPos,u.currentTime=w.currentTime,w=u):(w.captured=!1,w.insideElementPressed=!0,w.insideElement=!0,w.originalTarget=f.originalEvent.target,te(y,w)),y.addContact(),f.preventGesture||f.defaultPrevented?(f.shouldCapture=!1,f.shouldReleaseCapture=!1):(f.shouldCapture=!0,f.shouldReleaseCapture=!1,f.preventDefault=!0,(g.dragHandler||g.dragEndHandler||g.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(g,w),1===y.contacts?g.pressHandler&&!f.preventGesture&&g.pressHandler({eventSource:g,pointerType:w.type,position:I(w.contactPos,g.element),buttons:y.buttons,isTouchEvent:"touch"===w.type,originalEvent:f.originalEvent,userData:g.userData}):2===y.contacts&&g.pinchHandler&&"touch"===w.type&&(p.pinchGPoints=y.asArray(),p.lastPinchDist=p.currentPinchDist=p.pinchGPoints[0].currentPos.distanceTo(p.pinchGPoints[1].currentPos),p.lastPinchCenter=p.currentPinchCenter=O(p.pinchGPoints[0].currentPos,p.pinchGPoints[1].currentPos)))):(f.shouldCapture=!1,f.shouldReleaseCapture=!1,g.nonPrimaryPressHandler&&!f.preventGesture&&!f.defaultPrevented&&(f.preventDefault=!0,g.nonPrimaryPressHandler({eventSource:g,pointerType:w.type,position:I(w.currentPos,g.element),button:s,buttons:y.buttons,isTouchEvent:"touch"===w.type,originalEvent:f.originalEvent,userData:g.userData})))}function ae(g,f,w,s){var u,p,y,x=i[g.hash],S=g.getActivePointersListByType(w.type),R=!1;void 0!==f.originalEvent.buttons?S.buttons=f.originalEvent.buttons:0===s?S.buttons^=-2:1===s?S.buttons^=-5:2===s?S.buttons^=-3:3===s?S.buttons^=-9:4===s?S.buttons^=-17:5===s&&(S.buttons^=-33),f.shouldCapture=!1,0===s?((p=S.getById(w.id))?(S.removeContact(),p.captured&&(R=!0),p.lastPos=p.currentPos,p.lastTime=p.currentTime,p.currentPos=w.currentPos,p.currentTime=w.currentTime,p.insideElement||J(g,S,p),u=p.currentPos,y=p.currentTime):(w.captured=!1,w.insideElementPressed=!1,w.insideElement=!0,te(S,w),p=w),!f.preventGesture&&!f.defaultPrevented&&(R?(f.shouldReleaseCapture=!0,f.preventDefault=!0,(g.dragHandler||g.dragEndHandler||g.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(g,p),0===S.contacts?(g.releaseHandler&&u&&g.releaseHandler({eventSource:g,pointerType:p.type,position:I(u,g.element),buttons:S.buttons,insideElementPressed:p.insideElementPressed,insideElementReleased:p.insideElement,isTouchEvent:"touch"===p.type,originalEvent:f.originalEvent,userData:g.userData}),g.dragEndHandler&&x.sentDragEvent&&g.dragEndHandler({eventSource:g,pointerType:p.type,position:I(p.currentPos,g.element),speed:p.speed,direction:p.direction,shift:f.originalEvent.shiftKey,isTouchEvent:"touch"===p.type,originalEvent:f.originalEvent,userData:g.userData}),x.sentDragEvent=!1,(g.clickHandler||g.dblClickHandler)&&p.insideElement&&(y=y-p.contactTime<=g.clickTimeThreshold&&p.contactPos.distanceTo(u)<=g.clickDistThreshold,g.clickHandler&&g.clickHandler({eventSource:g,pointerType:p.type,position:I(p.currentPos,g.element),quick:y,shift:f.originalEvent.shiftKey,isTouchEvent:"touch"===p.type,originalEvent:f.originalEvent,originalTarget:p.originalTarget,userData:g.userData}),g.dblClickHandler&&y&&(S.clicks++,1===S.clicks?(x.lastClickPos=u,x.dblClickTimeOut=setTimeout(function(){S.clicks=0},g.dblClickTimeThreshold)):2===S.clicks&&(clearTimeout(x.dblClickTimeOut),S.clicks=0,x.lastClickPos.distanceTo(u)<=g.dblClickDistThreshold&&g.dblClickHandler({eventSource:g,pointerType:p.type,position:I(p.currentPos,g.element),shift:f.originalEvent.shiftKey,isTouchEvent:"touch"===p.type,originalEvent:f.originalEvent,userData:g.userData}),x.lastClickPos=null)))):2===S.contacts&&g.pinchHandler&&"touch"===p.type&&(x.pinchGPoints=S.asArray(),x.lastPinchDist=x.currentPinchDist=x.pinchGPoints[0].currentPos.distanceTo(x.pinchGPoints[1].currentPos),x.lastPinchCenter=x.currentPinchCenter=O(x.pinchGPoints[0].currentPos,x.pinchGPoints[1].currentPos))):(f.shouldReleaseCapture=!1,g.releaseHandler&&u&&(g.releaseHandler({eventSource:g,pointerType:p.type,position:I(u,g.element),buttons:S.buttons,insideElementPressed:p.insideElementPressed,insideElementReleased:p.insideElement,isTouchEvent:"touch"===p.type,originalEvent:f.originalEvent,userData:g.userData}),f.preventDefault=!0)))):(f.shouldReleaseCapture=!1,g.nonPrimaryReleaseHandler&&!f.preventGesture&&!f.defaultPrevented&&(f.preventDefault=!0,g.nonPrimaryReleaseHandler({eventSource:g,pointerType:w.type,position:I(w.currentPos,g.element),button:s,buttons:S.buttons,isTouchEvent:"touch"===w.type,originalEvent:f.originalEvent,userData:g.userData})))}function le(g,f,w){var s,u,p=i[g.hash],y=g.getActivePointersListByType(w.type);void 0!==f.originalEvent.buttons&&(y.buttons=f.originalEvent.buttons),(s=y.getById(w.id))&&(s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=w.currentPos,s.currentTime=w.currentTime,f.shouldCapture=!1,f.shouldReleaseCapture=!1,g.stopHandler&&"mouse"===w.type&&(clearTimeout(g.stopTimeOut),g.stopTimeOut=setTimeout(function(){var x,S,R;S=f.originalEvent,R=w.type,(x=g).stopHandler&&x.stopHandler({eventSource:x,pointerType:R,position:z(S,x.element),buttons:x.getActivePointersListByType(R).buttons,isTouchEvent:"touch"===R,originalEvent:S,userData:x.userData})},g.stopDelay)),0===y.contacts?g.moveHandler&&g.moveHandler({eventSource:g,pointerType:w.type,position:I(w.currentPos,g.element),buttons:y.buttons,isTouchEvent:"touch"===w.type,originalEvent:f.originalEvent,userData:g.userData}):1===y.contacts?(g.moveHandler&&(s=y.asArray()[0],g.moveHandler({eventSource:g,pointerType:s.type,position:I(s.currentPos,g.element),buttons:y.buttons,isTouchEvent:"touch"===s.type,originalEvent:f.originalEvent,userData:g.userData})),g.dragHandler&&!f.preventGesture&&!f.defaultPrevented&&(u=(s=y.asArray()[0]).currentPos.minus(s.lastPos),g.dragHandler({eventSource:g,pointerType:s.type,position:I(s.currentPos,g.element),buttons:y.buttons,delta:u,speed:s.speed,direction:s.direction,shift:f.originalEvent.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:f.originalEvent,userData:g.userData}),f.preventDefault=!0,p.sentDragEvent=!0)):2===y.contacts&&(g.moveHandler&&(s=y.asArray(),g.moveHandler({eventSource:g,pointerType:s[0].type,position:I(O(s[0].currentPos,s[1].currentPos),g.element),buttons:y.buttons,isTouchEvent:"touch"===s[0].type,originalEvent:f.originalEvent,userData:g.userData})),g.pinchHandler&&"touch"===w.type&&!f.preventGesture&&!f.defaultPrevented&&(u=p.pinchGPoints[0].currentPos.distanceTo(p.pinchGPoints[1].currentPos))!==p.currentPinchDist&&(p.lastPinchDist=p.currentPinchDist,p.currentPinchDist=u,p.lastPinchCenter=p.currentPinchCenter,p.currentPinchCenter=O(p.pinchGPoints[0].currentPos,p.pinchGPoints[1].currentPos),g.pinchHandler({eventSource:g,pointerType:"touch",gesturePoints:p.pinchGPoints,lastCenter:I(p.lastPinchCenter,g.element),center:I(p.currentPinchCenter,g.element),lastDistance:p.lastPinchDist,distance:p.currentPinchDist,shift:f.originalEvent.shiftKey,originalEvent:f.originalEvent,userData:g.userData}),f.preventDefault=!0)))}function he(g,f,w){var s=g.getActivePointersListByType(w.type);(w=s.getById(w.id))&&J(g,s,w)}t.MouseTracker.gesturePointVelocityTracker=(r=[],c=h=0,{addPoint:function(g,f){g=o(g,f),r.push({guid:g,gPoint:f,lastPos:f.currentPos}),1===r.length&&(c=t.now(),h=window.setInterval(l,50))},removePoint:function(g,f){var w,s=o(g,f),u=r.length;for(w=0;w<u;w++)if(r[w].guid===s){r.splice(w,1),0==--u&&window.clearInterval(h);break}}}),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",t.MouseTracker.wheelEventName],"DOMMouseScroll"===t.MouseTracker.wheelEventName&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.havePointerCapture=(d=document.createElement("div"),t.isFunction(d.setPointerCapture)&&t.isFunction(d.releasePointerCapture)),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(t.MouseTracker.havePointerEvents=!1,t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.havePointerCapture=(d=document.createElement("div"),t.isFunction(d.setCapture)&&t.isFunction(d.releaseCapture)),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),t.MouseTracker.GesturePointList=function(g){this._gPoints=[],this.type=g,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(g){return this._gPoints.push(g)},removeById:function(g){var f,w=this._gPoints.length;for(f=0;f<w;f++)if(this._gPoints[f].id===g){this._gPoints.splice(f,1);break}return this._gPoints.length},getByIndex:function(g){return g<this._gPoints.length?this._gPoints[g]:null},getById:function(g){var f,w=this._gPoints.length;for(f=0;f<w;f++)if(this._gPoints[f].id===g)return this._gPoints[f];return null},getPrimary:function(g){var f,w=this._gPoints.length;for(f=0;f<w;f++)if(this._gPoints[f].isPrimary)return this._gPoints[f];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(t.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}}}(OpenSeadragon),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(e,i,n){var a=e.parentNode;"number"==typeof i&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=void 0===i.attachToViewer||i.attachToViewer,this.autoFade=void 0===i.autoFade||i.autoFade,this.element=e,this.anchor=i.anchor,this.container=n,this.anchor===t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor===t.ControlAnchor.TOP_RIGHT||this.anchor===t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):a.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==t.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!==this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?this.anchor===t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){t.setElementOpacity(this.wrapper,e,!0)}}}(OpenSeadragon),function(t){function e(i,n){var a,o=i.controls;for(a=o.length-1;0<=a;a--)if(o[a].element===n)return a;return-1}t.ControlDock=function(i){var n,a,o=["topleft","topright","bottomright","bottomleft"];for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(1e6*Math.random()),container:t.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),"static"===t.getElementStyle(this.element).position&&(this.element.style.position="relative"),this.container.style.width="100%",this.container.style.height="100%"),a=0;a<o.length;a++)this.controls[n=o[a]]=t.makeNeutralElement("div"),this.controls[n].style.position="absolute",n.match("left")&&(this.controls[n].style.left="0px"),n.match("right")&&(this.controls[n].style.right="0px"),n.match("top")&&(this.controls[n].style.top="0px"),n.match("bottom")&&(this.controls[n].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(i,n){var a=null;if(!(0<=e(this,i=t.getElement(i)))){switch(n.anchor){case t.ControlAnchor.TOP_RIGHT:a=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:a=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:a=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:a=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;default:a=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new t.Control(i,n,a)),i.style.display="inline-block"}},removeControl:function(i){return 0<=(i=e(this,i=t.getElement(i)))&&(this.controls[i].destroy(),this.controls.splice(i,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;0<=i;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(i){var n;for(n=this.controls.length-1;0<=n;n--)this.controls[n].setVisible(i);return this}}}(OpenSeadragon),OpenSeadragon.Placement=OpenSeadragon.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}}),function(t){var e={},i=1;function n(s){return s=t.getElement(s),new t.Point(0===s.clientWidth?1:s.clientWidth,0===s.clientHeight?1:s.clientHeight)}function a(s,u){if(u instanceof t.Overlay)return u;var p=null;if(u.element)p=t.getElement(u.element);else{var y=u.id||"openseadragon-overlay-"+Math.floor(1e7*Math.random());(p=t.getElement(u.id))||((p=document.createElement("a")).href="#/overlay/"+y),p.id=y,t.addClass(p,u.className||"openseadragon-overlay")}var x=u.location,S=u.width,R=u.height;if(!x){y=u.x;var D=u.y;void 0!==u.px&&(y=(s=s.viewport.imageToViewportRectangle(new t.Rect(u.px,u.py,S||0,R||0))).x,D=s.y,S=void 0!==S?s.width:void 0,R=void 0!==R?s.height:void 0),x=new t.Point(y,D)}return(D=u.placement)&&"string"===t.type(D)&&(D=t.Placement[u.placement.toUpperCase()]),new t.Overlay({element:p,location:x,placement:D,onDraw:u.onDraw,checkResize:u.checkResize,width:S,height:R,rotationMode:u.rotationMode})}function o(s,u){var p;for(p=s.length-1;0<=p;p--)if(s[p].element===u)return p;return-1}function l(s,u){return t.requestAnimationFrame(function(){u(s)})}function r(s){t.requestAnimationFrame(function(){!function(u){var p,y,x;if(u.controlsShouldFade){for(p=t.now(),y=1-(p-=u.controlsFadeBeginTime)/u.controlsFadeLength,y=Math.min(1,y),y=Math.max(0,y),x=u.controls.length-1;0<=x;x--)u.controls[x].autoFade&&u.controls[x].setOpacity(y);0<y&&r(u)}}(s)})}function h(s){s.autoHideControls&&(s.controlsShouldFade=!0,s.controlsFadeBeginTime=t.now()+s.controlsFadeDelay,window.setTimeout(function(){r(s)},s.controlsFadeDelay))}function c(s){var u;for(s.controlsShouldFade=!1,u=s.controls.length-1;0<=u;u--)s.controls[u].setOpacity(1)}function d(){c(this)}function m(){h(this)}function v(s){var u={tracker:s.eventSource,position:s.position,originalEvent:s.originalEvent,preventDefault:s.preventDefault};this.raiseEvent("canvas-contextmenu",u),s.preventDefault=u.preventDefault}function T(s){var u={originalEvent:s.originalEvent,preventDefaultAction:!1,preventVerticalPan:s.preventVerticalPan||!this.panVertical,preventHorizontalPan:s.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",u),u.preventDefaultAction||s.ctrl||s.alt||s.meta)s.preventDefault=!1;else switch(s.keyCode){case 38:u.preventVerticalPan||(s.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),s.preventDefault=!0;break;case 40:u.preventVerticalPan||(s.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),s.preventDefault=!0;break;case 37:u.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),s.preventDefault=!0;break;case 39:u.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),s.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),s.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),s.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),s.preventDefault=!0;break;case 87:u.preventVerticalPan||(s.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),s.preventDefault=!0;break;case 83:u.preventVerticalPan||(s.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),s.preventDefault=!0;break;case 65:u.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),s.preventDefault=!0;break;case 68:u.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),s.preventDefault=!0;break;case 82:this.viewport.setRotation(s.shift?this.viewport.flipped?this.viewport.getRotation()+this.rotationIncrement:this.viewport.getRotation()-this.rotationIncrement:this.viewport.flipped?this.viewport.getRotation()-this.rotationIncrement:this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),s.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),s.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:s.preventDefault=!1}}function _(s){this.raiseEvent("canvas-key-press",s={originalEvent:s.originalEvent})}function E(s){document.activeElement===this.canvas||this.canvas.focus(),this.viewport.flipped&&(s.position.x=this.viewport.getContainerSize().x-s.position.x);var u={tracker:s.eventSource,position:s.position,quick:s.quick,shift:s.shift,originalEvent:s.originalEvent,originalTarget:s.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",u),!u.preventDefaultAction&&this.viewport&&s.quick&&(!0===(u=this.gestureSettingsByDeviceType(s.pointerType)).clickToZoom&&(this.viewport.zoomBy(s.shift?1/this.zoomPerClick:this.zoomPerClick,u.zoomToRefPoint?this.viewport.pointFromPixel(s.position,!0):null),this.viewport.applyConstraints()),u.dblClickDragToZoom&&(!0===e[this.hash].draggingToZoom?(e[this.hash].lastClickTime=null,e[this.hash].draggingToZoom=!1):e[this.hash].lastClickTime=t.now()))}function P(s){var u,p={tracker:s.eventSource,position:s.position,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",p),!p.preventDefaultAction&&this.viewport&&(u=this.gestureSettingsByDeviceType(s.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(s.shift?1/this.zoomPerClick:this.zoomPerClick,u.zoomToRefPoint?this.viewport.pointFromPixel(s.position,!0):null),this.viewport.applyConstraints())}function b(s){var u,p={tracker:s.eventSource,pointerType:s.pointerType,position:s.position,delta:s.delta,speed:s.speed,direction:s.direction,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",p),u=this.gestureSettingsByDeviceType(s.pointerType),!p.preventDefaultAction&&this.viewport)if(u.dblClickDragToZoom&&e[this.hash].draggingToZoom){var y=Math.pow(this.zoomPerDblClickDrag,s.delta.y/50);this.viewport.zoomBy(y)}else u.dragToPan&&!e[this.hash].draggingToZoom&&(this.panHorizontal||(s.delta.x=0),this.panVertical||(s.delta.y=0),this.viewport.flipped&&(s.delta.x=-s.delta.x),this.constrainDuringPan&&(p=this.viewport.deltaPointsFromPixels(s.delta.negate()),this.viewport.centerSpringX.target.value+=p.x,this.viewport.centerSpringY.target.value+=p.y,y=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=p.x,this.viewport.centerSpringY.target.value-=p.y,y.xConstrained&&(s.delta.x=0),y.yConstrained&&(s.delta.y=0)),this.viewport.panBy(this.viewport.deltaPointsFromPixels(s.delta.negate()),u.flickEnabled&&!this.constrainDuringPan))}function C(s){var u,p={tracker:s.eventSource,pointerType:s.pointerType,position:s.position,speed:s.speed,direction:s.direction,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",p),u=this.gestureSettingsByDeviceType(s.pointerType),!p.preventDefaultAction&&this.viewport){if(!e[this.hash].draggingToZoom&&u.dragToPan&&u.flickEnabled&&s.speed>=u.flickMinSpeed){var y=0;this.panHorizontal&&(y=u.flickMomentum*s.speed*Math.cos(s.direction)),p=0,this.panVertical&&(p=u.flickMomentum*s.speed*Math.sin(s.direction)),s=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),p=this.viewport.pointFromPixel(new t.Point(s.x-y,s.y-p)),this.viewport.panTo(p,!1)}this.viewport.applyConstraints()}u.dblClickDragToZoom&&!0===e[this.hash].draggingToZoom&&(e[this.hash].draggingToZoom=!1)}function z(s){this.raiseEvent("canvas-enter",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,buttons:s.buttons,pointers:s.pointers,insideElementPressed:s.insideElementPressed,buttonDownAny:s.buttonDownAny,originalEvent:s.originalEvent})}function I(s){this.raiseEvent("canvas-exit",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,buttons:s.buttons,pointers:s.pointers,insideElementPressed:s.insideElementPressed,buttonDownAny:s.buttonDownAny,originalEvent:s.originalEvent})}function O(s){if(this.raiseEvent("canvas-press",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,insideElementPressed:s.insideElementPressed,insideElementReleased:s.insideElementReleased,originalEvent:s.originalEvent}),this.gestureSettingsByDeviceType(s.pointerType).dblClickDragToZoom){var u=e[this.hash].lastClickTime;s=t.now(),null!==u&&(s-u<this.dblClickTimeThreshold&&(e[this.hash].draggingToZoom=!0),e[this.hash].lastClickTime=null)}}function G(s){this.raiseEvent("canvas-release",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,insideElementPressed:s.insideElementPressed,insideElementReleased:s.insideElementReleased,originalEvent:s.originalEvent})}function K(s){this.raiseEvent("canvas-nonprimary-press",{tracker:s.eventSource,position:s.position,pointerType:s.pointerType,button:s.button,buttons:s.buttons,originalEvent:s.originalEvent})}function X(s){this.raiseEvent("canvas-nonprimary-release",{tracker:s.eventSource,position:s.position,pointerType:s.pointerType,button:s.button,buttons:s.buttons,originalEvent:s.originalEvent})}function N(s){var u,p,y={tracker:s.eventSource,pointerType:s.pointerType,gesturePoints:s.gesturePoints,lastCenter:s.lastCenter,center:s.center,lastDistance:s.lastDistance,distance:s.distance,shift:s.shift,originalEvent:s.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",y),this.viewport&&((x=this.gestureSettingsByDeviceType(s.pointerType)).pinchToZoom&&(!y.preventDefaultPanAction||!y.preventDefaultZoomAction)&&(u=this.viewport.pointFromPixel(s.center,!0),x.zoomToRefPoint&&!y.preventDefaultPanAction&&(p=this.viewport.pointFromPixel(s.lastCenter,!0).minus(u),this.panHorizontal||(p.x=0),this.panVertical||(p.y=0),this.viewport.panBy(p,!0)),y.preventDefaultZoomAction||this.viewport.zoomBy(s.distance/s.lastDistance,u,!0),this.viewport.applyConstraints()),x.pinchRotate&&!y.preventDefaultRotateAction)){var x=Math.atan2(s.gesturePoints[0].currentPos.y-s.gesturePoints[1].currentPos.y,s.gesturePoints[0].currentPos.x-s.gesturePoints[1].currentPos.x);y=Math.atan2(s.gesturePoints[0].lastPos.y-s.gesturePoints[1].lastPos.y,s.gesturePoints[0].lastPos.x-s.gesturePoints[1].lastPos.x),u=this.viewport.pointFromPixel(s.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(x-y)*(180/Math.PI),u,!0)}}function Q(s){this.raiseEvent("canvas-focus",{tracker:s.eventSource,originalEvent:s.originalEvent})}function $(s){this.raiseEvent("canvas-blur",{tracker:s.eventSource,originalEvent:s.originalEvent})}function U(s){var u,p,y;(y=t.now())-this._lastScrollTime>this.minScrollDeltaTime?(this._lastScrollTime=y,this.raiseEvent("canvas-scroll",u={tracker:s.eventSource,position:s.position,scroll:s.scroll,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:!1,preventDefault:!0}),!u.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(s.position.x=this.viewport.getContainerSize().x-s.position.x),(p=this.gestureSettingsByDeviceType(s.pointerType)).scrollToZoom&&(y=Math.pow(this.zoomPerScroll,s.scroll),this.viewport.zoomBy(y,p.zoomToRefPoint?this.viewport.pointFromPixel(s.position,!0):null),this.viewport.applyConstraints())),s.preventDefault=u.preventDefault):s.preventDefault=!0}function Y(s){e[this.hash].mouseInside=!0,c(this),this.raiseEvent("container-enter",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,buttons:s.buttons,pointers:s.pointers,insideElementPressed:s.insideElementPressed,buttonDownAny:s.buttonDownAny,originalEvent:s.originalEvent})}function Z(s){s.pointers<1&&(e[this.hash].mouseInside=!1,e[this.hash].animating||h(this)),this.raiseEvent("container-exit",{tracker:s.eventSource,pointerType:s.pointerType,position:s.position,buttons:s.buttons,pointers:s.pointers,insideElementPressed:s.insideElementPressed,buttonDownAny:s.buttonDownAny,originalEvent:s.originalEvent})}function q(s){(function(u){if(!u._opening&&e[u.hash]){if(u.autoResize||e[u.hash].forceResize){if(u._autoResizePolling){y=n(u.container);var p=e[u.hash].prevContainerSize;y.equals(p)||(e[u.hash].needsResize=!0)}e[u.hash].needsResize&&function(x,S){var k,R=x.viewport,D=R.getZoom(),H=R.getCenter();if(R.resize(S,x.preserveImageSizeOnResize),R.panTo(H,!0),x.preserveImageSizeOnResize)k=e[x.hash].prevContainerSize.x/S.x;else{var A=new t.Point(0,0);H=new t.Point(e[x.hash].prevContainerSize.x,e[x.hash].prevContainerSize.y).distanceTo(A),k=(A=new t.Point(S.x,S.y).distanceTo(A))/H*e[x.hash].prevContainerSize.x/S.x}R.zoomTo(D*k,null,!0),e[x.hash].prevContainerSize=S,e[x.hash].forceRedraw=!0,e[x.hash].needsResize=!1,e[x.hash].forceResize=!1}(u,y||n(u.container))}p=u.viewport.update();var y=u.world.update(p)||p;p&&u.raiseEvent("viewport-change"),u.referenceStrip&&(y=u.referenceStrip.update(u.viewport)||y),!(p=e[u.hash].animating)&&y&&(u.raiseEvent("animation-start"),c(u)),(p=p&&!y)&&(e[u.hash].animating=!1),(y||p||e[u.hash].forceRedraw||u.world.needsDraw())&&((x=u).imageLoader.clear(),x.world.draw(),x.raiseEvent("update-viewport",{}),u._drawOverlays(),u.navigator&&u.navigator.update(u.viewport),e[u.hash].forceRedraw=!1,y&&u.raiseEvent("animation")),p&&(u.raiseEvent("animation-finish"),e[u.hash].mouseInside||h(u)),e[u.hash].animating=y}var x})(s),s._updateRequestId=!!s.isOpen()&&l(s,q)}function B(s,u){return s?s+u:u}function te(){e[this.hash].lastZoomTime=t.now(),e[this.hash].zoomFactor=this.zoomPerSecond,e[this.hash].zooming=!0,V(this)}function J(){e[this.hash].lastZoomTime=t.now(),e[this.hash].zoomFactor=1/this.zoomPerSecond,e[this.hash].zooming=!0,V(this)}function M(){e[this.hash].zooming=!1}function V(s){t.requestAnimationFrame(t.delegate(s,re))}function re(){var s,u;e[this.hash].zooming&&this.viewport&&(u=(s=t.now())-e[this.hash].lastZoomTime,u=Math.pow(e[this.hash].zoomFactor,u/1e3),this.viewport.zoomBy(u),this.viewport.applyConstraints(),e[this.hash].lastZoomTime=s,V(this))}function oe(){this.viewport&&(e[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function se(){this.viewport&&(e[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function ae(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function le(){this.viewport&&this.viewport.goHome()}function he(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function g(){if(this.viewport){var s=this.viewport.getRotation();this.viewport.flipped?s+=this.rotationIncrement:s-=this.rotationIncrement,this.viewport.setRotation(s)}}function f(){if(this.viewport){var s=this.viewport.getRotation();this.viewport.flipped?s-=this.rotationIncrement:s+=this.rotationIncrement,this.viewport.setRotation(s)}}function w(){this.viewport.toggleFlip()}t.Viewer=function(s){var u,S,p=arguments,y=this;if((s=t.isPlainObject(s)?s:{id:p[0],xmlPath:1<p.length?p[1]:void 0,prefixUrl:2<p.length?p[2]:void 0,controls:3<p.length?p[3]:void 0,overlays:4<p.length?p[4]:void 0}).config&&(t.extend(!0,s,s.config),delete s.config),s.drawerOptions=Object.assign({},["useCanvas"].reduce((S,R)=>(S[R]=s[R],delete s[R],S),{}),s.drawerOptions),t.extend(!0,this,{id:s.id,hash:s.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},t.DEFAULT_SETTINGS,s),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");void 0!==e[this.hash]&&t.console.warn("Hash "+this.hash+" has already been used."),e[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(S){S=t.getString("Errors.OpenFailed",S.eventSource,S.message),y._showMessage(S)}),t.ControlDock.call(this,s),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(S=this.canvas.style).width="100%",S.height="100%",S.overflow="hidden",S.position="absolute",S.top="0px",S.left="0px",t.setElementTouchActionNone(this.canvas),""!==s.tabIndex&&(this.canvas.tabIndex=void 0===s.tabIndex?0:s.tabIndex),this.container.className="openseadragon-container",function(S){S.width="100%",S.height="100%",S.position="relative",S.overflow="hidden",S.left="0px",S.top="0px",S.textAlign="left"}(this.container.style),t.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:t.delegate(this,v),keyDownHandler:t.delegate(this,T),keyHandler:t.delegate(this,_),clickHandler:t.delegate(this,E),dblClickHandler:t.delegate(this,P),dragHandler:t.delegate(this,b),dragEndHandler:t.delegate(this,C),enterHandler:t.delegate(this,z),leaveHandler:t.delegate(this,I),pressHandler:t.delegate(this,O),releaseHandler:t.delegate(this,G),nonPrimaryPressHandler:t.delegate(this,K),nonPrimaryReleaseHandler:t.delegate(this,X),scrollHandler:t.delegate(this,U),pinchHandler:t.delegate(this,N),focusHandler:t.delegate(this,Q),blurHandler:t.delegate(this,$)}),this.outerTracker=new t.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,Y),leaveHandler:t.delegate(this,Z)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),e[this.hash].prevContainerSize=n(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){e[y.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(S){y.source=y.world.getItemAt(0).source,e[y.hash].forceRedraw=!0,y._updateRequestId||(y._updateRequestId=l(y,q))}),this.world.addHandler("remove-item",function(S){y.source=y.world.getItemCount()?y.world.getItemAt(0).source:null,e[y.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(S){y.viewport&&y.viewport._setContentBounds(y.world.getHomeBounds(),y.world.getContentFactor())}),this.world.addHandler("item-index-change",function(S){y.source=y.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:e[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,overlayPreserveContentDirection:this.overlayPreserveContentDirection,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:s.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),Object.prototype.hasOwnProperty.call(this.drawerOptions,"useCanvas")&&(t.console.error('useCanvas is deprecated, use the "drawer" option to indicate preferred drawer(s)'),this.drawerOptions.useCanvas||(this.drawer=t.HTMLDrawer),delete this.drawerOptions.useCanvas);let x=Array.isArray(this.drawer)?this.drawer:[this.drawer];0===x.length&&(x=[t.DEFAULT_SETTINGS.drawer].flat(),t.console.warn("No valid drawers were selected. Using the default value.")),this.drawer=null;for(const S of x)if(this.requestDrawer(S,{mainDrawer:!0,redrawImmediately:!1}))break;if(!this.drawer)throw t.console.error("No drawer could be created!"),"Error with creating the selected drawer(s)";for(this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(u=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(u,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(u=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(u,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new t.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime,drawer:this.drawer.getType(),loadTilesWithAjax:this.loadTilesWithAjax,ajaxHeaders:this.ajaxHeaders,ajaxWithCredentials:this.ajaxWithCredentials})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),u=0;u<this.customControls.length;u++)this.addControl(this.customControls[u].id,{anchor:this.customControls[u].anchor});t.requestAnimationFrame(function(){h(y)}),t._viewers.set(this.element,this)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(s){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(s)},openTileSource:function(s){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(s)},get buttons(){return t.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(s,u){var p=this;if(this.close(),!s)return this;if(this.sequenceMode&&t.isArray(s))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===u||isNaN(u)||(this.initialPage=u),this.tileSources=s,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(!(s=t.isArray(s)?s:[s]).length)return this;this._opening=!0;for(var R,y=s.length,x=0,S=0,D=function(){if(x+S===y)if(x){(p._firstOpen||!p.preserveViewport)&&(p.viewport.goHome(!0),p.viewport.update()),p._firstOpen=!1;var k=s[0];if(k.tileSource&&(k=k.tileSource),p.overlays&&!p.preserveOverlays)for(var A=0;A<p.overlays.length;A++)p.currentOverlays[A]=a(p,p.overlays[A]);p._drawOverlays(),p._opening=!1,p.raiseEvent("open",{source:k})}else p._opening=!1,p.raiseEvent("open-failed",R)},H=0;H<s.length;H++)!function(k){void 0!==(k=t.isPlainObject(k)&&k.tileSource?k:{tileSource:k}).index&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete k.index),void 0===k.collectionImmediately&&(k.collectionImmediately=!0);var A=k.success;k.success=function(F){if(x++,k.tileSource.overlays)for(var L=0;L<k.tileSource.overlays.length;L++)p.addOverlay(k.tileSource.overlays[L]);A&&A(F),D()};var j=k.error;k.error=function(F){S++,R=R||F,j&&j(F),D()},p.addTiledImage(k)}(s[H]);return this},close:function(){return e[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),e[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(e[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),e[this.navigator.hash]=null,delete e[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),e[this.hash]=null,delete e[this.hash],this.canvas=null,this.container=null,t._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},requestDrawer(s,u){var p=(u=t.extend(!0,{mainDrawer:!0,redrawImmediately:!0,drawerOptions:null},u)).mainDrawer,y=u.redrawImmediately;u=u.drawerOptions;const x=this.drawer;let S=null;return s&&s.prototype instanceof t.DrawerBase?(S=s,s="custom"):"string"==typeof s&&(S=t.determineDrawer(s)),S||t.console.warn("Unsupported drawer! Drawer must be an existing string type, or a class that extends OpenSeadragon.DrawerBase."),!(!S||!S.isSupported())&&(x&&p&&x.destroy(),s=new S({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor,options:u||this.drawerOptions[s]}),p&&(this.drawer=s,y&&this.forceRedraw()),s)},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(s){return this.innerTracker.setTracking(s),this.outerTracker.setTracking(s),this.raiseEvent("mouse-enabled",{enabled:s}),this},areControlsEnabled:function(){var s,u=this.controls.length;for(s=0;s<this.controls.length;s++)u=u&&this.controls[s].isVisible();return u},setControlsEnabled:function(s){return(s?c:h)(this),this.raiseEvent("controls-enabled",{enabled:s}),this},setDebugMode:function(s){for(var u=0;u<this.world.getItemCount();u++)this.world.getItemAt(u).debugMode=s;this.debugMode=s,this.forceRedraw()},setAjaxHeaders:function(s,u){if(t.isPlainObject(s=null===s?{}:s)){if(void 0===u&&(u=!0),this.ajaxHeaders=s,u){for(var p=0;p<this.world.getItemCount();p++)this.world.getItemAt(p)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(var y in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[y].setAjaxHeaders(this.ajaxHeaders,!0)}}else console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object")},addButton:function(s){this.buttonGroup.addButton(s)},isFullPage:function(){return e[this.hash]&&e[this.hash].fullPage},setFullPage:function(s){var u,p,y=document.body,x=y.style,S=document.documentElement.style,R=this;if(s===this.isFullPage())return this;var D={fullPage:s,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",D),D.preventDefaultAction)return this;if(s&&this.element){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=x.margin,this.docMargin=S.margin,x.margin="0",S.margin="0",this.bodyPadding=x.padding,this.docPadding=S.padding,x.padding="0",S.padding="0",this.bodyWidth=x.width,this.docWidth=S.width,x.width="100%",S.width="100%",this.bodyHeight=x.height,this.docHeight=S.height,x.height="100%",S.height="100%",this.bodyDisplay=x.display,x.display="block",this.previousBody=[],e[this.hash].prevElementParent=this.element.parentNode,e[this.hash].prevNextSibling=this.element.nextSibling,e[this.hash].prevElementWidth=this.element.style.width,e[this.hash].prevElementHeight=this.element.style.height,u=y.childNodes.length,p=0;p<u;p++)this.previousBody.push(y.childNodes[0]),y.removeChild(y.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,y.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),y.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),e[this.hash].fullPage=!0,t.delegate(this,Y)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,x.margin=this.bodyMargin,S.margin=this.docMargin,x.padding=this.bodyPadding,S.padding=this.docPadding,x.width=this.bodyWidth,S.width=this.docWidth,x.height=this.bodyHeight,S.height=this.docHeight,x.display=this.bodyDisplay,y.removeChild(this.element),u=this.previousBody.length,p=0;p<u;p++)y.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),e[this.hash].prevElementParent.insertBefore(this.element,e[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(y.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=e[this.hash].prevElementWidth,this.element.style.height=e[this.hash].prevElementHeight;var H=0,k=function(){t.setPageScroll(R.pageScroll);var A=t.getPageScroll();++H<10&&(A.x!==R.pageScroll.x||A.y!==R.pageScroll.y)&&t.requestAnimationFrame(k)};t.requestAnimationFrame(k),e[this.hash].fullPage=!1,t.delegate(this,Z)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:s}),this},setFullScreen:function(s){var u=this;if(!t.supportsFullScreen)return this.setFullPage(s);if(t.isFullScreen()===s)return this;var p={fullScreen:s,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",p),p.preventDefaultAction)return this;if(s){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var y=function(){var x=t.isFullScreen();x||(t.removeEvent(document,t.fullScreenEventName,y),t.removeEvent(document,t.fullScreenErrorEventName,y),u.setFullPage(!1),u.isFullPage()&&(u.element.style.width=u.fullPageStyleWidth,u.element.style.height=u.fullPageStyleHeight)),u.navigator&&u.viewport&&setTimeout(function(){u.navigator.update(u.viewport)}),u.raiseEvent("full-screen",{fullScreen:x})};t.addEvent(document,t.fullScreenEventName,y),t.addEvent(document,t.fullScreenErrorEventName,y),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return"hidden"!==this.container.style.visibility},isFullScreen:function(){return t.isFullScreen()&&this.isFullPage()},setVisible:function(s){return this.container.style.visibility=s?"":"hidden",this.raiseEvent("visible",{visible:s}),this},addTiledImage:function(s){t.console.assert(s,"[Viewer.addTiledImage] options is required"),t.console.assert(s.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!s.replace||-1<s.index&&s.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var u=this;s.replace&&(s.replaceItem=u.world.getItemAt(s.index)),this._hideMessage(),void 0===s.placeholderFillStyle&&(s.placeholderFillStyle=this.placeholderFillStyle),void 0===s.opacity&&(s.opacity=this.opacity),void 0===s.preload&&(s.preload=this.preload),void 0===s.compositeOperation&&(s.compositeOperation=this.compositeOperation),void 0===s.crossOriginPolicy&&(s.crossOriginPolicy=(void 0!==s.tileSource.crossOriginPolicy?s.tileSource:this).crossOriginPolicy),void 0===s.ajaxWithCredentials&&(s.ajaxWithCredentials=this.ajaxWithCredentials),void 0===s.loadTilesWithAjax&&(s.loadTilesWithAjax=this.loadTilesWithAjax),t.isPlainObject(s.ajaxHeaders)||(s.ajaxHeaders={});var p={options:s};function y(R){for(var D=0;D<u._loadQueue.length;D++)if(u._loadQueue[D]===p){u._loadQueue.splice(D,1);break}0===u._loadQueue.length&&x(p),u.raiseEvent("add-item-failed",R),s.error&&s.error(R)}function x(R){u.collectionMode&&(u.world.arrange({immediately:R.options.collectionImmediately,rows:u.collectionRows,columns:u.collectionColumns,layout:u.collectionLayout,tileSize:u.collectionTileSize,tileMargin:u.collectionTileMargin}),u.world.setAutoRefigureSizes(!0))}function S(){for(var R,D;u._loadQueue.length&&(R=u._loadQueue[0]).tileSource;){if(u._loadQueue.splice(0,1),R.options.replace){var H=u.world.getIndexOfItem(R.options.replaceItem);-1!==H&&(R.options.index=H),u.world.removeItem(R.options.replaceItem)}D=new t.TiledImage({viewer:u,source:R.tileSource,viewport:u.viewport,drawer:u.drawer,tileCache:u.tileCache,imageLoader:u.imageLoader,x:R.options.x,y:R.options.y,width:R.options.width,height:R.options.height,fitBounds:R.options.fitBounds,fitBoundsPlacement:R.options.fitBoundsPlacement,clip:R.options.clip,placeholderFillStyle:R.options.placeholderFillStyle,opacity:R.options.opacity,preload:R.options.preload,degrees:R.options.degrees,flipped:R.options.flipped,compositeOperation:R.options.compositeOperation,springStiffness:u.springStiffness,animationTime:u.animationTime,minZoomImageRatio:u.minZoomImageRatio,wrapHorizontal:u.wrapHorizontal,wrapVertical:u.wrapVertical,maxTilesPerFrame:u.maxTilesPerFrame,immediateRender:u.immediateRender,blendTime:u.blendTime,alwaysBlend:u.alwaysBlend,minPixelRatio:u.minPixelRatio,smoothTileEdgesMinZoom:u.smoothTileEdgesMinZoom,iOSDevice:u.iOSDevice,crossOriginPolicy:R.options.crossOriginPolicy,ajaxWithCredentials:R.options.ajaxWithCredentials,loadTilesWithAjax:R.options.loadTilesWithAjax,ajaxHeaders:R.options.ajaxHeaders,debugMode:u.debugMode,subPixelRoundingForTransparency:u.subPixelRoundingForTransparency}),u.collectionMode&&u.world.setAutoRefigureSizes(!1),u.navigator&&(H=t.extend({},R.options,{replace:!1,originalTiledImage:D,tileSource:R.tileSource}),u.navigator.addTiledImage(H)),u.world.addItem(D,{index:R.options.index}),0===u._loadQueue.length&&x(R),1!==u.world.getItemCount()||u.preserveViewport||u.viewport.goHome(!0),R.options.success&&R.options.success({item:D})}}t.isArray(s.tileSource)?setTimeout(function(){y({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:s.tileSource,options:s})}):(this._loadQueue.push(p),function(R,D,H,k,A){var j=R;if("string"===t.type(D))if(D.match(/^\s*<.*>\s*$/))D=t.parseXml(D);else if(D.match(/^\s*[{[].*[}\]]\s*$/))try{var F=t.parseJSON(D);D=F}catch{}function L(W,ie){W.ready?k(W):(W.addHandler("ready",function(){k(W)}),W.addHandler("open-failed",function(ne){A({message:ne.message,source:ie})}))}setTimeout(function(){if("string"===t.type(D))(D=new t.TileSource({url:D,crossOriginPolicy:(void 0!==H.crossOriginPolicy?H:R).crossOriginPolicy,ajaxWithCredentials:R.ajaxWithCredentials,ajaxHeaders:H.ajaxHeaders||R.ajaxHeaders,splitHashDataForPost:R.splitHashDataForPost,success:function(ne){k(ne.tileSource)}})).addHandler("open-failed",function(ne){A(ne)});else if(t.isPlainObject(D)||D.nodeType)if(void 0!==D.crossOriginPolicy||void 0===H.crossOriginPolicy&&void 0===R.crossOriginPolicy||(D.crossOriginPolicy=(void 0!==H.crossOriginPolicy?H:R).crossOriginPolicy),void 0===D.ajaxWithCredentials&&(D.ajaxWithCredentials=R.ajaxWithCredentials),t.isFunction(D.getTileUrl)){var W=new t.TileSource(D);W.getTileUrl=D.getTileUrl,k(W)}else{var ie=t.TileSource.determineType(j,D);ie?(W=ie.prototype.configure.apply(j,[D]),L(new ie(W),D)):A({message:"Unable to load TileSource",source:D})}else L(D,D)})}(this,s.tileSource,s,function(R){p.tileSource=R,S()},function(R){R.options=s,y(R),S()}))},addSimpleImage:function(s){t.console.assert(s,"[Viewer.addSimpleImage] options is required"),t.console.assert(s.url,"[Viewer.addSimpleImage] options.url is required"),delete(s=t.extend({},s,{tileSource:{type:"image",url:s.url}})).url,this.addTiledImage(s)},addLayer:function(s){var u=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var p=t.extend({},s,{success:function(y){u.raiseEvent("add-layer",{options:s,drawer:y.item})},error:function(y){u.raiseEvent("add-layer-failed",y)}});return this.addTiledImage(p),this},getLayerAtLevel:function(s){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(s)},getLevelOfLayer:function(s){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(s)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(s,u){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(s,u)},removeLayer:function(s){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(s)},forceRedraw:function(){return e[this.hash].forceRedraw=!0,this},forceResize:function(){e[this.hash].needsResize=!0,e[this.hash].forceResize=!0},bindSequenceControls:function(){var s=t.delegate(this,d),u=t.delegate(this,m),p=t.delegate(this,this.goToNextPage),y=t.delegate(this,this.goToPreviousPage),x=this.navImages,S=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(S=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:B(this.prefixUrl,x.previous.REST),srcGroup:B(this.prefixUrl,x.previous.GROUP),srcHover:B(this.prefixUrl,x.previous.HOVER),srcDown:B(this.prefixUrl,x.previous.DOWN),onRelease:y,onFocus:s,onBlur:u}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:B(this.prefixUrl,x.next.REST),srcGroup:B(this.prefixUrl,x.next.GROUP),srcHover:B(this.prefixUrl,x.next.HOVER),srcDown:B(this.prefixUrl,x.next.DOWN),onRelease:p,onFocus:s,onBlur:u}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),S&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var s=t.delegate(this,te),u=t.delegate(this,M),p=t.delegate(this,oe),y=t.delegate(this,J),x=t.delegate(this,se),S=t.delegate(this,le),R=t.delegate(this,he),D=t.delegate(this,g),H=t.delegate(this,f),k=t.delegate(this,w),A=t.delegate(this,d),j=t.delegate(this,m),F=this.navImages,L=[],W=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(W=!1),this.showZoomControl&&(L.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:B(this.prefixUrl,F.zoomIn.REST),srcGroup:B(this.prefixUrl,F.zoomIn.GROUP),srcHover:B(this.prefixUrl,F.zoomIn.HOVER),srcDown:B(this.prefixUrl,F.zoomIn.DOWN),onPress:s,onRelease:u,onClick:p,onEnter:s,onExit:u,onFocus:A,onBlur:j})),L.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:B(this.prefixUrl,F.zoomOut.REST),srcGroup:B(this.prefixUrl,F.zoomOut.GROUP),srcHover:B(this.prefixUrl,F.zoomOut.HOVER),srcDown:B(this.prefixUrl,F.zoomOut.DOWN),onPress:y,onRelease:u,onClick:x,onEnter:y,onExit:u,onFocus:A,onBlur:j}))),this.showHomeControl&&L.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:B(this.prefixUrl,F.home.REST),srcGroup:B(this.prefixUrl,F.home.GROUP),srcHover:B(this.prefixUrl,F.home.HOVER),srcDown:B(this.prefixUrl,F.home.DOWN),onRelease:S,onFocus:A,onBlur:j})),this.showFullPageControl&&L.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:B(this.prefixUrl,F.fullpage.REST),srcGroup:B(this.prefixUrl,F.fullpage.GROUP),srcHover:B(this.prefixUrl,F.fullpage.HOVER),srcDown:B(this.prefixUrl,F.fullpage.DOWN),onRelease:R,onFocus:A,onBlur:j})),this.showRotationControl&&(L.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:B(this.prefixUrl,F.rotateleft.REST),srcGroup:B(this.prefixUrl,F.rotateleft.GROUP),srcHover:B(this.prefixUrl,F.rotateleft.HOVER),srcDown:B(this.prefixUrl,F.rotateleft.DOWN),onRelease:D,onFocus:A,onBlur:j})),L.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:B(this.prefixUrl,F.rotateright.REST),srcGroup:B(this.prefixUrl,F.rotateright.GROUP),srcHover:B(this.prefixUrl,F.rotateright.HOVER),srcDown:B(this.prefixUrl,F.rotateright.DOWN),onRelease:H,onFocus:A,onBlur:j}))),this.showFlipControl&&L.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:B(this.prefixUrl,F.flip.REST),srcGroup:B(this.prefixUrl,F.flip.GROUP),srcHover:B(this.prefixUrl,F.flip.HOVER),srcDown:B(this.prefixUrl,F.flip.DOWN),onRelease:k,onFocus:A,onBlur:j})),W?(this.buttonGroup=new t.ButtonGroup({buttons:L,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",t.delegate(this,ae)),(this.toolbar||this).addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT})):this.customButtons=L),this},currentPage:function(){return this._sequenceIndex},goToPage:function(s){return this.tileSources&&0<=s&&s<this.tileSources.length&&(this._sequenceIndex=s,this._updateSequenceButtons(s),this.open(this.tileSources[s]),this.referenceStrip&&this.referenceStrip.setFocus(s),this.raiseEvent("page",{page:s})),this},addOverlay:function(s,u,p,y){return p=t.isPlainObject(s)?s:{element:s,location:u,placement:p,onDraw:y},s=t.getElement(p.element),0<=o(this.currentOverlays,s)||(y=a(this,p),this.currentOverlays.push(y),y.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:s,location:p.location,placement:p.placement})),this},updateOverlay:function(s,u,p){var y;return s=t.getElement(s),0<=(y=o(this.currentOverlays,s))&&(this.currentOverlays[y].update(u,p),e[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:s,location:u,placement:p})),this},removeOverlay:function(s){var u;return s=t.getElement(s),0<=(u=o(this.currentOverlays,s))&&(this.currentOverlays[u].destroy(),this.currentOverlays.splice(u,1),e[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:s})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return e[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(s){return s=t.getElement(s),0<=(s=o(this.currentOverlays,s))?this.currentOverlays[s]:null},_updateSequenceButtons:function(s){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==s?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<s?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(s){this._hideMessage();var u=t.makeNeutralElement("div");u.appendChild(document.createTextNode(s)),this.messageDiv=t.makeCenteredNode(u),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var s=this.messageDiv;s&&(s.parentNode.removeChild(s),delete this.messageDiv)},gestureSettingsByDeviceType:function(s){switch(s){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var s,u=this.currentOverlays.length;for(s=0;s<u;s++)this.currentOverlays[s].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){this.showReferenceStrip=!0,this.sequenceMode?!this.referenceStrip&&this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),t.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){t.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var s=t.pixelDensityRatio,u=t.getCurrentPixelDensityRatio();s!==u&&(t.pixelDensityRatio=u,this.forceResize())},goToPreviousPage:function(){var s=this._sequenceIndex-1;this.navPrevNextWrap&&s<0&&(s+=this.tileSources.length),this.goToPage(s)},goToNextPage:function(){var s=this._sequenceIndex+1;this.navPrevNextWrap&&s>=this.tileSources.length&&(s=0),this.goToPage(s)},isAnimating:function(){return e[this.hash].animating}}),t.determineDrawer=function(s){for(var u in OpenSeadragon){const p=OpenSeadragon[u],y=p.prototype;if(y&&y instanceof OpenSeadragon.DrawerBase&&t.isFunction(y.getType)&&y.getType.call(p)===s)return p}return null}}(OpenSeadragon),function(t){function e(r){var h={tracker:r.eventSource,position:r.position,quick:r.quick,shift:r.shift,originalEvent:r.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-click",h),!h.preventDefaultAction&&r.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(r.position.x=this.viewport.getContainerSize().x-r.position.x),r=this.viewport.pointFromPixel(r.position),this.panVertical?this.panHorizontal||(r.x=this.viewer.viewport.getCenter(!0).x):r.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(r),this.viewer.viewport.applyConstraints())}function i(r){var h={tracker:r.eventSource,position:r.position,delta:r.delta,speed:r.speed,direction:r.direction,shift:r.shift,originalEvent:r.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",h),!h.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(r.delta.x=0),this.panVertical||(r.delta.y=0),this.viewer.viewport.flipped&&(r.delta.x=-r.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(r.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(r){r.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function a(r){var h={tracker:r.eventSource,position:r.position,scroll:r.scroll,shift:r.shift,originalEvent:r.originalEvent,preventDefault:r.preventDefault};this.viewer.raiseEvent("navigator-scroll",h),r.preventDefault=h.preventDefault}function o(r,h){l(r,"rotate("+h+"deg)")}function l(r,h){r.style.webkitTransform=h,r.style.mozTransform=h,r.style.msTransform=h,r.style.oTransform=h,r.style.transform=h}t.Navigator=function(r){var h,v,T,c=r.viewer,d=this;function m(v,T){o(d.displayRegionContainer,v),o(d.displayRegion,-v),d.viewport.setRotation(v,T)}r.element||r.id?(r.element?(r.id&&t.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),r.id=r.element.id?r.element.id:"navigator-"+t.now(),this.element=r.element):this.element=document.getElementById(r.id),r.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(r.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),r.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:r.autoFade},r.position&&("BOTTOM_RIGHT"===r.position?r.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===r.position?r.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===r.position?r.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===r.position?r.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:"ABSOLUTE"===r.position&&(r.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,r.controlOptions.top=r.top,r.controlOptions.left=r.left,r.controlOptions.height=r.height,r.controlOptions.width=r.width))),this.element.id=r.id,this.element.className+=" navigator",(r=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},r,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:r.animationTime,autoResize:!1,minZoomImageRatio:1,background:r.background,opacity:r.opacity,borderColor:r.borderColor,displayRegionColor:r.displayRegionColor})).minPixelRatio=this.minPixelRatio=c.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),r.controlOptions.anchor!==t.ControlAnchor.NONE&&(T=this.borderWidth,(v=this.element.style).margin="0px",v.border=T+"px solid "+r.borderColor,v.padding="0px",v.background=r.background,v.opacity=r.opacity,v.overflow="hidden"),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(v,T){v.position="relative",v.top="0px",v.left="0px",v.fontSize="0px",v.overflow="hidden",v.border=T+"px solid "+r.displayRegionColor,v.margin="0px",v.padding="0px",v.background="transparent",v.float="left",v.cssFloat="left",v.zIndex=999999999,v.cursor="default",v.boxSizing="content-box"}(this.displayRegion.style,this.borderWidth),t.setElementPointerEventsNone(this.displayRegion),t.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",t.setElementPointerEventsNone(this.displayRegionContainer),t.setElementTouchActionNone(this.displayRegionContainer),c.addControl(this.element,r.controlOptions),this._resizeWithViewer=r.controlOptions.anchor!==t.ControlAnchor.ABSOLUTE&&r.controlOptions.anchor!==t.ControlAnchor.NONE,r.width&&r.height?(this.setWidth(r.width),this.setHeight(r.height)):this._resizeWithViewer&&(h=t.getElementSize(c.element),this.element.style.height=Math.round(h.y*r.sizeRatio)+"px",this.element.style.width=Math.round(h.x*r.sizeRatio)+"px",this.oldViewerSize=h,h=t.getElementSize(this.element),this.elementArea=h.x*h.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[r]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),r.navigatorRotate&&(m(r.viewer.viewport?r.viewer.viewport.getRotation():r.viewer.degrees||0,!0),r.viewer.addHandler("rotate",function(v){m(v.degrees,v.immediately)})),this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:t.delegate(this,i),clickHandler:t.delegate(this,e),releaseHandler:t.delegate(this,n),scrollHandler:t.delegate(this,a),preProcessEventHandler:function(v){"wheel"===v.eventType&&(v.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",t.setElementPointerEventsNone(this.canvas),t.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){d.viewport&&d.viewport.goHome(!0)}),c.world.addHandler("item-index-change",function(v){window.setTimeout(function(){var T=d.world.getItemAt(v.previousIndex);d.world.setItemIndex(T,v.newIndex)},1)}),c.world.addHandler("remove-item",function(v){(v=d._getMatchingItem(v=v.item))&&d.world.removeItem(v)}),this.update(c.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var r=new t.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);r.equals(this.oldContainerSize)||(this.viewport.resize(r,!0),this.viewport.goHome(!0),this.oldContainerSize=r,this.world.update(),this.world.draw(),this.update(this.viewer.viewport))}},setWidth:function(r){this.width=r,this.element.style.width="number"==typeof r?r+"px":r,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(r){this.height=r,this.element.style.height="number"==typeof r?r+"px":r,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(r){return this.viewport.setFlip(r),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(r){l(this.canvas,r),l(this.element,r)},update:function(r){var h,c;if(r=r||this.viewer.viewport,h=t.getElementSize(this.viewer.element),this._resizeWithViewer&&h.x&&h.y&&!h.equals(this.oldViewerSize)&&(this.oldViewerSize=h,this.maintainSizeRatio||!this.elementArea?(c=h.x*this.sizeRatio,m=h.y*this.sizeRatio):(c=Math.sqrt(this.elementArea*(h.x/h.y)),m=this.elementArea/c),this.element.style.width=Math.round(c)+"px",this.element.style.height=Math.round(m)+"px",this.elementArea||(this.elementArea=c*m),this.updateSize()),r&&this.viewport){if(c=r.getBoundsNoRotate(!0),m=this.viewport.pixelFromPointNoRotate(c.getTopLeft(),!1),c=this.viewport.pixelFromPointNoRotate(c.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var d=r.getRotation(!0);o(this.displayRegion,-d)}(r=this.displayRegion.style).display=this.world.getItemCount()?"block":"none",r.top=m.y.toFixed(2)+"px",r.left=m.x.toFixed(2)+"px",d=c.x-m.x;var m=c.y-m.y;r.width=Math.round(Math.max(d,0))+"px",r.height=Math.round(Math.max(m,0))+"px"}},addTiledImage:function(r){var h=this,c=r.originalTiledImage;return delete r.original,r=t.extend({},r,{success:function(d){var m=d.item;function v(){h._matchBounds(m,c)}m._originalForNavigator=c,h._matchBounds(m,c,!0),h._matchOpacity(m,c),h._matchCompositeOperation(m,c),c.addHandler("bounds-change",v),c.addHandler("clip-change",v),c.addHandler("opacity-change",function(){h._matchOpacity(m,c)}),c.addHandler("composite-operation-change",function(){h._matchCompositeOperation(m,c)})}}),t.Viewer.prototype.addTiledImage.apply(this,[r])},destroy:function(){return t.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(r){for(var c,h=this.world.getItemCount(),d=0;d<h;d++)if((c=this.world.getItemAt(d))._originalForNavigator===r)return c;return null},_matchBounds:function(r,h,c){var d=h.getBoundsNoRotate();r.setPosition(d.getTopLeft(),c),r.setWidth(d.width,c),r.setRotation(h.getRotation(),c),r.setClip(h.getClip()),r.setFlip(h.getFlip())},_matchOpacity:function(r,h){r.setOpacity(h.opacity)},_matchCompositeOperation:function(r,h){r.setCompositeOperation(h.compositeOperation)}})}(OpenSeadragon),function(t){var e={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(i){var n,a=i.split("."),o=null,l=arguments,r=e;for(n=0;n<a.length-1;n++)r=r[a[n]]||{};return"string"!=typeof(o=r[a[n]])&&(t.console.error("Untranslated source string:",i),o=""),o.replace(/\{\d+\}/g,function(h){return(h=parseInt(h.match(/\d+/),10)+1)<l.length?l[h]:""})},setString:function(i,n){var a,o=i.split("."),l=e;for(a=0;a<o.length-1;a++)l[o[a]]||(l[o[a]]={}),l=l[o[a]];l[o[a]]=n}})}(OpenSeadragon),function(t){t.Point=function(e,i){this.x="number"==typeof e?e:0,this.y="number"==typeof i?i:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(e){return new t.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new t.Point(this.x-e.x,this.y-e.y)},times:function(e){return new t.Point(this.x*e,this.y*e)},divide:function(e){return new t.Point(this.x/e,this.y/e)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(e){return new t.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof t.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,i){var n,a;if(i=i||new t.Point(0,0),e%90==0)switch(t.positiveModulo(e,360)){case 0:n=1,a=0;break;case 90:n=0,a=1;break;case 180:n=-1,a=0;break;case 270:n=0,a=-1}else{var o=e*Math.PI/180;n=Math.cos(o),a=Math.sin(o)}return new t.Point(o=n*(this.x-i.x)-a*(this.y-i.y)+i.x,i=a*(this.x-i.x)+n*(this.y-i.y)+i.y)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(t){t.TileSource=function(e,i,n,a,o,l){var h,r=this,c=arguments;if(c=t.isPlainObject(e)?e:{width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]},t.EventSource.call(this),t.extend(!0,this,c),!this.success)for(h=0;h<arguments.length;h++)if(t.isFunction(arguments[h])){this.success=arguments[h];break}this.success&&this.addHandler("ready",function(d){r.success(d)}),"string"===t.type(e)&&(this.url=e),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=c.width&&c.height?c.width/c.height:1,this.dimensions=new t.Point(c.width,c.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=c.tileOverlap||0,this.minLevel=c.minLevel||0,this.maxLevel=null!=c.maxLevel?c.maxLevel:c.width&&c.height?Math.ceil(Math.log(Math.max(c.width,c.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(e){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth||this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight||this.getTileSize(e)},setMaxLevel:function(e){this.maxLevel=e,this._memoizeLevelScale()},getLevelScale:function(e){return this._memoizeLevelScale(),this.getLevelScale(e)},_memoizeLevelScale:function(){var e,i={};for(e=0;e<=this.maxLevel;e++)i[e]=1/Math.pow(2,this.maxLevel-e);this.getLevelScale=function(n){return i[n]}},getNumTiles:function(a){var i=this.getLevelScale(a),n=Math.ceil(i*this.dimensions.x/this.getTileWidth(a));return a=Math.ceil(i*this.dimensions.y/this.getTileHeight(a)),new t.Point(n,a)},getPixelRatio:function(i){var n=this.dimensions.times(this.getLevelScale(i));return new t.Point(i=1/n.x*t.pixelDensityRatio,n=1/n.y*t.pixelDensityRatio)},getClosestLevel:function(){var e,i;for(e=this.minLevel+1;e<=this.maxLevel&&!(1<(i=this.getNumTiles(e)).x||1<i.y);e++);return e-1},getTileAtPoint:function(e,i){var n=0<=i.x&&i.x<=1&&0<=i.y&&i.y<=1/this.aspectRatio;t.console.assert(n,"[TileSource.getTileAtPoint] must be called with a valid point.");var a=this.dimensions.x*this.getLevelScale(e);return n=i.x*a,a*=i.y,n=Math.floor(n/this.getTileWidth(e)),a=Math.floor(a/this.getTileHeight(e)),1<=i.x&&(n=this.getNumTiles(e).x-1),i.y>=1/this.aspectRatio-1e-15&&(a=this.getNumTiles(e).y-1),new t.Point(n,a)},getTileBounds:function(h,c,m,a){var o=this.dimensions.times(this.getLevelScale(h)),l=this.getTileWidth(h),d=this.getTileHeight(h),r=0===c?0:l*c-this.tileOverlap;return h=0===m?0:d*m-this.tileOverlap,c=l+(0===c?1:2)*this.tileOverlap,d+=(0===m?1:2)*this.tileOverlap,m=1/o.x,c=Math.min(c,o.x-r),d=Math.min(d,o.y-h),a?new t.Rect(0,0,c,d):new t.Rect(r*m,h*m,c*m,d*m)},getImageInfo:function(e){var i,n,a,o,l,r=this;e&&-1<(l=(o=(a=e.split("/"))[a.length-1]).lastIndexOf("."))&&(a[a.length-1]=o.slice(0,l));var h=null;if(this.splitHashDataForPost){var c=e.indexOf("#");-1!==c&&(h=e.substring(c+1),e=e.substr(0,c))}i=function(d){"string"==typeof d&&(d=t.parseXml(d));var m=t.TileSource.determineType(r,d,e);m?(void 0===(n=m.prototype.configure.apply(r,[d,e,h])).ajaxWithCredentials&&(n.ajaxWithCredentials=r.ajaxWithCredentials),n=new m(n),r.ready=!0,r.raiseEvent("ready",{tileSource:n})):r.raiseEvent("open-failed",{message:"Unable to load TileSource",source:e})},e.match(/\.js$/)?(c=e.split("/").pop().replace(".js",""),t.jsonp({url:e,async:!1,callbackName:c,callback:i})):t.makeAjaxRequest({url:e,postData:h,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(d){d=function(m){var T,_=m.responseText,E=m.status;if(!m)throw new Error(t.getString("Errors.Security"));if(200!==m.status&&0!==m.status)throw E=m.status,new Error(t.getString("Errors.Status",E,404===E?"Not Found":m.statusText));if(_.match(/^\s*<.*/))try{T=m.responseXML&&m.responseXML.documentElement?m.responseXML:t.parseXml(_)}catch{T=m.responseText}else if(_.match(/\s*[{[].*/))try{T=t.parseJSON(_)}catch{T=_}else T=_;return T}(d),i(d)},error:function(d,m){var v;try{v="HTTP "+d.status+" attempting to load TileSource: "+e}catch{v=(void 0!==m&&m.toString?m.toString():"Unknown error")+" attempting to load TileSource: "+e}t.console.error(v),r.raiseEvent("open-failed",{message:v,source:e,postData:h})}})},supports:function(e,i){return!1},configure:function(e,i,n){throw new Error("Method not implemented.")},getTileUrl:function(e,i,n){throw new Error("Method not implemented.")},getTilePostData:function(e,i,n){return null},getTileAjaxHeaders:function(e,i,n){return{}},getTileHashKey:function(e,i,n,a,o,l){return function r(h){return o?h+"+"+JSON.stringify(o):h}("string"!=typeof a?e+"/"+i+"_"+n:a)},tileExists:function(e,i,n){var a=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&0<=i&&0<=n&&i<a.x&&n<a.y},hasTransparency:function(e,i,n,a){return!!e||i.match(".png")},downloadTileStart:function(e){var i=e.userData,n=new Image;function a(o){n?(n.onload=n.onerror=n.onabort=null,e.finish(o?null:n,i.request,o)):e.finish(null,i.request,"Image load failed: undefined Image instance.")}i.image=n,i.request=null,n.onload=function(){a()},n.onabort=n.onerror=function(){a("Image load aborted.")},e.loadWithAjax?i.request=t.makeAjaxRequest({url:e.src,withCredentials:e.ajaxWithCredentials,headers:e.ajaxHeaders,responseType:"arraybuffer",postData:e.postData,success:function(o){var l;try{l=new window.Blob([o.response])}catch(h){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===h.name&&r&&((r=new r).append(o.response),l=r.getBlob())}0===l.size?a("Empty image response."):n.src=(window.URL||window.webkitURL).createObjectURL(l)},error:function(o){a("Image load aborted - XHR error")}}):(!1!==e.crossOriginPolicy&&(n.crossOrigin=e.crossOriginPolicy),n.src=e.src)},downloadTileAbort:function(e){e.userData.request&&e.userData.request.abort();var i=e.userData.image;e.userData.image&&(i.onload=i.onerror=i.onabort=null)},createTileCache:function(e,i,n){e._data=i},destroyTileCache:function(e){e._data=null,e._renderedContext=null},getTileCacheData:function(e){return e._data},getTileCacheDataAsImage:function(e){return e._data},getTileCacheDataAsContext2D:function(e){if(!e._renderedContext){var i=document.createElement("canvas");i.width=e._data.width,i.height=e._data.height,e._renderedContext=i.getContext("2d"),e._renderedContext.drawImage(e._data,0,0),e._data=null}return e._renderedContext}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype),t.TileSource.determineType=function(e,i,n){for(var a in OpenSeadragon)if(a.match(/.+TileSource$/)&&t.isFunction(OpenSeadragon[a])&&t.isFunction(OpenSeadragon[a].prototype.supports)&&OpenSeadragon[a].prototype.supports.call(e,i,n))return OpenSeadragon[a];return t.console.error("No TileSource was able to open %s %s",n,i),null}}(OpenSeadragon),function(t){function e(i,n){var a,o,l=(v=n.Image).Url,r=v.Format,m=v.Size,h=v.DisplayRect||[],c=parseInt(m.Width,10),d=parseInt(m.Height,10),v=(m=parseInt(v.TileSize,10),parseInt(v.Overlap,10)),T=[];for(o=0;o<h.length;o++)a=h[o].Rect,T.push(new t.DisplayRect(parseInt(a.X,10),parseInt(a.Y,10),parseInt(a.Width,10),parseInt(a.Height,10),parseInt(a.MinLevel,10),parseInt(a.MaxLevel,10)));return t.extend(!0,{width:c,height:d,tileSize:m,tileOverlap:v,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:r,displayRects:T},n)}t.DziTileSource=function(i,n,a,o,l,r,h,c,d){var m,v,T,_;if(_=t.isPlainObject(i)?i:{width:i,height:n,tileSize:a,tileOverlap:o,tilesUrl:l,fileFormat:r,displayRects:h,minLevel:c,maxLevel:d},this._levelRects={},this.tilesUrl=_.tilesUrl,this.fileFormat=_.fileFormat,this.displayRects=_.displayRects,this.displayRects)for(m=this.displayRects.length-1;0<=m;m--)for(T=(v=this.displayRects[m]).minLevel;T<=v.maxLevel;T++)this._levelRects[T]||(this._levelRects[T]=[]),this._levelRects[T].push(v);t.TileSource.apply(this,[_])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(i,n){var a;return i.Image?a=i.Image.xmlns:i.documentElement&&("Image"!==i.documentElement.localName&&"Image"!==i.documentElement.tagName||(a=i.documentElement.namespaceURI)),-1!==(a=(a||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==a.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,n,a){return i=(t.isPlainObject(i)?e:function(o,E){if(!E||!E.documentElement)throw new Error(t.getString("Errors.Xml"));var r,h,c,d,m,v=E.documentElement,T=v.localName||v.tagName,_=E.documentElement.namespaceURI,P=(E=null,[]);if("Image"===T)try{if(void 0===(d=v.getElementsByTagName("Size")[0])&&(d=v.getElementsByTagNameNS(_,"Size")[0]),E={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:v.getAttribute("Url"),Format:v.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(v.getAttribute("Overlap"),10),TileSize:parseInt(v.getAttribute("TileSize"),10),Size:{Height:parseInt(d.getAttribute("Height"),10),Width:parseInt(d.getAttribute("Width"),10)}}},!t.imageFormatSupported(E.Image.Format))throw new Error(t.getString("Errors.ImageFormat",E.Image.Format.toUpperCase()));for(void 0===(r=v.getElementsByTagName("DisplayRect"))&&(r=v.getElementsByTagNameNS(_,"DisplayRect")[0]),m=0;m<r.length;m++)void 0===(c=(h=r[m]).getElementsByTagName("Rect")[0])&&(c=h.getElementsByTagNameNS(_,"Rect")[0]),P.push({Rect:{X:parseInt(c.getAttribute("X"),10),Y:parseInt(c.getAttribute("Y"),10),Width:parseInt(c.getAttribute("Width"),10),Height:parseInt(c.getAttribute("Height"),10),MinLevel:parseInt(h.getAttribute("MinLevel"),10),MaxLevel:parseInt(h.getAttribute("MaxLevel"),10)}});return P.length&&(E.Image.DisplayRect=P),e(0,E)}catch(b){throw b instanceof Error?b:new Error(t.getString("Errors.Dzi"))}else{if("Collection"===T)throw new Error(t.getString("Errors.Dzc"));if("Error"===T)throw v=v.getElementsByTagName("Message")[0].firstChild.nodeValue,new Error(v)}throw new Error(t.getString("Errors.Dzi"))})(this,i),n&&!i.tilesUrl&&(i.tilesUrl=n.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),i.queryParams=-1!==n.search(/\.(dzi|xml|js)\?/)?n.match(/\?.*/):""),i},getTileUrl:function(i,n,a){return[this.tilesUrl,i,"/",n,"_",a,".",this.fileFormat,this.queryParams].join("")},tileExists:function(i,n,a){var o,l,r,h,c,d,m=this._levelRects[i];if(this.minLevel&&i<this.minLevel||this.maxLevel&&i>this.maxLevel)return!1;if(!m||!m.length)return!0;for(d=m.length-1;0<=d;d--)if(!(i<(o=m[d]).minLevel||i>o.maxLevel)&&(c=this.getLevelScale(i),h=(l=o.x*c)+o.width*c,c=(r=o.y*c)+o.height*c,l=Math.floor(l/this._tileWidth),r=Math.floor(r/this._tileWidth),h=Math.ceil(h/this._tileWidth),c=Math.ceil(c/this._tileWidth),l<=n&&n<h&&r<=a&&a<c))return!0;return!1}})}(OpenSeadragon),function(t){function e(n){var a=Array.isArray(n.profile)?n.profile[0]:n.profile,o=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(a);return a=!1,2===n.version&&1<n.profile.length&&n.profile[1].supports&&(a=-1!==n.profile[1].supports.indexOf("sizeByW")),3===n.version&&n.extraFeatures&&(a=-1!==n.extraFeatures.indexOf("sizeByWh")),!o||a}function i(n){for(var a=[],o=0;o<n.sizes.length;o++)a.push({url:n._id+"/full/"+n.sizes[o].width+","+(3===n.version?n.sizes[o].height:"")+"/0/default."+n.tileFormat,width:n.sizes[o].width,height:n.sizes[o].height});return a.sort(function(l,r){return l.width-r.width})}t.IIIFTileSource=function(n){if(t.extend(!0,this,n),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(n.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=n.version,this.tile_width&&this.tile_height)n.tileWidth=this.tile_width,n.tileHeight=this.tile_height;else if(this.tile_width)n.tileSize=this.tile_width;else if(this.tile_height)n.tileSize=this.tile_height;else if(this.tiles)if(1===this.tiles.length)n.tileWidth=this.tiles[0].width,n.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var a=0;a<this.tiles.length;a++)for(var o=0;o<this.tiles[a].scaleFactors.length;o++){var l=this.tiles[a].scaleFactors[o];this.scale_factors.push(l),n.tileSizePerScaleFactor[l]={width:this.tiles[a].width,height:this.tiles[a].height||this.tiles[a].width}}}else if(e(n)){for(var r=Math.min(this.height,this.width),h=[256,512,1024],c=[],d=0;d<h.length;d++)h[d]<=r&&c.push(h[d]);n.tileSize=0<c.length?Math.max.apply(null,c):r}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,n.levels=i(this),t.extend(!0,n,{width:n.levels[n.levels.length-1].width,height:n.levels[n.levels.length-1].height,tileSize:Math.max(n.height,n.width),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),this.levels=n.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!n.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var m=Math.max.apply(null,this.scale_factors);n.maxLevel=Math.round(Math.log(m)*Math.LOG2E)}else n.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));this.sizes&&((m=this.sizes.length)===n.maxLevel||m===n.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort((v,T)=>v.width-T.width),m===n.maxLevel&&this.levelSizes.push({width:this.width,height:this.height})),t.TileSource.apply(this,[n])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(n,a){return!!(n.protocol&&"http://iiif.io/api/image"===n.protocol||n["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"===n["@context"]||"http://iiif.io/api/image/1/context.json"===n["@context"])||n.profile&&0===n.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||n.identifier&&n.width&&n.height||n.documentElement&&"info"===n.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"===n.documentElement.namespaceURI)},configure:function(n,a,o){if(t.isPlainObject(n)){if(n["@context"]){var l=n["@context"];if(Array.isArray(l))for(var r=0;r<l.length;r++)if("string"==typeof l[r]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(l[r])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===l[r])){l=l[r];break}switch(l){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":n.version=1;break;case"http://iiif.io/api/image/2/context.json":n.version=2;break;case"http://iiif.io/api/image/3/context.json":n.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}else n["@context"]="http://iiif.io/api/image/1.0/context.json",n["@id"]=a.replace("/info.json",""),n.version=1;if(n.preferredFormats)for(var h=0;h<n.preferredFormats.length;h++)if(OpenSeadragon.imageFormatSupported(n.preferredFormats[h])){n.tileFormat=n.preferredFormats[h];break}return n}var c=function(T){if(!T||!T.documentElement)throw new Error(t.getString("Errors.Xml"));var m=T.documentElement;if(T=null,"info"===m.tagName)try{return function _(E,P,b){var C,z;if(3===E.nodeType&&b)(z=E.nodeValue.trim()).match(/^\d*$/)&&(z=Number(z)),P[b]?(t.isArray(P[b])||(P[b]=[P[b]]),P[b].push(z)):P[b]=z;else if(1===E.nodeType)for(C=0;C<E.childNodes.length;C++)_(E.childNodes[C],P,E.nodeName)}(m,T={}),T}catch(_){throw _ instanceof Error?_:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}(n);return c["@context"]="http://iiif.io/api/image/1.0/context.json",c["@id"]=a.replace("/info.xml",""),c.version=1,c},getTileWidth:function(n){return this.emulateLegacyImagePyramid?t.TileSource.prototype.getTileWidth.call(this,n):(n=Math.pow(2,this.maxLevel-n),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].width:this._tileWidth)},getTileHeight:function(n){return this.emulateLegacyImagePyramid?t.TileSource.prototype.getTileHeight.call(this,n):(n=Math.pow(2,this.maxLevel-n),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].height:this._tileHeight)},getLevelScale:function(n){if(this.emulateLegacyImagePyramid){return 0<this.levels.length&&n>=this.minLevel&&n<=this.maxLevel?this.levels[n].width/this.levels[this.maxLevel].width:NaN}return t.TileSource.prototype.getLevelScale.call(this,n)},getNumTiles:function(n){if(this.emulateLegacyImagePyramid)return this.getLevelScale(n)?new t.Point(1,1):new t.Point(0,0);if(this.levelSizes){var o=this.levelSizes[n],a=Math.ceil(o.width/this.getTileWidth(n));return o=Math.ceil(o.height/this.getTileHeight(n)),new t.Point(a,o)}return t.TileSource.prototype.getNumTiles.call(this,n)},getTileAtPoint:function(n,a){if(this.emulateLegacyImagePyramid)return new t.Point(0,0);if(this.levelSizes){var o=0<=a.x&&a.x<=1&&0<=a.y&&a.y<=1/this.aspectRatio;t.console.assert(o,"[TileSource.getTileAtPoint] must be called with a valid point.");var l=this.levelSizes[n].width;return o=a.x*l,l*=a.y,o=Math.floor(o/this.getTileWidth(n)),l=Math.floor(l/this.getTileHeight(n)),1<=a.x&&(o=this.getNumTiles(n).x-1),a.y>=1/this.aspectRatio-1e-15&&(l=this.getNumTiles(n).y-1),new t.Point(o,l)}return t.TileSource.prototype.getTileAtPoint.call(this,n,a)},getTileUrl:function(n,a,o){if(this.emulateLegacyImagePyramid){var l=null;return 0<this.levels.length&&n>=this.minLevel&&n<=this.maxLevel?this.levels[n].url:l}var r,h,c,d,m,v,T,_,E=Math.pow(.5,this.maxLevel-n);return this.levelSizes?(r=this.levelSizes[n].width,h=this.levelSizes[n].height):(r=Math.ceil(this.width*E),h=Math.ceil(this.height*E)),T=this.getTileWidth(n),_=this.getTileHeight(n),d=Math.round(T/E),m=Math.round(_/E),l=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,r<T&&h<_?(v=2===this.version&&r===this.width?"full":3===this.version&&r===this.width&&h===this.height?"max":3===this.version?r+","+h:r+",",c="full"):(n=a*d,E=o*m,d=Math.min(d,this.width-n),m=Math.min(m,this.height-E),c=0===a&&0===o&&d===this.width&&m===this.height?"full":[n,E,d,m].join(","),T=Math.min(T,r-a*T),_=Math.min(_,h-o*_),v=2===this.version&&T===this.width?"full":3===this.version&&T===this.width&&_===this.height?"max":3===this.version?T+","+_:T+","),[this._id,c,v,"0",l].join("/")},__testonly__:{canBeTiled:e,constructLevels:i}})}(OpenSeadragon),function(t){t.OsmTileSource=function(e,i,n,a,o){var l;(!(l=t.isPlainObject(e)?e:{width:e,height:i,tileSize:n,tileOverlap:a,tilesUrl:o}).width||!l.height)&&(l.width=65572864,l.height=65572864),l.tileSize||(l.tileSize=256,l.tileOverlap=0),l.tilesUrl||(l.tilesUrl="http://tile.openstreetmap.org/"),l.minLevel=8,t.TileSource.apply(this,[l])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&"openstreetmaps"===e.type},configure:function(e,i,n){return e},getTileUrl:function(e,i,n){return this.tilesUrl+(e-8)+"/"+i+"/"+n+".png"}})}(OpenSeadragon),function(t){t.TmsTileSource=function(e,i,n,a,o){var l;l=t.isPlainObject(e)?e:{width:e,height:i,tileSize:n,tileOverlap:a,tilesUrl:o};var h=256*Math.ceil(l.width/256),c=256*Math.ceil(l.height/256);l.maxLevel=Math.ceil(Math.log(c<h?h/256:c/256)/Math.log(2))-1,l.tileSize=256,l.width=h,l.height=c,t.TileSource.apply(this,[l])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&"tiledmapservice"===e.type},configure:function(e,i,n){return e},getTileUrl:function(e,i,n){var a=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+i+"/"+(a-n)+".png"}})}(OpenSeadragon),function(t){t.ZoomifyTileSource=function(e){void 0===e.tileSize&&(e.tileSize=256),void 0===e.fileFormat&&(e.fileFormat="jpg",this.fileFormat=e.fileFormat);var i={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(i.x,10)>e.tileSize||parseInt(i.y,10)>e.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),e.imageSizes.push({x:i.x,y:i.y}),e.gridSize.push(this._getGridSize(i.x,i.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(e,i,n){return{x:Math.ceil(e/n),y:Math.ceil(i/n)}},_calculateAbsoluteTileNumber:function(e,i,n){for(var a=0,o={},l=0;l<e;l++)a+=(o=this.gridSize[l]).x*o.y;return a+((o=this.gridSize[e]).x*n+i)},supports:function(e,i){return e.type&&"zoomifytileservice"===e.type},configure:function(e,i,n){return e},getTileUrl:function(e,i,n){var a=this._calculateAbsoluteTileNumber(e,i,n);return a=Math.floor(a/256),this.tilesUrl+"TileGroup"+a+"/"+e+"-"+i+"-"+n+"."+this.fileFormat}})}(OpenSeadragon),function(t){t.LegacyTileSource=function(e){var i,n,a;(i=t.isArray(e)?{type:"legacy-image-pyramid",levels:e}:i).levels=function(o){var l,r,h=[];for(r=0;r<o.length;r++)(l=o[r]).height&&l.width&&l.url?h.push({url:l.url,width:Number(l.width),height:Number(l.height)}):t.console.error("Unsupported image format: %s",l.url||"<no URL>");return h.sort(function(c,d){return c.height-d.height})}(i.levels),0<i.levels.length?(n=i.levels[i.levels.length-1].width,a=i.levels[i.levels.length-1].height):(a=n=0,t.console.error("No supported image formats found")),t.extend(!0,i,{width:n,height:a,tileSize:Math.max(a,n),tileOverlap:0,minLevel:0,maxLevel:0<i.levels.length?i.levels.length-1:0}),t.TileSource.apply(this,[i]),this.levels=i.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&"legacy-image-pyramid"===e.type||e.documentElement&&"legacy-image-pyramid"===e.documentElement.getAttribute("type")},configure:function(e,i,n){return t.isPlainObject(e)?e.levels:function(a){if(!a||!a.documentElement)throw new Error(t.getString("Errors.Xml"));var o,l,r=a.documentElement,h=r.tagName,c=null,d=[];if("image"===h)try{for(c={type:r.getAttribute("type"),levels:[]},d=r.getElementsByTagName("level"),l=0;l<d.length;l++)c.levels.push({url:(o=d[l]).getAttribute("url"),width:parseInt(o.getAttribute("width"),10),height:parseInt(o.getAttribute("height"),10)});return c.levels}catch(m){throw m instanceof Error?m:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"===h)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"===h)throw new Error("Error: "+a)}throw new Error("Unknown element "+h)}(e)},getLevelScale:function(e){return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].width/this.levels[this.maxLevel].width:NaN},getNumTiles:function(e){return this.getLevelScale(e)?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(e,i,n){return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].url:null}})}(OpenSeadragon),function(t){t.ImageTileSource=function(e){e=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1},e),t.TileSource.apply(this,[e])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&"image"===e.type},configure:function(e,i,n){return e},getImageInfo:function(e){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),t.addEvent(i,"load",function(){n.width=i.naturalWidth,n.height=i.naturalHeight,n.aspectRatio=n.width/n.height,n.dimensions=new t.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),t.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),i.src=e},getLevelScale:function(e){return e>=this.minLevel&&e<=this.maxLevel?this.levels[e].width/this.levels[this.maxLevel].width:NaN},getNumTiles:function(e){return this.getLevelScale(e)?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(e,i,n){return e>=this.minLevel&&e<=this.maxLevel?this.levels[e].url:null},getContext2D:function(e,i,n){return e>=this.minLevel&&e<=this.maxLevel?this.levels[e].context2D:null},destroy:function(e){this._freeupCanvasMemory(e)},_buildLevels:function(){var e=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!t.supportsCanvas)return delete this._image,e;var i=this._image.naturalWidth,n=this._image.naturalHeight,a=document.createElement("canvas"),o=a.getContext("2d");if(a.width=i,a.height=n,o.drawImage(this._image,0,0,i,n),e[0].context2D=o,delete this._image,t.isCanvasTainted(a))return e;for(;2<=i&&2<=n;){i=Math.floor(i/2),n=Math.floor(n/2);var l=document.createElement("canvas"),r=l.getContext("2d");l.width=i,l.height=n,r.drawImage(a,0,0,i,n),e.splice(0,0,{context2D:r,width:i,height:n}),a=l,o=r}return e},_freeupCanvasMemory:function(e){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D&&(this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0,e&&e.raiseEvent("image-unloaded",{context2D:this.levels[i].context2D}))}})}(OpenSeadragon),function(t){t.TileSourceCollection=function(e,i,n,a){t.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(t){function e(a){t.requestAnimationFrame(function(){var o,l;(o=a).shouldFade&&(l=t.now(),l=1-(l-=o.fadeBeginTime)/o.fadeLength,l=Math.min(1,l),l=Math.max(0,l),o.imgGroup&&t.setElementOpacity(o.imgGroup,l,!0),0<l&&e(o))})}function i(a,o){var l;a.element.disabled||(o>=t.ButtonState.GROUP&&a.currentState===t.ButtonState.REST&&((l=a).shouldFade=!1,l.imgGroup&&t.setElementOpacity(l.imgGroup,1,!0),a.currentState=t.ButtonState.GROUP),o>=t.ButtonState.HOVER&&a.currentState===t.ButtonState.GROUP&&(a.imgHover&&(a.imgHover.style.visibility=""),a.currentState=t.ButtonState.HOVER),o>=t.ButtonState.DOWN&&a.currentState===t.ButtonState.HOVER&&(a.imgDown&&(a.imgDown.style.visibility=""),a.currentState=t.ButtonState.DOWN))}function n(a,o){var l;a.element.disabled||(o<=t.ButtonState.HOVER&&a.currentState===t.ButtonState.DOWN&&(a.imgDown&&(a.imgDown.style.visibility="hidden"),a.currentState=t.ButtonState.HOVER),o<=t.ButtonState.GROUP&&a.currentState===t.ButtonState.HOVER&&(a.imgHover&&(a.imgHover.style.visibility="hidden"),a.currentState=t.ButtonState.GROUP),o<=t.ButtonState.REST&&a.currentState===t.ButtonState.GROUP&&((l=a).shouldFade=!0,l.fadeBeginTime=t.now()+l.fadeDelay,window.setTimeout(function(){e(l)},l.fadeDelay),a.currentState=t.ButtonState.REST))}t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(a){var o=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},a),this.element=a.element||t.makeNeutralElement("div"),a.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,t.setElementPointerEventsNone(this.imgRest),t.setElementPointerEventsNone(this.imgGroup),t.setElementPointerEventsNone(this.imgHover),t.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(l){l.insideElementPressed?(i(o,t.ButtonState.DOWN),o.raiseEvent("enter",{originalEvent:l.originalEvent})):l.buttonDownAny||i(o,t.ButtonState.HOVER)},focusHandler:function(l){o.tracker.enterHandler(l),o.raiseEvent("focus",{originalEvent:l.originalEvent})},leaveHandler:function(l){n(o,t.ButtonState.GROUP),l.insideElementPressed&&o.raiseEvent("exit",{originalEvent:l.originalEvent})},blurHandler:function(l){o.tracker.leaveHandler(l),o.raiseEvent("blur",{originalEvent:l.originalEvent})},pressHandler:function(l){i(o,t.ButtonState.DOWN),o.raiseEvent("press",{originalEvent:l.originalEvent})},releaseHandler:function(l){l.insideElementPressed&&l.insideElementReleased?(n(o,t.ButtonState.HOVER),o.raiseEvent("release",{originalEvent:l.originalEvent})):l.insideElementPressed?n(o,t.ButtonState.GROUP):i(o,t.ButtonState.HOVER)},clickHandler:function(l){l.quick&&o.raiseEvent("click",{originalEvent:l.originalEvent})},keyHandler:function(l){13===l.keyCode?(o.raiseEvent("click",{originalEvent:l.originalEvent}),o.raiseEvent("release",{originalEvent:l.originalEvent}),l.preventDefault=!0):l.preventDefault=!1}}),n(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){i(this,t.ButtonState.GROUP)},notifyGroupExit:function(){n(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}})}(OpenSeadragon),function(t){t.ButtonGroup=function(e){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var i,n=this.buttons.concat([]),a=this;if(this.element=e.element||t.makeNeutralElement("div"),!e.group)for(this.element.style.display="inline-block",i=0;i<n.length;i++)this.element.appendChild(n[i].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(o){var l;for(l=0;l<a.buttons.length;l++)a.buttons[l].notifyGroupEnter()},leaveHandler:function(o){var l;if(!o.insideElementPressed)for(l=0;l<a.buttons.length;l++)a.buttons[l].notifyGroupExit()}})},t.ButtonGroup.prototype={addButton:function(e){this.buttons.push(e),this.element.appendChild(e.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var e=this.buttons.pop();this.element.removeChild(e.element),e.destroy()}this.tracker.destroy(),this.element=null}}}(OpenSeadragon),function(t){t.Rect=function(e,i,n,a,o){var l,r;this.x="number"==typeof e?e:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof a?a:0,this.degrees="number"==typeof o?o:0,this.degrees=t.positiveModulo(this.degrees,360),270<=this.degrees?(l=this.getTopRight(),this.x=l.x,this.y=l.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=270):180<=this.degrees?(l=this.getBottomRight(),this.x=l.x,this.y=l.y,this.degrees-=180):90<=this.degrees&&(l=this.getBottomLeft(),this.x=l.x,this.y=l.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=90)},t.Rect.fromSummits=function(e,i,n){var a=e.distanceTo(i),o=e.distanceTo(n);return n=i.minus(e),i=Math.atan(n.y/n.x),n.x<0?i+=Math.PI:n.y<0&&(i+=2*Math.PI),new t.Rect(e.x,e.y,a,o,i/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(e){return e instanceof t.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new t.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new t.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var i=this.getBoundingBox(),n=e.getBoundingBox(),a=Math.min(i.x,n.x),o=Math.min(i.y,n.y);return e=Math.max(i.x+i.width,n.x+n.width),n=Math.max(i.y+i.height,n.y+n.height),new t.Rect(a,o,e-a,n-o)},intersection:function(e){var b,C,z,I,O,G,i=1e-10,n=[],a=this.getTopLeft();e.containsPoint(a,i)&&n.push(a),a=this.getTopRight(),e.containsPoint(a,i)&&n.push(a),a=this.getBottomLeft(),e.containsPoint(a,i)&&n.push(a),a=this.getBottomRight(),e.containsPoint(a,i)&&n.push(a),a=e.getTopLeft(),this.containsPoint(a,i)&&n.push(a),a=e.getTopRight(),this.containsPoint(a,i)&&n.push(a),a=e.getBottomLeft(),this.containsPoint(a,i)&&n.push(a),a=e.getBottomRight(),this.containsPoint(a,i)&&n.push(a);for(var o=this._getSegments(),l=e._getSegments(),r=0;r<o.length;r++)for(var h=o[r],c=0;c<l.length;c++){var d=l[c];z=d[0],I=d[1],void 0,void 0,O=(C=h[1]).minus(b=h[0]),(d=0==(C=-(G=I.minus(z)).x*O.y+O.x*G.y)?null:(I=(O.x*(b.y-z.y)-O.y*(b.x-z.x))/C,C=(G.x*(b.y-z.y)-G.y*(b.x-z.x))/C,-i<=I&&I<=1-i&&-i<=C&&C<=1-i?new t.Point(b.x+C*O.x,b.y+C*O.y):null))&&n.push(d)}if(0===n.length)return null;for(var m=n[0].x,v=n[0].x,T=n[0].y,_=n[0].y,E=1;E<n.length;E++){var P=n[E];P.x<m&&(m=P.x),P.x>v&&(v=P.x),P.y<T&&(T=P.y),P.y>_&&(_=P.y)}return new t.Rect(m,T,v-m,_-T)},_getSegments:function(){var e=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),a=this.getBottomRight();return[[e,i],[i,a],[a,n],[n,e]]},rotate:function(e,i){if(0===(e=t.positiveModulo(e,360)))return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(e,i);return e=(e=this.getTopRight().rotate(e,i).minus(n)).apply(function(a){return Math.abs(a)<1e-15?0:a}),i=Math.atan(e.y/e.x),e.x<0?i+=Math.PI:e.y<0&&(i+=2*Math.PI),new t.Rect(n.x,n.y,this.width,this.height,i/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var e=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),a=this.getBottomRight(),o=Math.min(e.x,i.x,n.x,a.x),l=Math.max(e.x,i.x,n.x,a.x),r=Math.min(e.y,i.y,n.y,a.y);return a=Math.max(e.y,i.y,n.y,a.y),new t.Rect(o,r,l-o,a-r)},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),i=Math.floor(e.x),n=Math.floor(e.y),a=Math.ceil(e.width+e.x-i);return e=Math.ceil(e.height+e.y-n),new t.Rect(i,n,a,e)},containsPoint:function(e,i){i=i||0;var n=this.getTopLeft(),a=this.getTopRight(),o=this.getBottomLeft(),l=a.minus(n),r=o.minus(n);return(e.x-n.x)*l.x+(e.y-n.y)*l.y>=-i&&(e.x-a.x)*l.x+(e.y-a.y)*l.y<=i&&(e.x-n.x)*r.x+(e.y-n.y)*r.y>=-i&&(e.x-o.x)*r.x+(e.y-o.y)*r.y<=i},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(t){var e={};function i(d){d.quick&&(d="horizontal"===this.scroll?Math.floor(d.position.x/(this.panelWidth+4)):Math.floor(d.position.y/this.panelHeight),this.viewer.goToPage(d)),this.element.focus()}function n(d){if(this.dragging=!0,this.element){var m=Number(this.element.style.marginLeft.replace("px","")),v=Number(this.element.style.marginTop.replace("px","")),T=Number(this.element.style.width.replace("px","")),_=Number(this.element.style.height.replace("px","")),E=t.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?0<-d.delta.x?m>-(T-E.x)&&(this.element.style.marginLeft=m+2*d.delta.x+"px",o(this,E.x,m+2*d.delta.x)):-d.delta.x<0&&m<0&&(this.element.style.marginLeft=m+2*d.delta.x+"px",o(this,E.x,m+2*d.delta.x)):0<-d.delta.y?v>-(_-E.y)&&(this.element.style.marginTop=v+2*d.delta.y+"px",o(this,E.y,v+2*d.delta.y)):-d.delta.y<0&&v<0&&(this.element.style.marginTop=v+2*d.delta.y+"px",o(this,E.y,v+2*d.delta.y))}}function a(d){if(this.element){var m=Number(this.element.style.marginLeft.replace("px","")),v=Number(this.element.style.marginTop.replace("px","")),T=Number(this.element.style.width.replace("px","")),_=Number(this.element.style.height.replace("px","")),E=t.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?0<d.scroll?m>-(T-E.x)&&(this.element.style.marginLeft=m-60*d.scroll+"px",o(this,E.x,m-60*d.scroll)):d.scroll<0&&m<0&&(this.element.style.marginLeft=m-60*d.scroll+"px",o(this,E.x,m-60*d.scroll)):d.scroll<0?v>E.y-_&&(this.element.style.marginTop=v+60*d.scroll+"px",o(this,E.y,v+60*d.scroll)):0<d.scroll&&v<0&&(this.element.style.marginTop=v+60*d.scroll+"px",o(this,E.y,v+60*d.scroll)),d.preventDefault=!0}}function o(d,m,v){var T,_,E,P,b;for(T="horizontal"===d.scroll?d.panelWidth:d.panelHeight,_=Math.ceil(m/T)+5,P=_=(_=(E=Math.ceil((Math.abs(v)+m)/T)+1)-_)<0?0:_;P<E&&P<d.panels.length;P++)if(!(b=d.panels[P]).activePanel){var C=d.viewer.tileSources[P];C=new t.Viewer({id:b.id,tileSources:[C=C.referenceStripThumbnailUrl?{type:"image",url:C.referenceStripThumbnailUrl}:C],element:b,navigatorSizeRatio:d.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:d.viewer.loadTilesWithAjax,ajaxHeaders:d.viewer.ajaxHeaders,drawer:"canvas"}),t.setElementPointerEventsNone(C.canvas),t.setElementPointerEventsNone(C.container),C.innerTracker.setTracking(!1),C.outerTracker.setTracking(!1),d.miniViewers[b.id]=C,b.activePanel=!0}}function l(d){d=d.eventSource.element,"horizontal"===this.scroll?d.style.marginBottom="0px":d.style.marginLeft="0px"}function r(d){d=d.eventSource.element,"horizontal"===this.scroll?d.style.marginBottom="-"+t.getElementSize(d).y/2+"px":d.style.marginLeft="-"+t.getElementSize(d).x/2+"px"}function h(d){if(d.ctrl||d.alt||d.meta)d.preventDefault=!1;else switch(d.keyCode){case 38:case 39:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 40:case 37:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1}}function c(d){if(d.ctrl||d.alt||d.meta)d.preventDefault=!1;else switch(d.keyCode){case 61:case 48:case 119:case 87:case 100:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 45:case 115:case 83:case 97:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1}}t.ReferenceStrip=function(d){var m,v,T,_=d.viewer,E=t.getElementSize(_.element);for(d.id||(d.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element}),t.extend(this,d),e[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,(v=this.element.style).marginTop="0px",v.marginRight="0px",v.marginBottom="0px",v.marginLeft="0px",v.left="0px",v.bottom="0px",v.border="0px",v.background="#000",v.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=_,this.tracker=new t.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:t.delegate(this,i),dragHandler:t.delegate(this,n),scrollHandler:t.delegate(this,a),enterHandler:t.delegate(this,l),leaveHandler:t.delegate(this,r),keyDownHandler:t.delegate(this,h),keyHandler:t.delegate(this,c),preProcessEventHandler:function(P){"wheel"===P.eventType&&(P.preventDefault=!0)}}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",_.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):"horizontal"===d.scroll?(this.element.style.width=E.x*d.sizeRatio*_.tileSources.length+12*_.tileSources.length+"px",this.element.style.height=E.y*d.sizeRatio+"px",_.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=E.y*d.sizeRatio*_.tileSources.length+12*_.tileSources.length+"px",this.element.style.width=E.x*d.sizeRatio+"px",_.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=E.x*this.sizeRatio+8,this.panelHeight=E.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},T=0;T<_.tileSources.length;T++)(m=t.makeNeutralElement("div")).id=this.element.id+"-"+T,m.style.width=this.panelWidth+"px",m.style.height=this.panelHeight+"px",m.style.display="inline",m.style.float="left",m.style.cssFloat="left",m.style.padding="2px",t.setElementTouchActionNone(m),t.setElementPointerEventsNone(m),this.element.appendChild(m),m.activePanel=!1,this.panels.push(m);o(this,"vertical"===this.scroll?E.y:E.x,0),this.setFocus(0)},t.ReferenceStrip.prototype={setFocus:function(d){var m,v=this.element.querySelector("#"+this.element.id+"-"+d),T=t.getElementSize(this.viewer.canvas),_=Number(this.element.style.width.replace("px","")),E=Number(this.element.style.height.replace("px","")),P=-Number(this.element.style.marginLeft.replace("px","")),b=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==v&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=v,this.currentSelected.style.background="#999","horizontal"===this.scroll?(m=Number(d)*(this.panelWidth+3))>P+T.x-this.panelWidth?(m=Math.min(m,_-T.x),this.element.style.marginLeft=-m+"px",o(this,T.x,-m)):m<P&&(m=Math.max(0,m-T.x/2),this.element.style.marginLeft=-m+"px",o(this,T.x,-m)):(m=Number(d)*(this.panelHeight+3))>b+T.y-this.panelHeight?(m=Math.min(m,E-T.y),this.element.style.marginTop=-m+"px",o(this,T.y,-m)):m<b&&(m=Math.max(0,m-T.y/2),this.element.style.marginTop=-m+"px",o(this,T.y,-m)),this.currentPage=d,l.call(this,{eventSource:this.tracker}))},update:function(){return!!e[this.id].animating},destroy:function(){if(this.miniViewers)for(var d in this.miniViewers)this.miniViewers[d].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}}}(OpenSeadragon),function(t){t.DisplayRect=function(e,i,n,a,o,l){t.Rect.apply(this,[e,i,n,a]),this.minLevel=o,this.maxLevel=l},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(OpenSeadragon),function(t){t.Spring=function(e){var i=arguments;"object"!=typeof e&&(e={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:1<i.length?i[1].springStiffness:5,animationTime:1<i.length?i[1].animationTime:1.5}),t.console.assert("number"==typeof e.springStiffness&&0!==e.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert("number"==typeof e.animationTime&&0<=e.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),e.exponential&&(this._exponential=!0,delete e.exponential),t.extend(!0,this,e),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(e){t.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=e,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(e){t.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(e){this.start.value+=e,this.target.value+=e,this._exponential&&(t.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(e){this._exponential=e,this._exponential&&(t.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){let e,i;var n;return this.current.time=t.now(),this._exponential?(e=this.start._logValue,i=this.target._logValue):(e=this.start.value,i=this.target.value),this.current.time>=this.target.time?this.current.value=this.target.value:(n=e+(i-e)*(n=this.springStiffness,(1-Math.exp(n*(-(this.current.time-this.start.time)/(this.target.time-this.start.time))))/(1-Math.exp(-n))),this.current.value=this._exponential?Math.exp(n):n),this.current.value!==this.target.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(t){t.ImageJob=function(e){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},e),this.data=null,this.userData={},this.errorMsg=null},t.ImageJob.prototype={start:function(){this.tries++;var e=this,i=this.abort;this.jobId=window.setTimeout(function(){e.finish(null,null,"Image load exceeded timeout ("+e.timeout+" ms)")},this.timeout),this.abort=function(){e.source.downloadTileAbort(e),"function"==typeof i&&i()},this.source.downloadTileStart(this)},finish:function(e,i,n){this.data=e,this.request=i,this.errorMsg=n,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(e){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},e)},t.ImageLoader.prototype={addJob:function(e){e.source||(t.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource."),e.source={downloadTileStart:(n=t.TileSource.prototype).downloadTileStart,downloadTileAbort:n.downloadTileAbort});var i=this,n=new t.ImageJob(n={src:e.src,tile:e.tile||{},source:e.source,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.loadWithAjax?e.ajaxHeaders:null,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,postData:e.postData,callback:function(a){var o,l,r,h;o=i,r=e.callback,""!==(l=a).errorMsg&&null==l.data&&l.tries<1+o.tileRetryMax&&o.failedTiles.push(l),o.jobsInProgress--,(!o.jobLimit||o.jobsInProgress<o.jobLimit)&&0<o.jobQueue.length&&((h=o.jobQueue.shift()).start(),o.jobsInProgress++),0<o.tileRetryMax&&0===o.jobQueue.length&&(!o.jobLimit||o.jobsInProgress<o.jobLimit)&&0<o.failedTiles.length&&(h=o.failedTiles.shift(),setTimeout(function(){h.start()},o.tileRetryDelay),o.jobsInProgress++),r(l.data,l.errorMsg,l.request)},abort:e.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(n.start(),this.jobsInProgress++):this.jobQueue.push(n)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var i=this.jobQueue[e];"function"==typeof i.abort&&i.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(t){t.Tile=function(e,i,n,a,o,l,r,h,c,d,m,v){this.level=e,this.x=i,this.y=n,this.bounds=a,this.positionedBounds=new OpenSeadragon.Rect(a.x,a.y,a.width,a.height),this.sourceBounds=d,this.exists=o,this._url=l,this.postData=m,this.context2D=r,this.loadWithAjax=h,this.ajaxHeaders=c,void 0===v&&(t.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),v=t.TileSource.prototype.getTileHashKey(e,i,n,l,c,m)),this.cacheKey=v,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},get image(){return t.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return t.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return"function"==typeof this._url?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord&&this.cacheImageRecord.getRenderedContext()},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;e=this.context2D}return e.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,i,n){var a=Math.max(1,Math.ceil((n.x-i.x)/2));return i=Math.max(1,Math.ceil((n.y-i.y)/2)),new t.Point(a,i).minus(this.position.times(t.pixelDensityRatio).times(e||1).apply(function(o){return o%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(e,i,n){n=t.isPlainObject(e)?e:{element:e,location:i,placement:n},this.elementWrapper=document.createElement("div"),this.element=n.element,this.elementWrapper.appendChild(this.element),this.elementWrapper.id=this.element.id?"overlay-wrapper-"+this.element.id:"overlay-wrapper",this.style=this.elementWrapper.style,this._init(n)},t.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=void 0===e.placement?t.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=void 0===e.checkResize||e.checkResize,this.width=void 0===e.width?null:e.width,this.height=void 0===e.height?null:e.height,this.rotationMode=e.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,i){var n=t.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?e.x-=i.x/2:n.isRight&&(e.x-=i.x),n.isVerticallyCentered?e.y-=i.y/2:n.isBottom&&(e.y-=i.y))},destroy:function(){var e=this.elementWrapper,i=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(i.display="none",document.body.appendChild(e))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var n=t.getCssPropertyWithVendorPrefix("transformOrigin");e=t.getCssPropertyWithVendorPrefix("transform"),n&&e&&(i[n]="",i[e]="")},drawHTML:function(e,i){var n=this.elementWrapper;n.parentNode!==e&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,e.appendChild(n),this.style.position="absolute",this.size=t.getElementSize(this.elementWrapper));var a=this._getOverlayPositionAndSize(i),o=a.position,l=this.size=a.size,r="";i.overlayPreserveContentDirection&&(r=i.flipped?" scaleX(-1)":" scaleX(1)");var h=i.flipped?-a.rotate:a.rotate;e=i.flipped?" scaleX(-1)":"",this.onDraw?this.onDraw(o,l,this.element):(n=this.style,(a=this.element.style).display="block",n.left=o.x+"px",n.top=o.y+"px",null!==this.width&&(a.width=l.x+"px"),null!==this.height&&(a.height=l.y+"px"),o=t.getCssPropertyWithVendorPrefix("transformOrigin"),l=t.getCssPropertyWithVendorPrefix("transform"),o&&l&&(h&&!i.flipped?(a[l]="",n[o]=this._getTransformOrigin(),n[l]="rotate("+h+"deg)"):!h&&i.flipped?(a[l]=r,n[o]=this._getTransformOrigin(),n[l]=e):h&&i.flipped?(a[l]=r,n[o]=this._getTransformOrigin(),n[l]="rotate("+h+"deg)"+e):(a[l]="",n[o]="",n[l]="")),n.display="flex")},_getOverlayPositionAndSize:function(e){var i=e.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(e);this.adjust(i,n);var a=0;if(e.getRotation(!0)&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var o=new t.Rect(i.x,i.y,n.x,n.y);i=(o=this._getBoundingBox(o,e.getRotation(!0))).getTopLeft(),n=o.getSize()}else a=e.getRotation(!0);return e.flipped&&(i.x=e.getContainerSize().x-i.x),{position:i,size:n,rotate:a}},_getSizeInPixels:function(e){var i=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var a=e.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=a.x),null!==this.height&&(n=a.y)}return this.checkResize&&(null===this.width||null===this.height)&&(a=this.size=t.getElementSize(this.elementWrapper),null===this.width&&(i=a.x),null===this.height&&(n=a.y)),new t.Point(i,n)},_getBoundingBox:function(e,i){var n=this._getPlacementPoint(e);return e.rotate(i,n).getBoundingBox()},_getPlacementPoint:function(e){var i=new t.Point(e.x,e.y),n=t.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=e.width/2:n.isRight&&(i.x+=e.width),n.isVerticallyCentered?i.y+=e.height/2:n.isBottom&&(i.y+=e.height)),i},_getTransformOrigin:function(){var e="",i=t.Placement.properties[this.placement];return i&&(i.isLeft?e="left":i.isRight&&(e="right"),i.isTop?e+=" top":i.isBottom&&(e+=" bottom")),e},update:function(e,i){i=t.isPlainObject(e)?e:{location:e,placement:i},this._init({location:i.location||this.location,placement:(void 0!==i.placement?i:this).placement,onDraw:i.onDraw||this.onDraw,checkResize:i.checkResize||this.checkResize,width:(void 0!==i.width?i:this).width,height:(void 0!==i.height?i:this).height,rotationMode:i.rotationMode||this.rotationMode})},getBounds:function(e){t.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(null===i||null===n){var a=e.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=a.x),null===n&&(n=a.y)}return a=this.location.clone(),this.adjust(a,new t.Point(i,n)),this._adjustBoundsForRotation(e,new t.Rect(a.x,a.y,i,n))},_adjustBoundsForRotation:function(e,i){return e&&0!==e.getRotation(!0)&&this.rotationMode!==t.OverlayRotationMode.EXACT?this.rotationMode!==t.OverlayRotationMode.BOUNDING_BOX?i.rotate(-e.getRotation(!0),this._getPlacementPoint(i)):null===this.width||null===this.height?i:(i=this._getOverlayPositionAndSize(e),e.viewerElementToViewportRectangle(new t.Rect(i.position.x,i.position.y,i.size.x,i.size.y))):i}}}(OpenSeadragon),function(t){const e=t;e.DrawerBase=class{constructor(i){t.console.assert(i.viewer,"[Drawer] options.viewer is required"),t.console.assert(i.viewport,"[Drawer] options.viewport is required"),t.console.assert(i.element,"[Drawer] options.element is required"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor="string"==typeof i.debugGridColor?[i.debugGridColor]:i.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,this.options=i.options||{},this.container=t.getElement(i.element),this._renderingTarget=this._createDrawingElement(),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.canvas.style.left="0",t.setElementOpacity(this.canvas,this.viewer.opacity,!0),t.setElementPointerEventsNone(this.canvas),t.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._checkForAPIOverrides()}get canvas(){return this._renderingTarget}get element(){return t.console.error("Drawer.element is deprecated. Use Drawer.container instead."),this.container}getType(){t.console.error("Drawer.getType must be implemented by child class")}static isSupported(){t.console.error("Drawer.isSupported must be implemented by child class")}_createDrawingElement(){return t.console.error("Drawer._createDrawingElement must be implemented by child class"),null}draw(i){t.console.error("Drawer.draw must be implemented by child class")}canRotate(){t.console.error("Drawer.canRotate must be implemented by child class")}destroy(){t.console.error("Drawer.destroy must be implemented by child class")}minimumOverlapRequired(i){return!1}setImageSmoothingEnabled(i){t.console.error("Drawer.setImageSmoothingEnabled must be implemented by child class")}drawDebuggingRect(i){t.console.warn("[drawer].drawDebuggingRect is not implemented by this drawer")}clear(){t.console.warn("[drawer].clear() is deprecated. The drawer is responsible for clearing itself as needed before drawing tiles.")}_checkForAPIOverrides(){if(this._createDrawingElement===t.DrawerBase.prototype._createDrawingElement)throw new Error("[drawer]._createDrawingElement must be implemented by child class");if(this.draw===t.DrawerBase.prototype.draw)throw new Error("[drawer].draw must be implemented by child class");if(this.canRotate===t.DrawerBase.prototype.canRotate)throw new Error("[drawer].canRotate must be implemented by child class");if(this.destroy===t.DrawerBase.prototype.destroy)throw new Error("[drawer].destroy must be implemented by child class");if(this.setImageSmoothingEnabled===t.DrawerBase.prototype.setImageSmoothingEnabled)throw new Error("[drawer].setImageSmoothingEnabled must be implemented by child class")}viewportToDrawerRectangle(i){var n=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0);return i=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0),new t.Rect(n.x*t.pixelDensityRatio,n.y*t.pixelDensityRatio,i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio)}viewportCoordToDrawerCoord(i){return i=this.viewport.pixelFromPointNoRotate(i,!0),new t.Point(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio)}_calculateCanvasSize(){var i=t.pixelDensityRatio,n=this.viewport.getContainerSize();return new e.Point(Math.round(n.x*i),Math.round(n.y*i))}_raiseTiledImageDrawnEvent(i,n){this.viewer&&this.viewer.raiseEvent("tiled-image-drawn",{tiledImage:i,tiles:n})}_raiseDrawerErrorEvent(i,n){this.viewer&&this.viewer.raiseEvent("drawer-error",{tiledImage:i,drawer:this,error:n})}}}(OpenSeadragon),function(t){var e=t;t.HTMLDrawer=class i extends e.DrawerBase{constructor(a){super(a),this.viewer.rejectEventHandler("tile-drawing","The HTMLDrawer does not raise the tile-drawing event"),this.viewer.allowEventHandler("tile-drawn")}static isSupported(){return!0}getType(){return"html"}minimumOverlapRequired(a){return!0}_createDrawingElement(){return t.makeNeutralElement("div")}draw(a){var o=this;this._prepareNewFrame(),a.forEach(function(l){0!==l.opacity&&o._drawTiles(l)})}canRotate(){return!1}destroy(){this.container.removeChild(this.canvas)}setImageSmoothingEnabled(){}_prepareNewFrame(){this.canvas.innerHTML=""}_drawTiles(a){var o=a.getTilesToDraw().map(h=>h.tile);if(0!==a.opacity&&(0!==o.length||a.placeholderFillStyle))for(var l=o.length-1;0<=l;l--){var r=o[l];this._drawTile(r),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:a,tile:r})}}_drawTile(a){t.console.assert(a,"[Drawer._drawTile] tile is required");let o=this.canvas;if(a.cacheImageRecord)if(a.loaded){if(!a.element){var l=a.getImage();if(!l)return;a.element=t.makeNeutralElement("div"),a.imgElement=l.cloneNode(),a.imgElement.style.msInterpolationMode="nearest-neighbor",a.imgElement.style.width="100%",a.imgElement.style.height="100%",a.style=a.element.style,a.style.position="absolute"}a.element.parentNode!==o&&o.appendChild(a.element),a.imgElement.parentNode!==a.element&&a.element.appendChild(a.imgElement),a.style.top=a.position.y+"px",a.style.left=a.position.x+"px",a.style.height=a.size.y+"px",a.style.width=a.size.x+"px",a.flipped&&(a.style.transform="scaleX(-1)"),t.setElementOpacity(a.element,a.opacity)}else t.console.warn("Attempting to draw tile %s when it's not yet loaded.",a.toString());else t.console.warn("[Drawer._drawTileToHTML] attempting to draw tile %s when it's not cached",a.toString())}}}(OpenSeadragon),function(t){var e=t;t.CanvasDrawer=class i extends e.DrawerBase{constructor(r){super(r),this.context=this.canvas.getContext("2d"),this.sketchCanvas=null,this.sketchContext=null,this._imageSmoothingEnabled=!0,this.viewer.allowEventHandler("tile-drawn"),this.viewer.allowEventHandler("tile-drawing")}static isSupported(){return t.supportsCanvas}getType(){return"canvas"}_createDrawingElement(){let r=t.makeNeutralElement("canvas");var h=this._calculateCanvasSize();return r.width=h.x,r.height=h.y,r}draw(r){this._prepareNewFrame(),this.viewer.viewport.getFlip()!==this._viewportFlipped&&this._flip();for(const h of r)0!==h.opacity&&this._drawTiles(h)}canRotate(){return!0}destroy(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null,this.container.removeChild(this.canvas)}minimumOverlapRequired(r){return!0}setImageSmoothingEnabled(r){this._imageSmoothingEnabled=!!r,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw()}drawDebuggingRect(r){var h=this.context;h.save(),h.lineWidth=2*t.pixelDensityRatio,h.strokeStyle=this.debugGridColor[0],h.fillStyle=this.debugGridColor[0],h.strokeRect(r.x*t.pixelDensityRatio,r.y*t.pixelDensityRatio,r.width*t.pixelDensityRatio,r.height*t.pixelDensityRatio),h.restore()}get _viewportFlipped(){return this.context.getTransform().a<0}_raiseTileDrawingEvent(r,h,c,d){this.viewer.raiseEvent("tile-drawing",{tiledImage:r,context:h,tile:c,rendered:d})}_prepareNewFrame(){var r=this._calculateCanvasSize();(this.canvas.width!==r.x||this.canvas.height!==r.y)&&(this.canvas.width=r.x,this.canvas.height=r.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(r=this._calculateSketchCanvasSize(),this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear()}_clear(r,h){r=this._getContext(r),h?r.clearRect(h.x,h.y,h.width,h.height):r.clearRect(0,0,(h=r.canvas).width,h.height)}_drawTiles(r){var h=r.getTilesToDraw().map(I=>I.tile);if(0!==r.opacity&&(0!==h.length||r.placeholderFillStyle)){var d,c=h[0];c&&(d=r.opacity<1||r.compositeOperation&&"source-over"!==r.compositeOperation||!r._isBottomItem()&&r.source.hasTransparency(c.context2D,c.getUrl(),c.ajaxHeaders,c.postData));var m,v,E,T=this.viewport.getZoom(!0),_=r.viewportToImageZoom(T);if(1<h.length&&_>r.smoothTileEdgesMinZoom&&!r.iOSDevice&&r.getRotation(!0)%360==0&&(d=!0,m=c.getScaleForEdgeSmoothing(),v=c.getTranslationForEdgeSmoothing(m,this._getCanvasSize(!1),this._getCanvasSize(!0))),d&&(m||(E=(E=this.viewport.viewportToViewerElementRectangle(r.getClippedBounds(!0)).getIntegerBoundingBox()).times(t.pixelDensityRatio)),this._clear(!0,E)),m||this._setRotations(r,d),T=!1,r._clip&&(this._saveContext(d),_=(_=r.imageToViewportRectangle(r._clip,!0)).rotate(-r.getRotation(!0),r._getRotationPoint(!0)),_=this.viewportToDrawerRectangle(_),m&&(_=_.times(m)),v&&(_=_.translate(v)),this._setClip(_,d),T=!0),r._croppingPolygons){var P=this;T||this._saveContext(d);try{var b=r._croppingPolygons.map(function(I){return I.map(function(O){return O=r.imageToViewportCoordinates(O.x,O.y,!0).rotate(-r.getRotation(!0),r._getRotationPoint(!0)),O=P.viewportCoordToDrawerCoord(O),m&&(O=O.times(m)),v?O.plus(v):O})});this._clipWithPolygons(b,d)}catch(I){t.console.error(I)}T=!0}if(r._hasOpaqueTile=!1,r.placeholderFillStyle&&!1===r._hasOpaqueTile){let I=this.viewportToDrawerRectangle(r.getBoundsNoRotate(!0));m&&(I=I.times(m)),v&&(I=I.translate(v));let O=null;O="function"==typeof r.placeholderFillStyle?r.placeholderFillStyle(r,this.context):r.placeholderFillStyle,this._drawRectangle(I,O,d)}var C=!1;(b=function(I){if("number"==typeof I)return o(I);if(!I||!t.Browser)return n;var O=I[t.Browser.vendor];return a(O)&&(O=I["*"]),o(O)}(r.subPixelRoundingForTransparency))===t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS?C=!0:b===t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&(C=!(this.viewer&&this.viewer.isAnimating()));for(var z=0;z<h.length;z++)this._drawTile(c=h[z],r,d,m,v,C,r.source),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:r,tile:c});T&&this._restoreContext(d),m||(r.getRotation(!0)%360!=0&&this._restoreRotationChanges(d),this.viewport.getRotation(!0)%360!=0&&this._restoreRotationChanges(d)),d&&(m&&this._setRotations(r),this.blendSketch({opacity:r.opacity,scale:m,translate:v,compositeOperation:r.compositeOperation,bounds:E}),m&&(r.getRotation(!0)%360!=0&&this._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!=0&&this._restoreRotationChanges(!1))),this._drawDebugInfo(r,h),this._raiseTiledImageDrawnEvent(r,h)}}_drawDebugInfo(r,h){if(r.debugMode)for(var c=h.length-1;0<=c;c--){var d=h[c];try{this._drawDebugInfoOnTile(d,h.length,c,r)}catch(m){t.console.error(m)}}}_clipWithPolygons(r,h){var c=this._getContext(h);c.beginPath();for(const v of r)for(var[d,m]of v.entries())c[0===d?"moveTo":"lineTo"](m.x,m.y);c.clip()}_drawTile(r,h,c,d,m,v,T){t.console.assert(r,"[Drawer._drawTile] tile is required"),t.console.assert(h,"[Drawer._drawTile] drawingHandler is required"),c=this._getContext(c),this._drawTileToCanvas(r,c,h,d=d||1,m,v,T)}_drawTileToCanvas(r,h,c,d,m,v,T){var _,E=r.position.times(t.pixelDensityRatio),P=r.size.times(t.pixelDensityRatio);if(r.context2D||r.cacheImageRecord)if(_=r.getCanvasContext(),r.loaded&&_){var b,C;h.save(),"number"==typeof d&&1!==d&&(E=E.times(d),P=P.times(d)),m instanceof t.Point&&(E=E.plus(m)),1===h.globalAlpha&&r.hasTransparency&&(v&&(E.x=Math.round(E.x),E.y=Math.round(E.y),P.x=Math.round(P.x),P.y=Math.round(P.y)),h.clearRect(E.x,E.y,P.x,P.y)),this._raiseTileDrawingEvent(c,h,r,_),r.sourceBounds?(b=Math.min(r.sourceBounds.width,_.canvas.width),C=Math.min(r.sourceBounds.height,_.canvas.height)):(b=_.canvas.width,C=_.canvas.height),h.translate(E.x+P.x/2,0),r.flipped&&h.scale(-1,1),h.drawImage(_.canvas,0,0,b,C,-P.x/2,E.y,P.x,P.y),h.restore()}else t.console.warn("Attempting to draw tile %s when it's not yet loaded.",r.toString());else t.console.warn("[Drawer._drawTileToCanvas] attempting to draw tile %s when it's not cached",r.toString())}_getContext(r){var h=this.context;if(r){if(null===this.sketchCanvas){if(this.sketchCanvas=document.createElement("canvas"),r=this._calculateSketchCanvasSize(),this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var c=this;this.viewer.addHandler("rotate",function d(){if(0!==c.viewport.getRotation()){c.viewer.removeHandler("rotate",d);var m=c._calculateSketchCanvasSize();c.sketchCanvas.width=m.x,c.sketchCanvas.height=m.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}h=this.sketchContext}return h}_saveContext(r){this._getContext(r).save()}_restoreContext(r){this._getContext(r).restore()}_setClip(r,h){(h=this._getContext(h)).beginPath(),h.rect(r.x,r.y,r.width,r.height),h.clip()}_drawRectangle(r,h,c){(c=this._getContext(c)).save(),c.fillStyle=h,c.fillRect(r.x,r.y,r.width,r.height),c.restore()}blendSketch(r,h,c,d){var m=r;r=(m=t.isPlainObject(m)?m:{opacity:r,scale:h,translate:c,compositeOperation:d}).opacity,d=m.compositeOperation;var v=m.bounds;this.context.save(),this.context.globalAlpha=r,d&&(this.context.globalCompositeOperation=d),v?(v.x<0&&(v.width+=v.x,v.x=0),v.x+v.width>this.canvas.width&&(v.width=this.canvas.width-v.x),v.y<0&&(v.height+=v.y,v.y=0),v.y+v.height>this.canvas.height&&(v.height=this.canvas.height-v.y),this.context.drawImage(this.sketchCanvas,v.x,v.y,v.width,v.height,v.x,v.y,v.width,v.height)):(h=m.scale||1,r=(c=m.translate)instanceof t.Point?c:new t.Point(0,0),d=0,v=0,c&&(m=this.sketchCanvas.width-this.canvas.width,c=this.sketchCanvas.height-this.canvas.height,d=Math.round(m/2),v=Math.round(c/2)),this.context.drawImage(this.sketchCanvas,r.x-d*h,r.y-v*h,(this.canvas.width+2*d)*h,(this.canvas.height+2*v)*h,-d,-v,this.canvas.width+2*d,this.canvas.height+2*v)),this.context.restore()}_drawDebugInfoOnTile(r,h,c,d){var m=this.viewer.world.getIndexOfItem(d)%this.debugGridColor.length,v=this.context;v.save(),v.lineWidth=2*t.pixelDensityRatio,v.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",v.strokeStyle=this.debugGridColor[m],v.fillStyle=this.debugGridColor[m],this._setRotations(d),this._viewportFlipped&&this._flip({point:r.position.plus(r.size.divide(2))}),v.strokeRect(r.position.x*t.pixelDensityRatio,r.position.y*t.pixelDensityRatio,r.size.x*t.pixelDensityRatio,r.size.y*t.pixelDensityRatio);var T=(r.position.x+r.size.x/2)*t.pixelDensityRatio,_=(r.position.y+r.size.y/2)*t.pixelDensityRatio;v.translate(T,_),m=this.viewport.getRotation(!0),v.rotate(Math.PI/180*-m),v.translate(-T,-_),0===r.x&&0===r.y&&(v.fillText("Zoom: "+this.viewport.getZoom(),r.position.x*t.pixelDensityRatio,(r.position.y-30)*t.pixelDensityRatio),v.fillText("Pan: "+this.viewport.getBounds().toString(),r.position.x*t.pixelDensityRatio,(r.position.y-20)*t.pixelDensityRatio)),v.fillText("Level: "+r.level,(r.position.x+10)*t.pixelDensityRatio,(r.position.y+20)*t.pixelDensityRatio),v.fillText("Column: "+r.x,(r.position.x+10)*t.pixelDensityRatio,(r.position.y+30)*t.pixelDensityRatio),v.fillText("Row: "+r.y,(r.position.x+10)*t.pixelDensityRatio,(r.position.y+40)*t.pixelDensityRatio),v.fillText("Order: "+c+" of "+h,(r.position.x+10)*t.pixelDensityRatio,(r.position.y+50)*t.pixelDensityRatio),v.fillText("Size: "+r.size.toString(),(r.position.x+10)*t.pixelDensityRatio,(r.position.y+60)*t.pixelDensityRatio),v.fillText("Position: "+r.position.toString(),(r.position.x+10)*t.pixelDensityRatio,(r.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!=0&&this._restoreRotationChanges(),d.getRotation(!0)%360!=0&&this._restoreRotationChanges(),v.restore()}_updateImageSmoothingEnabled(r){r.msImageSmoothingEnabled=this._imageSmoothingEnabled,r.imageSmoothingEnabled=this._imageSmoothingEnabled}_getCanvasSize(r){return r=this._getContext(r).canvas,new t.Point(r.width,r.height)}_getCanvasCenter(){return new t.Point(this.canvas.width/2,this.canvas.height/2)}_setRotations(r,h=!1){var c=!1;this.viewport.getRotation(!0)%360!=0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:h,saveContext:c}),c=!1),r.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:r.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(r._getRotationPoint(!0),!0),useSketch:h,saveContext:c})}_offsetForRotation(r){var h=r.point?r.point.times(t.pixelDensityRatio):this._getCanvasCenter(),c=this._getContext(r.useSketch);c.save(),c.translate(h.x,h.y),c.rotate(Math.PI/180*r.degrees),c.translate(-h.x,-h.y)}_flip(r){var h=(r=r||{}).point?r.point.times(t.pixelDensityRatio):this._getCanvasCenter();(r=this._getContext(r.useSketch)).translate(h.x,0),r.scale(-1,1),r.translate(-h.x,0)}_restoreRotationChanges(r){this._getContext(r).restore()}_calculateCanvasSize(){var r=t.pixelDensityRatio,h=this.viewport.getContainerSize();return{x:Math.round(h.x*r),y:Math.round(h.y*r)}}_calculateSketchCanvasSize(){var r=this._calculateCanvasSize();return 0===this.viewport.getRotation()?r:{x:r=Math.ceil(Math.sqrt(r.x*r.x+r.y*r.y)),y:r}}};var n=t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function a(l){return l!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&l!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&l!==t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function o(l){return a(l)?n:l}}(OpenSeadragon),function(t){const e=t;e.WebGLDrawer=class extends e.DrawerBase{constructor(i){super(i),this._destroyed=!1,this._TextureMap=new Map,this._TileMap=new Map,this._gl=null,this._firstPass=null,this._secondPass=null,this._glFrameBuffer=null,this._renderToTexture=null,this._glFramebufferToCanvasTransform=null,this._outputCanvas=null,this._outputContext=null,this._clippingCanvas=null,this._clippingContext=null,this._renderingCanvas=null,this._backupCanvasDrawer=null,this._imageSmoothingEnabled=!0,this._boundToTileReady=n=>this._tileReadyHandler(n),this._boundToImageUnloaded=n=>this._imageUnloadedHandler(n),this.viewer.addHandler("tile-ready",this._boundToTileReady),this.viewer.addHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.rejectEventHandler("tile-drawn","The WebGLDrawer does not raise the tile-drawn event"),this.viewer.rejectEventHandler("tile-drawing","The WebGLDrawer does not raise the tile-drawing event"),this._setupCanvases(),this._setupRenderer(),this.context=this._outputContext}destroy(){if(!this._destroyed){let n=this._gl;var i=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let o=0;o<i;++o)n.activeTexture(n.TEXTURE0+o),n.bindTexture(n.TEXTURE_2D,null),n.bindTexture(n.TEXTURE_CUBE_MAP,null);n.bindBuffer(n.ARRAY_BUFFER,null),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null),this._unloadTextures(),n.deleteBuffer(this._secondPass.bufferOutputPosition),n.deleteFramebuffer(this._glFrameBuffer),this._renderingCanvas.width=this._renderingCanvas.height=1,this._clippingCanvas.width=this._clippingCanvas.height=1,this._outputCanvas.width=this._outputCanvas.height=1,this._renderingCanvas=null,this._clippingCanvas=this._clippingContext=null,this._outputCanvas=this._outputContext=null;let a=n.getExtension("WEBGL_lose_context");a&&a.loseContext(),this.viewer.removeHandler("tile-ready",this._boundToTileReady),this.viewer.removeHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.removeHandler("resize",this._resizeHandler),this._gl=null,this._backupCanvasDrawer&&(this._backupCanvasDrawer.destroy(),this._backupCanvasDrawer=null),this.container.removeChild(this.canvas),this.viewer.drawer===this&&(this.viewer.drawer=null),this._destroyed=!0}}canRotate(){return!0}static isSupported(){let i=document.createElement("canvas"),n=t.isFunction(i.getContext)&&i.getContext("webgl"),a=n&&n.getExtension("WEBGL_lose_context");return a&&a.loseContext(),!!n}getType(){return"webgl"}minimumOverlapRequired(i){return i.isTainted()}_createDrawingElement(){let i=t.makeNeutralElement("canvas");var n=this._calculateCanvasSize();return i.width=n.x,i.height=n.y,i}_getBackupCanvasDrawer(){return this._backupCanvasDrawer||(this._backupCanvasDrawer=this.viewer.requestDrawer("canvas",{mainDrawer:!1}),this._backupCanvasDrawer.canvas.style.setProperty("visibility","hidden")),this._backupCanvasDrawer}draw(i){let n=this._gl;var a=this.viewport.getBoundsNoRotateWithMargins(!0);let o=a,l=new e.Point(a.x+a.width/2,a.y+a.height/2),r=this.viewport.getRotation(!0)*Math.PI/180;var h=this.viewport.flipped?-1:1;a=t.Mat3.makeTranslation(-l.x,-l.y);let c=t.Mat3.makeScaling(2/o.width*h,-2/o.height);h=t.Mat3.makeRotation(-r);let d=c.multiply(h).multiply(a);n.bindFramebuffer(n.FRAMEBUFFER,null),n.clear(n.COLOR_BUFFER_BIT),this._outputContext.clearRect(0,0,this._outputCanvas.width,this._outputCanvas.height);let m=!1;i.forEach((v,T)=>{if(v.isTainted()){m&&(this._outputContext.drawImage(this._renderingCanvas,0,0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.clear(n.COLOR_BUFFER_BIT),m=!1);const N=this._getBackupCanvasDrawer();N.draw([v]),this._outputContext.drawImage(N.canvas,0,0)}else{let N=v.getTilesToDraw();if(v.placeholderFillStyle&&!1===v._hasOpaqueTile&&this._drawPlaceholder(v),0!==N.length&&0!==v.getOpacity()){var _=N[0],E=v.compositeOperation||this.viewer.compositeOperation||v._clip||v._croppingPolygons||v.debugMode,P=E||v.opacity<1||_.hasTransparency;E&&(m&&this._outputContext.drawImage(this._renderingCanvas,0,0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.clear(n.COLOR_BUFFER_BIT)),n.useProgram(this._firstPass.shaderProgram),P?(n.bindFramebuffer(n.FRAMEBUFFER,this._glFrameBuffer),n.clear(n.COLOR_BUFFER_BIT)):n.bindFramebuffer(n.FRAMEBUFFER,null);let Q=d;var b=v.getRotation(!0);if(b%360!=0){_=t.Mat3.makeRotation(-b*Math.PI/180),b=v.getBoundsNoRotate(!0).getCenter();let U=t.Mat3.makeTranslation(b.x,b.y);b=t.Mat3.makeTranslation(-b.x,-b.y),b=U.multiply(_).multiply(b),Q=d.multiply(b)}var C=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);if(C<=0)throw new Error(`WegGL error: bad value for gl parameter MAX_TEXTURE_IMAGE_UNITS (${C}). This could happen\n                        if too many contexts have been created and not released, or there is another problem with the graphics card.`);var z=new Float32Array(12*C),I=new Array(C);let $=new Array(C);var O=new Array(C);for(let U=0;U<N.length;U++){let Y=N[U].tile;var G=U%C,K=1+G,X=Y.getCanvasContext();let Z=X?this._TextureMap.get(X.canvas):null;if(Z||(this._tileReadyHandler({tile:Y,tiledImage:v}),Z=X?this._TextureMap.get(X.canvas):null),Z&&this._getTileData(Y,v,Z,Q,G,z,I,$,O),K===C||U===N.length-1){for(let q=0;q<=K;q++)n.activeTexture(n.TEXTURE0+q),n.bindTexture(n.TEXTURE_2D,I[q]);n.bindBuffer(n.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),n.bufferData(n.ARRAY_BUFFER,z,n.DYNAMIC_DRAW),$.forEach((q,B)=>{n.uniformMatrix3fv(this._firstPass.uTransformMatrices[B],!1,q)}),n.uniform1fv(this._firstPass.uOpacities,new Float32Array(O)),n.bindBuffer(n.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),n.vertexAttribPointer(this._firstPass.aOutputPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),n.vertexAttribPointer(this._firstPass.aTexturePosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._firstPass.bufferIndex),n.vertexAttribPointer(this._firstPass.aIndex,1,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLES,0,6*K)}}P&&(n.useProgram(this._secondPass.shaderProgram),n.bindFramebuffer(n.FRAMEBUFFER,null),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._renderToTexture),this._gl.uniform1f(this._secondPass.uOpacityMultiplier,v.opacity),n.bindBuffer(n.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),n.vertexAttribPointer(this._secondPass.aTexturePosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),n.vertexAttribPointer(this._secondPass.aOutputPosition,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLES,0,6)),m=!0,E&&(this._applyContext2dPipeline(v,N,T),m=!1,n.bindFramebuffer(n.FRAMEBUFFER,null),n.clear(n.COLOR_BUFFER_BIT)),0===T&&this._raiseTiledImageDrawnEvent(v,N.map(U=>U.tile))}}}),m&&this._outputContext.drawImage(this._renderingCanvas,0,0)}setImageSmoothingEnabled(i){this._imageSmoothingEnabled!==i&&(this._imageSmoothingEnabled=i,this._unloadTextures(),this.viewer.world.draw())}drawDebuggingRect(i){let n=this._outputContext;n.save(),n.lineWidth=2*t.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,i.width*t.pixelDensityRatio,i.height*t.pixelDensityRatio),n.restore()}_getTextureDataFromTile(i){return i.getCanvasContext().canvas}_applyContext2dPipeline(i,n,a){this._outputContext.save(),this._outputContext.globalCompositeOperation=0===a?null:i.compositeOperation||this.viewer.compositeOperation,i._croppingPolygons||i._clip?(this._renderToClippingCanvas(i),this._outputContext.drawImage(this._clippingCanvas,0,0)):this._outputContext.drawImage(this._renderingCanvas,0,0),this._outputContext.restore(),i.debugMode&&((a=this.viewer.viewport.getFlip())&&this._flip(),this._drawDebugInfo(n,i,a),a&&this._flip())}_getTileData(i,n,a,o,l,r,h,c,d){var m=a.texture,v=a.position;r.set(v,12*l),a=this._calculateOverlapFraction(i,n),r=i.positionedBounds.width*a.x,v=i.positionedBounds.height*a.y,n=i.positionedBounds.x+(0===i.x?0:r),a=i.positionedBounds.y+(0===i.y?0:v);let T=new t.Mat3([(r=i.positionedBounds.x+i.positionedBounds.width-(i.isRightMost?0:r))-n,0,0,0,(v=i.positionedBounds.y+i.positionedBounds.height-(i.isBottomMost?0:v))-a,0,n,a,1]);if(i.flipped){let _=t.Mat3.makeTranslation(.5,0);a=t.Mat3.makeTranslation(-.5,0),a=_.multiply(t.Mat3.makeScaling(-1,1)).multiply(a),T=T.multiply(a)}o=o.multiply(T),d[l]=i.opacity,h[l]=m,c[l]=o.values}_textureFilter(){return this._imageSmoothingEnabled?this._gl.LINEAR:this._gl.NEAREST}_setupRenderer(){let i=this._gl;i||t.console.error("_setupCanvases must be called before _setupRenderer"),this._unitQuad=this._makeQuadVertexBuffer(0,1,0,1),this._makeFirstPassShaderProgram(),this._makeSecondPassShaderProgram(),this._renderToTexture=i.createTexture(),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._renderToTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this._renderingCanvas.width,this._renderingCanvas.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this._textureFilter()),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),this._glFrameBuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._glFrameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._renderToTexture,0),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA)}_makeFirstPassShaderProgram(){let i=this._glNumTextures=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);var n=`\n            attribute vec2 a_output_position;\n            attribute vec2 a_texture_position;\n            attribute float a_index;\n\n            ${[...Array(i).keys()].map(h=>`uniform mat3 u_matrix_${h};`).join("\n")} // create a uniform mat3 for each potential tile to draw\n\n            varying vec2 v_texture_position;\n            varying float v_image_index;\n\n            void main() {\n\n                mat3 transform_matrix; // value will be set by the if/elses in makeConditional()\n\n                ${[...Array(i).keys()].map(h=>`${0<h?"else ":""}if(int(a_index) == ${h}) { transform_matrix = u_matrix_${h}; }`).join("\n")}\n\n                gl_Position = vec4(transform_matrix * vec3(a_output_position, 1), 1);\n\n                v_texture_position = a_texture_position;\n                v_image_index = a_index;\n            }\n            `,a=`\n            precision mediump float;\n\n            // our textures\n            uniform sampler2D u_images[${i}];\n            // our opacities\n            uniform float u_opacities[${i}];\n\n            // the varyings passed in from the vertex shader.\n            varying vec2 v_texture_position;\n            varying float v_image_index;\n\n            void main() {\n                // can't index directly with a variable, need to use a loop iterator hack\n                for(int i = 0; i < ${i}; ++i){\n                    if(i == int(v_image_index)){\n                        gl_FragColor = texture2D(u_images[i], v_texture_position) * u_opacities[i];\n                    }\n                }\n            }\n            `;let o=this._gl,l=this.constructor.initShaderProgram(o,n,a);o.useProgram(l),this._firstPass={shaderProgram:l,aOutputPosition:o.getAttribLocation(l,"a_output_position"),aTexturePosition:o.getAttribLocation(l,"a_texture_position"),aIndex:o.getAttribLocation(l,"a_index"),uTransformMatrices:[...Array(this._glNumTextures).keys()].map(h=>o.getUniformLocation(l,"u_matrix_"+h)),uImages:o.getUniformLocation(l,"u_images"),uOpacities:o.getUniformLocation(l,"u_opacities"),bufferOutputPosition:o.createBuffer(),bufferTexturePosition:o.createBuffer(),bufferIndex:o.createBuffer()},o.uniform1iv(this._firstPass.uImages,[...Array(i).keys()]);let r=new Float32Array(12*i);for(let h=0;h<i;++h)r.set(Float32Array.from(this._unitQuad),12*h);o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),o.bufferData(o.ARRAY_BUFFER,r,o.STATIC_DRAW),o.enableVertexAttribArray(this._firstPass.aOutputPosition),o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),o.enableVertexAttribArray(this._firstPass.aTexturePosition),o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferIndex),a=[...Array(this._glNumTextures).keys()].map(h=>Array(6).fill(h)).flat(),o.bufferData(o.ARRAY_BUFFER,new Float32Array(a),o.STATIC_DRAW),o.enableVertexAttribArray(this._firstPass.aIndex)}_makeSecondPassShaderProgram(){let i=this._gl;var n=this.constructor.initShaderProgram(i,"\n            attribute vec2 a_output_position;\n            attribute vec2 a_texture_position;\n\n            uniform mat3 u_matrix;\n\n            varying vec2 v_texture_position;\n\n            void main() {\n                gl_Position = vec4(u_matrix * vec3(a_output_position, 1), 1);\n\n                v_texture_position = a_texture_position;\n            }\n            ","\n            precision mediump float;\n\n            // our texture\n            uniform sampler2D u_image;\n\n            // the texCoords passed in from the vertex shader.\n            varying vec2 v_texture_position;\n\n            // the opacity multiplier for the image\n            uniform float u_opacity_multiplier;\n\n            void main() {\n                gl_FragColor = texture2D(u_image, v_texture_position);\n                gl_FragColor *= u_opacity_multiplier;\n            }\n            ");i.useProgram(n),this._secondPass={shaderProgram:n,aOutputPosition:i.getAttribLocation(n,"a_output_position"),aTexturePosition:i.getAttribLocation(n,"a_texture_position"),uMatrix:i.getUniformLocation(n,"u_matrix"),uImage:i.getUniformLocation(n,"u_image"),uOpacityMultiplier:i.getUniformLocation(n,"u_opacity_multiplier"),bufferOutputPosition:i.createBuffer(),bufferTexturePosition:i.createBuffer()},i.bindBuffer(i.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),i.bufferData(i.ARRAY_BUFFER,this._unitQuad,i.STATIC_DRAW),i.enableVertexAttribArray(this._secondPass.aOutputPosition),i.bindBuffer(i.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),i.bufferData(i.ARRAY_BUFFER,this._unitQuad,i.DYNAMIC_DRAW),i.enableVertexAttribArray(this._secondPass.aTexturePosition),n=t.Mat3.makeScaling(2,2).multiply(t.Mat3.makeTranslation(-.5,-.5)),i.uniformMatrix3fv(this._secondPass.uMatrix,!1,n.values)}_resizeRenderer(){let i=this._gl;var n=this._renderingCanvas.width,a=this._renderingCanvas.height;i.viewport(0,0,n,a),i.deleteTexture(this._renderToTexture),this._renderToTexture=i.createTexture(),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._renderToTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,a,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this._textureFilter()),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindFramebuffer(i.FRAMEBUFFER,this._glFrameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._renderToTexture,0)}_setupCanvases(){let i=this;this._outputCanvas=this.canvas,this._outputContext=this._outputCanvas.getContext("2d"),this._renderingCanvas=document.createElement("canvas"),this._clippingCanvas=document.createElement("canvas"),this._clippingContext=this._clippingCanvas.getContext("2d"),this._renderingCanvas.width=this._clippingCanvas.width=this._outputCanvas.width,this._renderingCanvas.height=this._clippingCanvas.height=this._outputCanvas.height,this._gl=this._renderingCanvas.getContext("webgl"),this._resizeHandler=function(){i._outputCanvas!==i.viewer.drawer.canvas&&(i._outputCanvas.style.width=i.viewer.drawer.canvas.clientWidth+"px",i._outputCanvas.style.height=i.viewer.drawer.canvas.clientHeight+"px");var n=i._calculateCanvasSize();(i._outputCanvas.width!==n.x||i._outputCanvas.height!==n.y)&&(i._outputCanvas.width=n.x,i._outputCanvas.height=n.y),i._renderingCanvas.style.width=i._outputCanvas.clientWidth+"px",i._renderingCanvas.style.height=i._outputCanvas.clientHeight+"px",i._renderingCanvas.width=i._clippingCanvas.width=i._outputCanvas.width,i._renderingCanvas.height=i._clippingCanvas.height=i._outputCanvas.height,i._resizeRenderer()},this.viewer.addHandler("resize",this._resizeHandler)}_makeQuadVertexBuffer(i,n,a,o){return new Float32Array([i,o,n,o,i,a,i,a,n,o,n,a])}_tileReadyHandler(i){let n=i.tile,a=i.tiledImage;if(!a.isTainted()){var o=n.getCanvasContext(),l=o&&o.canvas;if(l&&!t.isCanvasTainted(l)){if(!this._TextureMap.get(l)){let m=this._gl;var r=m.createTexture();let v;var h=a.source.tileOverlap;let T,_;if(n.sourceBounds?(T=Math.min(n.sourceBounds.width,l.width)/l.width,_=Math.min(n.sourceBounds.height,l.height)/l.height):(T=1,_=1),0<h){var c=this._calculateOverlapFraction(n,a);v=this._makeQuadVertexBuffer((0===n.x?0:c.x)*T,h=(n.isRightMost?1:1-c.x)*T,i=(0===n.y?0:c.y)*_,c=(n.isBottomMost?1:1-c.y)*_)}else v=1===T&&1===_?this._unitQuad:this._makeQuadVertexBuffer(0,T,0,_);this._TextureMap.set(l,c={texture:r,position:v}),m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this._textureFilter()),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,this._textureFilter()),this._uploadImageData(o)}}else a.isTainted()||(a.setTainted(!0),t.console.warn("WebGL cannot be used to draw this TiledImage because it has tainted data. Does crossOriginPolicy need to be set?"),this._raiseDrawerErrorEvent(a,"Tainted data cannot be used by the WebGLDrawer. Falling back to CanvasDrawer for this TiledImage."))}}_calculateOverlapFraction(i,n){var a=n.source.tileOverlap;return{x:a/(i.sourceBounds.width+((0===i.x?0:a)+(i.isRightMost?0:a))),y:a/((n=i.sourceBounds.height)+((0===i.y?0:a)+(i.isBottomMost?0:a)))}}_unloadTextures(){Array.from(this._TextureMap.keys()).forEach(n=>{this._cleanupImageData(n)})}_uploadImageData(i){let n=this._gl;var a=i.canvas;try{if(!a)throw i;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,a)}catch(o){t.console.error("Error uploading image data to WebGL",o)}}_imageUnloadedHandler(i){this._cleanupImageData(i=i.context2D.canvas)}_cleanupImageData(i){var n=this._TextureMap.get(i);this._TextureMap.delete(i),n&&this._gl.deleteTexture(n.texture)}_setClip(){}_renderToClippingCanvas(i){if(this._clippingContext.clearRect(0,0,this._clippingCanvas.width,this._clippingCanvas.height),this._clippingContext.save(),this.viewer.viewport.getFlip()){var n=new t.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(n.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-n.x,0)}if(i._clip){let o=[{x:i._clip.x,y:i._clip.y},{x:i._clip.x+i._clip.width,y:i._clip.y},{x:i._clip.x+i._clip.width,y:i._clip.y+i._clip.height},{x:i._clip.x,y:i._clip.y+i._clip.height}].map(l=>(l=i.imageToViewportCoordinates(l.x,l.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0)),this.viewportCoordToDrawerCoord(l)));this._clippingContext.beginPath(),o.forEach((l,r)=>{this._clippingContext[0===r?"moveTo":"lineTo"](l.x,l.y)}),this._clippingContext.clip(),this._setClip()}if(i._croppingPolygons){let a=i._croppingPolygons.map(o=>o.map(l=>(l=i.imageToViewportCoordinates(l.x,l.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0)),this.viewportCoordToDrawerCoord(l))));this._clippingContext.beginPath(),a.forEach(o=>{o.forEach((l,r)=>{this._clippingContext[0===r?"moveTo":"lineTo"](l.x,l.y)})}),this._clippingContext.clip()}this.viewer.viewport.getFlip()&&(n=new t.Point(this.canvas.width/2,this.canvas.height/2),this._clippingContext.translate(n.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-n.x,0)),this._clippingContext.drawImage(this._renderingCanvas,0,0),this._clippingContext.restore()}_setRotations(i){var n=!1;this.viewport.getRotation(!0)%360!=0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),saveContext:n}),n=!1),i.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:i.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(i._getRotationPoint(!0),!0),saveContext:n})}_offsetForRotation(i){var n=i.point?i.point.times(t.pixelDensityRatio):this._getCanvasCenter(),a=this._outputContext;a.save(),a.translate(n.x,n.y),a.rotate(Math.PI/180*i.degrees),a.translate(-n.x,-n.y)}_flip(i){var n=(i=i||{}).point?i.point.times(t.pixelDensityRatio):this._getCanvasCenter();(i=this._outputContext).translate(n.x,0),i.scale(-1,1),i.translate(-n.x,0)}_drawDebugInfo(i,n,a){for(var o=i.length-1;0<=o;o--){var l=i[o].tile;try{this._drawDebugInfoOnTile(l,i.length,o,n,a)}catch(r){t.console.error(r)}}}_drawDebugInfoOnTile(i,n,a,o,l){var r=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,h=this.context;h.save(),h.lineWidth=2*t.pixelDensityRatio,h.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",h.strokeStyle=this.debugGridColor[r],h.fillStyle=this.debugGridColor[r],this._setRotations(o),l&&this._flip({point:i.position.plus(i.size.divide(2))}),h.strokeRect(i.position.x*t.pixelDensityRatio,i.position.y*t.pixelDensityRatio,i.size.x*t.pixelDensityRatio,i.size.y*t.pixelDensityRatio);var c=(i.position.x+i.size.x/2)*t.pixelDensityRatio;h.translate(c,r=(i.position.y+i.size.y/2)*t.pixelDensityRatio),l=this.viewport.getRotation(!0),h.rotate(Math.PI/180*-l),h.translate(-c,-r),0===i.x&&0===i.y&&(h.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*t.pixelDensityRatio,(i.position.y-30)*t.pixelDensityRatio),h.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*t.pixelDensityRatio,(i.position.y-20)*t.pixelDensityRatio)),h.fillText("Level: "+i.level,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+20)*t.pixelDensityRatio),h.fillText("Column: "+i.x,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+30)*t.pixelDensityRatio),h.fillText("Row: "+i.y,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+40)*t.pixelDensityRatio),h.fillText("Order: "+a+" of "+n,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+50)*t.pixelDensityRatio),h.fillText("Size: "+i.size.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+60)*t.pixelDensityRatio),h.fillText("Position: "+i.position.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!=0&&this._restoreRotationChanges(),o.getRotation(!0)%360!=0&&this._restoreRotationChanges(),h.restore()}_drawPlaceholder(i){var n=i.getBounds(!0),a=this.viewportToDrawerRectangle(i.getBounds(!0));const o=this._outputContext;let l;l="function"==typeof i.placeholderFillStyle?i.placeholderFillStyle(i,o):i.placeholderFillStyle,this._offsetForRotation({degrees:this.viewer.viewport.getRotation(!0)}),o.fillStyle=l,o.translate(a.x,a.y),o.rotate(Math.PI/180*n.degrees),o.translate(-a.x,-a.y),o.fillRect(a.x,a.y,a.width,a.height),this._restoreRotationChanges()}_getCanvasCenter(){return new t.Point(this.canvas.width/2,this.canvas.height/2)}_restoreRotationChanges(){this._outputContext.restore()}static initShaderProgram(i,n,a){function o(r,h,c){return h=r.createShader(h),r.shaderSource(h,c),r.compileShader(h),r.getShaderParameter(h,r.COMPILE_STATUS)?h:(t.console.error("An error occurred compiling the shaders: "+r.getShaderInfoLog(h)),r.deleteShader(h),null)}var l=o(i,i.VERTEX_SHADER,n);return n=o(i,i.FRAGMENT_SHADER,a),a=i.createProgram(),i.attachShader(a,l),i.attachShader(a,n),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)?a:(t.console.error("Unable to initialize the shader program: "+i.getProgramInfoLog(a)),null)}}}(OpenSeadragon),function(t){t.Viewport=function(e){var i=arguments;(e=i.length&&i[0]instanceof t.Point?{containerSize:i[0],contentSize:i[1],config:i[2]}:e).config&&(t.extend(!0,e,e.config),delete e.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,e.initialDegrees=e.degrees,delete e.degrees,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:t.DEFAULT_SETTINGS.silenceMultiImageWarnings},e),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new t.Spring({initial:e.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={get degrees(){return t.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(e){t.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(e)},resetContentSize:function(e){return t.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(e instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(0<e.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(0<e.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,i){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,i)},_setContentBounds:function(e,i){t.console.assert(e,"[Viewport._setContentBounds] bounds is required"),t.console.assert(e instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(0<e.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(0<e.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=e.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?1<=e?e:1:1<=e?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new t.Rect(e.x-i/2,e.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel||this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(e){t.console.assert("object"===t.type(e),"[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation(e))},getBoundsNoRotate:function(e){var i=this.getCenter(e),n=1/this.getZoom(e);return e=n/this.getAspectRatio(),new t.Rect(i.x-n/2,i.y-e/2,n,e)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(e),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var i=this.getBoundsNoRotate(e);return e=this._containerInnerSize.x*this.getZoom(e),i.x-=this._margins.left/e,i.y-=this._margins.top/e,i.width+=(this._margins.left+this._margins.right)/e,i.height+=(this._margins.top+this._margins.bottom)/e,i},getCenter:function(e){var i,n,a,o=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),l=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return e?o:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),e=(n=1/(a=this.getZoom()))/this.getAspectRatio(),e=new t.Rect(o.x-n/2,o.y-e/2,n,e),a=this._pixelFromPoint(this.zoomPoint,e).minus(i).rotate(-this.getRotation(!0)).divide(this._containerInnerSize.x*a),l.plus(a)):l},getZoom:function(e){return(e?this.zoomSpring.current:this.zoomSpring.target).value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var i=this.viewportToViewerElementRectangle(e).getBoundingBox(),n=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),a=!1,o=!1;if(!this.wrapHorizontal){var h,l=i.x+i.width,r=n.x+n.width;l=n.x-l+(h=i.width>n.width?this.visibilityRatio*n.width:this.visibilityRatio*i.width),r=r-i.x-h,h>n.width?(i.x+=(l+r)/2,a=!0):r<0?(i.x+=r,a=!0):0<l&&(i.x+=l,a=!0)}if(!this.wrapVertical){var c=i.y+i.height;c=n.y-c+(l=i.height>n.height?this.visibilityRatio*n.height:this.visibilityRatio*i.height),r=(r=n.y+n.height)-i.y-l,l>n.height?(i.y+=(c+r)/2,o=!0):r<0?(i.y+=r,o=!0):0<c&&(i.y+=c,o=!0)}return(e=(c=a||o)?this.viewerElementToViewportRectangle(i):e.clone()).xConstrained=a,e.yConstrained=o,e.constraintApplied=c,e},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var i=this.getZoom(),n=this._applyZoomConstraints(i);return i!==n&&this.zoomTo(n,this.zoomPoint,e),(n=this.getConstrainedBounds(!1)).constraintApplied&&(this.fitBounds(n,e),this._raiseConstraintsEvent(e)),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(e,i){var n=(i=i||{}).immediately||!1,a=i.constraints||!1,o=this.getAspectRatio(),l=e.getCenter(),r=new t.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox();r.getAspectRatio()>=o?r.height=r.width/o:r.width=r.height*o,r.x=l.x-r.width/2,r.y=l.y-r.height/2;var h=1/r.width;if(n)return this.panTo(l,!0),this.zoomTo(h,null,!0),a&&this.applyConstraints(!0),this;var c=this.getCenter(!0);return i=this.getZoom(!0),this.panTo(c,!0),this.zoomTo(i,null,!0),e=this.getBounds(),0===(o=this.getZoom())||Math.abs(h/o-1)<1e-8?(this.zoomTo(h,null,!0),this.panTo(l,n),a&&this.applyConstraints(!1),this):(a?(this.panTo(l,!1),h=this._applyZoomConstraints(h),this.zoomTo(h,null,!1),l=this.getConstrainedBounds(),this.panTo(c,!0),this.zoomTo(i,null,!0),this.fitBounds(l)):(o=r.rotate(-this.getRotation()).getTopLeft().times(h).minus(e.getTopLeft().times(o)).divide(h-o),this.zoomTo(h,o,n)),this)},fitBounds:function(e,i){return this._fitBounds(e,{immediately:i,constraints:!1})},fitBoundsWithConstraints:function(e,i){return this._fitBounds(e,{immediately:i,constraints:!0})},fitVertically:function(e){var i=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,e)},fitHorizontally:function(e){var i=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,e)},getConstrainedBounds:function(e){return e=this.getBounds(e),this._applyBoundaryConstraints(e)},panBy:function(e,i){var n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(e),i)},panTo:function(e,i){return i?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:i}),this},zoomBy:function(e,i,n){return this.zoomTo(this.zoomSpring.target.value*e,i,n)},zoomTo:function(e,i,n){var a=this;return this.zoomPoint=i instanceof t.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint(function(){a.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:i,immediately:n}),this},setRotation:function(e,i){return this.rotateTo(e,null,i)},getRotation:function(e){return(e?this.degreesSpring.current:this.degreesSpring.target).value},setRotationWithPivot:function(e,i,n){return this.rotateTo(e,i,n)},rotateTo:function(e,i,n){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===e&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=i instanceof t.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n)if(this.rotationPivot){if(!(e-this._oldDegrees))return this.rotationPivot=null,this;this._rotateAboutPivot(e)}else this.degreesSpring.resetTo(e);else{var a=t.positiveModulo(this.degreesSpring.current.value,360),o=t.positiveModulo(e,360);180<(i=o-a)?o-=360:i<-180&&(o+=360),this.degreesSpring.resetTo(e+(a-o)),this.degreesSpring.springTo(e)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e,immediately:!!n,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(e,i,n){return this.rotateTo(this.degreesSpring.target.value+e,i,n)},resize:function(e,i){var a=this.getBoundsNoRotate(),o=a;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),i&&(o.width=a.width*(e.x/this.containerSize.x),o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:i}),o=this.fitBounds(o,!0),this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:e,maintain:i}),o},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var i=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,i||!this.zoomSpring.isAtTargetValue()||!this.centerSpringX.isAtTargetValue()||!this.centerSpringY.isAtTargetValue()||!this.degreesSpring.isAtTargetValue()},_rotateAboutPivot:function(e){var i=!0===e,n=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),i?this.degreesSpring.update():this.degreesSpring.resetTo(e),e=n.rotate(-1*(e=this.degreesSpring.current.value-this._oldDegrees)).times(-1),this.centerSpringX.shiftBy(e.x),this.centerSpringY.shiftBy(e.y)},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var i=this.pixelFromPoint(this.zoomPoint,!0);e(),i=this.pixelFromPoint(this.zoomPoint,!0).minus(i),i=this.deltaPointsFromPixels(i,!0),this.centerSpringX.shiftBy(i.x),this.centerSpringY.shiftBy(i.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,i){return e.times(this._containerInnerSize.x*this.getZoom(i))},deltaPixelsFromPoints:function(e,i){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation(i)),i)},deltaPointsFromPixelsNoRotate:function(e,i){return e.divide(this._containerInnerSize.x*this.getZoom(i))},deltaPointsFromPixels:function(e,i){return this.deltaPointsFromPixelsNoRotate(e,i).rotate(-this.getRotation(i))},pixelFromPointNoRotate:function(e,i){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(i))},pixelFromPoint:function(e,i){return this._pixelFromPoint(e,this.getBoundsNoRotate(i))},_pixelFromPointNoRotate:function(e,i){return e.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,i){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(!0),this.getCenter(!0)),i)},pointFromPixelNoRotate:function(e,i){return i=this.getBoundsNoRotate(i),e.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/i.width).plus(i.getTopLeft())},pointFromPixel:function(e,i){return this.pointFromPixelNoRotate(e,i).rotate(-this.getRotation(i),this.getCenter(i))},_viewportToImageDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(e,i){if(e instanceof t.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(1<n)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(e,i,!0)}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(e,i){if(e instanceof t.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(1<n)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(e,i,!0)}return(i=this._imageToViewportDelta(e,i)).x+=this._contentBoundsNoRotate.x,i.y+=this._contentBoundsNoRotate.y,i},imageToViewportRectangle:function(e,i,n,a){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,a)),this.viewer){var l=this.viewer.world.getItemCount();if(1<l)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===l)return this.viewer.world.getItemAt(0).imageToViewportRectangle(e,i,n,a,!0)}return n=this.imageToViewportCoordinates(o.x,o.y),a=this._imageToViewportDelta(o.width,o.height),new t.Rect(n.x,n.y,a.x,a.y,o.degrees)},viewportToImageRectangle:function(e,i,n,a){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,a)),this.viewer){var l=this.viewer.world.getItemCount();if(1<l)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===l)return this.viewer.world.getItemAt(0).viewportToImageRectangle(e,i,n,a,!0)}return n=this.viewportToImageCoordinates(o.x,o.y),a=this._viewportToImageDelta(o.width,o.height),new t.Rect(n.x,n.y,a.x,a.y,o.degrees)},viewerElementToImageCoordinates:function(e){return e=this.pointFromPixel(e,!0),this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(e){return e=this.imageToViewportCoordinates(e),this.pixelFromPoint(e,!0)},windowToImageCoordinates:function(e){return t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer."),e=e.minus(t.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(e){return t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(e).plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(e){return t.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return t.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){return t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer."),e=e.minus(t.getElementPosition(this.viewer.element)),this.viewerElementToViewportCoordinates(e)},viewportToWindowCoordinates:function(e){return t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(e).plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).viewportToImageZoom(e)}return e*(this._containerInnerSize.x/(i=this._contentSizeNoRotate.x)*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image. Instead, use [TiledImage.imageToViewportZoom] for the specific image of interest");else if(1===i)return this.viewer.world.getItemAt(0).imageToViewportZoom(e)}return e*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e||(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this},getMaxZoomPixelRatio:function(){return this.maxZoomPixelRatio},setMaxZoomPixelRatio:function(e,i=!0,n=!1){t.console.assert(!isNaN(e),"[Viewport.setMaxZoomPixelRatio] ratio must be a number"),isNaN(e)||(this.maxZoomPixelRatio=e,i&&this.getZoom()>this.getMaxZoom()&&this.applyConstraints(n))}}}(OpenSeadragon),function(t){t.TiledImage=function(e){this._initialized=!1,t.console.assert(e.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(e.drawer,"[TiledImage] options.drawer is required"),t.console.assert(e.viewer,"[TiledImage] options.viewer is required"),t.console.assert(e.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(e.source,"[TiledImage] options.source is required"),t.console.assert(!e.clip||e.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=e.tileCache,delete e.tileCache,this._drawer=e.drawer,delete e.drawer,this._imageLoader=e.imageLoader,delete e.imageLoader,e.clip instanceof t.Rect&&(this._clip=e.clip.clone()),delete e.clip;var i=e.x||0;delete e.x;var n=e.y||0;delete e.y,this.normHeight=e.source.dimensions.y/e.source.dimensions.x,this.contentAspectX=e.source.dimensions.x/e.source.dimensions.y;var a=1;e.width?(a=e.width,delete e.width,e.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete e.height)):e.height&&(a=e.height/this.normHeight,delete e.height);var o=e.fitBounds;delete e.fitBounds;var l=e.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete e.fitBoundsPlacement;var r=e.degrees||0;delete e.degrees;var h=e.ajaxHeaders;delete e.ajaxHeaders,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_needsDraw:!0,_needsUpdate:!0,_hasOpaqueTile:!1,_tilesLoading:0,_tilesToDraw:[],_lastDrawn:[],_isBlending:!1,_wasBlending:!1,_isTainted:!1,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:t.DEFAULT_SETTINGS.subPixelRoundingForTransparency,maxTilesPerFrame:t.DEFAULT_SETTINGS.maxTilesPerFrame},e),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:a,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),o&&this.fitBounds(o,l,!0),this._ownAjaxHeaders={},this.setAjaxHeaders(h,!1),this._initialized=!0},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},redraw:function(){this._needsDraw=!0},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(e){var i=this._xSpring.update(),n=this._ySpring.update(),a=this._scaleSpring.update(),o=this._degreesSpring.update();return((o=i||n||a||o||this._needsUpdate)||e||!this._fullyLoaded)&&(e=this._updateLevelsForViewport(),this._setFullyLoaded(e)),this._needsUpdate=!1,!!o&&(this._updateForScale(),this._raiseBoundsChange(),this._needsDraw=!0)},setDrawn:function(){return this._needsDraw=this._isBlending||this._wasBlending,this._needsDraw},setTainted(e){this._isTainted=e},isTainted(){return this._isTainted},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy(this.viewer)},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(e){return e?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(e){var i=this.getBoundsNoRotate(e);if(this._clip){var n=(e?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x;n=this._clip.times(n),i=new t.Rect(i.x+n.x,i.y+n.y,n.width,n.height)}return i.rotate(this.getRotation(e),this._getRotationPoint(e))},getTileBounds:function(e,i,n){var a=this.source.getNumTiles(e),o=(a.x+i%a.x)%a.x,l=(a.y+n%a.y)%a.y;return e=this.source.getTileBounds(e,o,l),this.getFlip()&&(e.x=Math.max(0,1-e.x-e.width)),e.x+=(i-o)/a.x,e.y+=this._worldHeightCurrent/this._worldWidthCurrent*((n-l)/a.y),e},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var e=this.imageToWindowCoordinates(new t.Point(0,0)),i=this.imageToWindowCoordinates(this.getContentSize());return new t.Point(i.x-e.x,i.y-e.y)},_viewportToImageDelta:function(e,i,n){return new t.Point(e*(this.source.dimensions.x/(n=(n?this._scaleSpring.current:this._scaleSpring.target).value)),i*(this.source.dimensions.y*this.contentAspectX/n))},viewportToImageCoordinates:function(e,i,n){var a;return e instanceof t.Point?(n=i,a=e):a=new t.Point(e,i),a=a.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(a.x-this._xSpring.current.value,a.y-this._ySpring.current.value):this._viewportToImageDelta(a.x-this._xSpring.target.value,a.y-this._ySpring.target.value)},_imageToViewportDelta:function(e,i,n){return new t.Point(e/this.source.dimensions.x*(n=(n?this._scaleSpring.current:this._scaleSpring.target).value),i/this.source.dimensions.y/this.contentAspectX*n)},imageToViewportCoordinates:function(e,i,n){return e instanceof t.Point&&(n=i,i=e.y,e=e.x),i=this._imageToViewportDelta(e,i,n),n?(i.x+=this._xSpring.current.value,i.y+=this._ySpring.current.value):(i.x+=this._xSpring.target.value,i.y+=this._ySpring.target.value),i.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(e,i,n,a,o){var l=e;return l instanceof t.Rect?o=i:l=new t.Rect(e,i,n,a),n=this.imageToViewportCoordinates(l.getTopLeft(),o),a=this._imageToViewportDelta(l.width,l.height,o),new t.Rect(n.x,n.y,a.x,a.y,l.degrees+this.getRotation(o))},viewportToImageRectangle:function(e,i,n,a,o){var l=e;return e instanceof t.Rect?o=i:l=new t.Rect(e,i,n,a),n=this.viewportToImageCoordinates(l.getTopLeft(),o),a=this._viewportToImageDelta(l.width,l.height,o),new t.Rect(n.x,n.y,a.x,a.y,l.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(e){return e=this.viewport.pointFromPixel(e,!0),this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(e){return e=this.imageToViewportCoordinates(e),this.viewport.pixelFromPoint(e,!0)},windowToImageCoordinates:function(e){return e=e.minus(OpenSeadragon.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(e){var i=this._scaleSpring.current.value;return e=e.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((e.x-this._xSpring.current.value)/i,(e.y-this._ySpring.current.value)/i,e.width/i,e.height/i,e.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,i){var n=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(i){if(n&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0,this._needsUpdate=!0}else{if(n)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0,this._needsUpdate=!0}n||this._raiseBoundsChange()},setWidth:function(e,i){this._setScale(e,i)},setHeight:function(e,i){this._setScale(e/this.normHeight,i)},setCroppingPolygons:function(e){try{if(!t.isArray(e))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=e.map(function(n){return n.map(function(a){try{if(function(n){return n instanceof t.Point||"number"==typeof n.x&&"number"==typeof n.y}(a))return{x:a.x,y:a.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})}),this._needsDraw=!0}catch(n){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(n),this.resetCroppingPolygons()}},resetCroppingPolygons:function(){this._croppingPolygons=null,this._needsDraw=!0},fitBounds:function(e,i,n){var a=t.Placement.properties[i=i||t.Placement.CENTER],o=this.contentAspectX,l=0,r=0,h=1;if(i=1,this._clip&&(o=this._clip.getAspectRatio(),h=this._clip.width/this.source.dimensions.x,i=this._clip.height/this.source.dimensions.y,e.getAspectRatio()>o?(l=this._clip.x/this._clip.height*e.height,r=this._clip.y/this._clip.height*e.height):(l=this._clip.x/this._clip.width*e.width,r=this._clip.y/this._clip.width*e.width)),e.getAspectRatio()>o){var c=e.height/i;i=0,a.isHorizontallyCentered?i=(e.width-e.height*o)/2:a.isRight&&(i=e.width-e.height*o),this.setPosition(new t.Point(e.x-l+i,e.y-r),n),this.setHeight(c,n)}else c=e.width/h,h=0,a.isVerticallyCentered?h=(e.height-e.width/o)/2:a.isBottom&&(h=e.height-e.width/o),this.setPosition(new t.Point(e.x-l,e.y-r+h),n),this.setWidth(c,n)},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(e){t.console.assert(!e||e instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),this._clip=e instanceof t.Rect?e.clone():null,this._needsUpdate=!0,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return this.flipped},setFlip:function(e){this.flipped=e},get flipped(){return this._flipped},set flipped(e){var i=this._flipped!==!!e;this._flipped=!!e,i&&(this.update(!0),this._needsDraw=!0,this._raiseBoundsChange())},get wrapHorizontal(){return this._wrapHorizontal},set wrapHorizontal(e){var i=this._wrapHorizontal!==!!e;this._wrapHorizontal=!!e,this._initialized&&i&&(this.update(!0),this._needsDraw=!0)},get wrapVertical(){return this._wrapVertical},set wrapVertical(e){var i=this._wrapVertical!==!!e;this._wrapVertical=!!e,this._initialized&&i&&(this.update(!0),this._needsDraw=!0)},get debugMode(){return this._debugMode},set debugMode(e){this._debugMode=!!e,this._needsDraw=!0},getOpacity:function(){return this.opacity},setOpacity:function(e){this.opacity=e},get opacity(){return this._opacity},set opacity(e){e!==this.opacity&&(this._opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return(e?this._degreesSpring.current:this._degreesSpring.target).value},setRotation:function(e,i){(this._degreesSpring.target.value!==e||!this._degreesSpring.isAtTargetValue())&&(i?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._needsUpdate=!0,this._raiseBoundsChange())},getDrawArea:function(){if(0===this._opacity&&!this._preload)return!1;var e=this._viewportToTiledImageRectangle(this.viewport.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var i=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));e=e.intersection(i)}return e},getTilesToDraw:function(){let e=this._tilesToDraw.flat();return this._updateTilesInViewport(e),e=this._tilesToDraw.flat(),e.forEach(i=>{i.tile.beingDrawn=!0}),this._lastDrawn=e,e},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},get compositeOperation(){return this._compositeOperation},set compositeOperation(e){e!==this._compositeOperation&&(this._compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this._compositeOperation}))},getCompositeOperation:function(){return this._compositeOperation},setCompositeOperation:function(e){this.compositeOperation=e},setAjaxHeaders:function(e,i){t.isPlainObject(e=null===e?{}:e)?(this._ownAjaxHeaders=e,this._updateAjaxHeaders(i)):console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object")},_updateAjaxHeaders:function(e){if(void 0===e&&(e=!0),this.ajaxHeaders=t.isPlainObject(this.viewer.ajaxHeaders)?t.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this._ownAjaxHeaders,e){var i,n;for(var a in this.tilesMatrix)for(var o in i=this.source.getNumTiles(a),this.tilesMatrix[a])for(var l in n=(i.x+o%i.x)%i.x,this.tilesMatrix[a][o])if(r=(i.y+l%i.y)%i.y,(l=this.tilesMatrix[a][o][l]).loadWithAjax=this.loadTilesWithAjax,l.loadWithAjax){var r=this.source.getTileAjaxHeaders(a,n,r);l.ajaxHeaders=t.extend({},this.ajaxHeaders,r)}else l.ajaxHeaders=null;for(var h=0;h<this._imageLoader.jobQueue.length;h++){var c=this._imageLoader.jobQueue[h];c.loadWithAjax=c.tile.loadWithAjax,c.ajaxHeaders=c.tile.loadWithAjax?c.tile.ajaxHeaders:null}}},_setScale:function(e,i){var n=this._scaleSpring.target.value===e;if(i){if(n&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}else{if(n)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}n||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),i=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value;return i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(i/this.minPixelRatio)/Math.log(2)))),i=Math.max(i,this.source.minLevel||0),{lowestLevel:Math.min(e,i),highestLevel:i}},_updateLevelsForViewport:function(){var e=this._getLevelsInterval(),i=e.lowestLevel;e=e.highestLevel;var n=[],a=this.getDrawArea(),o=t.now();if(this._lastDrawn.forEach(T=>{T.tile.beingDrawn=!1}),this._tilesToDraw=[],this._tilesLoading=0,this.loadingCoverage={},!a)return this._needsDraw=!1,this._fullyLoaded;var l=new Array(e-i+1);for(let T=0,_=e;_>=i;_--,T++)l[T]=_;for(let T=e+1;T<=this.source.maxLevel;T++){var r=this.tilesMatrix[T]&&this.tilesMatrix[T][0]&&this.tilesMatrix[T][0][0];if(r&&r.isBottomMost&&r.isRightMost&&r.loaded){l.push(T);break}}let h=!1;for(let T=0;T<l.length;T++){var c=l[T],d=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(c),!0).x*this._scaleSpring.current.value;if(T===l.length-1||d>=this.minPixelRatio)h=!0;else if(!h)continue;var m=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(c),!1).x*this._scaleSpring.current.value,v=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value;if(v=this.immediateRender?1:v,d=Math.min(1,(d-.5)/.5),m=v/Math.abs(v-m),n=(m=this._updateLevel(c,d,m,a,o,n)).bestTiles,m=m.updatedTiles.filter(_=>_.loaded),this._tilesToDraw[c]=m.map(d=function(_,E,P){return function(b){return{tile:b,level:_,levelOpacity:E,currentTime:P}}}(c,d,o)),this._providesCoverage(this.coverage,c))break}return n&&0<n.length?(n.forEach(function(T){T&&!T.context2D&&this._loadTile(T,o)},this),!(this._needsDraw=!0)):0===this._tilesLoading},_updateTilesInViewport:function(e){let i=t.now(),n=this;this._tilesLoading=0,this._wasBlending=this._isBlending,this._isBlending=!1,this.loadingCoverage={};let a=e.length?e[0].level:0;if(this.getDrawArea()){let r=0;for(let h=0;h<e.length;h++){var o=e[h];void 0,(d=(c=o).tile)&&d.loaded&&(c=n._blendTile(d,d.x,d.y,c.level,c.levelOpacity,i,a),n._isBlending=n._isBlending||c,n._needsDraw=n._needsDraw||c||n._wasBlending),this._providesCoverage(this.coverage,o.level)&&(r=Math.max(r,o.level))}if(0<r)for(var l in this._tilesToDraw)l<r&&delete this._tilesToDraw[l]}var c,d},_blendTile:function(e,i,n,a,o,l,r){let c,d,h=1e3*this.blendTime;return e.blendStart||(e.blendStart=l),c=l-e.blendStart,d=h?Math.min(1,c/h):1,a===r&&(d=1,c=h),this.alwaysBlend&&(d*=o),e.opacity=d,1===d&&(this._setCoverage(this.coverage,a,i,n,!0),this._hasOpaqueTile=!0),c<h},_updateLevel:function(e,i,n,a,o,l){var r=a.getBoundingBox().getTopLeft(),h=a.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:!0,level:e,opacity:i,visibility:n,drawArea:a,topleft:r,bottomright:h,currenttime:o,best:l}),this._resetCoverage(this.coverage,e),this._resetCoverage(this.loadingCoverage,e);var c=(h=this._getCornerTiles(e,r,h)).topLeft,d=h.bottomRight,m=this.source.getNumTiles(e),v=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(d.x+=1,this.wrapHorizontal||(d.x=Math.min(d.x,m.x-1))),h=Math.max(0,(d.x-c.x)*(d.y-c.y));for(var T=new Array(h),_=0,E=c.x;E<=d.x;E++)for(var P=c.y;P<=d.y;P++){var b;if(this.getFlip()){var C=(m.x+E%m.x)%m.x;b=E+m.x-C-C-1}else b=E;null!==a.intersection(this.getTileBounds(e,b,P))&&(l=(C=this._updateTile(b,P,e,n,v,m,o,l)).bestTiles,T[_]=C.tile,_+=1)}return{bestTiles:l,updatedTiles:T}},_positionTile:function(e,i,n,a,o){(h=e.bounds.getTopLeft()).x*=this._scaleSpring.current.value,h.y*=this._scaleSpring.current.value,h.x+=this._xSpring.current.value,h.y+=this._ySpring.current.value,(c=e.bounds.getSize()).x*=this._scaleSpring.current.value,c.y*=this._scaleSpring.current.value,e.positionedBounds.x=h.x,e.positionedBounds.y=h.y,e.positionedBounds.width=c.x,e.positionedBounds.height=c.y;var l=n.pixelFromPointNoRotate(h,!0),r=n.pixelFromPointNoRotate(h,!1),h=n.deltaPixelsFromPointsNoRotate(c,!0),c=n.deltaPixelsFromPointsNoRotate(c,!1);c=r.plus(c.divide(2)),c=a.squaredDistanceTo(c),this.viewer.drawer.minimumOverlapRequired(this)&&(i||(h=h.plus(new t.Point(1,1))),e.isRightMost&&this.wrapHorizontal&&(h.x+=.75),e.isBottomMost&&this.wrapVertical&&(h.y+=.75)),e.position=l,e.size=h,e.squaredDistance=c,e.visibility=o},_updateTile:function(e,i,n,a,o,l,r,h){return r=this._getTile(e,i,n,r,l),this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:r}),this._setCoverage(this.coverage,n,e,i,!1),l=r.loaded||r.loading||this._isCovered(this.loadingCoverage,n,e,i),this._setCoverage(this.loadingCoverage,n,e,i,l),r.exists?(r.loaded&&1===r.opacity&&this._setCoverage(this.coverage,n,e,i,!0),this._positionTile(r,this.source.tileOverlap,this.viewport,o,a),r.loaded||(r.context2D?this._setTileLoaded(r):(a=this._tileCache.getImageRecord(r.cacheKey))&&this._setTileLoaded(r,a.getData())),r.loading?this._tilesLoading++:l||(h=this._compareTiles(h,r,this.maxTilesPerFrame)),{bestTiles:h,tile:r}):{bestTiles:h,tile:r}},_getCornerTiles:function(e,i,n){var a,o;this.wrapHorizontal?(a=t.positiveModulo(i.x,1),o=t.positiveModulo(n.x,1)):(a=Math.max(0,i.x),o=Math.min(1,n.x));var l=1/this.source.aspectRatio;this.wrapVertical?(r=t.positiveModulo(i.y,l),h=t.positiveModulo(n.y,l)):(r=Math.max(0,i.y),h=Math.min(l,n.y));var r=this.source.getTileAtPoint(e,new t.Point(a,r)),h=this.source.getTileAtPoint(e,new t.Point(o,h));return e=this.source.getNumTiles(e),this.wrapHorizontal&&(r.x+=e.x*Math.floor(i.x),h.x+=e.x*Math.floor(n.x)),this.wrapVertical&&(r.y+=e.y*Math.floor(i.y/l),h.y+=e.y*Math.floor(n.y/l)),{topLeft:r,bottomRight:h}},_getTile:function(e,i,n,a,o){var l,r,h,c,d,m,v,T,_,E=this.tilesMatrix,P=this.source;return E[n]||(E[n]={}),E[n][e]||(E[n][e]={}),(!E[n][e][i]||!E[n][e][i].flipped!=!this.flipped)&&(l=(o.x+e%o.x)%o.x,r=(o.y+i%o.y)%o.y,h=this.getTileBounds(n,e,i),c=P.getTileBounds(n,l,r,!0),d=P.tileExists(n,l,r),m=P.getTileUrl(n,l,r),_=P.getTilePostData(n,l,r),this.loadTilesWithAjax?(v=P.getTileAjaxHeaders(n,l,r),t.isPlainObject(this.ajaxHeaders)&&(v=t.extend({},this.ajaxHeaders,v))):v=null,T=P.getContext2D?P.getContext2D(n,l,r):void 0,_=new t.Tile(n,e,i,h,d,m,T,this.loadTilesWithAjax,v,c,_,P.getTileHashKey(n,l,r,m,v,_)),this.getFlip()?0==l&&(_.isRightMost=!0):l==o.x-1&&(_.isRightMost=!0),r==o.y-1&&(_.isBottomMost=!0),_.flipped=this.flipped,E[n][e][i]=_),(_=E[n][e][i]).lastTouchTime=a,_},_loadTile:function(e,i){var n=this;e.loading=!0,this._imageLoader.addJob({src:e.getUrl(),tile:e,source:this.source,postData:e.postData,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(a,o,l){n._onTileLoad(e,i,a,o,l)},abort:function(){e.loading=!1}})},_onTileLoad:function(e,i,n,a,o){if(n)if(e.exists=!0,i<this.lastResetTime)t.console.warn("Ignoring tile %s loaded before reset: %s",e,e.getUrl()),e.loading=!1;else{var r;r=this.source.getClosestLevel(),this._setTileLoaded(e,n,r,o)}else t.console.error("Tile %s failed to load: %s - error: %s",e,e.getUrl(),a),this.viewer.raiseEvent("tile-load-failed",{tile:e,tiledImage:this,time:i,message:a,tileRequest:o}),e.loading=!1,e.exists=!1},_setTileLoaded:function(e,i,n,a){var o=0,l=!1,r=this;function h(){return l&&t.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),o++,c}function c(){0==--o&&(e.loading=!1,e.loaded=!0,e.hasTransparency=r.source.hasTransparency(e.context2D,e.getUrl(),e.ajaxHeaders,e.postData),e.context2D||r._tileCache.cacheTile({data:i,tile:e,cutoff:n,tiledImage:r}),r.viewer.raiseEvent("tile-ready",{tile:e,tiledImage:r,tileRequest:a}),r._needsDraw=!0)}var d=h();this.viewer.raiseEvent("tile-loaded",{tile:e,tiledImage:this,tileRequest:a,get image(){return t.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),i},data:i,getCompletionCallback:h}),l=!0,d()},_compareTiles:function(e,i,n){return e?(e.push(i),this._sortTiles(e),e.length>n&&e.pop(),e):[i]},_sortTiles:function(e){e.sort(function(i,n){return null===i?1:null===n?-1:i.visibility===n.visibility?i.squaredDistance-n.squaredDistance:n.visibility-i.visibility})},_providesCoverage:function(e,i,n,a){var o,l,r,h;if(!e[i])return!1;if(void 0!==n&&void 0!==a)return void 0===e[i][n]||void 0===e[i][n][a]||!0===e[i][n][a];for(r in o=e[i])if(Object.prototype.hasOwnProperty.call(o,r))for(h in l=o[r])if(Object.prototype.hasOwnProperty.call(l,h)&&!l[h])return!1;return!0},_isCovered:function(e,i,n,a){return void 0===n||void 0===a?this._providesCoverage(e,i+1):this._providesCoverage(e,i+1,2*n,2*a)&&this._providesCoverage(e,i+1,2*n,2*a+1)&&this._providesCoverage(e,i+1,2*n+1,2*a)&&this._providesCoverage(e,i+1,2*n+1,2*a+1)},_setCoverage:function(e,i,n,a,o){e[i]?(e[i][n]||(e[i][n]={}),e[i][n][a]=o):t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i)},_resetCoverage:function(e,i){e[i]={}}})}(OpenSeadragon),function(t){function e(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=n.tile,this.tiledImage=n.tiledImage}function i(n){t.console.assert(n,"[ImageRecord] options is required"),t.console.assert(n.data,"[ImageRecord] options.data is required"),this._tiles=[],n.create.apply(null,[this,n.data,n.ownerTile]),this._destroyImplementation=n.destroy.bind(null,this),this.getImage=n.getImage.bind(null,this),this.getData=n.getData.bind(null,this),this.getRenderedContext=n.getRenderedContext.bind(null,this)}i.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(n){t.console.assert(n,"[ImageRecord.addTile] tile is required"),this._tiles.push(n)},removeTile:function(n){for(var a=0;a<this._tiles.length;a++)if(this._tiles[a]===n)return void this._tiles.splice(a,1);t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",n)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(n){this._maxImageCacheCount=(n=n||{}).maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var a=n.cutoff||0,o=this._tilesLoaded.length,l=this._imagesLoaded[n.tile.cacheKey];if(l||(n.data||(t.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),n.data=n.image),t.console.assert(n.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),l=this._imagesLoaded[n.tile.cacheKey]=new i({data:n.data,ownerTile:n.tile,create:n.tiledImage.source.createTileCache,destroy:n.tiledImage.source.destroyTileCache,getImage:n.tiledImage.source.getTileCacheDataAsImage,getData:n.tiledImage.source.getTileCacheData,getRenderedContext:n.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),l.addTile(n.tile),n.tile.cacheImageRecord=l,this._imagesLoadedCount>this._maxImageCacheCount){for(var d,m,T,E,r=null,h=-1,c=null,P=this._tilesLoaded.length-1;0<=P;P--)(d=(E=this._tilesLoaded[P]).tile).level<=a||d.beingDrawn||(r?((T=d.lastTouchTime)<(m=r.lastTouchTime)||T===m&&r.level<d.level)&&(r=d,h=P,c=E):(r=d,h=P,c=E));r&&0<=h&&(this._unloadTile(c),o=h)}this._tilesLoaded[o]=new e({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(n){t.console.assert(n,"[TileCache.clearTilesFor] tiledImage is required");for(var a,o=0;o<this._tilesLoaded.length;++o)(a=this._tilesLoaded[o]).tiledImage===n&&(this._unloadTile(a),this._tilesLoaded.splice(o,1),o--)},getImageRecord:function(n){return t.console.assert(n,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[n]},_unloadTile:function(n){t.console.assert(n,"[TileCache._unloadTile] tileRecord is required");var a=n.tile,o=n.tiledImage;let l=a.getCanvasContext&&a.getCanvasContext();a.unload(),a.cacheImageRecord=null,(n=this._imagesLoaded[a.cacheKey])&&(n.removeTile(a),n.getTileCount()||(n.destroy(),delete this._imagesLoaded[a.cacheKey],this._imagesLoadedCount--,l&&(l.canvas.width=0,l.canvas.height=0,o.viewer.raiseEvent("image-unloaded",{context2D:l,tile:a}))),o.viewer.raiseEvent("tile-unloaded",{tile:a,tiledImage:o}))}}}(OpenSeadragon),function(t){t.World=function(e){var i=this;t.console.assert(e.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(n){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(e,i){t.console.assert(e,"[World.addItem] item is required"),t.console.assert(e instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index?(i=Math.max(0,Math.min(this._items.length,i.index)),this._items.splice(i,0,e)):this._items.push(e),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return t.console.assert(void 0!==e,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return t.console.assert(e,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,i){t.console.assert(e,"[World.setItemIndex] item is required"),t.console.assert(void 0!==i,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(e);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(i,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:n,newIndex:i}))},removeItem:function(e){t.console.assert(e,"[World.removeItem] item is required");var i=t.indexOf(this._items,e);-1!==i&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){var e,i;for(this.viewer._cancelPendingImages(),i=0;i<this._items.length;i++)(e=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<n.length;i++)this._raiseRemoveItem(e=n[i])},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(e){for(var i=!1,n=0;n<this._items.length;n++)i=this._items[n].update(e)||i;return i},draw:function(){this.viewer.drawer.draw(this._items),this._needsDraw=!1,this._items.forEach(e=>{this._needsDraw=e.setDrawn()||this._needsDraw})},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){(this._autoRefigureSizes=e)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){var h,i=(e=e||{}).immediately||!1,n=e.layout||t.DEFAULT_SETTINGS.collectionLayout,o=e.columns||t.DEFAULT_SETTINGS.collectionColumns,l=e.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,r=l+(e.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin);h=!e.rows&&o?o:Math.ceil(this._items.length/(e.rows||t.DEFAULT_SETTINGS.collectionRows));var m,v,T,c=0,d=0;this.setAutoRefigureSizes(!1);for(var _=0;_<this._items.length;_++)_&&_%h==0&&("horizontal"===n?(d+=r,c=0):(c+=r,d=0)),T=(v=(T=(m=this._items[_]).getBounds()).width>T.height?l:l*(T.width/T.height))*(T.height/T.width),T=new t.Point(c+(l-v)/2,d+(l-T)/2),m.setPosition(T,i),m.setWidth(v,i),"horizontal"===n?c+=r:d+=r;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var a=this._items[0],o=a.getBounds();this._contentFactor=a.getContentSize().x/o.width;for(var l=a.getClippedBounds().getBoundingBox(),r=l.x,h=l.y,c=l.x+l.width,d=l.y+l.height,m=1;m<this._items.length;m++)o=(a=this._items[m]).getBounds(),this._contentFactor=Math.max(this._contentFactor,a.getContentSize().x/o.width),l=a.getClippedBounds().getBoundingBox(),r=Math.min(r,l.x),h=Math.min(h,l.y),c=Math.max(c,l.x+l.width),d=Math.max(d,l.y+l.height);this._homeBounds=new t.Rect(r,h,c-r,d-h),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;this._contentFactor===n&&this._homeBounds.equals(e)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon);