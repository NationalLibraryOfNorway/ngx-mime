function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}(function(e){e.version={versionStr:"3.1.0",major:parseInt("3",10),minor:parseInt("1",10),revision:parseInt("0",10)};var n,t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,a=Object.prototype.hasOwnProperty;e.isFunction=function(r){return"function"===e.type(r)},e.isArray=Array.isArray||function(r){return"array"===e.type(r)},e.isWindow=function(r){return r&&"object"==typeof r&&"setInterval"in r},e.type=function(r){return null==r?String(r):t[i.call(r)]||"object"},e.isPlainObject=function(r){if(!r||"object"!==OpenSeadragon.type(r)||r.nodeType||e.isWindow(r)||r.constructor&&!a.call(r,"constructor")&&!a.call(r.constructor.prototype,"isPrototypeOf"))return!1;var s;for(var l in r)s=l;return void 0===s||a.call(r,s)},e.isEmptyObject=function(r){for(var s in r)return!1;return!0},e.freezeObject=function(r){return e.freezeObject=Object.freeze?Object.freeze:function(s){return s},e.freezeObject(r)},e.supportsCanvas=(n=document.createElement("canvas"),!(!e.isFunction(n.getContext)||!n.getContext("2d"))),e.isCanvasTainted=function(r){var s=!1;try{r.getContext("2d").getImageData(0,0,1,1)}catch{s=!0}return s},e.supportsAddEventListener=!(!document.documentElement.addEventListener||!document.addEventListener),e.supportsRemoveEventListener=!(!document.documentElement.removeEventListener||!document.removeEventListener),e.supportsEventListenerOptions=function(){var r=0;if(e.supportsAddEventListener)try{var s={get capture(){return r++,!1},get once(){return r++,!1},get passive(){return r++,!1}};window.addEventListener("test",null,s),window.removeEventListener("test",null,s)}catch{r=0}return 3<=r}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var r=document.createElement("canvas").getContext("2d"),s=window.devicePixelRatio||1;return r=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1,Math.max(s,1)/r}return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(OpenSeadragon),function(e){function t(r){}e.extend=function(){var r,s,l,u,v,d,m=arguments[0]||{},w=arguments.length,T=!1,S=1;for("boolean"==typeof m&&(T=m,m=arguments[1]||{},S=2),"object"==typeof m||OpenSeadragon.isFunction(m)||(m={}),w===S&&(m=this,--S);S<w;S++)if(null!==(r=arguments[S])||void 0!==r)for(s in r)l=m[s],m!==(u=r[s])&&(T&&u&&(OpenSeadragon.isPlainObject(u)||(v=OpenSeadragon.isArray(u)))?(v?(v=!1,d=l&&OpenSeadragon.isArray(l)?l:[]):d=l&&OpenSeadragon.isPlainObject(l)?l:{},m[s]=OpenSeadragon.extend(T,d,u)):void 0!==u&&(m[s]=u));return m},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:function(){if("object"!=typeof navigator)return!1;var r=navigator.userAgent;return"string"==typeof r&&(-1!==r.indexOf("iPhone")||-1!==r.indexOf("iPad")||-1!==r.indexOf("iPod"))}(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(r,s){return function(){var l=arguments;return s.apply(r,l=void 0===l?[]:l)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(r){return e._viewers.get(this.getElement(r))},getElement:function(r){return"string"==typeof r?document.getElementById(r):r},getElementPosition:function(r){var s,l,u=new e.Point;for(l=n(r=e.getElement(r),s="fixed"===e.getElementStyle(r).position);l;)u.x+=r.offsetLeft,u.y+=r.offsetTop,s&&(u=u.plus(e.getPageScroll())),l=n(r=l,s="fixed"===e.getElementStyle(r).position);return u},getElementOffset:function(r){var s,l=(r=e.getElement(r))&&r.ownerDocument,u={top:0,left:0};return l?(s=l.documentElement,void 0!==r.getBoundingClientRect&&(u=r.getBoundingClientRect()),new e.Point(u.left+((l=l===l.window?l:9===l.nodeType&&(l.defaultView||l.parentWindow)).pageXOffset||s.scrollLeft)-(s.clientLeft||0),u.top+(l.pageYOffset||s.scrollTop)-(s.clientTop||0))):new e.Point},getElementSize:function(r){return r=e.getElement(r),new e.Point(r.clientWidth,r.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(r){return(r=e.getElement(r)).currentStyle}:function(r){return r=e.getElement(r),window.getComputedStyle(r,"")},getCssPropertyWithVendorPrefix:function(r){var s={};return e.getCssPropertyWithVendorPrefix=function(l){if(void 0!==s[l])return s[l];var u=document.createElement("div").style,v=null;if(void 0!==u[l])v=l;else for(var d=["Webkit","Moz","MS","O","webkit","moz","ms","o"],m=e.capitalizeFirstLetter(l),w=0;w<d.length;w++){var T=d[w]+m;if(void 0!==u[T]){v=T;break}}return s[l]=v},e.getCssPropertyWithVendorPrefix(r)},capitalizeFirstLetter:function(r){return r.charAt(0).toUpperCase()+r.slice(1)},positiveModulo:function(r,s){return(r%=s)<0&&(r+=s),r},pointInElement:function(u,s){u=e.getElement(u);var l=e.getElementOffset(u);return u=e.getElementSize(u),s.x>=l.x&&s.x<l.x+u.x&&s.y<l.y+u.y&&s.y>=l.y},getMousePosition:function(r){if("number"==typeof r.pageX)e.getMousePosition=function(s){var l=new e.Point;return l.x=s.pageX,l.y=s.pageY,l};else{if("number"!=typeof r.clientX)throw new Error("Unknown event mouse position, no known technique.");e.getMousePosition=function(s){var l=new e.Point;return l.x=s.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,l.y=s.clientY+document.body.scrollTop+document.documentElement.scrollTop,l}}return e.getMousePosition(r)},getPageScroll:function(){var r=document.documentElement||{},s=document.body||{};if("number"==typeof window.pageXOffset)e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(s.scrollLeft||s.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!r.scrollLeft&&!r.scrollTop)return new e.Point(0,0);e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return e.getPageScroll()},setPageScroll:function(r){if(void 0!==window.scrollTo)e.setPageScroll=function(u){window.scrollTo(u.x,u.y)};else{var s=e.getPageScroll();if(s.x===r.x&&s.y===r.y)return;document.body.scrollLeft=r.x,document.body.scrollTop=r.y;var l=e.getPageScroll();if(l.x!==s.x&&l.y!==s.y)return void(e.setPageScroll=function(u){document.body.scrollLeft=u.x,document.body.scrollTop=u.y});if(document.documentElement.scrollLeft=r.x,document.documentElement.scrollTop=r.y,(l=e.getPageScroll()).x!==s.x&&l.y!==s.y)return void(e.setPageScroll=function(u){document.documentElement.scrollLeft=u.x,document.documentElement.scrollTop=u.y});e.setPageScroll=function(u){}}e.setPageScroll(r)},getWindowSize:function(){var r=document.documentElement||{},s=document.body||{};if("number"==typeof window.innerWidth)e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(r.clientWidth||r.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!s.clientWidth&&!s.clientHeight)throw new Error("Unknown window size, no known technique.");e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)}}return e.getWindowSize()},makeCenteredNode:function(r){r=e.getElement(r);var s=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(s[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(s[1].style,{display:"table-row"}),e.extend(s[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),s[0].appendChild(s[1]),s[1].appendChild(s[2]),s[2].appendChild(r),s[0]},makeNeutralElement:function(l){var s=document.createElement(l);return(l=s.style).background="transparent none",l.border="none",l.margin="0px",l.padding="0px",l.position="static",s},now:function(){return e.now=Date.now?Date.now:function(){return(new Date).getTime()},e.now()},makeTransparentImage:function(r){var s=e.makeNeutralElement("img");return s.src=r,s},setElementOpacity:function(r,s,l){r=e.getElement(r),l&&!e.Browser.alpha&&(s=Math.round(s)),e.Browser.opacity?r.style.opacity=s<1?s:"":s<1?(s=Math.round(100*s),r.style.filter="alpha(opacity="+s+")"):r.style.filter=""},setElementTouchActionNone:function(r){void 0!==(r=e.getElement(r)).style.touchAction?r.style.touchAction="none":void 0!==r.style.msTouchAction&&(r.style.msTouchAction="none")},setElementPointerEvents:function(r,s){void 0!==(r=e.getElement(r)).style&&void 0!==r.style.pointerEvents&&(r.style.pointerEvents=s)},setElementPointerEventsNone:function(r){e.setElementPointerEvents(r,"none")},addClass:function(r,s){(r=e.getElement(r)).className?-1===(" "+r.className+" ").indexOf(" "+s+" ")&&(r.className+=" "+s):r.className=s},indexOf:function(r,s,l){return this.indexOf=Array.prototype.indexOf?function(u,v,d){return u.indexOf(v,d)}:function(u,v,T){var m,w;if(T=T||0,!u)throw new TypeError;if(0===(w=u.length)||w<=T)return-1;for(m=T=T<0?w-Math.abs(T):T;m<w;m++)if(u[m]===v)return m;return-1},this.indexOf(r,s,l)},removeClass:function(r,s){var l,u,v=[];for(l=(r=e.getElement(r)).className.split(/\s+/),u=0;u<l.length;u++)l[u]&&l[u]!==s&&v.push(l[u]);r.className=v.join(" ")},normalizeEventListenerOptions:function(r){return void 0!==r?"boolean"==typeof r?e.supportsEventListenerOptions?{capture:r}:r:e.supportsEventListenerOptions?r:void 0!==r.capture&&r.capture:!!e.supportsEventListenerOptions&&{capture:!1}},addEvent:function(){if(e.supportsAddEventListener)return function(r,s,l,u){u=e.normalizeEventListenerOptions(u),(r=e.getElement(r)).addEventListener(s,l,u)};if(document.documentElement.attachEvent&&document.attachEvent)return function(r,s,l){(r=e.getElement(r)).attachEvent("on"+s,l)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(r,s,l,u){u=e.normalizeEventListenerOptions(u),(r=e.getElement(r)).removeEventListener(s,l,u)};if(document.documentElement.detachEvent&&document.detachEvent)return function(r,s,l){(r=e.getElement(r)).detachEvent("on"+s,l)};throw new Error("No known event model.")}(),cancelEvent:function(r){r.preventDefault()},eventIsCanceled:function(r){return r.defaultPrevented},stopEvent:function(r){r.stopPropagation()},createCallback:function(r,s){var l,u=[];for(l=2;l<arguments.length;l++)u.push(arguments[l]);return function(){var v,d=u.concat([]);for(v=0;v<arguments.length;v++)d.push(arguments[v]);return s.apply(r,d)}},getUrlParameter:function(r){return(r=a[r])||null},getUrlProtocol:function(r){return null===(r=r.match(/^([a-z]+:)\/\//i))?window.location.protocol:r[1].toLowerCase()},createAjaxRequest:function(r){var s;try{s=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{s=!1}if(s)e.createAjaxRequest=window.XMLHttpRequest?function(l){return l?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");e.createAjaxRequest=function(){return new XMLHttpRequest}}return e.createAjaxRequest(r)},makeAjaxRequest:function(r,s,l){var u,v,d,m;e.isPlainObject(r)&&(s=r.success,l=r.error,u=r.withCredentials,v=r.headers,d=r.responseType||null,m=r.postData||null,r=r.url);var w=e.getUrlProtocol(r),T=e.createAjaxRequest("file:"===w);if(!e.isFunction(s))throw new Error("makeAjaxRequest requires a success callback");T.onreadystatechange=function(){4===T.readyState&&(T.onreadystatechange=function(){},200<=T.status&&T.status<300||0===T.status&&"http:"!==w&&"https:"!==w?s(T):e.isFunction(l)?l(T):e.console.error("AJAX request returned %d: %s",T.status,r))};var S=m?"POST":"GET";try{if(T.open(S,r,!0),d&&(T.responseType=d),v)for(var P in v)Object.prototype.hasOwnProperty.call(v,P)&&v[P]&&T.setRequestHeader(P,v[P]);u&&(T.withCredentials=!0),T.send(m)}catch(_){e.console.error("%s while making AJAX request: %s",_.name,_.message),T.onreadystatechange=function(){},e.isFunction(l)&&l(T,_)}return T},jsonp:function(r){var s,l=r.url,u=document.head||document.getElementsByTagName("head")[0]||document.documentElement,v=r.callbackName||"openseadragon"+e.now(),d=window[v],m=r.param||"callback",w=r.callback;l=l.replace(/(=)\?(&|$)|\?\?/i,"$1"+v+"$2"),l+=(/\?/.test(l)?"&":"?")+m+"="+v,window[v]=function(T){if(d)window[v]=d;else try{delete window[v]}catch{}w&&e.isFunction(w)&&w(T)},s=document.createElement("script"),void 0===r.async&&!1===r.async||(s.async="async"),r.scriptCharset&&(s.charset=r.scriptCharset),s.src=l,s.onload=s.onreadystatechange=function(T,S){(S||!s.readyState||/loaded|complete/.test(s.readyState))&&(s.onload=s.onreadystatechange=null,u&&s.parentNode&&u.removeChild(s),s=void 0)},u.insertBefore(s,u.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(r){if(window.DOMParser)e.parseXml=function(s){return(new DOMParser).parseFromString(s,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");e.parseXml=function(s){var l=null;return(l=new ActiveXObject("Microsoft.XMLDOM")).async=!1,l.loadXML(s),l}}return e.parseXml(r)},parseJSON:function(r){return e.parseJSON=window.JSON.parse,e.parseJSON(r)},imageFormatSupported:function(r){return!!i[(r=r||"").toLowerCase()]},setImageFormatsSupported:function(r){e.extend(i,r)}}),e.console=window.console||{log:t,debug:t,info:t,warn:t,error:t,assert:t};var i={bmp:!(e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0}),jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},a={};function n(r,s){return s&&r!==document.body?document.body:r.offsetParent}(function(){var r=navigator.appVersion,s=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(s.substring(s.indexOf("MSIE")+5,s.indexOf(";",s.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=s.indexOf("Edge")?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(s.substring(s.indexOf("Edge")+5))):0<=s.indexOf("Edg")?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(s.substring(s.indexOf("Edg")+4))):0<=s.indexOf("Firefox")?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(s.substring(s.indexOf("Firefox")+8))):0<=s.indexOf("Safari")?(e.Browser.vendor=0<=s.indexOf("Chrome")?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(s.substring(s.substring(0,s.indexOf("Safari")).lastIndexOf("/")+1,s.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(s)&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(r)}var l,u,v=window.location.search.substring(1).split("&");for(u=0;u<v.length;u++)if(0<(m=(l=v[u]).indexOf("="))){var d=l.substring(0,m),m=l.substring(m+1);try{a[d]=decodeURIComponent(m)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",d,m)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(r){var s=r.requestAnimationFrame||r.mozRequestAnimationFrame||r.webkitRequestAnimationFrame||r.msRequestAnimationFrame,l=r.cancelAnimationFrame||r.mozCancelAnimationFrame||r.webkitCancelAnimationFrame||r.msCancelAnimationFrame;if(s&&l)e.requestAnimationFrame=function(){return s.apply(r,arguments)},e.cancelAnimationFrame=function(){return l.apply(r,arguments)};else{var u,v=[],d=[],m=0;e.requestAnimationFrame=function(w){return v.push([++m,w]),u=u||setInterval(function(){if(v.length){var T=e.now(),S=d;for(d=v,v=S;d.length;)d.shift()[1](T)}else clearInterval(u),u=void 0},20),m},e.cancelAnimationFrame=function(w){var T,S;for(T=0,S=v.length;T<S;T+=1)if(v[T][0]===w)return void v.splice(T,1);for(T=0,S=d.length;T<S;T+=1)if(d[T][0]===w)return void d.splice(T,1)}}}(window)}(OpenSeadragon),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.OpenSeadragon=t()}(this,function(){return OpenSeadragon}),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(i){return i.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(i){return i.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(i){return i.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(i){return i.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(i){return i.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return null!==t.getFullScreenElement()},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(OpenSeadragon),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(t,i,a,n){var r=this;n=n||1;var s=0;this.addHandler(t,function l(u){++s===n&&r.removeHandler(t,l),i(u)},a)},addHandler:function(t,i,a){var n=this.events[t];n||(this.events[t]=n=[]),i&&e.isFunction(i)&&(n[n.length]={handler:i,userData:a||null})},removeHandler:function(t,i){var a,n=this.events[t],r=[];if(n&&e.isArray(n)){for(a=0;a<n.length;a++)n[a].handler!==i&&r.push(n[a]);this.events[t]=r}},numberOfHandlers:function(t){return(t=this.events[t])?t.length:0},removeAllHandlers:function(t){if(t)this.events[t]=[];else for(var i in this.events)this.events[i]=[]},getHandler:function(t){var i=this.events[t];return i&&i.length?(i=1===i.length?[i[0]]:Array.apply(null,i),function(a,n){var r,s=i.length;for(r=0;r<s;r++)i[r]&&(n.eventSource=a,n.userData=i[r].userData,i[r].handler(n))}):null},raiseEvent:function(t,i){(t=this.getHandler(t))&&t(this,i=i||{})}}}(OpenSeadragon),function(e){var t=[],i={};e.MouseTracker=function(p){t.push(this);var o=arguments;e.isPlainObject(p)||(p={element:o[0],clickTimeThreshold:o[1],clickDistThreshold:o[2]}),this.hash=Math.random(),this.element=e.getElement(p.element),this.clickTimeThreshold=p.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=p.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=p.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=p.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=p.userData||null,this.stopDelay=p.stopDelay||50,this.preProcessEventHandler=p.preProcessEventHandler||null,this.contextMenuHandler=p.contextMenuHandler||null,this.enterHandler=p.enterHandler||null,this.leaveHandler=p.leaveHandler||null,this.exitHandler=p.exitHandler||null,this.overHandler=p.overHandler||null,this.outHandler=p.outHandler||null,this.pressHandler=p.pressHandler||null,this.nonPrimaryPressHandler=p.nonPrimaryPressHandler||null,this.releaseHandler=p.releaseHandler||null,this.nonPrimaryReleaseHandler=p.nonPrimaryReleaseHandler||null,this.moveHandler=p.moveHandler||null,this.scrollHandler=p.scrollHandler||null,this.clickHandler=p.clickHandler||null,this.dblClickHandler=p.dblClickHandler||null,this.dragHandler=p.dragHandler||null,this.dragEndHandler=p.dragEndHandler||null,this.pinchHandler=p.pinchHandler||null,this.stopHandler=p.stopHandler||null,this.keyDownHandler=p.keyDownHandler||null,this.keyUpHandler=p.keyUpHandler||null,this.keyHandler=p.keyHandler||null,this.focusHandler=p.focusHandler||null,this.blurHandler=p.blurHandler||null;var h=this;i[this.hash]={click:function(c){var g,x;z(h,x={originalEvent:g=c,eventType:"click",pointerType:"mouse",isEmulated:!1}),x.preventDefault&&!x.defaultPrevented&&e.cancelEvent(g),x.stopPropagation&&e.stopEvent(g)},dblclick:function(c){var g,x;z(h,x={originalEvent:g=c,eventType:"dblclick",pointerType:"mouse",isEmulated:!1}),x.preventDefault&&!x.defaultPrevented&&e.cancelEvent(g),x.stopPropagation&&e.stopEvent(g)},keydown:function(c){var f,g,x,y;x=null,z(f=h,y={originalEvent:g=c,eventType:"keydown",pointerType:"",isEmulated:!1}),f.keyDownHandler&&!y.preventGesture&&!y.defaultPrevented&&f.keyDownHandler(x={eventSource:f,keyCode:g.keyCode||g.charCode,ctrl:g.ctrlKey,shift:g.shiftKey,alt:g.altKey,meta:g.metaKey,originalEvent:g,preventDefault:y.preventDefault||y.defaultPrevented,userData:f.userData}),(x&&x.preventDefault||y.preventDefault&&!y.defaultPrevented)&&e.cancelEvent(g),y.stopPropagation&&e.stopEvent(g)},keyup:function(c){var f,g,x,y;x=null,z(f=h,y={originalEvent:g=c,eventType:"keyup",pointerType:"",isEmulated:!1}),f.keyUpHandler&&!y.preventGesture&&!y.defaultPrevented&&f.keyUpHandler(x={eventSource:f,keyCode:g.keyCode||g.charCode,ctrl:g.ctrlKey,shift:g.shiftKey,alt:g.altKey,meta:g.metaKey,originalEvent:g,preventDefault:y.preventDefault||y.defaultPrevented,userData:f.userData}),(x&&x.preventDefault||y.preventDefault&&!y.defaultPrevented)&&e.cancelEvent(g),y.stopPropagation&&e.stopEvent(g)},keypress:function(c){var f,g,x,y;x=null,z(f=h,y={originalEvent:g=c,eventType:"keypress",pointerType:"",isEmulated:!1}),f.keyHandler&&!y.preventGesture&&!y.defaultPrevented&&f.keyHandler(x={eventSource:f,keyCode:g.keyCode||g.charCode,ctrl:g.ctrlKey,shift:g.shiftKey,alt:g.altKey,meta:g.metaKey,originalEvent:g,preventDefault:y.preventDefault||y.defaultPrevented,userData:f.userData}),(x&&x.preventDefault||y.preventDefault&&!y.defaultPrevented)&&e.cancelEvent(g),y.stopPropagation&&e.stopEvent(g)},focus:function(c){var f,g,x;z(f=h,x={originalEvent:g=c,eventType:"focus",pointerType:"",isEmulated:!1}),f.focusHandler&&!x.preventGesture&&f.focusHandler({eventSource:f,originalEvent:g,userData:f.userData})},blur:function(c){var f,g,x;z(f=h,x={originalEvent:g=c,eventType:"blur",pointerType:"",isEmulated:!1}),f.blurHandler&&!x.preventGesture&&f.blurHandler({eventSource:f,originalEvent:g,userData:f.userData})},contextmenu:function(c){var f,g,x,y;x=null,z(f=h,y={originalEvent:g=c,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1}),f.contextMenuHandler&&!y.preventGesture&&!y.defaultPrevented&&(x={eventSource:f,position:D(C(g),f.element),originalEvent:y.originalEvent,preventDefault:y.preventDefault||y.defaultPrevented,userData:f.userData},f.contextMenuHandler(x)),(x&&x.preventDefault||y.preventDefault&&!y.defaultPrevented)&&e.cancelEvent(g),y.stopPropagation&&e.stopEvent(g)},wheel:function(c){K(h,c,c)},mousewheel:function(c){W(h,c)},DOMMouseScroll:function(c){W(h,c)},MozMousePixelScroll:function(c){W(h,c)},losecapture:function(c){var f,g,x,y;x={id:e.MouseTracker.mousePointerId,type:"mouse"},z(f=h,y={originalEvent:g=c,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1}),g.target===f.element&&A(f,x,!1),y.stopPropagation&&e.stopEvent(g)},mouseenter:function(c){Y(h,c)},mouseleave:function(c){Q(h,c)},mouseover:function(c){$(h,c)},mouseout:function(c){V(h,c)},mousedown:function(c){G(h,c)},mouseup:function(c){j(h,c)},mousemove:function(c){J(h,c)},touchstart:function(c){!function(f,g){var x,y,E,k=g.changedTouches.length,b=f.getActivePointersListByType("touch");x=e.now(),b.getLength()>g.touches.length-k&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var H={originalEvent:g,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(z(f,H),y=0;y<k;y++)te(f,H,E={id:g.changedTouches[y].identifier,type:"touch",isPrimary:0===b.getLength(),currentPos:C(g.changedTouches[y]),currentTime:x}),ne(f,H,E,0),A(f,E,!0);H.preventDefault&&!H.defaultPrevented&&e.cancelEvent(g),H.stopPropagation&&e.stopEvent(g)}(h,c)},touchend:function(c){!function(f,g){var x,y,E,k=g.changedTouches.length;x=e.now();var b={originalEvent:g,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(z(f,b),y=0;y<k;y++)oe(f,b,E={id:g.changedTouches[y].identifier,type:"touch",currentPos:C(g.changedTouches[y]),currentTime:x},0),A(f,E,!1),ie(f,b,E);b.preventDefault&&!b.defaultPrevented&&e.cancelEvent(g),b.stopPropagation&&e.stopEvent(g)}(h,c)},touchmove:function(c){!function(f,g){var x,y,k=g.changedTouches.length;x=e.now();var b={originalEvent:g,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(z(f,b),y=0;y<k;y++)re(f,b,{id:g.changedTouches[y].identifier,type:"touch",currentPos:C(g.changedTouches[y]),currentTime:x});b.preventDefault&&!b.defaultPrevented&&e.cancelEvent(g),b.stopPropagation&&e.stopEvent(g)}(h,c)},touchcancel:function(c){!function(f,g){var x,E=g.changedTouches.length,k={originalEvent:g,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(z(f,k),x=0;x<E;x++)se(f,0,{id:g.changedTouches[x].identifier,type:"touch"});k.stopPropagation&&e.stopEvent(g)}(h,c)},gesturestart:function(c){e.eventIsCanceled(c)||c.preventDefault()},gesturechange:function(c){e.eventIsCanceled(c)||c.preventDefault()},gotpointercapture:function(c){var f,g,x;z(f=h,x={originalEvent:g=c,eventType:"gotpointercapture",pointerType:_(g),isEmulated:!1}),g.target===f.element&&A(f,{id:g.pointerId,type:_(g)},!0),x.stopPropagation&&e.stopEvent(g)},lostpointercapture:function(c){var f,g,x;z(f=h,x={originalEvent:g=c,eventType:"lostpointercapture",pointerType:_(g),isEmulated:!1}),g.target===f.element&&A(f,{id:g.pointerId,type:_(g)},!1),x.stopPropagation&&e.stopEvent(g)},pointerenter:function(c){Y(h,c)},pointerleave:function(c){Q(h,c)},pointerover:function(c){$(h,c)},pointerout:function(c){V(h,c)},pointerdown:function(c){G(h,c)},pointerup:function(c){j(h,c)},pointermove:function(c){J(h,c)},pointercancel:function(c){var f,g,x,y;f=h,x={id:(g=c).pointerId,type:_(g)},z(f,y={originalEvent:g,eventType:"pointercancel",pointerType:x.type,isEmulated:!1}),se(f,0,x),y.stopPropagation&&e.stopEvent(g)},pointerupcaptured:function(c){var f,g;(f=h).getActivePointersListByType(_(g=c)).getById(g.pointerId)&&I(f,g),e.stopEvent(g)},pointermovecaptured:function(c){var f,g;(f=h).getActivePointersListByType(_(g=c)).getById(g.pointerId)&&ee(f,g),e.stopEvent(g)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),p.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var p;for(w(this),this.element=null,p=0;p<t.length;p++)if(t[p]===this){t.splice(p,1);break}i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(p){return(p?function(o){var h,c,f=i[o.hash];if(!f.tracking){for(c=0;c<e.MouseTracker.subscribeEvents.length;c++)e.addEvent(o.element,h=e.MouseTracker.subscribeEvents[c],f[h],h===e.MouseTracker.wheelEventName&&{passive:!1,capture:!1});m(o),f.tracking=!0}}:w)(this),this},getActivePointersListByType:function(p){var o,h,c=i[this.hash],f=c.activePointersLists.length;for(o=0;o<f;o++)if(c.activePointersLists[o].type===p)return c.activePointersLists[o];return h=new e.MouseTracker.GesturePointList(p),c.activePointersLists.push(h),h},getActivePointerCount:function(){var p,o=i[this.hash],h=o.activePointersLists.length,c=0;for(p=0;p<h;p++)c+=o.activePointersLists[p].getLength();return c},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var l,u,v,d,a=function(){try{return window.self!==window.top}catch{return!0}}();function n(p){try{return p.addEventListener&&p.removeEventListener}catch{return}}function r(p,o){return p.hash.toString()+o.type+o.id.toString()}function s(){var p,o,h,c,f,g=l.length,x=e.now();for(c=x-v,v=x,p=0;p<g;p++)(h=(o=l[p]).gPoint).direction=Math.atan2(h.currentPos.y-o.lastPos.y,h.currentPos.x-o.lastPos.x),f=o.lastPos.distanceTo(h.currentPos),o.lastPos=h.currentPos,h.speed=1e3*f/(1+c)*.75+.25*h.speed}function m(p){var o,h,c,f,g,x=i[p.hash],y=x.activePointersLists.length;for(o=0;o<y;o++)if(0<(c=x.activePointersLists[o]).getLength()){for(g=[],f=c.asArray(),h=0;h<f.length;h++)g.push(f[h]);for(h=0;h<g.length;h++)U(p,c,g[h])}for(o=0;o<y;o++)x.activePointersLists.pop();x.sentDragEvent=!1}function w(p){var o,h,c=i[p.hash];if(c.tracking){for(h=0;h<e.MouseTracker.subscribeEvents.length;h++)e.removeEvent(p.element,o=e.MouseTracker.subscribeEvents[h],c[o],!1);m(p),c.tracking=!1}}function T(p,o){if(p=i[p.hash],"pointerevent"===o)return{upName:"pointerup",upHandler:p.pointerupcaptured,moveName:"pointermove",moveHandler:p.pointermovecaptured};if("mouse"===o)return{upName:"pointerup",upHandler:p.pointerupcaptured,moveName:"pointermove",moveHandler:p.pointermovecaptured};if("touch"===o)return{upName:"touchend",upHandler:p.touchendcaptured,moveName:"touchmove",moveHandler:p.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function S(p,o){var h;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(!(h=p.getActivePointersListByType(o.type).getById(o.id))||!h.captured)return;try{p.element.releasePointerCapture(o.id)}catch{}}else p.element.releaseCapture();else h=T(p,e.MouseTracker.havePointerEvents?"pointerevent":o.type),a&&n(window.top)&&e.removeEvent(window.top,h.upName,h.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,h.moveName,h.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,h.upName,h.upHandler,!0);A(p,o,!1)}function P(p){return e.MouseTracker.havePointerEvents?p.pointerId:e.MouseTracker.mousePointerId}function _(p){return e.MouseTracker.havePointerEvents?p.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function R(p){return!e.MouseTracker.havePointerEvents||p.isPrimary}function C(p){return e.getMousePosition(p)}function B(p,o){return D(C(p),o)}function D(p,o){return o=e.getElementOffset(o),p.minus(o)}function L(p,o){return new e.Point((p.x+o.x)/2,(p.y+o.y)/2)}function W(p,o){var h={target:o.target||o.srcElement,type:"wheel",shiftKey:o.shiftKey||!1,clientX:o.clientX,clientY:o.clientY,pageX:o.pageX||o.clientX,pageY:o.pageY||o.clientY,deltaMode:"MozMousePixelScroll"===o.type?0:1,deltaX:0,deltaZ:0};h.deltaY="mousewheel"===e.MouseTracker.wheelEventName?-o.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:o.detail,K(p,h,o)}function K(p,o,h){var c,f,g=null;c=o.deltaY<0?1:-1,z(p,f={originalEvent:o,eventType:"wheel",pointerType:"mouse",isEmulated:o!==h}),p.scrollHandler&&!f.preventGesture&&!f.defaultPrevented&&(g={eventSource:p,pointerType:"mouse",position:B(o,p.element),scroll:c,shift:o.shiftKey,isTouchEvent:!1,originalEvent:h,preventDefault:f.preventDefault||f.defaultPrevented,userData:p.userData},p.scrollHandler(g)),f.stopPropagation&&e.stopEvent(h),(g&&g.preventDefault||f.preventDefault&&!f.defaultPrevented)&&e.cancelEvent(h)}function Y(p,o){var h={id:P(o),type:_(o),isPrimary:R(o),currentPos:C(o),currentTime:e.now()};z(p,o={originalEvent:o,eventType:"pointerenter",pointerType:h.type,isEmulated:!1}),te(p,o,h)}function Q(p,o){var h={id:P(o),type:_(o),isPrimary:R(o),currentPos:C(o),currentTime:e.now()};z(p,o={originalEvent:o,eventType:"pointerleave",pointerType:h.type,isEmulated:!1}),ie(p,o,h)}function $(p,o){var f,g,x,y,E,h={id:P(o),type:_(o),isPrimary:R(o),currentPos:C(o),currentTime:e.now()},c={originalEvent:o,eventType:"pointerover",pointerType:h.type,isEmulated:!1};z(p,c),g=c,(E=(y=(f=p).getActivePointersListByType((x=h).type)).getById(x.id))?x=E:(x.captured=!1,x.insideElementPressed=!1),f.overHandler&&f.overHandler({eventSource:f,pointerType:x.type,position:D(x.currentPos,f.element),buttons:y.buttons,pointers:f.getActivePointerCount(),insideElementPressed:x.insideElementPressed,buttonDownAny:0!==y.buttons,isTouchEvent:"touch"===x.type,originalEvent:g.originalEvent,userData:f.userData}),c.preventDefault&&!c.defaultPrevented&&e.cancelEvent(o),c.stopPropagation&&e.stopEvent(o)}function V(p,o){var f,g,x,y,E,h={id:P(o),type:_(o),isPrimary:R(o),currentPos:C(o),currentTime:e.now()},c={originalEvent:o,eventType:"pointerout",pointerType:h.type,isEmulated:!1};z(p,c),g=c,(E=(y=(f=p).getActivePointersListByType((x=h).type)).getById(x.id))?x=E:(x.captured=!1,x.insideElementPressed=!1),f.outHandler&&f.outHandler({eventSource:f,pointerType:x.type,position:x.currentPos&&D(x.currentPos,f.element),buttons:y.buttons,pointers:f.getActivePointerCount(),insideElementPressed:x.insideElementPressed,buttonDownAny:0!==y.buttons,isTouchEvent:"touch"===x.type,originalEvent:g.originalEvent,userData:f.userData}),c.preventDefault&&!c.defaultPrevented&&e.cancelEvent(o),c.stopPropagation&&e.stopEvent(o)}function G(p,o){var h={id:P(o),type:_(o),isPrimary:R(o),currentPos:C(o),currentTime:e.now()},c=e.MouseTracker.havePointerEvents&&"touch"===h.type&&e.Browser.vendor!==e.BROWSERS.IE,f={originalEvent:o,eventType:"pointerdown",pointerType:h.type,isEmulated:!1};z(p,f),ne(p,f,h,o.button),f.preventDefault&&!f.defaultPrevented&&e.cancelEvent(o),f.stopPropagation&&e.stopEvent(o),f.shouldCapture&&(c?A(p,h,!0):function(g,x){var y;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{g.element.setPointerCapture(x.id)}catch{return void e.console.warn("setPointerCapture() called on invalid pointer ID")}else g.element.setCapture(!0);else y=T(g,e.MouseTracker.havePointerEvents?"pointerevent":x.type),a&&n(window.top)&&e.addEvent(window.top,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.moveName,y.moveHandler,!0);A(g,x,!0)}(p,h))}function j(p,o){I(p,o)}function I(p,o){var h,c={originalEvent:o,eventType:"pointerup",pointerType:(h={id:P(o),type:_(o),isPrimary:R(o),currentPos:C(o),currentTime:e.now()}).type,isEmulated:!1};z(p,c),oe(p,c,h,o.button),c.preventDefault&&!c.defaultPrevented&&e.cancelEvent(o),c.stopPropagation&&e.stopEvent(o),c.shouldReleaseCapture&&(o.target===p.element?S(p,h):A(p,h,!1))}function J(p,o){ee(p,o)}function ee(p,o){var h={id:P(o),type:_(o),isPrimary:R(o),currentPos:C(o),currentTime:e.now()},c={originalEvent:o,eventType:"pointermove",pointerType:h.type,isEmulated:!1};z(p,c),re(p,c,h),c.preventDefault&&!c.defaultPrevented&&e.cancelEvent(o),c.stopPropagation&&e.stopEvent(o)}function q(p,o){return o.speed=0,o.direction=0,o.contactPos=o.currentPos,o.contactTime=o.currentTime,o.lastPos=o.currentPos,o.lastTime=o.currentTime,p.add(o)}function U(p,o,h){var c,f=o.getById(h.id);return f?(f.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),S(p,f)),o.removeContact(),c=o.removeById(h.id)):c=o.getLength(),c}function z(p,o){o.eventSource=p,o.eventPhase=o.originalEvent&&void 0!==o.originalEvent.eventPhase?o.originalEvent.eventPhase:0,o.defaultPrevented=e.eventIsCanceled(o.originalEvent),o.shouldCapture=!1,o.shouldReleaseCapture=!1,o.userData=p.userData,function(h,c){switch(c.eventType){case"pointermove":case"pointerdown":case"pointerup":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!1,c.preventGesture=!h.hasGestureHandlers,c.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!1,c.preventGesture=!1,c.stopPropagation=!1;break;case"wheel":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!1,c.preventGesture=!h.hasScrollHandler,c.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":c.isStoppable=!0,c.isCancelable=!1,c.preventDefault=!1,c.preventGesture=!1,c.stopPropagation=!1;break;case"click":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!!h.clickHandler,c.preventGesture=!1,c.stopPropagation=!1;break;case"dblclick":c.isStoppable=!0,c.isCancelable=!0,c.preventDefault=!!h.dblClickHandler,c.preventGesture=!1,c.stopPropagation=!1;break;default:c.isStoppable=!1,c.isCancelable=!1,c.preventDefault=!1,c.preventGesture=!1,c.stopPropagation=!1}}(p,o),p.preProcessEventHandler&&p.preProcessEventHandler(o)}function A(p,o,h){(o=(p=p.getActivePointersListByType(o.type)).getById(o.id))?h&&!o.captured?(o.captured=!0,p.captureCount++):!h&&o.captured&&(o.captured=!1,p.captureCount--,p.captureCount<0&&(p.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function te(p,o,h){var c,f=p.getActivePointersListByType(h.type);(c=f.getById(h.id))?(c.insideElement=!0,c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=h.currentPos,c.currentTime=h.currentTime,h=c):(h.captured=!1,h.insideElementPressed=!1,h.insideElement=!0,q(f,h)),p.enterHandler&&p.enterHandler({eventSource:p,pointerType:h.type,position:D(h.currentPos,p.element),buttons:f.buttons,pointers:p.getActivePointerCount(),insideElementPressed:h.insideElementPressed,buttonDownAny:0!==f.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:p.userData})}function ie(p,o,h){var c,f=p.getActivePointersListByType(h.type);(c=f.getById(h.id))?(c.captured?(c.insideElement=!1,c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=h.currentPos,c.currentTime=h.currentTime):U(p,f,c),h=c):(h.captured=!1,h.insideElementPressed=!1),(p.leaveHandler||p.exitHandler)&&(o={eventSource:p,pointerType:h.type,position:h.currentPos&&D(h.currentPos,p.element),buttons:f.buttons,pointers:p.getActivePointerCount(),insideElementPressed:h.insideElementPressed,buttonDownAny:0!==f.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:p.userData},p.leaveHandler&&p.leaveHandler(o),p.exitHandler&&p.exitHandler(o))}function ne(p,o,h,c){var f,g=i[p.hash],x=p.getActivePointersListByType(h.type);void 0!==o.originalEvent.buttons?x.buttons=o.originalEvent.buttons:0===c?x.buttons|=1:1===c?x.buttons|=4:2===c?x.buttons|=2:3===c?x.buttons|=8:4===c?x.buttons|=16:5===c&&(x.buttons|=32),0===c?((f=x.getById(h.id))?(f.insideElementPressed=!0,f.insideElement=!0,f.originalTarget=o.originalEvent.target,f.contactPos=h.currentPos,f.contactTime=h.currentTime,f.lastPos=f.currentPos,f.lastTime=f.currentTime,f.currentPos=h.currentPos,f.currentTime=h.currentTime,h=f):(h.captured=!1,h.insideElementPressed=!0,h.insideElement=!0,h.originalTarget=o.originalEvent.target,q(x,h)),x.addContact(),o.preventGesture||o.defaultPrevented?(o.shouldCapture=!1,o.shouldReleaseCapture=!1):(o.shouldCapture=!0,o.shouldReleaseCapture=!1,o.preventDefault=!0,(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(p,h),1===x.contacts?p.pressHandler&&!o.preventGesture&&p.pressHandler({eventSource:p,pointerType:h.type,position:D(h.contactPos,p.element),buttons:x.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:p.userData}):2===x.contacts&&p.pinchHandler&&"touch"===h.type&&(g.pinchGPoints=x.asArray(),g.lastPinchDist=g.currentPinchDist=g.pinchGPoints[0].currentPos.distanceTo(g.pinchGPoints[1].currentPos),g.lastPinchCenter=g.currentPinchCenter=L(g.pinchGPoints[0].currentPos,g.pinchGPoints[1].currentPos)))):(o.shouldCapture=!1,o.shouldReleaseCapture=!1,p.nonPrimaryPressHandler&&!o.preventGesture&&!o.defaultPrevented&&(o.preventDefault=!0,p.nonPrimaryPressHandler({eventSource:p,pointerType:h.type,position:D(h.currentPos,p.element),button:c,buttons:x.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:p.userData})))}function oe(p,o,h,c){var f,g,x,y=i[p.hash],E=p.getActivePointersListByType(h.type),k=!1;void 0!==o.originalEvent.buttons?E.buttons=o.originalEvent.buttons:0===c?E.buttons^=-2:1===c?E.buttons^=-5:2===c?E.buttons^=-3:3===c?E.buttons^=-9:4===c?E.buttons^=-17:5===c&&(E.buttons^=-33),o.shouldCapture=!1,0===c?((g=E.getById(h.id))?(E.removeContact(),g.captured&&(k=!0),g.lastPos=g.currentPos,g.lastTime=g.currentTime,g.currentPos=h.currentPos,g.currentTime=h.currentTime,g.insideElement||U(p,E,g),f=g.currentPos,x=g.currentTime):(h.captured=!1,h.insideElementPressed=!1,h.insideElement=!0,q(E,h),g=h),!o.preventGesture&&!o.defaultPrevented&&(k?(o.shouldReleaseCapture=!0,o.preventDefault=!0,(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(p,g),0===E.contacts?(p.releaseHandler&&f&&p.releaseHandler({eventSource:p,pointerType:g.type,position:D(f,p.element),buttons:E.buttons,insideElementPressed:g.insideElementPressed,insideElementReleased:g.insideElement,isTouchEvent:"touch"===g.type,originalEvent:o.originalEvent,userData:p.userData}),p.dragEndHandler&&y.sentDragEvent&&p.dragEndHandler({eventSource:p,pointerType:g.type,position:D(g.currentPos,p.element),speed:g.speed,direction:g.direction,shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===g.type,originalEvent:o.originalEvent,userData:p.userData}),y.sentDragEvent=!1,(p.clickHandler||p.dblClickHandler)&&g.insideElement&&(x=x-g.contactTime<=p.clickTimeThreshold&&g.contactPos.distanceTo(f)<=p.clickDistThreshold,p.clickHandler&&p.clickHandler({eventSource:p,pointerType:g.type,position:D(g.currentPos,p.element),quick:x,shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===g.type,originalEvent:o.originalEvent,originalTarget:g.originalTarget,userData:p.userData}),p.dblClickHandler&&x&&(E.clicks++,1===E.clicks?(y.lastClickPos=f,y.dblClickTimeOut=setTimeout(function(){E.clicks=0},p.dblClickTimeThreshold)):2===E.clicks&&(clearTimeout(y.dblClickTimeOut),E.clicks=0,y.lastClickPos.distanceTo(f)<=p.dblClickDistThreshold&&p.dblClickHandler({eventSource:p,pointerType:g.type,position:D(g.currentPos,p.element),shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===g.type,originalEvent:o.originalEvent,userData:p.userData}),y.lastClickPos=null)))):2===E.contacts&&p.pinchHandler&&"touch"===g.type&&(y.pinchGPoints=E.asArray(),y.lastPinchDist=y.currentPinchDist=y.pinchGPoints[0].currentPos.distanceTo(y.pinchGPoints[1].currentPos),y.lastPinchCenter=y.currentPinchCenter=L(y.pinchGPoints[0].currentPos,y.pinchGPoints[1].currentPos))):(o.shouldReleaseCapture=!1,p.releaseHandler&&f&&(p.releaseHandler({eventSource:p,pointerType:g.type,position:D(f,p.element),buttons:E.buttons,insideElementPressed:g.insideElementPressed,insideElementReleased:g.insideElement,isTouchEvent:"touch"===g.type,originalEvent:o.originalEvent,userData:p.userData}),o.preventDefault=!0)))):(o.shouldReleaseCapture=!1,p.nonPrimaryReleaseHandler&&!o.preventGesture&&!o.defaultPrevented&&(o.preventDefault=!0,p.nonPrimaryReleaseHandler({eventSource:p,pointerType:h.type,position:D(h.currentPos,p.element),button:c,buttons:E.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:p.userData})))}function re(p,o,h){var c,f,g=i[p.hash],x=p.getActivePointersListByType(h.type);void 0!==o.originalEvent.buttons&&(x.buttons=o.originalEvent.buttons),(c=x.getById(h.id))&&(c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=h.currentPos,c.currentTime=h.currentTime,o.shouldCapture=!1,o.shouldReleaseCapture=!1,p.stopHandler&&"mouse"===h.type&&(clearTimeout(p.stopTimeOut),p.stopTimeOut=setTimeout(function(){var y,E,k;E=o.originalEvent,k=h.type,(y=p).stopHandler&&y.stopHandler({eventSource:y,pointerType:k,position:B(E,y.element),buttons:y.getActivePointersListByType(k).buttons,isTouchEvent:"touch"===k,originalEvent:E,userData:y.userData})},p.stopDelay)),0===x.contacts?p.moveHandler&&p.moveHandler({eventSource:p,pointerType:h.type,position:D(h.currentPos,p.element),buttons:x.buttons,isTouchEvent:"touch"===h.type,originalEvent:o.originalEvent,userData:p.userData}):1===x.contacts?(p.moveHandler&&(c=x.asArray()[0],p.moveHandler({eventSource:p,pointerType:c.type,position:D(c.currentPos,p.element),buttons:x.buttons,isTouchEvent:"touch"===c.type,originalEvent:o.originalEvent,userData:p.userData})),p.dragHandler&&!o.preventGesture&&!o.defaultPrevented&&(f=(c=x.asArray()[0]).currentPos.minus(c.lastPos),p.dragHandler({eventSource:p,pointerType:c.type,position:D(c.currentPos,p.element),buttons:x.buttons,delta:f,speed:c.speed,direction:c.direction,shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===c.type,originalEvent:o.originalEvent,userData:p.userData}),o.preventDefault=!0,g.sentDragEvent=!0)):2===x.contacts&&(p.moveHandler&&(c=x.asArray(),p.moveHandler({eventSource:p,pointerType:c[0].type,position:D(L(c[0].currentPos,c[1].currentPos),p.element),buttons:x.buttons,isTouchEvent:"touch"===c[0].type,originalEvent:o.originalEvent,userData:p.userData})),p.pinchHandler&&"touch"===h.type&&!o.preventGesture&&!o.defaultPrevented&&(f=g.pinchGPoints[0].currentPos.distanceTo(g.pinchGPoints[1].currentPos))!==g.currentPinchDist&&(g.lastPinchDist=g.currentPinchDist,g.currentPinchDist=f,g.lastPinchCenter=g.currentPinchCenter,g.currentPinchCenter=L(g.pinchGPoints[0].currentPos,g.pinchGPoints[1].currentPos),p.pinchHandler({eventSource:p,pointerType:"touch",gesturePoints:g.pinchGPoints,lastCenter:D(g.lastPinchCenter,p.element),center:D(g.currentPinchCenter,p.element),lastDistance:g.lastPinchDist,distance:g.currentPinchDist,shift:o.originalEvent.shiftKey,originalEvent:o.originalEvent,userData:p.userData}),o.preventDefault=!0)))}function se(p,o,h){var c=p.getActivePointersListByType(h.type);(h=c.getById(h.id))&&U(p,c,h)}e.MouseTracker.gesturePointVelocityTracker=(l=[],v=u=0,{addPoint:function(p,o){p=r(p,o),l.push({guid:p,gPoint:o,lastPos:o.currentPos}),1===l.length&&(v=e.now(),u=window.setInterval(s,50))},removePoint:function(p,o){var h,c=r(p,o),f=l.length;for(h=0;h<f;h++)if(l[h].guid===c){l.splice(h,1),0==--f&&window.clearInterval(u);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&8<e.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],"DOMMouseScroll"===e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=(d=document.createElement("div"),e.isFunction(d.setPointerCapture)&&e.isFunction(d.releasePointerCapture)),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=(d=document.createElement("div"),e.isFunction(d.setCapture)&&e.isFunction(d.releaseCapture)),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(p){this._gPoints=[],this.type=p,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(p){return this._gPoints.push(p)},removeById:function(p){var o,h=this._gPoints.length;for(o=0;o<h;o++)if(this._gPoints[o].id===p){this._gPoints.splice(o,1);break}return this._gPoints.length},getByIndex:function(p){return p<this._gPoints.length?this._gPoints[p]:null},getById:function(p){var o,h=this._gPoints.length;for(o=0;o<h;o++)if(this._gPoints[o].id===p)return this._gPoints[o];return null},getPrimary:function(p){var o,h=this._gPoints.length;for(o=0;o<h;o++)if(this._gPoints[o].isPrimary)return this._gPoints[o];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,a){var n=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=void 0===i.attachToViewer||i.attachToViewer,this.autoFade=void 0===i.autoFade||i.autoFade,this.element=t,this.anchor=i.anchor,this.container=a,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):n.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!==this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){e.setElementOpacity(this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?this.element:this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(i,a){var n,r=i.controls;for(n=r.length-1;0<=n;n--)if(r[n].element===a)return n;return-1}e.ControlDock=function(i){var a,n,r=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<r.length;n++)this.controls[a=r[n]]=e.makeNeutralElement("div"),this.controls[a].style.position="absolute",a.match("left")&&(this.controls[a].style.left="0px"),a.match("right")&&(this.controls[a].style.right="0px"),a.match("top")&&(this.controls[a].style.top="0px"),a.match("bottom")&&(this.controls[a].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,a){var n=null;if(!(0<=t(this,i=e.getElement(i)))){switch(a.anchor){case e.ControlAnchor.TOP_RIGHT:n=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:n=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:n=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:n=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;default:n=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,a,n)),i.style.display="inline-block"}},removeControl:function(i){return 0<=(i=t(this,i=e.getElement(i)))&&(this.controls[i].destroy(),this.controls.splice(i,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;0<=i;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(i){var a;for(a=this.controls.length-1;0<=a;a--)this.controls[a].setVisible(i);return this}}}(OpenSeadragon),OpenSeadragon.Placement=OpenSeadragon.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}}),function(e){var t={},i=1;function a(o){return o=e.getElement(o),new e.Point(0===o.clientWidth?1:o.clientWidth,0===o.clientHeight?1:o.clientHeight)}function n(o,h){if(h instanceof e.Overlay)return h;var c=null;if(h.element)c=e.getElement(h.element);else{var f=h.id||"openseadragon-overlay-"+Math.floor(1e7*Math.random());(c=e.getElement(h.id))||((c=document.createElement("a")).href="#/overlay/"+f),c.id=f,e.addClass(c,h.className||"openseadragon-overlay")}var g=h.location,x=h.width,y=h.height;if(!g){f=h.x;var E=h.y;void 0!==h.px&&(f=(o=o.viewport.imageToViewportRectangle(new e.Rect(h.px,h.py,x||0,y||0))).x,E=o.y,x=void 0!==x?o.width:void 0,y=void 0!==y?o.height:void 0),g=new e.Point(f,E)}return(E=h.placement)&&"string"===e.type(E)&&(E=e.Placement[h.placement.toUpperCase()]),new e.Overlay({element:c,location:g,placement:E,onDraw:h.onDraw,checkResize:h.checkResize,width:x,height:y,rotationMode:h.rotationMode})}function r(o,h){var c;for(c=o.length-1;0<=c;c--)if(o[c].element===h)return c;return-1}function s(o,h){return e.requestAnimationFrame(function(){h(o)})}function l(o){e.requestAnimationFrame(function(){!function(h){var c,f,g;if(h.controlsShouldFade){for(c=e.now(),f=1-(c-=h.controlsFadeBeginTime)/h.controlsFadeLength,f=Math.min(1,f),f=Math.max(0,f),g=h.controls.length-1;0<=g;g--)h.controls[g].autoFade&&h.controls[g].setOpacity(f);0<f&&l(h)}}(o)})}function u(o){o.autoHideControls&&(o.controlsShouldFade=!0,o.controlsFadeBeginTime=e.now()+o.controlsFadeDelay,window.setTimeout(function(){l(o)},o.controlsFadeDelay))}function v(o){var h;for(o.controlsShouldFade=!1,h=o.controls.length-1;0<=h;h--)o.controls[h].setOpacity(1)}function d(){v(this)}function m(){u(this)}function w(o){var h={tracker:o.eventSource,position:o.position,originalEvent:o.originalEvent,preventDefault:o.preventDefault};this.raiseEvent("canvas-contextmenu",h),o.preventDefault=h.preventDefault}function T(o){var h={originalEvent:o.originalEvent,preventDefaultAction:!1,preventVerticalPan:o.preventVerticalPan||!this.panVertical,preventHorizontalPan:o.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",h),h.preventDefaultAction||o.ctrl||o.alt||o.meta)o.preventDefault=!1;else switch(o.keyCode){case 38:h.preventVerticalPan||(o.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 40:h.preventVerticalPan||(o.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 37:h.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 39:h.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;default:o.preventDefault=!1}}function S(o){var h={originalEvent:o.originalEvent,preventDefaultAction:!1,preventVerticalPan:o.preventVerticalPan||!this.panVertical,preventHorizontalPan:o.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",h),h.preventDefaultAction||o.ctrl||o.alt||o.meta)o.preventDefault=!1;else switch(o.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 119:case 87:h.preventVerticalPan||(o.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 115:case 83:h.preventVerticalPan||(o.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 97:h.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 100:h.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 114:this.viewport.setRotation(e.positiveModulo(this.viewport.flipped?this.viewport.degrees-this.rotationIncrement:this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 82:this.viewport.setRotation(e.positiveModulo(this.viewport.flipped?this.viewport.degrees+this.rotationIncrement:this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),o.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:o.preventDefault=!1}}function P(o){var h;document.activeElement===this.canvas||this.canvas.focus(),this.viewport.flipped&&(o.position.x=this.viewport.getContainerSize().x-o.position.x);var c={tracker:o.eventSource,position:o.position,quick:o.quick,shift:o.shift,originalEvent:o.originalEvent,originalTarget:o.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",c),!c.preventDefaultAction&&this.viewport&&o.quick&&(h=this.gestureSettingsByDeviceType(o.pointerType)).clickToZoom&&(this.viewport.zoomBy(o.shift?1/this.zoomPerClick:this.zoomPerClick,h.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints())}function _(o){var h,c={tracker:o.eventSource,position:o.position,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",c),!c.preventDefaultAction&&this.viewport&&(h=this.gestureSettingsByDeviceType(o.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(o.shift?1/this.zoomPerClick:this.zoomPerClick,h.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints())}function R(o){var h,c={tracker:o.eventSource,pointerType:o.pointerType,position:o.position,delta:o.delta,speed:o.speed,direction:o.direction,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",c),(h=this.gestureSettingsByDeviceType(o.pointerType)).dragToPan&&!c.preventDefaultAction&&this.viewport){if(this.panHorizontal||(o.delta.x=0),this.panVertical||(o.delta.y=0),this.viewport.flipped&&(o.delta.x=-o.delta.x),this.constrainDuringPan){var f=this.viewport.deltaPointsFromPixels(o.delta.negate());this.viewport.centerSpringX.target.value+=f.x,this.viewport.centerSpringY.target.value+=f.y;var g=this.viewport.getBounds();c=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=f.x,this.viewport.centerSpringY.target.value-=f.y,g.x!==c.x&&(o.delta.x=0),g.y!==c.y&&(o.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(o.delta.negate()),h.flickEnabled&&!this.constrainDuringPan)}}function C(o){var h={tracker:o.eventSource,pointerType:o.pointerType,position:o.position,speed:o.speed,direction:o.direction,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",h),!h.preventDefaultAction&&this.viewport){var c=this.gestureSettingsByDeviceType(o.pointerType);if(c.flickEnabled&&o.speed>=c.flickMinSpeed){var f=0;this.panHorizontal&&(f=c.flickMomentum*o.speed*Math.cos(o.direction)),h=0,this.panVertical&&(h=c.flickMomentum*o.speed*Math.sin(o.direction)),o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),h=this.viewport.pointFromPixel(new e.Point(o.x-f,o.y-h)),this.viewport.panTo(h,!1)}this.viewport.applyConstraints()}}function B(o){this.raiseEvent("canvas-enter",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function D(o){this.raiseEvent("canvas-exit",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function L(o){this.raiseEvent("canvas-press",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,insideElementPressed:o.insideElementPressed,insideElementReleased:o.insideElementReleased,originalEvent:o.originalEvent})}function W(o){this.raiseEvent("canvas-release",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,insideElementPressed:o.insideElementPressed,insideElementReleased:o.insideElementReleased,originalEvent:o.originalEvent})}function K(o){this.raiseEvent("canvas-nonprimary-press",{tracker:o.eventSource,position:o.position,pointerType:o.pointerType,button:o.button,buttons:o.buttons,originalEvent:o.originalEvent})}function Y(o){this.raiseEvent("canvas-nonprimary-release",{tracker:o.eventSource,position:o.position,pointerType:o.pointerType,button:o.button,buttons:o.buttons,originalEvent:o.originalEvent})}function Q(o){var h,c,f,g={tracker:o.eventSource,pointerType:o.pointerType,gesturePoints:o.gesturePoints,lastCenter:o.lastCenter,center:o.center,lastDistance:o.lastDistance,distance:o.distance,shift:o.shift,originalEvent:o.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};this.raiseEvent("canvas-pinch",g),this.viewport&&((h=this.gestureSettingsByDeviceType(o.pointerType)).pinchToZoom&&(!g.preventDefaultPanAction||!g.preventDefaultZoomAction)&&(c=this.viewport.pointFromPixel(o.center,!0),h.zoomToRefPoint&&!g.preventDefaultPanAction&&(f=this.viewport.pointFromPixel(o.lastCenter,!0).minus(c),this.panHorizontal||(f.x=0),this.panVertical||(f.y=0),this.viewport.panBy(f,!0)),g.preventDefaultZoomAction||this.viewport.zoomBy(o.distance/o.lastDistance,c,!0),this.viewport.applyConstraints()),h.pinchRotate&&!g.preventDefaultRotateAction&&(g=Math.atan2(o.gesturePoints[0].currentPos.y-o.gesturePoints[1].currentPos.y,o.gesturePoints[0].currentPos.x-o.gesturePoints[1].currentPos.x),o=Math.atan2(o.gesturePoints[0].lastPos.y-o.gesturePoints[1].lastPos.y,o.gesturePoints[0].lastPos.x-o.gesturePoints[1].lastPos.x),this.viewport.setRotation(this.viewport.getRotation()+(g-o)*(180/Math.PI))))}function $(o){var h,c,f;(f=e.now())-this._lastScrollTime>this.minScrollDeltaTime?(this._lastScrollTime=f,this.raiseEvent("canvas-scroll",h={tracker:o.eventSource,position:o.position,scroll:o.scroll,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1,preventDefault:!0}),!h.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(o.position.x=this.viewport.getContainerSize().x-o.position.x),(c=this.gestureSettingsByDeviceType(o.pointerType)).scrollToZoom&&(f=Math.pow(this.zoomPerScroll,o.scroll),this.viewport.zoomBy(f,c.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints())),o.preventDefault=h.preventDefault):o.preventDefault=!0}function V(o){t[this.hash].mouseInside=!0,v(this),this.raiseEvent("container-enter",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function G(o){o.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||u(this)),this.raiseEvent("container-exit",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function j(o){(function(h){if(!h._opening&&t[h.hash]){if(h.autoResize){var c=a(h.container),f=t[h.hash].prevContainerSize;if(!c.equals(f)){var g=h.viewport;if(h.preserveImageSizeOnResize){var x=f.x/c.x;f=g.getZoom()*x,x=g.getCenter(),g.resize(c,!1),g.zoomTo(f,null,!0),g.panTo(x,!0)}else{var y=g.getBounds();g.resize(c,!0),g.fitBoundsWithConstraints(y,!0)}t[h.hash].prevContainerSize=c,t[h.hash].forceRedraw=!0}}y=h.viewport.update(),c=h.world.update()||y,y&&h.raiseEvent("viewport-change"),h.referenceStrip&&(c=h.referenceStrip.update(h.viewport)||c),!(y=t[h.hash].animating)&&c&&(h.raiseEvent("animation-start"),v(h)),(y=y&&!c)&&(t[h.hash].animating=!1),(c||y||t[h.hash].forceRedraw||h.world.needsDraw())&&((E=h).imageLoader.clear(),E.drawer.clear(),E.world.draw(),E.raiseEvent("update-viewport",{}),h._drawOverlays(),h.navigator&&h.navigator.update(h.viewport),t[h.hash].forceRedraw=!1,c&&h.raiseEvent("animation")),y&&(h.raiseEvent("animation-finish"),t[h.hash].mouseInside||u(h)),t[h.hash].animating=c}var E})(o),o._updateRequestId=!!o.isOpen()&&s(o,j)}function I(o,h){return o?o+h:h}function J(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,U(this)}function ee(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,U(this)}function q(){t[this.hash].zooming=!1}function U(o){e.requestAnimationFrame(e.delegate(o,z))}function z(){var o,h;t[this.hash].zooming&&this.viewport&&(h=(o=e.now())-t[this.hash].lastZoomTime,h=Math.pow(t[this.hash].zoomFactor,h/1e3),this.viewport.zoomBy(h),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=o,U(this))}function A(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function te(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function ie(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function ne(){this.viewport&&this.viewport.goHome()}function oe(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function re(){if(this.viewport){var o=this.viewport.getRotation();o=e.positiveModulo(this.viewport.flipped?o+this.rotationIncrement:o-this.rotationIncrement,360),this.viewport.setRotation(o)}}function se(){if(this.viewport){var o=this.viewport.getRotation();o=e.positiveModulo(this.viewport.flipped?o-this.rotationIncrement:o+this.rotationIncrement,360),this.viewport.setRotation(o)}}function p(){this.viewport.toggleFlip()}e.Viewer=function(o){var h,g,c=arguments,f=this;if((o=e.isPlainObject(o)?o:{id:c[0],xmlPath:1<c.length?c[1]:void 0,prefixUrl:2<c.length?c[2]:void 0,controls:3<c.length?c[3]:void 0,overlays:4<c.length?c[4]:void 0}).config&&(e.extend(!0,o,o.config),delete o.config),e.extend(!0,this,{id:o.id,hash:o.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,o),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(g){g=e.getString("Errors.OpenFailed",g.eventSource,g.message),f._showMessage(g)}),e.ControlDock.call(this,o),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(g=this.canvas.style).width="100%",g.height="100%",g.overflow="hidden",g.position="absolute",g.top="0px",g.left="0px",e.setElementTouchActionNone(this.canvas),""!==o.tabIndex&&(this.canvas.tabIndex=void 0===o.tabIndex?0:o.tabIndex),this.container.className="openseadragon-container",function(g){g.width="100%",g.height="100%",g.position="relative",g.overflow="hidden",g.left="0px",g.top="0px",g.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,w),keyDownHandler:e.delegate(this,T),keyHandler:e.delegate(this,S),clickHandler:e.delegate(this,P),dblClickHandler:e.delegate(this,_),dragHandler:e.delegate(this,R),dragEndHandler:e.delegate(this,C),enterHandler:e.delegate(this,B),leaveHandler:e.delegate(this,D),pressHandler:e.delegate(this,L),releaseHandler:e.delegate(this,W),nonPrimaryPressHandler:e.delegate(this,K),nonPrimaryReleaseHandler:e.delegate(this,Y),scrollHandler:e.delegate(this,$),pinchHandler:e.delegate(this,Q)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,V),leaveHandler:e.delegate(this,G)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=a(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(g){f.source=f.world.getItemAt(0).source,t[f.hash].forceRedraw=!0,f._updateRequestId||(f._updateRequestId=s(f,j))}),this.world.addHandler("remove-item",function(g){f.source=f.world.getItemCount()?f.world.getItemAt(0).source:null,t[f.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(g){f.viewport&&f.viewport._setContentBounds(f.world.getHomeBounds(),f.world.getContentFactor())}),this.world.addHandler("item-index-change",function(g){f.source=f.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:o.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(h=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(h,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(h=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(h,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),h=0;h<this.customControls.length;h++)this.addControl(this.customControls[h].id,{anchor:this.customControls[h].anchor});e.requestAnimationFrame(function(){u(f)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(o){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(o)},openTileSource:function(o){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(o)},get buttons(){return e.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(o,h){var c=this;if(this.close(),!o)return this;if(this.sequenceMode&&e.isArray(o))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===h||isNaN(h)||(this.initialPage=h),this.tileSources=o,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(!(o=e.isArray(o)?o:[o]).length)return this;this._opening=!0;for(var y,f=o.length,g=0,x=0,E=function(){if(g+x===f)if(g){(c._firstOpen||!c.preserveViewport)&&(c.viewport.goHome(!0),c.viewport.update()),c._firstOpen=!1;var b=o[0];if(b.tileSource&&(b=b.tileSource),c.overlays&&!c.preserveOverlays)for(var H=0;H<c.overlays.length;H++)c.currentOverlays[H]=n(c,c.overlays[H]);c._drawOverlays(),c._opening=!1,c.raiseEvent("open",{source:b})}else c._opening=!1,c.raiseEvent("open-failed",y)},k=0;k<o.length;k++)!function(b){void 0!==(b=e.isPlainObject(b)&&b.tileSource?b:{tileSource:b}).index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete b.index),void 0===b.collectionImmediately&&(b.collectionImmediately=!0);var H=b.success;b.success=function(O){if(g++,b.tileSource.overlays)for(var F=0;F<b.tileSource.overlays.length;F++)c.addOverlay(b.tileSource.overlays[F]);H&&H(O),E()};var N=b.error;b.error=function(O){x++,y=y||O,N&&N(O),E()},c.addTiledImage(b)}(o[k]);return this},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),t[this.navigator.hash]=null,delete t[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(o){return this.innerTracker.setTracking(o),this.outerTracker.setTracking(o),this.raiseEvent("mouse-enabled",{enabled:o}),this},areControlsEnabled:function(){var o,h=this.controls.length;for(o=0;o<this.controls.length;o++)h=h&&this.controls[o].isVisible();return h},setControlsEnabled:function(o){return(o?v:u)(this),this.raiseEvent("controls-enabled",{enabled:o}),this},setDebugMode:function(o){for(var h=0;h<this.world.getItemCount();h++)this.world.getItemAt(h).debugMode=o;this.debugMode=o,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(o){var h,c,f=document.body,g=f.style,x=document.documentElement.style,y=this;if(o===this.isFullPage())return this;var E={fullPage:o,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",E),E.preventDefaultAction)return this;if(o){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=g.margin,this.docMargin=x.margin,g.margin="0",x.margin="0",this.bodyPadding=g.padding,this.docPadding=x.padding,g.padding="0",x.padding="0",this.bodyWidth=g.width,this.docWidth=x.width,g.width="100%",x.width="100%",this.bodyHeight=g.height,this.docHeight=x.height,g.height="100%",x.height="100%",this.bodyDisplay=g.display,g.display="block",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,h=f.childNodes.length,c=0;c<h;c++)this.previousBody.push(f.childNodes[0]),f.removeChild(f.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,f.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),f.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,V)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,g.margin=this.bodyMargin,x.margin=this.docMargin,g.padding=this.bodyPadding,x.padding=this.docPadding,g.width=this.bodyWidth,x.width=this.docWidth,g.height=this.bodyHeight,x.height=this.docHeight,g.display=this.bodyDisplay,f.removeChild(this.element),h=this.previousBody.length,c=0;c<h;c++)f.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(f.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var k=0,b=function(){e.setPageScroll(y.pageScroll);var H=e.getPageScroll();++k<10&&(H.x!==y.pageScroll.x||H.y!==y.pageScroll.y)&&e.requestAnimationFrame(b)};e.requestAnimationFrame(b),t[this.hash].fullPage=!1,e.delegate(this,G)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:o}),this},setFullScreen:function(o){var h=this;if(!e.supportsFullScreen)return this.setFullPage(o);if(e.isFullScreen()===o)return this;var c={fullScreen:o,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",c),c.preventDefaultAction)return this;if(o){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var f=function(){var g=e.isFullScreen();g||(e.removeEvent(document,e.fullScreenEventName,f),e.removeEvent(document,e.fullScreenErrorEventName,f),h.setFullPage(!1),h.isFullPage()&&(h.element.style.width=h.fullPageStyleWidth,h.element.style.height=h.fullPageStyleHeight)),h.navigator&&h.viewport&&setTimeout(function(){h.navigator.update(h.viewport)}),h.raiseEvent("full-screen",{fullScreen:g})};e.addEvent(document,e.fullScreenEventName,f),e.addEvent(document,e.fullScreenErrorEventName,f),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!==this.container.style.visibility},isFullScreen:function(){return e.isFullScreen()&&this.isFullPage()},setVisible:function(o){return this.container.style.visibility=o?"":"hidden",this.raiseEvent("visible",{visible:o}),this},addTiledImage:function(o){e.console.assert(o,"[Viewer.addTiledImage] options is required"),e.console.assert(o.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!o.replace||-1<o.index&&o.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var h=this;o.replace&&(o.replaceItem=h.world.getItemAt(o.index)),this._hideMessage(),void 0===o.placeholderFillStyle&&(o.placeholderFillStyle=this.placeholderFillStyle),void 0===o.opacity&&(o.opacity=this.opacity),void 0===o.preload&&(o.preload=this.preload),void 0===o.compositeOperation&&(o.compositeOperation=this.compositeOperation),void 0===o.crossOriginPolicy&&(o.crossOriginPolicy=(void 0!==o.tileSource.crossOriginPolicy?o.tileSource:this).crossOriginPolicy),void 0===o.ajaxWithCredentials&&(o.ajaxWithCredentials=this.ajaxWithCredentials),void 0===o.loadTilesWithAjax&&(o.loadTilesWithAjax=this.loadTilesWithAjax),null==o.ajaxHeaders?o.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(o.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(o.ajaxHeaders=e.extend({},this.ajaxHeaders,o.ajaxHeaders));var c={options:o};function f(y){for(var E=0;E<h._loadQueue.length;E++)if(h._loadQueue[E]===c){h._loadQueue.splice(E,1);break}0===h._loadQueue.length&&g(c),h.raiseEvent("add-item-failed",y),o.error&&o.error(y)}function g(y){h.collectionMode&&(h.world.arrange({immediately:y.options.collectionImmediately,rows:h.collectionRows,columns:h.collectionColumns,layout:h.collectionLayout,tileSize:h.collectionTileSize,tileMargin:h.collectionTileMargin}),h.world.setAutoRefigureSizes(!0))}function x(){for(var y,E;h._loadQueue.length&&(y=h._loadQueue[0]).tileSource;){if(h._loadQueue.splice(0,1),y.options.replace){var k=h.world.getIndexOfItem(y.options.replaceItem);-1!==k&&(y.options.index=k),h.world.removeItem(y.options.replaceItem)}E=new e.TiledImage({viewer:h,source:y.tileSource,viewport:h.viewport,drawer:h.drawer,tileCache:h.tileCache,imageLoader:h.imageLoader,x:y.options.x,y:y.options.y,width:y.options.width,height:y.options.height,fitBounds:y.options.fitBounds,fitBoundsPlacement:y.options.fitBoundsPlacement,clip:y.options.clip,placeholderFillStyle:y.options.placeholderFillStyle,opacity:y.options.opacity,preload:y.options.preload,degrees:y.options.degrees,flipped:y.options.flipped,compositeOperation:y.options.compositeOperation,springStiffness:h.springStiffness,animationTime:h.animationTime,minZoomImageRatio:h.minZoomImageRatio,wrapHorizontal:h.wrapHorizontal,wrapVertical:h.wrapVertical,immediateRender:h.immediateRender,blendTime:h.blendTime,alwaysBlend:h.alwaysBlend,minPixelRatio:h.minPixelRatio,smoothTileEdgesMinZoom:h.smoothTileEdgesMinZoom,iOSDevice:h.iOSDevice,crossOriginPolicy:y.options.crossOriginPolicy,ajaxWithCredentials:y.options.ajaxWithCredentials,loadTilesWithAjax:y.options.loadTilesWithAjax,ajaxHeaders:y.options.ajaxHeaders,debugMode:h.debugMode,subPixelRoundingForTransparency:h.subPixelRoundingForTransparency}),h.collectionMode&&h.world.setAutoRefigureSizes(!1),h.navigator&&(k=e.extend({},y.options,{replace:!1,originalTiledImage:E,tileSource:y.tileSource}),h.navigator.addTiledImage(k)),h.world.addItem(E,{index:y.options.index}),0===h._loadQueue.length&&g(y),1!==h.world.getItemCount()||h.preserveViewport||h.viewport.goHome(!0),y.options.success&&y.options.success({item:E})}}e.isArray(o.tileSource)?setTimeout(function(){f({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:o.tileSource,options:o})}):(this._loadQueue.push(c),function(y,E,k,b,H){var N=y;if("string"===e.type(E))if(E.match(/^\s*<.*>\s*$/))E=e.parseXml(E);else if(E.match(/^\s*[{[].*[}\]]\s*$/))try{var O=e.parseJSON(E);E=O}catch{}function F(M,Z){M.ready?b(M):(M.addHandler("ready",function(){b(M)}),M.addHandler("open-failed",function(X){H({message:X.message,source:Z})}))}setTimeout(function(){if("string"===e.type(E))(E=new e.TileSource({url:E,crossOriginPolicy:(void 0!==k.crossOriginPolicy?k:y).crossOriginPolicy,ajaxWithCredentials:y.ajaxWithCredentials,ajaxHeaders:k.ajaxHeaders||y.ajaxHeaders,splitHashDataForPost:y.splitHashDataForPost,useCanvas:y.useCanvas,success:function(X){b(X.tileSource)}})).addHandler("open-failed",function(X){H(X)});else if(e.isPlainObject(E)||E.nodeType)if(void 0!==E.crossOriginPolicy||void 0===k.crossOriginPolicy&&void 0===y.crossOriginPolicy||(E.crossOriginPolicy=(void 0!==k.crossOriginPolicy?k:y).crossOriginPolicy),void 0===E.ajaxWithCredentials&&(E.ajaxWithCredentials=y.ajaxWithCredentials),void 0===E.useCanvas&&(E.useCanvas=y.useCanvas),e.isFunction(E.getTileUrl)){var M=new e.TileSource(E);M.getTileUrl=E.getTileUrl,b(M)}else{var Z=e.TileSource.determineType(N,E);Z?(M=Z.prototype.configure.apply(N,[E]),F(new Z(M),E)):H({message:"Unable to load TileSource",source:E})}else F(E,E)})}(this,o.tileSource,o,function(y){c.tileSource=y,x()},function(y){y.options=o,f(y),x()}))},addSimpleImage:function(o){e.console.assert(o,"[Viewer.addSimpleImage] options is required"),e.console.assert(o.url,"[Viewer.addSimpleImage] options.url is required"),delete(o=e.extend({},o,{tileSource:{type:"image",url:o.url}})).url,this.addTiledImage(o)},addLayer:function(o){var h=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var c=e.extend({},o,{success:function(f){h.raiseEvent("add-layer",{options:o,drawer:f.item})},error:function(f){h.raiseEvent("add-layer-failed",f)}});return this.addTiledImage(c),this},getLayerAtLevel:function(o){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(o)},getLevelOfLayer:function(o){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(o)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(o,h){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(o,h)},removeLayer:function(o){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(o)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var o=e.delegate(this,d),h=e.delegate(this,m),c=e.delegate(this,this.goToNextPage),f=e.delegate(this,this.goToPreviousPage),g=this.navImages,x=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(x=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:I(this.prefixUrl,g.previous.REST),srcGroup:I(this.prefixUrl,g.previous.GROUP),srcHover:I(this.prefixUrl,g.previous.HOVER),srcDown:I(this.prefixUrl,g.previous.DOWN),onRelease:f,onFocus:o,onBlur:h}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:I(this.prefixUrl,g.next.REST),srcGroup:I(this.prefixUrl,g.next.GROUP),srcHover:I(this.prefixUrl,g.next.HOVER),srcDown:I(this.prefixUrl,g.next.DOWN),onRelease:c,onFocus:o,onBlur:h}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),x&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var o=e.delegate(this,J),h=e.delegate(this,q),c=e.delegate(this,A),f=e.delegate(this,ee),g=e.delegate(this,te),x=e.delegate(this,ne),y=e.delegate(this,oe),E=e.delegate(this,re),k=e.delegate(this,se),b=e.delegate(this,p),H=e.delegate(this,d),N=e.delegate(this,m),O=this.navImages,F=[],M=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(M=!1),this.showZoomControl&&(F.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:I(this.prefixUrl,O.zoomIn.REST),srcGroup:I(this.prefixUrl,O.zoomIn.GROUP),srcHover:I(this.prefixUrl,O.zoomIn.HOVER),srcDown:I(this.prefixUrl,O.zoomIn.DOWN),onPress:o,onRelease:h,onClick:c,onEnter:o,onExit:h,onFocus:H,onBlur:N})),F.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:I(this.prefixUrl,O.zoomOut.REST),srcGroup:I(this.prefixUrl,O.zoomOut.GROUP),srcHover:I(this.prefixUrl,O.zoomOut.HOVER),srcDown:I(this.prefixUrl,O.zoomOut.DOWN),onPress:f,onRelease:h,onClick:g,onEnter:f,onExit:h,onFocus:H,onBlur:N}))),this.showHomeControl&&F.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:I(this.prefixUrl,O.home.REST),srcGroup:I(this.prefixUrl,O.home.GROUP),srcHover:I(this.prefixUrl,O.home.HOVER),srcDown:I(this.prefixUrl,O.home.DOWN),onRelease:x,onFocus:H,onBlur:N})),this.showFullPageControl&&F.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:I(this.prefixUrl,O.fullpage.REST),srcGroup:I(this.prefixUrl,O.fullpage.GROUP),srcHover:I(this.prefixUrl,O.fullpage.HOVER),srcDown:I(this.prefixUrl,O.fullpage.DOWN),onRelease:y,onFocus:H,onBlur:N})),this.showRotationControl&&(F.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:I(this.prefixUrl,O.rotateleft.REST),srcGroup:I(this.prefixUrl,O.rotateleft.GROUP),srcHover:I(this.prefixUrl,O.rotateleft.HOVER),srcDown:I(this.prefixUrl,O.rotateleft.DOWN),onRelease:E,onFocus:H,onBlur:N})),F.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:I(this.prefixUrl,O.rotateright.REST),srcGroup:I(this.prefixUrl,O.rotateright.GROUP),srcHover:I(this.prefixUrl,O.rotateright.HOVER),srcDown:I(this.prefixUrl,O.rotateright.DOWN),onRelease:k,onFocus:H,onBlur:N}))),this.showFlipControl&&F.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:I(this.prefixUrl,O.flip.REST),srcGroup:I(this.prefixUrl,O.flip.GROUP),srcHover:I(this.prefixUrl,O.flip.HOVER),srcDown:I(this.prefixUrl,O.flip.DOWN),onRelease:b,onFocus:H,onBlur:N})),M?(this.buttonGroup=new e.ButtonGroup({buttons:F,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,ie)),(this.toolbar||this).addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=F),this},currentPage:function(){return this._sequenceIndex},goToPage:function(o){return this.tileSources&&0<=o&&o<this.tileSources.length&&(this._sequenceIndex=o,this._updateSequenceButtons(o),this.open(this.tileSources[o]),this.referenceStrip&&this.referenceStrip.setFocus(o),this.raiseEvent("page",{page:o})),this},addOverlay:function(o,h,c,f){return c=e.isPlainObject(o)?o:{element:o,location:h,placement:c,onDraw:f},o=e.getElement(c.element),0<=r(this.currentOverlays,o)||(f=n(this,c),this.currentOverlays.push(f),f.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:o,location:c.location,placement:c.placement})),this},updateOverlay:function(o,h,c){var f;return o=e.getElement(o),0<=(f=r(this.currentOverlays,o))&&(this.currentOverlays[f].update(h,c),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:o,location:h,placement:c})),this},removeOverlay:function(o){var h;return o=e.getElement(o),0<=(h=r(this.currentOverlays,o))&&(this.currentOverlays[h].destroy(),this.currentOverlays.splice(h,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:o})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(o){return o=e.getElement(o),0<=(o=r(this.currentOverlays,o))?this.currentOverlays[o]:null},_updateSequenceButtons:function(o){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==o?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<o?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(o){this._hideMessage();var h=e.makeNeutralElement("div");h.appendChild(document.createTextNode(o)),this.messageDiv=e.makeCenteredNode(h),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var o=this.messageDiv;o&&(o.parentNode.removeChild(o),delete this.messageDiv)},gestureSettingsByDeviceType:function(o){switch(o){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var o,h=this.currentOverlays.length;for(o=0;o<h;o++)this.currentOverlays[o].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){this.showReferenceStrip=!0,this.sequenceMode?!this.referenceStrip&&this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var o=e.pixelDensityRatio,h=e.getCurrentPixelDensityRatio();o!==h&&(e.pixelDensityRatio=h,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var o=this._sequenceIndex-1;this.navPrevNextWrap&&o<0&&(o+=this.tileSources.length),this.goToPage(o)},goToNextPage:function(){var o=this._sequenceIndex+1;this.navPrevNextWrap&&o>=this.tileSources.length&&(o=0),this.goToPage(o)},isAnimating:function(){return t[this.hash].animating}})}(OpenSeadragon),function(e){function t(l){var u={tracker:l.eventSource,position:l.position,quick:l.quick,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-click",u),!u.preventDefaultAction&&l.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(l.position.x=this.viewport.getContainerSize().x-l.position.x),l=this.viewport.pointFromPixel(l.position),this.panVertical?this.panHorizontal||(l.x=this.viewer.viewport.getCenter(!0).x):l.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(l),this.viewer.viewport.applyConstraints())}function i(l){var u={tracker:l.eventSource,position:l.position,delta:l.delta,speed:l.speed,direction:l.direction,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",u),!u.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(l.delta.x=0),this.panVertical||(l.delta.y=0),this.viewer.viewport.flipped&&(l.delta.x=-l.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(l.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function a(l){l.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function n(l){var u={tracker:l.eventSource,position:l.position,scroll:l.scroll,shift:l.shift,originalEvent:l.originalEvent,preventDefault:l.preventDefault};this.viewer.raiseEvent("navigator-scroll",u),l.preventDefault=u.preventDefault}function r(l,u){s(l,"rotate("+u+"deg)")}function s(l,u){l.style.webkitTransform=u,l.style.mozTransform=u,l.style.msTransform=u,l.style.oTransform=u,l.style.transform=u}e.Navigator=function(l){var u,w,T,v=l.viewer,d=this;function m(w){r(d.displayRegionContainer,w),r(d.displayRegion,-w),d.viewport.setRotation(w)}l.id?(this.element=document.getElementById(l.id),l.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(l.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),l.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:l.autoFade},l.position&&("BOTTOM_RIGHT"===l.position?l.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===l.position?l.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===l.position?l.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===l.position?l.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"===l.position&&(l.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,l.controlOptions.top=l.top,l.controlOptions.left=l.left,l.controlOptions.height=l.height,l.controlOptions.width=l.width))),this.element.id=l.id,this.element.className+=" navigator",(l=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},l,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:l.autoResize,minZoomImageRatio:1,background:l.background,opacity:l.opacity,borderColor:l.borderColor,displayRegionColor:l.displayRegionColor})).minPixelRatio=this.minPixelRatio=v.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),l.controlOptions.anchor!==e.ControlAnchor.NONE&&(T=this.borderWidth,(w=this.element.style).margin="0px",w.border=T+"px solid "+l.borderColor,w.padding="0px",w.background=l.background,w.opacity=l.opacity,w.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(w,T){w.position="relative",w.top="0px",w.left="0px",w.fontSize="0px",w.overflow="hidden",w.border=T+"px solid "+l.displayRegionColor,w.margin="0px",w.padding="0px",w.background="transparent",w.float="left",w.cssFloat="left",w.styleFloat="left",w.zIndex=999999999,w.cursor="default"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),v.addControl(this.element,l.controlOptions),this._resizeWithViewer=l.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&l.controlOptions.anchor!==e.ControlAnchor.NONE,l.width&&l.height?(this.setWidth(l.width),this.setHeight(l.height)):this._resizeWithViewer&&(u=e.getElementSize(v.element),this.element.style.height=Math.round(u.y*l.sizeRatio)+"px",this.element.style.width=Math.round(u.x*l.sizeRatio)+"px",this.oldViewerSize=u,u=e.getElementSize(this.element),this.elementArea=u.x*u.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[l]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),l.navigatorRotate&&(m(l.viewer.viewport?l.viewer.viewport.getRotation():l.viewer.degrees||0),l.viewer.addHandler("rotate",function(w){m(w.degrees)})),this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,a),scrollHandler:e.delegate(this,n),preProcessEventHandler:function(w){"wheel"===w.eventType&&(w.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){d.viewport&&d.viewport.goHome(!0)}),v.world.addHandler("item-index-change",function(w){window.setTimeout(function(){var T=d.world.getItemAt(w.previousIndex);d.world.setItemIndex(T,w.newIndex)},1)}),v.world.addHandler("remove-item",function(w){(w=d._getMatchingItem(w=w.item))&&d.world.removeItem(w)}),this.update(v.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var l=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);l.equals(this.oldContainerSize)||(this.viewport.resize(l,!0),this.viewport.goHome(!0),this.oldContainerSize=l,this.drawer.clear(),this.world.draw())}},setWidth:function(l){this.width=l,this.element.style.width="number"==typeof l?l+"px":l,this._resizeWithViewer=!1},setHeight:function(l){this.height=l,this.element.style.height="number"==typeof l?l+"px":l,this._resizeWithViewer=!1},setFlip:function(l){return this.viewport.setFlip(l),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(l){s(this.displayRegion,l),s(this.canvas,l),s(this.element,l)},update:function(l){var u;if(v=e.getElementSize(this.viewer.element),this._resizeWithViewer&&v.x&&v.y&&!v.equals(this.oldViewerSize)&&(this.oldViewerSize=v,this.maintainSizeRatio||!this.elementArea?(u=v.x*this.sizeRatio,d=v.y*this.sizeRatio):(u=Math.sqrt(this.elementArea*(v.x/v.y)),d=this.elementArea/u),this.element.style.width=Math.round(u)+"px",this.element.style.height=Math.round(d)+"px",this.elementArea||(this.elementArea=u*d),this.updateSize()),l&&this.viewport){v=l.getBoundsNoRotate(!0),u=this.viewport.pixelFromPointNoRotate(v.getTopLeft(),!1),d=this.viewport.pixelFromPointNoRotate(v.getBottomRight(),!1).minus(this.totalBorderWidths),(l=this.displayRegion.style).display=this.world.getItemCount()?"block":"none",l.top=Math.round(u.y)+"px",l.left=Math.round(u.x)+"px";var v=Math.abs(u.x-d.x),d=Math.abs(u.y-d.y);l.width=Math.round(Math.max(v,0))+"px",l.height=Math.round(Math.max(d,0))+"px"}},addTiledImage:function(l){var u=this,v=l.originalTiledImage;return delete l.original,l=e.extend({},l,{success:function(d){var m=d.item;function w(){u._matchBounds(m,v)}m._originalForNavigator=v,u._matchBounds(m,v,!0),u._matchOpacity(m,v),u._matchCompositeOperation(m,v),v.addHandler("bounds-change",w),v.addHandler("clip-change",w),v.addHandler("opacity-change",function(){u._matchOpacity(m,v)}),v.addHandler("composite-operation-change",function(){u._matchCompositeOperation(m,v)})}}),e.Viewer.prototype.addTiledImage.apply(this,[l])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(l){for(var v,u=this.world.getItemCount(),d=0;d<u;d++)if((v=this.world.getItemAt(d))._originalForNavigator===l)return v;return null},_matchBounds:function(l,u,v){var d=u.getBoundsNoRotate();l.setPosition(d.getTopLeft(),v),l.setWidth(d.width,v),l.setRotation(u.getRotation(),v),l.setClip(u.getClip()),l.setFlip(u.getFlip())},_matchOpacity:function(l,u){l.setOpacity(u.opacity)},_matchCompositeOperation:function(l,u){l.setCompositeOperation(u.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(i){var a,n=i.split("."),r=null,s=arguments,l=t;for(a=0;a<n.length-1;a++)l=l[n[a]]||{};return"string"!=typeof(r=l[n[a]])&&(e.console.error("Untranslated source string:",i),r=""),r.replace(/\{\d+\}/g,function(u){return(u=parseInt(u.match(/\d+/),10)+1)<s.length?s[u]:""})},setString:function(i,a){var n,r=i.split("."),s=t;for(n=0;n<r.length-1;n++)s[r[n]]||(s[r[n]]={}),s=s[r[n]];s[r[n]]=a}})}(OpenSeadragon),function(e){e.Point=function(t,i){this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},squaredDistanceTo:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var a,n;if(i=i||new e.Point(0,0),t%90==0)switch(e.positiveModulo(t,360)){case 0:a=1,n=0;break;case 90:a=0,n=1;break;case 180:a=-1,n=0;break;case 270:a=0,n=-1}else{var r=t*Math.PI/180;a=Math.cos(r),n=Math.sin(r)}return new e.Point(r=a*(this.x-i.x)-n*(this.y-i.y)+i.x,i=n*(this.x-i.x)+a*(this.y-i.y)+i.y)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,i,a,n,r,s){var u,l=this,v=arguments;if(v=e.isPlainObject(t)?t:{width:v[0],height:v[1],tileSize:v[2],tileOverlap:v[3],minLevel:v[4],maxLevel:v[5]},e.EventSource.call(this),e.extend(!0,this,v),!this.success)for(u=0;u<arguments.length;u++)if(e.isFunction(arguments[u])){this.success=arguments[u];break}this.success&&this.addHandler("ready",function(d){l.success(d)}),"string"===e.type(t)&&(this.url=t),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=v.width&&v.height?v.width/v.height:1,this.dimensions=new e.Point(v.width,v.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=v.tileOverlap||0,this.minLevel=v.minLevel||0,this.maxLevel=null!=v.maxLevel?v.maxLevel:v.width&&v.height?Math.ceil(Math.log(Math.max(v.width,v.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(t){return this._tileWidth||this.getTileSize(t)},getTileHeight:function(t){return this._tileHeight||this.getTileSize(t)},setMaxLevel:function(t){this.maxLevel=t,this._memoizeLevelScale()},getLevelScale:function(t){return this._memoizeLevelScale(),this.getLevelScale(t)},_memoizeLevelScale:function(){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);this.getLevelScale=function(a){return i[a]}},getNumTiles:function(n){var i=this.getLevelScale(n),a=Math.ceil(i*this.dimensions.x/this.getTileWidth(n));return n=Math.ceil(i*this.dimensions.y/this.getTileHeight(n)),new e.Point(a,n)},getPixelRatio:function(i){var a=this.dimensions.times(this.getLevelScale(i));return new e.Point(i=1/a.x*e.pixelDensityRatio,a=1/a.y*e.pixelDensityRatio)},getClosestLevel:function(){var t,i;for(t=this.minLevel+1;t<=this.maxLevel&&!(1<(i=this.getNumTiles(t)).x||1<i.y);t++);return t-1},getTileAtPoint:function(t,i){var a=0<=i.x&&i.x<=1&&0<=i.y&&i.y<=1/this.aspectRatio;e.console.assert(a,"[TileSource.getTileAtPoint] must be called with a valid point.");var n=this.dimensions.x*this.getLevelScale(t);return a=i.x*n,n*=i.y,a=Math.floor(a/this.getTileWidth(t)),n=Math.floor(n/this.getTileHeight(t)),1<=i.x&&(a=this.getNumTiles(t).x-1),i.y>=1/this.aspectRatio-1e-15&&(n=this.getNumTiles(t).y-1),new e.Point(a,n)},getTileBounds:function(u,v,m,n){var r=this.dimensions.times(this.getLevelScale(u)),s=this.getTileWidth(u),d=this.getTileHeight(u),l=0===v?0:s*v-this.tileOverlap;return u=0===m?0:d*m-this.tileOverlap,v=s+(0===v?1:2)*this.tileOverlap,d+=(0===m?1:2)*this.tileOverlap,m=1/r.x,v=Math.min(v,r.x-l),d=Math.min(d,r.y-u),n?new e.Rect(0,0,v,d):new e.Rect(l*m,u*m,v*m,d*m)},getImageInfo:function(t){var i,a,n,r,s,l=this;t&&-1<(s=(r=(n=t.split("/"))[n.length-1]).lastIndexOf("."))&&(n[n.length-1]=r.slice(0,s));var u=null;if(this.splitHashDataForPost){var v=t.indexOf("#");-1!==v&&(u=t.substring(v+1),t=t.substr(0,v))}i=function(d){"string"==typeof d&&(d=e.parseXml(d));var m=e.TileSource.determineType(l,d,t);m?(void 0===(a=m.prototype.configure.apply(l,[d,t,u])).ajaxWithCredentials&&(a.ajaxWithCredentials=l.ajaxWithCredentials),a=new m(a),l.ready=!0,l.raiseEvent("ready",{tileSource:a})):l.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(v=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:v,callback:i})):e.makeAjaxRequest({url:t,postData:u,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(d){d=function(m){var T,S=m.responseText,P=m.status;if(!m)throw new Error(e.getString("Errors.Security"));if(200!==m.status&&0!==m.status)throw P=m.status,new Error(e.getString("Errors.Status",P,404===P?"Not Found":m.statusText));if(S.match(/\s*<.*/))try{T=m.responseXML&&m.responseXML.documentElement?m.responseXML:e.parseXml(S)}catch{T=m.responseText}else if(S.match(/\s*[{[].*/))try{T=e.parseJSON(S)}catch{T=S}else T=S;return T}(d),i(d)},error:function(d,m){var w;try{w="HTTP "+d.status+" attempting to load TileSource: "+t}catch{w=(void 0!==m&&m.toString?m.toString():"Unknown error")+" attempting to load TileSource: "+t}e.console.error(w),l.raiseEvent("open-failed",{message:w,source:t,postData:u})}})},supports:function(t,i){return!1},configure:function(t,i,a){throw new Error("Method not implemented.")},getTileUrl:function(t,i,a){throw new Error("Method not implemented.")},getTilePostData:function(t,i,a){return null},getTileAjaxHeaders:function(t,i,a){return{}},getTileHashKey:function(t,i,a,n,r,s){return r?n+"+"+JSON.stringify(r):n},tileExists:function(t,i,a){var n=this.getNumTiles(t);return t>=this.minLevel&&t<=this.maxLevel&&0<=i&&0<=a&&i<n.x&&a<n.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,i,a){for(var n in OpenSeadragon)if(n.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[n])&&e.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(t,i,a))return OpenSeadragon[n];return e.console.error("No TileSource was able to open %s %s",a,i),null}}(OpenSeadragon),function(e){function t(i,a){var n,r,s=(w=a.Image).Url,l=w.Format,m=w.Size,u=w.DisplayRect||[],v=parseInt(m.Width,10),d=parseInt(m.Height,10),w=(m=parseInt(w.TileSize,10),parseInt(w.Overlap,10)),T=[];for(r=0;r<u.length;r++)n=u[r].Rect,T.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:v,height:d,tileSize:m,tileOverlap:w,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:l,displayRects:T},a)}e.DziTileSource=function(i,a,n,r,s,l,u,v,d){var m,w,T,S;if(S=e.isPlainObject(i)?i:{width:i,height:a,tileSize:n,tileOverlap:r,tilesUrl:s,fileFormat:l,displayRects:u,minLevel:v,maxLevel:d},this._levelRects={},this.tilesUrl=S.tilesUrl,this.fileFormat=S.fileFormat,this.displayRects=S.displayRects,this.displayRects)for(m=this.displayRects.length-1;0<=m;m--)for(T=(w=this.displayRects[m]).minLevel;T<=w.maxLevel;T++)this._levelRects[T]||(this._levelRects[T]=[]),this._levelRects[T].push(w);e.TileSource.apply(this,[S])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(i,a){var n;return i.Image?n=i.Image.xmlns:i.documentElement&&("Image"!==i.documentElement.localName&&"Image"!==i.documentElement.tagName||(n=i.documentElement.namespaceURI)),-1!==(n=(n||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==n.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,a,n){return i=(e.isPlainObject(i)?t:function(r,P){if(!P||!P.documentElement)throw new Error(e.getString("Errors.Xml"));var l,u,v,d,m,w=P.documentElement,T=w.localName||w.tagName,S=P.documentElement.namespaceURI,_=(P=null,[]);if("Image"===T)try{if(void 0===(d=w.getElementsByTagName("Size")[0])&&(d=w.getElementsByTagNameNS(S,"Size")[0]),P={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:w.getAttribute("Url"),Format:w.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(w.getAttribute("Overlap"),10),TileSize:parseInt(w.getAttribute("TileSize"),10),Size:{Height:parseInt(d.getAttribute("Height"),10),Width:parseInt(d.getAttribute("Width"),10)}}},!e.imageFormatSupported(P.Image.Format))throw new Error(e.getString("Errors.ImageFormat",P.Image.Format.toUpperCase()));for(void 0===(l=w.getElementsByTagName("DisplayRect"))&&(l=w.getElementsByTagNameNS(S,"DisplayRect")[0]),m=0;m<l.length;m++)void 0===(v=(u=l[m]).getElementsByTagName("Rect")[0])&&(v=u.getElementsByTagNameNS(S,"Rect")[0]),_.push({Rect:{X:parseInt(v.getAttribute("X"),10),Y:parseInt(v.getAttribute("Y"),10),Width:parseInt(v.getAttribute("Width"),10),Height:parseInt(v.getAttribute("Height"),10),MinLevel:parseInt(u.getAttribute("MinLevel"),10),MaxLevel:parseInt(u.getAttribute("MaxLevel"),10)}});return _.length&&(P.Image.DisplayRect=_),t(0,P)}catch(R){throw R instanceof Error?R:new Error(e.getString("Errors.Dzi"))}else{if("Collection"===T)throw new Error(e.getString("Errors.Dzc"));if("Error"===T)throw w=w.getElementsByTagName("Message")[0].firstChild.nodeValue,new Error(w)}throw new Error(e.getString("Errors.Dzi"))})(this,i),a&&!i.tilesUrl&&(i.tilesUrl=a.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),i.queryParams=-1!==a.search(/\.(dzi|xml|js)\?/)?a.match(/\?.*/):""),i},getTileUrl:function(i,a,n){return[this.tilesUrl,i,"/",a,"_",n,".",this.fileFormat,this.queryParams].join("")},tileExists:function(i,a,n){var r,s,l,u,v,d,m=this._levelRects[i];if(this.minLevel&&i<this.minLevel||this.maxLevel&&i>this.maxLevel)return!1;if(!m||!m.length)return!0;for(d=m.length-1;0<=d;d--)if(!(i<(r=m[d]).minLevel||i>r.maxLevel)&&(v=this.getLevelScale(i),u=(s=r.x*v)+r.width*v,v=(l=r.y*v)+r.height*v,s=Math.floor(s/this._tileWidth),l=Math.floor(l/this._tileWidth),u=Math.ceil(u/this._tileWidth),v=Math.ceil(v/this._tileWidth),s<=a&&a<u&&l<=n&&n<v))return!0;return!1}})}(OpenSeadragon),function(e){function t(a){var n=Array.isArray(a.profile)?a.profile[0]:a.profile,r=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(n);return n=!1,2===a.version&&1<a.profile.length&&a.profile[1].supports&&(n=-1!==a.profile[1].supports.indexOf("sizeByW")),3===a.version&&a.extraFeatures&&(n=-1!==a.extraFeatures.indexOf("sizeByWh")),!r||n}function i(a){for(var n=[],r=0;r<a.sizes.length;r++)n.push({url:a["@id"]+"/full/"+a.sizes[r].width+","+(3===a.version?a.sizes[r].height:"")+"/0/default."+a.tileFormat,width:a.sizes[r].width,height:a.sizes[r].height});return n.sort(function(s,l){return s.width-l.width})}e.IIIFTileSource=function(a){if(e.extend(!0,this,a),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(a.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=a.version,this.tile_width&&this.tile_height)a.tileWidth=this.tile_width,a.tileHeight=this.tile_height;else if(this.tile_width)a.tileSize=this.tile_width;else if(this.tile_height)a.tileSize=this.tile_height;else if(this.tiles)if(1===this.tiles.length)a.tileWidth=this.tiles[0].width,a.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var n=0;n<this.tiles.length;n++)for(var r=0;r<this.tiles[n].scaleFactors.length;r++){var s=this.tiles[n].scaleFactors[r];this.scale_factors.push(s),a.tileSizePerScaleFactor[s]={width:this.tiles[n].width,height:this.tiles[n].height||this.tiles[n].width}}}else if(t(a)){for(var l=Math.min(this.height,this.width),u=[256,512,1024],v=[],d=0;d<u.length;d++)u[d]<=l&&v.push(u[d]);a.tileSize=0<v.length?Math.max.apply(null,v):l}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,a.levels=i(this),e.extend(!0,a,{width:a.levels[a.levels.length-1].width,height:a.levels[a.levels.length-1].height,tileSize:Math.max(a.height,a.width),tileOverlap:0,minLevel:0,maxLevel:a.levels.length-1}),this.levels=a.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!a.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var m=Math.max.apply(null,this.scale_factors);a.maxLevel=Math.round(Math.log(m)*Math.LOG2E)}else a.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[a])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(a,n){return!!(a.protocol&&"http://iiif.io/api/image"===a.protocol||a["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"===a["@context"]||"http://iiif.io/api/image/1/context.json"===a["@context"])||a.profile&&0===a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||a.identifier&&a.width&&a.height||a.documentElement&&"info"===a.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"===a.documentElement.namespaceURI)},configure:function(a,n,r){if(e.isPlainObject(a)){if(a["@context"]){var s=a["@context"];if(Array.isArray(s))for(var l=0;l<s.length;l++)if("string"==typeof s[l]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(s[l])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===s[l])){s=s[l];break}switch(s){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":a.version=1;break;case"http://iiif.io/api/image/2/context.json":a.version=2;break;case"http://iiif.io/api/image/3/context.json":a.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=n.replace("/info.json",""),a.version=1;if(!a["@id"]&&a.id&&(a["@id"]=a.id),a.preferredFormats)for(var u=0;u<a.preferredFormats.length;u++)if(OpenSeadragon.imageFormatSupported(a.preferredFormats[u])){a.tileFormat=a.preferredFormats[u];break}return a}var v=function(T){if(!T||!T.documentElement)throw new Error(e.getString("Errors.Xml"));var m=T.documentElement;if(T=null,"info"===m.tagName)try{return function S(P,_,R){var C,B;if(3===P.nodeType&&R)(B=P.nodeValue.trim()).match(/^\d*$/)&&(B=Number(B)),_[R]?(e.isArray(_[R])||(_[R]=[_[R]]),_[R].push(B)):_[R]=B;else if(1===P.nodeType)for(C=0;C<P.childNodes.length;C++)S(P.childNodes[C],_,P.nodeName)}(m,T={}),T}catch(S){throw S instanceof Error?S:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(a);return v["@context"]="http://iiif.io/api/image/1.0/context.json",v["@id"]=n.replace("/info.xml",""),v.version=1,v},getTileWidth:function(a){return this.emulateLegacyImagePyramid?e.TileSource.prototype.getTileWidth.call(this,a):(a=Math.pow(2,this.maxLevel-a),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].width:this._tileWidth)},getTileHeight:function(a){return this.emulateLegacyImagePyramid?e.TileSource.prototype.getTileHeight.call(this,a):(a=Math.pow(2,this.maxLevel-a),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].height:this._tileHeight)},getLevelScale:function(a){if(this.emulateLegacyImagePyramid){return 0<this.levels.length&&a>=this.minLevel&&a<=this.maxLevel?this.levels[a].width/this.levels[this.maxLevel].width:NaN}return e.TileSource.prototype.getLevelScale.call(this,a)},getNumTiles:function(a){return this.emulateLegacyImagePyramid?this.getLevelScale(a)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,a)},getTileAtPoint:function(a,n){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,a,n)},getTileUrl:function(a,n,r){if(this.emulateLegacyImagePyramid){var s=null;return 0<this.levels.length&&a>=this.minLevel&&a<=this.maxLevel?this.levels[a].url:s}var l,u,v,d,m,w=Math.pow(.5,this.maxLevel-a),T=Math.ceil(this.width*w),S=Math.ceil(this.height*w);return l=this.getTileWidth(a),u=this.getTileHeight(a),m=Math.ceil(l/w),s=Math.ceil(u/w),a=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,T<l&&S<u?(d=2===this.version&&T===this.width?"full":3===this.version&&T===this.width&&S===this.height?"max":3===this.version?T+","+S:T+",",v="full"):(S=n*m,T=r*s,m=Math.min(m,this.width-S),s=Math.min(s,this.height-T),v=0===n&&0===r&&m===this.width&&s===this.height?"full":[S,T,m,s].join(","),m=Math.ceil(m*w),w=Math.ceil(s*w),d=2===this.version&&m===this.width?"full":3===this.version&&m===this.width&&w===this.height?"max":3===this.version?m+","+w:m+","),[this["@id"],v,d,"0",a].join("/")},__testonly__:{canBeTiled:t,constructLevels:i}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,i,a,n,r){var s;(!(s=e.isPlainObject(t)?t:{width:t,height:i,tileSize:a,tileOverlap:n,tilesUrl:r}).width||!s.height)&&(s.width=65572864,s.height=65572864),s.tileSize||(s.tileSize=256,s.tileOverlap=0),s.tilesUrl||(s.tilesUrl="http://tile.openstreetmap.org/"),s.minLevel=8,e.TileSource.apply(this,[s])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"openstreetmaps"===t.type},configure:function(t,i,a){return t},getTileUrl:function(t,i,a){return this.tilesUrl+(t-8)+"/"+i+"/"+a+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,i,a,n,r){var s;s=e.isPlainObject(t)?t:{width:t,height:i,tileSize:a,tileOverlap:n,tilesUrl:r};var u=256*Math.ceil(s.width/256),v=256*Math.ceil(s.height/256);s.maxLevel=Math.ceil(Math.log(v<u?u/256:v/256)/Math.log(2))-1,s.tileSize=256,s.width=u,s.height=v,e.TileSource.apply(this,[s])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"tiledmapservice"===t.type},configure:function(t,i,a){return t},getTileUrl:function(t,i,a){var n=this.getNumTiles(t).y-1;return this.tilesUrl+t+"/"+i+"/"+(n-a)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(t){void 0===t.tileSize&&(t.tileSize=256),void 0===t.fileFormat&&(t.fileFormat="jpg",this.fileFormat=t.fileFormat);var i={x:t.width,y:t.height};for(t.imageSizes=[{x:t.width,y:t.height}],t.gridSize=[this._getGridSize(t.width,t.height,t.tileSize)];parseInt(i.x,10)>t.tileSize||parseInt(i.y,10)>t.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),t.imageSizes.push({x:i.x,y:i.y}),t.gridSize.push(this._getGridSize(i.x,i.y,t.tileSize));t.imageSizes.reverse(),t.gridSize.reverse(),t.minLevel=0,t.maxLevel=t.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[t])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(t,i,a){return{x:Math.ceil(t/a),y:Math.ceil(i/a)}},_calculateAbsoluteTileNumber:function(t,i,a){for(var n=0,r={},s=0;s<t;s++)n+=(r=this.gridSize[s]).x*r.y;return n+((r=this.gridSize[t]).x*a+i)},supports:function(t,i){return t.type&&"zoomifytileservice"===t.type},configure:function(t,i,a){return t},getTileUrl:function(t,i,a){var n=this._calculateAbsoluteTileNumber(t,i,a);return n=Math.floor(n/256),this.tilesUrl+"TileGroup"+n+"/"+t+"-"+i+"-"+a+"."+this.fileFormat}})}(OpenSeadragon),function(e){e.LegacyTileSource=function(t){var i,a,n;(i=e.isArray(t)?{type:"legacy-image-pyramid",levels:t}:i).levels=function(r){var s,l,u=[];for(l=0;l<r.length;l++)(s=r[l]).height&&s.width&&s.url?u.push({url:s.url,width:Number(s.width),height:Number(s.height)}):e.console.error("Unsupported image format: %s",s.url||"<no URL>");return u.sort(function(v,d){return v.height-d.height})}(i.levels),0<i.levels.length?(a=i.levels[i.levels.length-1].width,n=i.levels[i.levels.length-1].height):(n=a=0,e.console.error("No supported image formats found")),e.extend(!0,i,{width:a,height:n,tileSize:Math.max(n,a),tileOverlap:0,minLevel:0,maxLevel:0<i.levels.length?i.levels.length-1:0}),e.TileSource.apply(this,[i]),this.levels=i.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"legacy-image-pyramid"===t.type||t.documentElement&&"legacy-image-pyramid"===t.documentElement.getAttribute("type")},configure:function(t,i,a){return e.isPlainObject(t)?t.levels:function(n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var r,s,l=n.documentElement,u=l.tagName,v=null,d=[];if("image"===u)try{for(v={type:l.getAttribute("type"),levels:[]},d=l.getElementsByTagName("level"),s=0;s<d.length;s++)v.levels.push({url:(r=d[s]).getAttribute("url"),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10)});return v.levels}catch(m){throw m instanceof Error?m:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"===u)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"===u)throw new Error("Error: "+n)}throw new Error("Unknown element "+u)}(t)},getLevelScale:function(t){return 0<this.levels.length&&t>=this.minLevel&&t<=this.maxLevel?this.levels[t].width/this.levels[this.maxLevel].width:NaN},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(t,i,a){return 0<this.levels.length&&t>=this.minLevel&&t<=this.maxLevel?this.levels[t].url:null}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&"image"===t.type},configure:function(t,i,a){return t},getImageInfo:function(t){var i=this._image=new Image,a=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",function(){a.width=i.naturalWidth,a.height=i.naturalHeight,a.aspectRatio=a.width/a.height,a.dimensions=new e.Point(a.width,a.height),a._tileWidth=a.width,a._tileHeight=a.height,a.tileOverlap=0,a.minLevel=0,a.levels=a._buildLevels(),a.maxLevel=a.levels.length-1,a.ready=!0,a.raiseEvent("ready",{tileSource:a})}),e.addEvent(i,"error",function(){a.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})}),i.src=t},getLevelScale:function(t){return t>=this.minLevel&&t<=this.maxLevel?this.levels[t].width/this.levels[this.maxLevel].width:NaN},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(t,i,a){return t>=this.minLevel&&t<=this.maxLevel?this.levels[t].url:null},getContext2D:function(t,i,a){return t>=this.minLevel&&t<=this.maxLevel?this.levels[t].context2D:null},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var t=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=this._image.naturalWidth,a=this._image.naturalHeight,n=document.createElement("canvas"),r=n.getContext("2d");if(n.width=i,n.height=a,r.drawImage(this._image,0,0,i,a),t[0].context2D=r,delete this._image,e.isCanvasTainted(n))return t;for(;2<=i&&2<=a;){i=Math.floor(i/2),a=Math.floor(a/2);var s=document.createElement("canvas"),l=s.getContext("2d");s.width=i,s.height=a,l.drawImage(n,0,0,i,a),t.splice(0,0,{context2D:l,width:i,height:a}),n=s,r=l}return t},_freeupCanvasMemory:function(){for(var t=0;t<this.levels.length;t++)this.levels[t].context2D&&(this.levels[t].context2D.canvas.height=0,this.levels[t].context2D.canvas.width=0)}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,i,a,n){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(n){e.requestAnimationFrame(function(){var r,s;(r=n).shouldFade&&(s=e.now(),s=1-(s-=r.fadeBeginTime)/r.fadeLength,s=Math.min(1,s),s=Math.max(0,s),r.imgGroup&&e.setElementOpacity(r.imgGroup,s,!0),0<s&&t(r))})}function i(n,r){var s;n.element.disabled||(r>=e.ButtonState.GROUP&&n.currentState===e.ButtonState.REST&&((s=n).shouldFade=!1,s.imgGroup&&e.setElementOpacity(s.imgGroup,1,!0),n.currentState=e.ButtonState.GROUP),r>=e.ButtonState.HOVER&&n.currentState===e.ButtonState.GROUP&&(n.imgHover&&(n.imgHover.style.visibility=""),n.currentState=e.ButtonState.HOVER),r>=e.ButtonState.DOWN&&n.currentState===e.ButtonState.HOVER&&(n.imgDown&&(n.imgDown.style.visibility=""),n.currentState=e.ButtonState.DOWN))}function a(n,r){var s;n.element.disabled||(r<=e.ButtonState.HOVER&&n.currentState===e.ButtonState.DOWN&&(n.imgDown&&(n.imgDown.style.visibility="hidden"),n.currentState=e.ButtonState.HOVER),r<=e.ButtonState.GROUP&&n.currentState===e.ButtonState.HOVER&&(n.imgHover&&(n.imgHover.style.visibility="hidden"),n.currentState=e.ButtonState.GROUP),r<=e.ButtonState.REST&&n.currentState===e.ButtonState.GROUP&&((s=n).shouldFade=!0,s.fadeBeginTime=e.now()+s.fadeDelay,window.setTimeout(function(){t(s)},s.fadeDelay),n.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(n){var r=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},n),this.element=n.element||e.makeNeutralElement("div"),n.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(s){s.insideElementPressed?(i(r,e.ButtonState.DOWN),r.raiseEvent("enter",{originalEvent:s.originalEvent})):s.buttonDownAny||i(r,e.ButtonState.HOVER)},focusHandler:function(s){r.tracker.enterHandler(s),r.raiseEvent("focus",{originalEvent:s.originalEvent})},leaveHandler:function(s){a(r,e.ButtonState.GROUP),s.insideElementPressed&&r.raiseEvent("exit",{originalEvent:s.originalEvent})},blurHandler:function(s){r.tracker.leaveHandler(s),r.raiseEvent("blur",{originalEvent:s.originalEvent})},pressHandler:function(s){i(r,e.ButtonState.DOWN),r.raiseEvent("press",{originalEvent:s.originalEvent})},releaseHandler:function(s){s.insideElementPressed&&s.insideElementReleased?(a(r,e.ButtonState.HOVER),r.raiseEvent("release",{originalEvent:s.originalEvent})):s.insideElementPressed?a(r,e.ButtonState.GROUP):i(r,e.ButtonState.HOVER)},clickHandler:function(s){s.quick&&r.raiseEvent("click",{originalEvent:s.originalEvent})},keyHandler:function(s){13===s.keyCode?(r.raiseEvent("click",{originalEvent:s.originalEvent}),r.raiseEvent("release",{originalEvent:s.originalEvent}),s.preventDefault=!0):s.preventDefault=!1}}),a(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){i(this,e.ButtonState.GROUP)},notifyGroupExit:function(){a(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,a=this.buttons.concat([]),n=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",i=0;i<a.length;i++)this.element.appendChild(a[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(r){var s;for(s=0;s<n.buttons.length;s++)n.buttons[s].notifyGroupEnter()},leaveHandler:function(r){var s;if(!r.insideElementPressed)for(s=0;s<n.buttons.length;s++)n.buttons[s].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var t=this.buttons.pop();this.element.removeChild(t.element),t.destroy()}this.tracker.destroy(),this.element=null}}}(OpenSeadragon),function(e){e.Rect=function(t,i,a,n,r){var s,l;this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof a?a:0,this.height="number"==typeof n?n:0,this.degrees="number"==typeof r?r:0,this.degrees=e.positiveModulo(this.degrees,360),270<=this.degrees?(s=this.getTopRight(),this.x=s.x,this.y=s.y,l=this.height,this.height=this.width,this.width=l,this.degrees-=270):180<=this.degrees?(s=this.getBottomRight(),this.x=s.x,this.y=s.y,this.degrees-=180):90<=this.degrees&&(s=this.getBottomLeft(),this.x=s.x,this.y=s.y,l=this.height,this.height=this.width,this.width=l,this.degrees-=90)},e.Rect.fromSummits=function(t,i,a){var n=t.distanceTo(i),r=t.distanceTo(a);return a=i.minus(t),i=Math.atan(a.y/a.x),a.x<0?i+=Math.PI:a.y<0&&(i+=2*Math.PI),new e.Rect(t.x,t.y,n,r,i/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),a=t.getBoundingBox(),n=Math.min(i.x,a.x),r=Math.min(i.y,a.y);return t=Math.max(i.x+i.width,a.x+a.width),a=Math.max(i.y+i.height,a.y+a.height),new e.Rect(n,r,t-n,a-r)},intersection:function(t){var R,C,B,D,L,W,i=1e-10,a=[],n=this.getTopLeft();t.containsPoint(n,i)&&a.push(n),n=this.getTopRight(),t.containsPoint(n,i)&&a.push(n),n=this.getBottomLeft(),t.containsPoint(n,i)&&a.push(n),n=this.getBottomRight(),t.containsPoint(n,i)&&a.push(n),n=t.getTopLeft(),this.containsPoint(n,i)&&a.push(n),n=t.getTopRight(),this.containsPoint(n,i)&&a.push(n),n=t.getBottomLeft(),this.containsPoint(n,i)&&a.push(n),n=t.getBottomRight(),this.containsPoint(n,i)&&a.push(n);for(var r=this._getSegments(),s=t._getSegments(),l=0;l<r.length;l++)for(var u=r[l],v=0;v<s.length;v++){var d=s[v];B=d[0],D=d[1],void 0,void 0,L=(C=u[1]).minus(R=u[0]),(d=0==(C=-(W=D.minus(B)).x*L.y+L.x*W.y)?null:(D=(L.x*(R.y-B.y)-L.y*(R.x-B.x))/C,C=(W.x*(R.y-B.y)-W.y*(R.x-B.x))/C,-i<=D&&D<=1-i&&-i<=C&&C<=1-i?new e.Point(R.x+C*L.x,R.y+C*L.y):null))&&a.push(d)}if(0===a.length)return null;for(var m=a[0].x,w=a[0].x,T=a[0].y,S=a[0].y,P=1;P<a.length;P++){var _=a[P];_.x<m&&(m=_.x),_.x>w&&(w=_.x),_.y<T&&(T=_.y),_.y>S&&(S=_.y)}return new e.Rect(m,T,w-m,S-T)},_getSegments:function(){var t=this.getTopLeft(),i=this.getTopRight(),a=this.getBottomLeft(),n=this.getBottomRight();return[[t,i],[i,n],[n,a],[a,t]]},rotate:function(t,i){if(0===(t=e.positiveModulo(t,360)))return this.clone();i=i||this.getCenter();var a=this.getTopLeft().rotate(t,i);return t=(t=this.getTopRight().rotate(t,i).minus(a)).apply(function(n){return Math.abs(n)<1e-15?0:n}),i=Math.atan(t.y/t.x),t.x<0?i+=Math.PI:t.y<0&&(i+=2*Math.PI),new e.Rect(a.x,a.y,this.width,this.height,i/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),a=this.getBottomLeft(),n=this.getBottomRight(),r=Math.min(t.x,i.x,a.x,n.x),s=Math.max(t.x,i.x,a.x,n.x),l=Math.min(t.y,i.y,a.y,n.y);return n=Math.max(t.y,i.y,a.y,n.y),new e.Rect(r,l,s-r,n-l)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),a=Math.floor(t.y),n=Math.ceil(t.width+t.x-i);return t=Math.ceil(t.height+t.y-a),new e.Rect(i,a,n,t)},containsPoint:function(t,i){i=i||0;var a=this.getTopLeft(),n=this.getTopRight(),r=this.getBottomLeft(),s=n.minus(a),l=r.minus(a);return(t.x-a.x)*s.x+(t.y-a.y)*s.y>=-i&&(t.x-n.x)*s.x+(t.y-n.y)*s.y<=i&&(t.x-a.x)*l.x+(t.y-a.y)*l.y>=-i&&(t.x-r.x)*l.x+(t.y-r.y)*l.y<=i},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function i(d){d.quick&&(d="horizontal"===this.scroll?Math.floor(d.position.x/this.panelWidth):Math.floor(d.position.y/this.panelHeight),this.viewer.goToPage(d)),this.element.focus()}function a(d){if(this.dragging=!0,this.element){var m=Number(this.element.style.marginLeft.replace("px","")),w=Number(this.element.style.marginTop.replace("px","")),T=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),P=e.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?0<-d.delta.x?m>-(T-P.x)&&(this.element.style.marginLeft=m+2*d.delta.x+"px",r(this,P.x,m+2*d.delta.x)):-d.delta.x<0&&m<0&&(this.element.style.marginLeft=m+2*d.delta.x+"px",r(this,P.x,m+2*d.delta.x)):0<-d.delta.y?w>-(S-P.y)&&(this.element.style.marginTop=w+2*d.delta.y+"px",r(this,P.y,w+2*d.delta.y)):-d.delta.y<0&&w<0&&(this.element.style.marginTop=w+2*d.delta.y+"px",r(this,P.y,w+2*d.delta.y))}}function n(d){if(this.element){var m=Number(this.element.style.marginLeft.replace("px","")),w=Number(this.element.style.marginTop.replace("px","")),T=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),P=e.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?0<d.scroll?m>-(T-P.x)&&(this.element.style.marginLeft=m-60*d.scroll+"px",r(this,P.x,m-60*d.scroll)):d.scroll<0&&m<0&&(this.element.style.marginLeft=m-60*d.scroll+"px",r(this,P.x,m-60*d.scroll)):d.scroll<0?w>P.y-S&&(this.element.style.marginTop=w+60*d.scroll+"px",r(this,P.y,w+60*d.scroll)):0<d.scroll&&w<0&&(this.element.style.marginTop=w+60*d.scroll+"px",r(this,P.y,w+60*d.scroll)),d.preventDefault=!0}}function r(d,m,w){var T,S,P,_,R;for(T="horizontal"===d.scroll?d.panelWidth:d.panelHeight,S=Math.ceil(m/T)+5,_=S=(S=(P=Math.ceil((Math.abs(w)+m)/T)+1)-S)<0?0:S;_<P&&_<d.panels.length;_++)if(!(R=d.panels[_]).activePanel){var C=d.viewer.tileSources[_];C=new e.Viewer({id:R.id,tileSources:[C=C.referenceStripThumbnailUrl?{type:"image",url:C.referenceStripThumbnailUrl}:C],element:R,navigatorSizeRatio:d.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:d.viewer.loadTilesWithAjax,ajaxHeaders:d.viewer.ajaxHeaders,useCanvas:d.useCanvas}),e.setElementPointerEventsNone(C.canvas),e.setElementPointerEventsNone(C.container),C.innerTracker.setTracking(!1),C.outerTracker.setTracking(!1),d.miniViewers[R.id]=C,R.activePanel=!0}}function s(d){d=d.eventSource.element,"horizontal"===this.scroll?d.style.marginBottom="0px":d.style.marginLeft="0px"}function l(d){d=d.eventSource.element,"horizontal"===this.scroll?d.style.marginBottom="-"+e.getElementSize(d).y/2+"px":d.style.marginLeft="-"+e.getElementSize(d).x/2+"px"}function u(d){if(d.ctrl||d.alt||d.meta)d.preventDefault=!1;else switch(d.keyCode){case 38:case 39:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 40:case 37:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1}}function v(d){if(d.ctrl||d.alt||d.meta)d.preventDefault=!1;else switch(d.keyCode){case 61:case 48:case 119:case 87:case 100:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 45:case 115:case 83:case 97:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1}}e.ReferenceStrip=function(d){var m,w,T,S=d.viewer,P=e.getElementSize(S.element);for(d.id||(d.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element}),e.extend(this,d),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,(w=this.element.style).marginTop="0px",w.marginRight="0px",w.marginBottom="0px",w.marginLeft="0px",w.left="0px",w.bottom="0px",w.border="0px",w.background="#000",w.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=S,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,i),dragHandler:e.delegate(this,a),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,s),leaveHandler:e.delegate(this,l),keyDownHandler:e.delegate(this,u),keyHandler:e.delegate(this,v),preProcessEventHandler:function(_){"wheel"===_.eventType&&(_.preventDefault=!0)}}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",S.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"===d.scroll?(this.element.style.width=P.x*d.sizeRatio*S.tileSources.length+12*S.tileSources.length+"px",this.element.style.height=P.y*d.sizeRatio+"px",S.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=P.y*d.sizeRatio*S.tileSources.length+12*S.tileSources.length+"px",this.element.style.width=P.x*d.sizeRatio+"px",S.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=P.x*this.sizeRatio+8,this.panelHeight=P.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},T=0;T<S.tileSources.length;T++)(m=e.makeNeutralElement("div")).id=this.element.id+"-"+T,m.style.width=this.panelWidth+"px",m.style.height=this.panelHeight+"px",m.style.display="inline",m.style.float="left",m.style.cssFloat="left",m.style.styleFloat="left",m.style.padding="2px",e.setElementTouchActionNone(m),e.setElementPointerEventsNone(m),this.element.appendChild(m),m.activePanel=!1,this.panels.push(m);r(this,"vertical"===this.scroll?P.y:P.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(d){var m,w=this.element.querySelector("#"+this.element.id+"-"+d),T=e.getElementSize(this.viewer.canvas),S=Number(this.element.style.width.replace("px","")),P=Number(this.element.style.height.replace("px","")),_=-Number(this.element.style.marginLeft.replace("px","")),R=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==w&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=w,this.currentSelected.style.background="#999","horizontal"===this.scroll?(m=Number(d)*(this.panelWidth+3))>_+T.x-this.panelWidth?(m=Math.min(m,S-T.x),this.element.style.marginLeft=-m+"px",r(this,T.x,-m)):m<_&&(m=Math.max(0,m-T.x/2),this.element.style.marginLeft=-m+"px",r(this,T.x,-m)):(m=Number(d)*(this.panelHeight+3))>R+T.y-this.panelHeight?(m=Math.min(m,P-T.y),this.element.style.marginTop=-m+"px",r(this,T.y,-m)):m<R&&(m=Math.max(0,m-T.y/2),this.element.style.marginTop=-m+"px",r(this,T.y,-m)),this.currentPage=d,s.call(this,{eventSource:this.tracker}))},update:function(){return!!t[this.id].animating},destroy:function(){if(this.miniViewers)for(var d in this.miniViewers)this.miniViewers[d].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}}}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,a,n,r,s){e.Rect.apply(this,[t,i,a,n]),this.minLevel=r,this.maxLevel=s},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:1<i.length?i[1].springStiffness:5,animationTime:1<i.length?i[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&0<=t.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,i;this.current.time=e.now(),this._exponential?(t=this.start._logValue,i=this.target._logValue):(t=this.start.value,i=this.target.value),a=this.current.time>=this.target.time?i:t+(i-t)*(n=this.springStiffness,a=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(n*-a))/(1-Math.exp(-n)));var a,n=this.current.value;return this.current.value=this._exponential?Math.exp(a):a,n!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){function t(i){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},i),this.image=null}t.prototype={errorMsg:null,start:function(){var i=this,a=this.abort;this.image=new Image,this.image.onload=function(){i.finish(!0)},this.image.onabort=this.image.onerror=function(){i.errorMsg="Image load aborted",i.finish(!1)},this.jobId=window.setTimeout(function(){i.errorMsg="Image load exceeded timeout ("+i.timeout+" ms)",i.finish(!1)},this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",postData:this.postData,success:function(n){try{s=new window.Blob([n.response])}catch(l){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===l.name&&r&&((r=new r).append(n.response),s=r.getBlob())}0===s.size&&(i.errorMsg="Empty image response.",i.finish(!1));var s=(window.URL||window.webkitURL).createObjectURL(s);i.image.src=s},error:function(n){i.errorMsg="Image load aborted - XHR error: Ajax returned "+n.status,i.finish(!1)}}),this.abort=function(){i.request.abort(),"function"==typeof a&&a()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(i){this.image.onload=this.image.onerror=this.image.onabort=null,i||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(i){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},i)},e.ImageLoader.prototype={addJob:function(i){var a=this,n=new t({src:i.src,loadWithAjax:i.loadWithAjax,ajaxHeaders:i.loadWithAjax?i.ajaxHeaders:null,crossOriginPolicy:i.crossOriginPolicy,ajaxWithCredentials:i.ajaxWithCredentials,postData:i.postData,callback:function(r){var s,l,u;l=r,u=i.callback,(s=a).jobsInProgress--,(!s.jobLimit||s.jobsInProgress<s.jobLimit)&&0<s.jobQueue.length&&(s.jobQueue.shift().start(),s.jobsInProgress++),u(l.image,l.errorMsg,l.request)},abort:i.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(n.start(),this.jobsInProgress++):this.jobQueue.push(n)},clear:function(){for(var i=0;i<this.jobQueue.length;i++){var a=this.jobQueue[i];"function"==typeof a.abort&&a.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(t,i,a,n,r,s,l,u,v,d,m,w){this.level=t,this.x=i,this.y=a,this.bounds=n,this.sourceBounds=d,this.exists=r,this.url=s,this.postData=m,this.context2D=l,this.loadWithAjax=u,this.ajaxHeaders=v,void 0===w&&(e.console.error("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),w=e.TileSource.prototype.getTileHashKey(t,i,a,s,v,m)),this.cacheKey=w,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==t&&t.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,i,a,n,r){var s,l=this.position.times(e.pixelDensityRatio),u=this.size.times(e.pixelDensityRatio);if(this.context2D||this.cacheImageRecord)if(s=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&s){var v,d;t.save(),t.globalAlpha=this.opacity,"number"==typeof a&&1!==a&&(l=l.times(a),u=u.times(a)),n instanceof e.Point&&(l=l.plus(n)),1===t.globalAlpha&&this._hasTransparencyChannel()&&(r&&(l.x=Math.round(l.x),l.y=Math.round(l.y),u.x=Math.round(u.x),u.y=Math.round(u.y)),t.clearRect(l.x,l.y,u.x,u.y)),i({context:t,tile:this,rendered:s}),this.sourceBounds?(v=Math.min(this.sourceBounds.width,s.canvas.width),d=Math.min(this.sourceBounds.height,s.canvas.height)):(v=s.canvas.width,d=s.canvas.height),t.translate(l.x+u.x/2,0),this.flipped&&t.scale(-1,1),t.drawImage(s.canvas,0,0,v,d,-u.x/2,l.y,u.x,u.y),t.restore()}else e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());else e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,a){var n=Math.max(1,Math.ceil((a.x-i.x)/2));return i=Math.max(1,Math.ceil((a.y-i.y)/2)),new e.Point(n,i).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply(function(r){return r%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,a){a=e.isPlainObject(t)?t:{element:t,location:i,placement:a},this.element=a.element,this.style=a.element.style,this._init(a)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var a=e.Placement.properties[this.placement];a&&(a.isHorizontallyCentered?t.x-=i.x/2:a.isRight&&(t.x-=i.x),a.isVerticallyCentered?t.y-=i.y/2:a.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var a=e.getCssPropertyWithVendorPrefix("transformOrigin");t=e.getCssPropertyWithVendorPrefix("transform"),a&&t&&(i[a]="",i[t]="")},drawHTML:function(t,i){var a=this.element;a.parentNode!==t&&(a.prevElementParent=a.parentNode,a.prevNextSibling=a.nextSibling,t.appendChild(a),this.style.position="absolute",this.size=e.getElementSize(a));var n=this._getOverlayPositionAndSize(i);t=n.position,a=this.size=n.size,i=n.rotate,this.onDraw?this.onDraw(t,a,this.element):((n=this.style).left=t.x+"px",n.top=t.y+"px",null!==this.width&&(n.width=a.x+"px"),null!==this.height&&(n.height=a.y+"px"),t=e.getCssPropertyWithVendorPrefix("transformOrigin"),a=e.getCssPropertyWithVendorPrefix("transform"),t&&a&&(i?(n[t]=this._getTransformOrigin(),n[a]="rotate("+i+"deg)"):(n[t]="",n[a]="")),n.display="block")},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),a=this._getSizeInPixels(t);this.adjust(i,a);var n=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var r=new e.Rect(i.x,i.y,a.x,a.y);i=(r=this._getBoundingBox(r,t.degrees)).getTopLeft(),a=r.getSize()}else n=t.degrees;return{position:i,size:a,rotate:n}},_getSizeInPixels:function(t){var i=this.size.x,a=this.size.y;if(null!==this.width||null!==this.height){var n=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=n.x),null!==this.height&&(a=n.y)}return this.checkResize&&(null===this.width||null===this.height)&&(n=this.size=e.getElementSize(this.element),null===this.width&&(i=n.x),null===this.height&&(a=n.y)),new e.Point(i,a)},_getBoundingBox:function(t,i){var a=this._getPlacementPoint(t);return t.rotate(i,a).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),a=e.Placement.properties[this.placement];return a&&(a.isHorizontallyCentered?i.x+=t.width/2:a.isRight&&(i.x+=t.width),a.isVerticallyCentered?i.y+=t.height/2:a.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i&&(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom")),t},update:function(t,i){i=e.isPlainObject(t)?t:{location:t,placement:i},this._init({location:i.location||this.location,placement:(void 0!==i.placement?i:this).placement,onDraw:i.onDraw||this.onDraw,checkResize:i.checkResize||this.checkResize,width:(void 0!==i.width?i:this).width,height:(void 0!==i.height?i:this).height,rotationMode:i.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,a=this.height;if(null===i||null===a){var n=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=n.x),null===a&&(a=n.y)}return n=this.location.clone(),this.adjust(n,new e.Point(i,a)),this._adjustBoundsForRotation(t,new e.Rect(n.x,n.y,i,a))},_adjustBoundsForRotation:function(t,i){return t&&0!==t.degrees&&this.rotationMode!==e.OverlayRotationMode.EXACT?this.rotationMode!==e.OverlayRotationMode.BOUNDING_BOX?i.rotate(-t.degrees,this._getPlacementPoint(i)):null===this.width||null===this.height?i:(i=this._getOverlayPositionAndSize(t),t.viewerElementToViewportRectangle(new e.Rect(i.position.x,i.position.y,i.size.x,i.size.y))):i}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas&&(i=this._calculateCanvasSize(),this.canvas.width=i.x,this.canvas.height=i.y),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,i,a,n){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,a,n),this},updateOverlay:function(t,i,a){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,a),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){return t=this.viewport.pixelFromPointNoRotate(t,!0),new e.Point(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio)},clipWithPolygons:function(t,i){if(this.useCanvas){var a=this._getContext(i);a.beginPath(),t.forEach(function(n){n.forEach(function(r,s){a[0===s?"moveTo":"lineTo"](r.x,r.y)})}),a.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,a=0;a<i.getItemCount();a++)i.getItemAt(a).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,a=0;a<t.getItemCount();a++){var n=t.getItemAt(a).getOpacity();i<n&&(i=n)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var t=this._calculateCanvasSize();(this.canvas.width!==t.x||this.canvas.height!==t.y)&&(this.canvas.width=t.x,this.canvas.height=t.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(t=this._calculateSketchCanvasSize(),this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear()}},_clear:function(t,i){this.useCanvas&&(t=this._getContext(t),i?t.clearRect(i.x,i.y,i.width,i.height):t.clearRect(0,0,(i=t.canvas).width,i.height))},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0);return t=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0),new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio)},drawTile:function(t,i,a,n,r,s){e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas?(a=this._getContext(a),t.drawCanvas(a,i,n=n||1,r,s)):t.drawHTML(this.canvas)},_getContext:function(t){var i=this.context;if(t){if(null===this.sketchCanvas){if(this.sketchCanvas=document.createElement("canvas"),t=this._calculateSketchCanvasSize(),this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var a=this;this.viewer.addHandler("rotate",function n(){if(0!==a.viewport.getRotation()){a.viewer.removeHandler("rotate",n);var r=a._calculateSketchCanvasSize();a.sketchCanvas.width=r.x,a.sketchCanvas.height=r.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}i=this.sketchContext}return i},saveContext:function(t){this.useCanvas&&this._getContext(t).save()},restoreContext:function(t){this.useCanvas&&this._getContext(t).restore()},setClip:function(t,i){this.useCanvas&&((i=this._getContext(i)).beginPath(),i.rect(t.x,t.y,t.width,t.height),i.clip())},drawRectangle:function(t,i,a){this.useCanvas&&((a=this._getContext(a)).save(),a.fillStyle=i,a.fillRect(t.x,t.y,t.width,t.height),a.restore())},blendSketch:function(t,i,a,n){var r=t;if(e.isPlainObject(r)||(r={opacity:t,scale:i,translate:a,compositeOperation:n}),this.useCanvas&&this.sketchCanvas){t=r.opacity,n=r.compositeOperation;var s=r.bounds;this.context.save(),this.context.globalAlpha=t,n&&(this.context.globalCompositeOperation=n),s?(s.x<0&&(s.width+=s.x,s.x=0),s.x+s.width>this.canvas.width&&(s.width=this.canvas.width-s.x),s.y<0&&(s.height+=s.y,s.y=0),s.y+s.height>this.canvas.height&&(s.height=this.canvas.height-s.y),this.context.drawImage(this.sketchCanvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height)):(i=r.scale||1,t=(a=r.translate)instanceof e.Point?a:new e.Point(0,0),n=0,s=0,a&&(r=this.sketchCanvas.width-this.canvas.width,a=this.sketchCanvas.height-this.canvas.height,n=Math.round(r/2),s=Math.round(a/2)),this.context.drawImage(this.sketchCanvas,t.x-n*i,t.y-s*i,(this.canvas.width+2*n)*i,(this.canvas.height+2*s)*i,-n,-s,this.canvas.width+2*n,this.canvas.height+2*s)),this.context.restore()}},drawDebugInfo:function(t,i,a,n){if(this.useCanvas){var r=this.viewer.world.getIndexOfItem(n)%this.debugGridColor.length,s=this.context;s.save(),s.lineWidth=2*e.pixelDensityRatio,s.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",s.strokeStyle=this.debugGridColor[r],s.fillStyle=this.debugGridColor[r],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),n.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0)}),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),s.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var l=(t.position.x+t.size.x/2)*e.pixelDensityRatio;s.translate(l,r=(t.position.y+t.size.y/2)*e.pixelDensityRatio),s.rotate(Math.PI/180*-this.viewport.degrees),s.translate(-l,-r),0===t.x&&0===t.y&&(s.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),s.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),s.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),s.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),s.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),s.fillText("Order: "+a+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),s.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),s.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),n.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),s.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(t){this.useCanvas&&(this._imageSmoothingEnabled=t,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(t){t.msImageSmoothingEnabled=this._imageSmoothingEnabled,t.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){return t=this._getContext(t).canvas,new e.Point(t.width,t.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),a=this._getContext(t.useSketch);a.save(),a.translate(i.x,i.y),this.viewer.viewport.flipped?(a.rotate(Math.PI/180*-t.degrees),a.scale(-1,1)):a.rotate(Math.PI/180*t.degrees),a.translate(-i.x,-i.y)},_flip:function(t){var i=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter();(t=this._getContext(t.useSketch)).translate(i.x,0),t.scale(-1,1),t.translate(-i.x,0)},_restoreRotationChanges:function(t){this._getContext(t).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*t),y:Math.round(i.y*t)}},_calculateSketchCanvasSize:function(){var t=this._calculateCanvasSize();return 0===this.viewport.getRotation()?t:{x:t=Math.ceil(Math.sqrt(t.x*t.x+t.y*t.y)),y:t}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;(t=i.length&&i[0]instanceof e.Point?{containerSize:i[0],contentSize:i[1],config:i[2]}:t).config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:e.DEFAULT_SETTINGS.silenceMultiImageWarnings},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(0<t.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(0<t.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(0<t.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(0<t.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?1<=t?t:1:1<=t?1:t)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),a=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-a/2,i,a)},goHome:function(t){return this.viewer&&this.viewer.raiseEvent("home",{immediately:t}),this.fitBounds(this.getHomeBounds(),t)},getMinZoom:function(){var t=this.getHomeZoom();return this.minZoomLevel||this.minZoomImageRatio*t},getMaxZoom:function(){var t=this.maxZoomLevel;return t||(t=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,t/=this._contentBounds.width),Math.max(t,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var i=this.getCenter(t),a=1/this.getZoom(t);return t=a/this.getAspectRatio(),new e.Rect(i.x-a/2,i.y-t/2,a,t)},getBoundsWithMargins:function(t){return this.getBoundsNoRotateWithMargins(t).rotate(-this.getRotation(),this.getCenter(t))},getBoundsNoRotateWithMargins:function(t){var i=this.getBoundsNoRotate(t);return t=this._containerInnerSize.x*this.getZoom(t),i.x-=this._margins.left/t,i.y-=this._margins.top/t,i.width+=(this._margins.left+this._margins.right)/t,i.height+=(this._margins.top+this._margins.bottom)/t,i},getCenter:function(t){var i,a,n,r=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?r:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),t=(a=1/(n=this.getZoom()))/this.getAspectRatio(),t=new e.Rect(r.x-a/2,r.y-t/2,a,t),n=this._pixelFromPoint(this.zoomPoint,t).minus(i).divide(this._containerInnerSize.x*n),s.plus(n)):s},getZoom:function(t){return(t?this.zoomSpring.current:this.zoomSpring.target).value},_applyZoomConstraints:function(t){return Math.max(Math.min(t,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){if(t=new e.Rect(t.x,t.y,t.width,t.height),!this.wrapHorizontal){var i=this.visibilityRatio*t.width,a=t.x+t.width,n=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width;a=this._contentBoundsNoRotate.x-a+i,n=n-t.x-i,i>this._contentBoundsNoRotate.width?t.x+=(a+n)/2:n<0?t.x+=n:0<a&&(t.x+=a)}return this.wrapVertical||(n=this._contentBoundsNoRotate.y-(n=t.y+t.height)+(i=this.visibilityRatio*t.height),a=(a=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height)-t.y-i,i>this._contentBoundsNoRotate.height?t.y+=(n+a)/2:a<0?t.y+=a:0<n&&(t.y+=n)),t},_raiseConstraintsEvent:function(t){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:t})},applyConstraints:function(t){var i=this.getZoom(),a=this._applyZoomConstraints(i);return i!==a&&this.zoomTo(a,this.zoomPoint,t),i=this.getBoundsNoRotate(),a=this._applyBoundaryConstraints(i),this._raiseConstraintsEvent(t),i.x===a.x&&i.y===a.y&&!t||this.fitBounds(a.rotate(-this.getRotation()),t),this},ensureVisible:function(t){return this.applyConstraints(t)},_fitBounds:function(t,i){var a=(i=i||{}).immediately||!1,n=i.constraints||!1,r=this.getAspectRatio();if(i=t.getCenter(),(t=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox()).getAspectRatio()>=r?t.height=t.width/r:t.width=t.height*r,t.x=i.x-t.width/2,t.y=i.y-t.height/2,r=1/t.width,n){var s=t.getAspectRatio(),l=this._applyZoomConstraints(r);r!==l&&(t.width=1/(r=l),t.x=i.x-t.width/2,t.height=t.width/s,t.y=i.y-t.height/2),i=(t=this._applyBoundaryConstraints(t)).getCenter(),this._raiseConstraintsEvent(a)}return a?(this.panTo(i,!0),this.zoomTo(r,null,!0)):(this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0),l=this.getBounds(),0===(s=this.getZoom())||Math.abs(r/s-1)<1e-8?(this.zoomTo(r,!0),this.panTo(i,a)):(s=(t=t.rotate(-this.getRotation())).getTopLeft().times(r).minus(l.getTopLeft().times(s)).divide(r-s),this.zoomTo(r,s,a)))},fitBounds:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!1})},fitBoundsWithConstraints:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(t){return t=this.getBounds(t),this._applyBoundaryConstraints(t)},panBy:function(t,i){var a=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(a.plus(t),i)},panTo:function(t,i){return i?(this.centerSpringX.resetTo(t.x),this.centerSpringY.resetTo(t.y)):(this.centerSpringX.springTo(t.x),this.centerSpringY.springTo(t.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:t,immediately:i}),this},zoomBy:function(t,i,a){return this.zoomTo(this.zoomSpring.target.value*t,i,a)},zoomTo:function(t,i,a){var n=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,a?this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.resetTo(t)}):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:a}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(t,i){var n=this.getBoundsNoRotate(),r=n;return this.containerSize.x=t.x,this.containerSize.y=t.y,this._updateContainerInnerSize(),i&&(r.width=n.width*(t.x/this.containerSize.x),r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var t=this;this._adjustCenterSpringsForZoomPoint(function(){t.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var i=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,i},_adjustCenterSpringsForZoomPoint:function(t){if(this.zoomPoint){var i=this.pixelFromPoint(this.zoomPoint,!0);t(),i=this.pixelFromPoint(this.zoomPoint,!0).minus(i),i=this.deltaPointsFromPixels(i,!0),this.centerSpringX.shiftBy(i.x),this.centerSpringY.shiftBy(i.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else t()},deltaPixelsFromPointsNoRotate:function(t,i){return t.times(this._containerInnerSize.x*this.getZoom(i))},deltaPixelsFromPoints:function(t,i){return this.deltaPixelsFromPointsNoRotate(t.rotate(this.getRotation()),i)},deltaPointsFromPixelsNoRotate:function(t,i){return t.divide(this._containerInnerSize.x*this.getZoom(i))},deltaPointsFromPixels:function(t,i){return this.deltaPointsFromPixelsNoRotate(t,i).rotate(-this.getRotation())},pixelFromPointNoRotate:function(t,i){return this._pixelFromPointNoRotate(t,this.getBoundsNoRotate(i))},pixelFromPoint:function(t,i){return this._pixelFromPoint(t,this.getBoundsNoRotate(i))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(t,i){return this._pixelFromPointNoRotate(t.rotate(this.getRotation(),this.getCenter(!0)),i)},pointFromPixelNoRotate:function(t,i){return i=this.getBoundsNoRotate(i),t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/i.width).plus(i.getTopLeft())},pointFromPixel:function(t,i){return this.pointFromPixelNoRotate(t,i).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,i){var a=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/a,i*this._contentSizeNoRotate.x/a)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var a=this.viewer.world.getItemCount();if(1<a)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===a)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,i,!0)}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var a=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*a,i/this._contentSizeNoRotate.x*a)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var a=this.viewer.world.getItemCount();if(1<a)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===a)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,i,!0)}return(i=this._imageToViewportDelta(t,i)).x+=this._contentBoundsNoRotate.x,i.y+=this._contentBoundsNoRotate.y,i},imageToViewportRectangle:function(t,i,a,n){var r=t;if(r instanceof e.Rect||(r=new e.Rect(t,i,a,n)),this.viewer){var s=this.viewer.world.getItemCount();if(1<s)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===s)return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,i,a,n,!0)}return a=this.imageToViewportCoordinates(r.x,r.y),n=this._imageToViewportDelta(r.width,r.height),new e.Rect(a.x,a.y,n.x,n.y,r.degrees)},viewportToImageRectangle:function(t,i,a,n){var r=t;if(r instanceof e.Rect||(r=new e.Rect(t,i,a,n)),this.viewer){var s=this.viewer.world.getItemCount();if(1<s)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===s)return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,i,a,n,!0)}return a=this.viewportToImageCoordinates(r.x,r.y),n=this._viewportToImageDelta(r.width,r.height),new e.Rect(a.x,a.y,n.x,n.y,r.degrees)},viewerElementToImageCoordinates:function(t){return t=this.pointFromPixel(t,!0),this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(t){return t=this.imageToViewportCoordinates(t),this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer."),t=t.minus(e.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(t){return this.pointFromPixel(t,!0)},viewportToViewerElementCoordinates:function(t){return this.pixelFromPoint(t,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer."),t=t.minus(e.getElementPosition(this.viewer.element)),this.viewerElementToViewportCoordinates(t)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}return t*(this._containerInnerSize.x/(i=this._contentSizeNoRotate.x)*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(t){return this.flipped===t||(this.flipped=t,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:t})),this}}}(OpenSeadragon),function(e){e.TiledImage=function(n){var r=this;e.console.assert(n.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(n.drawer,"[TiledImage] options.drawer is required"),e.console.assert(n.viewer,"[TiledImage] options.viewer is required"),e.console.assert(n.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(n.source,"[TiledImage] options.source is required"),e.console.assert(!n.clip||n.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=n.tileCache,delete n.tileCache,this._drawer=n.drawer,delete n.drawer,this._imageLoader=n.imageLoader,delete n.imageLoader,n.clip instanceof e.Rect&&(this._clip=n.clip.clone()),delete n.clip;var s=n.x||0;delete n.x;var l=n.y||0;delete n.y,this.normHeight=n.source.dimensions.y/n.source.dimensions.x,this.contentAspectX=n.source.dimensions.x/n.source.dimensions.y;var u=1;n.width?(u=n.width,delete n.width,n.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete n.height)):n.height&&(u=n.height/this.normHeight,delete n.height);var v=n.fitBounds;delete n.fitBounds;var d=n.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete n.fitBoundsPlacement;var m=n.degrees||0;delete n.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:e.DEFAULT_SETTINGS.subPixelRoundingForTransparency},n),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:s,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:u,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:m,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),v&&this.fitBounds(v,d,!0),this._drawingHandler=function(w){r.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:r},w))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(n){n!==this._fullyLoaded&&(this._fullyLoaded=n,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var n=this._xSpring.update(),r=this._ySpring.update(),s=this._scaleSpring.update(),l=this._degreesSpring.update();return!!(n||r||s||l)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(n){return this.getBoundsNoRotate(n).rotate(this.getRotation(n),this._getRotationPoint(n))},getBoundsNoRotate:function(n){return n?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(n){var r=this.getBoundsNoRotate(n);if(this._clip){var s=(n?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x;s=this._clip.times(s),r=new e.Rect(r.x+s.x,r.y+s.y,s.width,s.height)}return r.rotate(this.getRotation(n),this._getRotationPoint(n))},getTileBounds:function(n,r,s){var l=this.source.getNumTiles(n),u=(l.x+r%l.x)%l.x,v=(l.y+s%l.y)%l.y;return n=this.source.getTileBounds(n,u,v),this.getFlip()&&(n.x=1-n.x-n.width),n.x+=(r-u)/l.x,n.y+=this._worldHeightCurrent/this._worldWidthCurrent*((s-v)/l.y),n},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var n=this.imageToWindowCoordinates(new e.Point(0,0)),r=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(r.x-n.x,r.y-n.y)},_viewportToImageDelta:function(n,r,s){return new e.Point(n*(this.source.dimensions.x/(s=(s?this._scaleSpring.current:this._scaleSpring.target).value)),r*(this.source.dimensions.y*this.contentAspectX/s))},viewportToImageCoordinates:function(n,r,s){var l;return n instanceof e.Point?(s=r,l=n):l=new e.Point(n,r),l=l.rotate(-this.getRotation(s),this._getRotationPoint(s)),s?this._viewportToImageDelta(l.x-this._xSpring.current.value,l.y-this._ySpring.current.value):this._viewportToImageDelta(l.x-this._xSpring.target.value,l.y-this._ySpring.target.value)},_imageToViewportDelta:function(n,r,s){return new e.Point(n/this.source.dimensions.x*(s=(s?this._scaleSpring.current:this._scaleSpring.target).value),r/this.source.dimensions.y/this.contentAspectX*s)},imageToViewportCoordinates:function(n,r,s){return n instanceof e.Point&&(s=r,r=n.y,n=n.x),r=this._imageToViewportDelta(n,r),s?(r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value):(r.x+=this._xSpring.target.value,r.y+=this._ySpring.target.value),r.rotate(this.getRotation(s),this._getRotationPoint(s))},imageToViewportRectangle:function(n,r,s,l,u){var v=n;return v instanceof e.Rect?u=r:v=new e.Rect(n,r,s,l),s=this.imageToViewportCoordinates(v.getTopLeft(),u),l=this._imageToViewportDelta(v.width,v.height,u),new e.Rect(s.x,s.y,l.x,l.y,v.degrees+this.getRotation(u))},viewportToImageRectangle:function(n,r,s,l,u){var v=n;return n instanceof e.Rect?u=r:v=new e.Rect(n,r,s,l),s=this.viewportToImageCoordinates(v.getTopLeft(),u),l=this._viewportToImageDelta(v.width,v.height,u),new e.Rect(s.x,s.y,l.x,l.y,v.degrees-this.getRotation(u))},viewerElementToImageCoordinates:function(n){return n=this.viewport.pointFromPixel(n,!0),this.viewportToImageCoordinates(n)},imageToViewerElementCoordinates:function(n){return n=this.imageToViewportCoordinates(n),this.viewport.pixelFromPoint(n,!0)},windowToImageCoordinates:function(n){return n=n.minus(OpenSeadragon.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(n){return this.imageToViewerElementCoordinates(n).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(n){var r=this._scaleSpring.current.value;return n=n.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((n.x-this._xSpring.current.value)/r,(n.y-this._ySpring.current.value)/r,n.width/r,n.height/r,n.degrees)},viewportToImageZoom:function(n){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*n},imageToViewportZoom:function(n){return n/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(n,r){var s=this._xSpring.target.value===n.x&&this._ySpring.target.value===n.y;if(r){if(s&&this._xSpring.current.value===n.x&&this._ySpring.current.value===n.y)return;this._xSpring.resetTo(n.x),this._ySpring.resetTo(n.y),this._needsDraw=!0}else{if(s)return;this._xSpring.springTo(n.x),this._ySpring.springTo(n.y),this._needsDraw=!0}s||this._raiseBoundsChange()},setWidth:function(n,r){this._setScale(n,r)},setHeight:function(n,r){this._setScale(n/this.normHeight,r)},setCroppingPolygons:function(n){try{if(!e.isArray(n))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=n.map(function(s){return s.map(function(l){try{if(function(s){return s instanceof e.Point||"number"==typeof s.x&&"number"==typeof s.y}(l))return{x:l.x,y:l.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})})}catch(s){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(s),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(n,r,s){var l=e.Placement.properties[r=r||e.Placement.CENTER],u=this.contentAspectX,v=0,d=0,m=1;if(r=1,this._clip&&(u=this._clip.getAspectRatio(),m=this._clip.width/this.source.dimensions.x,r=this._clip.height/this.source.dimensions.y,n.getAspectRatio()>u?(v=this._clip.x/this._clip.height*n.height,d=this._clip.y/this._clip.height*n.height):(v=this._clip.x/this._clip.width*n.width,d=this._clip.y/this._clip.width*n.width)),n.getAspectRatio()>u){var w=n.height/r;r=0,l.isHorizontallyCentered?r=(n.width-n.height*u)/2:l.isRight&&(r=n.width-n.height*u),this.setPosition(new e.Point(n.x-v+r,n.y-d),s),this.setHeight(w,s)}else w=n.width/m,m=0,l.isVerticallyCentered?m=(n.height-n.width/u)/2:l.isBottom&&(m=n.height-n.width/u),this.setPosition(new e.Point(n.x-v,n.y-d+m),s),this.setWidth(w,s)},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(n){e.console.assert(!n||n instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),this._clip=n instanceof e.Rect?n.clone():null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(n){this.flipped=!!n,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(n){n!==this.opacity&&(this.opacity=n,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(n){this._preload=!!n,this._needsDraw=!0},getRotation:function(n){return(n?this._degreesSpring.current:this._degreesSpring.target).value},setRotation:function(n,r){(this._degreesSpring.target.value!==n||!this._degreesSpring.isAtTargetValue())&&(r?this._degreesSpring.resetTo(n):this._degreesSpring.springTo(n),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(n){return this.getBoundsNoRotate(n).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(n){n!==this.compositeOperation&&(this.compositeOperation=n,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(n,r){var s=this._scaleSpring.target.value===n;if(r){if(s&&this._scaleSpring.current.value===n)return;this._scaleSpring.resetTo(n),this._updateForScale(),this._needsDraw=!0}else{if(s)return;this._scaleSpring.springTo(n),this._updateForScale(),this._needsDraw=!0}s||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var n=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),r=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value;return r=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(r/this.minPixelRatio)/Math.log(2)))),r=Math.max(r,this.source.minLevel||0),{lowestLevel:Math.min(n,r),highestLevel:r}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var n=this.viewport,r=this._viewportToTiledImageRectangle(n.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var s=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(r=r.intersection(s)))return}var l=(s=this._getLevelsInterval()).lowestLevel;s=s.highestLevel;for(var u=null,v=!1,d=e.now(),m=s;l<=m;m--){var w=!1,T=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(m),!0).x*this._scaleSpring.current.value;if(m===l||!v&&T>=this.minPixelRatio)v=w=!0;else if(!v)continue;var S=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(m),!1).x*this._scaleSpring.current.value,P=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value;if(P=this.immediateRender?1:P,T=Math.min(1,(T-.5)/.5),S=P/Math.abs(P-S),u=this._updateLevel(v,w,m,T,S,r,d,u),this._providesCoverage(this.coverage,m))break}this._drawTiles(this.lastDrawn),u&&!u.context2D?(this._loadTile(u,d),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(n,r,s){var l,u;this.wrapHorizontal?(l=e.positiveModulo(r.x,1),u=e.positiveModulo(s.x,1)):(l=Math.max(0,r.x),u=Math.min(1,s.x));var v=1/this.source.aspectRatio;this.wrapVertical?(d=e.positiveModulo(r.y,v),m=e.positiveModulo(s.y,v)):(d=Math.max(0,r.y),m=Math.min(v,s.y));var d=this.source.getTileAtPoint(n,new e.Point(l,d)),m=this.source.getTileAtPoint(n,new e.Point(u,m));return n=this.source.getNumTiles(n),this.wrapHorizontal&&(d.x+=n.x*Math.floor(r.x),m.x+=n.x*Math.floor(s.x)),this.wrapVertical&&(d.y+=n.y*Math.floor(r.y/v),m.y+=n.y*Math.floor(s.y/v)),{topLeft:d,bottomRight:m}},_updateLevel:function(n,r,s,l,u,v,d,m){var w=v.getBoundingBox().getTopLeft(),T=v.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:n,level:s,opacity:l,visibility:u,drawArea:v,topleft:w,bottomright:T,currenttime:d,best:m}),this._resetCoverage(this.coverage,s),this._resetCoverage(this.loadingCoverage,s);var S=(T=this._getCornerTiles(s,w,T)).topLeft,P=T.bottomRight,_=this.source.getNumTiles(s),R=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(P.x+=1,this.wrapHorizontal||(P.x=Math.min(P.x,_.x-1)));for(var C=S.x;C<=P.x;C++)for(var B=S.y;B<=P.y;B++){if(this.getFlip()){var D=(_.x+C%_.x)%_.x;D=C+_.x-D-D-1}else D=C;null!==v.intersection(this.getTileBounds(s,D,B))&&(m=this._updateTile(r,n,D,B,s,l,u,R,_,d,m))}return m},_updateTile:function(n,r,s,l,u,v,d,m,_,T,S){var P=this._getTile(s,l,u,T,_,this._worldWidthCurrent,this._worldHeightCurrent);return _=r,this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:P}),this._setCoverage(this.coverage,u,s,l,!1),r=P.loaded||P.loading||this._isCovered(this.loadingCoverage,u,s,l),this._setCoverage(this.loadingCoverage,u,s,l,r),!P.exists||(n&&!_&&(this._isCovered(this.coverage,u,s,l)?this._setCoverage(this.coverage,u,s,l,!0):_=!0),!_)||(this._positionTile(P,this.source.tileOverlap,this.viewport,m,d),P.loaded||(P.context2D?this._setTileLoaded(P):(d=this._tileCache.getImageRecord(P.cacheKey))&&(d=d.getImage(),this._setTileLoaded(P,d))),P.loaded?this._blendTile(P,s,l,u,v,T)&&(this._needsDraw=!0):P.loading?this._tilesLoading++:r||(S=this._compareTiles(S,P))),S},_getTile:function(n,r,s,l,u,v,d){var m,w,T,S,P,_,R,C,B,D=this.tilesMatrix,L=this.source;return D[s]||(D[s]={}),D[s][n]||(D[s][n]={}),(!D[s][n][r]||!D[s][n][r].flipped!=!this.flipped)&&(m=(u.x+n%u.x)%u.x,w=(u.y+r%u.y)%u.y,T=this.getTileBounds(s,n,r),S=L.getTileBounds(s,m,w,!0),P=L.tileExists(s,m,w),_=L.getTileUrl(s,m,w),B=L.getTilePostData(s,m,w),this.loadTilesWithAjax?(R=L.getTileAjaxHeaders(s,m,w),e.isPlainObject(this.ajaxHeaders)&&(R=e.extend({},this.ajaxHeaders,R))):R=null,C=L.getContext2D?L.getContext2D(s,m,w):void 0,B=new e.Tile(s,n,r,T,P,_,C,this.loadTilesWithAjax,R,S,B,L.getTileHashKey(s,m,w,_,R,B)),this.getFlip()?0==m&&(B.isRightMost=!0):m==u.x-1&&(B.isRightMost=!0),w==u.y-1&&(B.isBottomMost=!0),B.flipped=this.flipped,D[s][n][r]=B),(B=D[s][n][r]).lastTouchTime=l,B},_loadTile:function(n,r){var s=this;n.loading=!0,this._imageLoader.addJob({src:n.url,postData:n.postData,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(l,u,v){s._onTileLoad(n,r,l,u,v)},abort:function(){n.loading=!1}})},_onTileLoad:function(n,r,s,l,u){if(s)if(r<this.lastResetTime)e.console.warn("Ignoring tile %s loaded before reset: %s",n,n.url),n.loading=!1;else{let m=function(){var w=v.source.getClosestLevel();v._setTileLoaded(n,s,w,u)};var v=this;this._midDraw?window.setTimeout(m,1):m()}else e.console.error("Tile %s failed to load: %s - error: %s",n,n.url,l),this.viewer.raiseEvent("tile-load-failed",{tile:n,tiledImage:this,time:r,message:l,tileRequest:u}),n.loading=!1,n.exists=!1},_setTileLoaded:function(n,r,s,l){var u=0,v=this;function d(){return u++,m}function m(){0==--u&&(n.loading=!1,n.loaded=!0,n.context2D||v._tileCache.cacheTile({image:r,tile:n,cutoff:s,tiledImage:v}),v._needsDraw=!0)}this.viewer.raiseEvent("tile-loaded",{tile:n,tiledImage:this,tileRequest:l,image:r,getCompletionCallback:d}),d()()},_positionTile:function(n,r,s,l,u){(m=n.bounds.getTopLeft()).x*=this._scaleSpring.current.value,m.y*=this._scaleSpring.current.value,m.x+=this._xSpring.current.value,m.y+=this._ySpring.current.value,(w=n.bounds.getSize()).x*=this._scaleSpring.current.value,w.y*=this._scaleSpring.current.value;var v=s.pixelFromPointNoRotate(m,!0),d=s.pixelFromPointNoRotate(m,!1),m=s.deltaPixelsFromPointsNoRotate(w,!0),w=s.deltaPixelsFromPointsNoRotate(w,!1);w=d.plus(w.divide(2)),w=l.squaredDistanceTo(w),r||(m=m.plus(new e.Point(1,1))),n.isRightMost&&this.wrapHorizontal&&(m.x+=.75),n.isBottomMost&&this.wrapVertical&&(m.y+=.75),n.position=v,n.size=m,n.squaredDistance=w,n.visibility=u},_blendTile:function(n,r,s,l,u,v){var d,m=1e3*this.blendTime;if(n.blendStart||(n.blendStart=v),d=v-n.blendStart,v=m?Math.min(1,d/m):1,this.alwaysBlend&&(v*=u),n.opacity=v,this.lastDrawn.push(n),1===v)this._setCoverage(this.coverage,l,r,s,!0),this._hasOpaqueTile=!0;else if(d<m)return!0;return!1},_compareTiles:function(n,r){return!n||r.visibility>n.visibility||r.visibility===n.visibility&&r.squaredDistance<n.squaredDistance?r:n},_drawTiles:function(n){if(0!==this.opacity&&(0!==n.length||this.placeholderFillStyle)){var s,r=n[0];r&&(s=this.opacity<1||this.compositeOperation&&"source-over"!==this.compositeOperation||!this._isBottomItem()&&r._hasTransparencyChannel());var l,u,m,v=this.viewport.getZoom(!0),d=this.viewportToImageZoom(v);if(1<n.length&&d>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360==0&&e.supportsCanvas&&this.viewer.useCanvas&&(s=!0,l=r.getScaleForEdgeSmoothing(),u=r.getTranslationForEdgeSmoothing(l,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0))),s&&(l||(m=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(0===this.viewport.degrees&&this.getRotation(!0)%360==0||(m.x=this._drawer.viewer.container.clientWidth-(m.x+m.width))),m=m.times(e.pixelDensityRatio)),this._drawer._clear(!0,m)),l||(0!==this.viewport.degrees&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:s}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:s}),0===this.viewport.degrees&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip()),v=!1,this._clip&&(this._drawer.saveContext(s),d=(d=this.imageToViewportRectangle(this._clip,!0)).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),d=this._drawer.viewportToDrawerRectangle(d),l&&(d=d.times(l)),u&&(d=d.translate(u)),this._drawer.setClip(d,s),v=!0),this._croppingPolygons){this._drawer.saveContext(s);try{var w=this._croppingPolygons.map(function(_){return _.map(function(R){return R=this.imageToViewportCoordinates(R.x,R.y,!0).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),R=this._drawer.viewportCoordToDrawerCoord(R),l?R.times(l):R})});this._drawer.clipWithPolygons(w,s)}catch(_){e.console.error(_)}v=!0}if(this.placeholderFillStyle&&!1===this._hasOpaqueTile){w=this._drawer.viewportToDrawerRectangle(this.getBounds(!0)),l&&(w=w.times(l)),u&&(w=w.translate(u));var T=null;T="function"==typeof this.placeholderFillStyle?this.placeholderFillStyle(this,this._drawer.context):this.placeholderFillStyle,this._drawer.drawRectangle(w,T,s)}var S=!1;(T=function(_){if("number"==typeof _)return a(_);if(!_||!e.Browser)return t;var R=_[e.Browser.vendor];return i(R)&&(R=_["*"]),a(R)}(this.subPixelRoundingForTransparency))===e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS?S=!0:T===e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&(S=!(this.viewer&&this.viewer.isAnimating()));for(var P=n.length-1;0<=P;P--)this._drawer.drawTile(r=n[P],this._drawingHandler,s,l,u,S),r.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:r});v&&this._drawer.restoreContext(s),l||(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(s),0!==this.viewport.degrees&&this._drawer._restoreRotationChanges(s)),s&&(l&&(0!==this.viewport.degrees&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:!1}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:l,translate:u,compositeOperation:this.compositeOperation,bounds:m}),l&&(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(!1),0!==this.viewport.degrees&&this._drawer._restoreRotationChanges(!1))),l||0===this.viewport.degrees&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(n)}},_drawDebugInfo:function(n){if(this.debugMode)for(var r=n.length-1;0<=r;r--){var s=n[r];try{this._drawer.drawDebugInfo(s,n.length,r,this)}catch(l){e.console.error(l)}}},_providesCoverage:function(n,r,s,l){var u,v,d,m;if(!n[r])return!1;if(void 0!==s&&void 0!==l)return void 0===n[r][s]||void 0===n[r][s][l]||!0===n[r][s][l];for(d in u=n[r])if(Object.prototype.hasOwnProperty.call(u,d))for(m in v=u[d])if(Object.prototype.hasOwnProperty.call(v,m)&&!v[m])return!1;return!0},_isCovered:function(n,r,s,l){return void 0===s||void 0===l?this._providesCoverage(n,r+1):this._providesCoverage(n,r+1,2*s,2*l)&&this._providesCoverage(n,r+1,2*s,2*l+1)&&this._providesCoverage(n,r+1,2*s+1,2*l)&&this._providesCoverage(n,r+1,2*s+1,2*l+1)},_setCoverage:function(n,r,s,l,u){n[r]?(n[r][s]||(n[r][s]={}),n[r][s][l]=u):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",r)},_resetCoverage:function(n,r){n[r]={}}});var t=e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function i(n){return n!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&n!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&n!==e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function a(n){return i(n)?t:n}}(OpenSeadragon),function(e){function t(a){e.console.assert(a,"[TileCache.cacheTile] options is required"),e.console.assert(a.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(a.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=a.tile,this.tiledImage=a.tiledImage}function i(a){e.console.assert(a,"[ImageRecord] options is required"),e.console.assert(a.image,"[ImageRecord] options.image is required"),this._image=a.image,this._tiles=[]}i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var a=document.createElement("canvas");a.width=this._image.width,a.height=this._image.height,this._renderedContext=a.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(a){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=a},addTile:function(a){e.console.assert(a,"[ImageRecord.addTile] tile is required"),this._tiles.push(a)},removeTile:function(a){for(var n=0;n<this._tiles.length;n++)if(this._tiles[n]===a)return void this._tiles.splice(n,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",a)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(a){this._maxImageCacheCount=(a=a||{}).maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(a){e.console.assert(a,"[TileCache.cacheTile] options is required"),e.console.assert(a.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(a.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(a.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var n=a.cutoff||0,r=this._tilesLoaded.length,s=this._imagesLoaded[a.tile.cacheKey];if(s||(e.console.assert(a.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),s=this._imagesLoaded[a.tile.cacheKey]=new i({image:a.image}),this._imagesLoadedCount++),s.addTile(a.tile),a.tile.cacheImageRecord=s,this._imagesLoadedCount>this._maxImageCacheCount){for(var d,m,T,P,l=null,u=-1,v=null,_=this._tilesLoaded.length-1;0<=_;_--)(d=(P=this._tilesLoaded[_]).tile).level<=n||d.beingDrawn||(l?((T=d.lastTouchTime)<(m=l.lastTouchTime)||T===m&&l.level<d.level)&&(l=d,u=_,v=P):(l=d,u=_,v=P));l&&0<=u&&(this._unloadTile(v),r=u)}this._tilesLoaded[r]=new t({tile:a.tile,tiledImage:a.tiledImage})},clearTilesFor:function(a){e.console.assert(a,"[TileCache.clearTilesFor] tiledImage is required");for(var n,r=0;r<this._tilesLoaded.length;++r)(n=this._tilesLoaded[r]).tiledImage===a&&(this._unloadTile(n),this._tilesLoaded.splice(r,1),r--)},getImageRecord:function(a){return e.console.assert(a,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[a]},_unloadTile:function(a){e.console.assert(a,"[TileCache._unloadTile] tileRecord is required");var n=a.tile,r=a.tiledImage;n.unload(),n.cacheImageRecord=null,(a=this._imagesLoaded[n.cacheKey]).removeTile(n),a.getTileCount()||(a.destroy(),delete this._imagesLoaded[n.cacheKey],this._imagesLoadedCount--),r.viewer.raiseEvent("tile-unloaded",{tile:n,tiledImage:r})}}}(OpenSeadragon),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(a){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index?(i=Math.max(0,Math.min(this._items.length,i.index)),this._items.splice(i,0,t)):this._items.push(t),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==i,"[World.setItemIndex] index is required");var a=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==a&&-1!==a&&(this._items.splice(a,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:a,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);-1!==i&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var t,i;for(this.viewer._cancelPendingImages(),i=0;i<this._items.length;i++)(t=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var a=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<a.length;i++)this._raiseRemoveItem(t=a[i])},resetItems:function(){for(var t=0;t<this._items.length;t++)this._items[t].reset()},update:function(){for(var t=!1,i=0;i<this._items.length;i++)t=this._items[i].update()||t;return t},draw:function(){for(var t=0;t<this._items.length;t++)this._items[t].draw();this._needsDraw=!1},needsDraw:function(){for(var t=0;t<this._items.length;t++)if(this._items[t].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(t){(this._autoRefigureSizes=t)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var u,i=(t=t||{}).immediately||!1,a=t.layout||e.DEFAULT_SETTINGS.collectionLayout,r=t.columns||e.DEFAULT_SETTINGS.collectionColumns,s=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=s+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);u=!t.rows&&r?r:Math.ceil(this._items.length/(t.rows||e.DEFAULT_SETTINGS.collectionRows));var m,w,T,v=0,d=0;this.setAutoRefigureSizes(!1);for(var S=0;S<this._items.length;S++)S&&S%u==0&&("horizontal"===a?(d+=l,v=0):(v+=l,d=0)),T=(w=(T=(m=this._items[S]).getBounds()).width>T.height?s:s*(T.width/T.height))*(T.height/T.width),T=new e.Point(v+(s-w)/2,d+(s-T)/2),m.setPosition(T,i),m.setWidth(w,i),"horizontal"===a?v+=l:d+=l;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,a=this._contentFactor||0;if(this._items.length){var n=this._items[0],r=n.getBounds();this._contentFactor=n.getContentSize().x/r.width;for(var s=n.getClippedBounds().getBoundingBox(),l=s.x,u=s.y,v=s.x+s.width,d=s.y+s.height,m=1;m<this._items.length;m++)r=(n=this._items[m]).getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/r.width),s=n.getClippedBounds().getBoundingBox(),l=Math.min(l,s.x),u=Math.min(u,s.y),v=Math.max(v,s.x+s.width),d=Math.max(d,s.y+s.height);this._homeBounds=new e.Rect(l,u,v-l,d-u),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===a&&this._homeBounds.equals(t)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(t){this.raiseEvent("remove-item",{item:t})}})}(OpenSeadragon);